<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2506" height="1847"><desc>%0ATitle%20UMA%20wide%20ecosystem%20-%20Alice%20to%20Bob%20(push%20data)%20with%20DKIM%20signed%20claims%0A%0Aactor%20%22Alice%20(RqP)%5Cnalice%40gmail.com%2C%20alice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthN%20Server%5Cnfoo.com%22%20as%20authServer%20%23lightpink%0Aparticipant%20%22IMAP%20Server%5Cngmail.com%22%20as%20imapServer%20%23de5246%0Aparticipant%20%22SMTP%20Server%5Cngmail.com%22%20as%20smtpServer%20%23de5246%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnfoo.com%22%20as%20claimsProvider%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnfoo.com%22%20as%20rqpClient%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnbar.com%22%20as%20rsServer%20%23lightsteelblue%0Aparticipant%20%22AuthZ%20Server%5Cnbar.com%22%20as%20asServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RO)%5Cnbob%40outlook.com%2C%20bob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Anote%20right%20of%20Alice%3AIf%20Alice%20uses%20an%20email%20provider%20(gmail)%20that%20does%20not%20support%20webfinger%2C%5Cnshe%20must%20set%20up%20her%20mailbox%20to%20automatically%20forward%20emails%20sent%5Cnfrom%20challenge%40foo.com%20to%20response%40foo.com%0Aend%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Abox%20over%20claimsProvider%3AClaims%20Provider%20can%20send%20email%20messages%20from%20addresses%20challenge%40foo.com%20and%20retrieve%20from%20response%40foo.com%0Aend%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20foo.com%20AuthN%20server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20bar.com%20AuthZ%20server%0Anote%20right%20of%20rsServer%3Abar.com%20Admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%20set%5Cn'Incoming'%20and%20'Outgoing'%20with%20the%20bar.com%20AuthZ%20server%20with%20the%20associated%20scopes%3A%5Cn'Outgoing'%3A%20query%2C%20view%5Cn'Incoming'%3A%20create%0Anote%20over%20claimsProvider%3AClaims%20Provider%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Ffoo.com%2F.well-known%2Fclaims-provider-configuration%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20registered%20at%20Alice's%20AuthN%20server%20and%20is%20assigned%20'query-users'%2C%20'view-user'%20admin%20role%0AAlice-%3ErqpClient%3AInitiate%20request%0ArqpClient-%3ErsServer%3A1.%20Request%20Bob's%20'Incoming'%20resource%5Cn(scope%3Dcreate)%0ArqpClient%3C-rsServer%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Alice%20is%20involved%0AauthServer%3C-rqpClient%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Alice%20is%20not%20involved%0AauthServer%3C-rqpClient%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0AauthServer-%3ErqpClient%3A4.%20Return%20access_token%0Anote%20left%20of%20rqpClient%3Aticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0Aalt%20Get%20Claims%20%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20left%20of%20rqpClient%3AAlice's%20email_address%20is%20in%20access_token%20returned%20at%20step%203.%20a)%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%2C%20ticket_challenge)%0Aelse%20Get%20Claims%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20left%20of%20rqpClient%3A%20The%20email_address%20is%20determined%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%2C%20Alice's%20email_address%2C%20ticket_challenge)%0Aend%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users%2C%20view-users'%20admin%20role%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0AauthServer%3C-claimsProvider%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users%2C%20view-users)%0AauthServer-%3EclaimsProvider%3A7.%20Return%20access_token%0A%0Aalt%20Prepare%20email_address%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20over%20claimsProvider%3AUse%20Alices's%20email_address%20extracted%20from%20access_token%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20over%20claimsProvider%3AUse%20Alice's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Alice's%20user_claims%5Cn(access_token%2C%20Alice's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Alice's%20user_claims%0A%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0AsmtpServer%3C-claimsProvider%3A10.%20Send%20plain_message%20from%20challenge%40foo.com%20to%20alice%40gmail.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0AimapServer-%3EclaimsProvider%3A11.%20Retrieve%20dkim_signed_message%20sent%20from%20alice%40gmail.com%20to%20response%40foo.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0Aend%0AclaimsProvider-%3ErqpClient%3A12.%20Return%20claims_token%5Cn(Alice's%20user_claims%2C%20dkim_signed_message%20-%20optional)%5Cnif%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Aalt%20Domain%20part%20of%20email_address%20or%20Webfinger%20is%20used%20to%20locate%20Claims%20Provider%20configuration%20url%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrup%20discovery%20of%20Claims%20Provider%20config%20url%20via%20Webfinger%2C%20if%20it%20doesn't%20work%5Cnbuild%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%20%5Cn5.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20evaluate%20user_claims%5Cn8.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aelse%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Anote%20over%20asServer%3A1.%20extract%20dkim_signed%20_message%20from%20claims_token%5Cn2.%20verify%20DKIM%20signature%20of%20dkim_signed%20_message%5Cn3.%20extract%20'From%3A'%20part%20of%20dkim_signed_message%20e.g.%20Alice%20Henderson%20%3Calice%40gmail.com%3E%5Cn4.%20extract%20claims_provider_configuration_url%20and%20ticket_challenge%20from%20dkim_signed_message%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20extract%20user_claims%20from%20claims_token%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArqpClient-%3ErsServer%3A15.%20Post%20data%20into%20Bob's%20'Incoming'%20resource%5Cn(RPT)%0ArqpClient%3C-rsServer%3A16.%20201%20Created</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2506" height="1847"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1027.016616205434" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Alice to Bob (push data) with DKIM signed claims</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 78.15138224949999 L 73.48673024355469 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 78.15138224949999 L 406.58261939027346 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 503.66264149825065 78.15138224949999 L 503.66264149825065 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 693.7955853557377 78.15138224949999 L 693.7955853557377 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1229.017348732144 78.15138224949999 L 1229.017348732144 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 78.15138224949999 L 1546.9561795623524 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1824.9723652056337 78.15138224949999 L 1824.9723652056337 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2205.1410279961024 78.15138224949999 L 2205.1410279961024 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2433.1062861028604 78.15138224949999 L 2433.1062861028604 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 78.50038110255468 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 78.50037859572947 32.143922998476604 M 73.48673024355469 37.16258750749999 L 73.48673024355469 47.893559521499995 M 67.15369757955469 41.03277413549999 L 79.81976290755469 41.03277413549999 M 73.48673024355469 47.893559521499995 L 67.15369757955469 57.92086123949999 M 73.48673024355469 47.893559521499995 L 79.81976290755469 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="49.90221944033203" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com, alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 369.0433024265547 45.694589846499994 L 444.1219363539922 45.694589846499994 L 444.1219363539922 78.15138224949999 L 369.0433024265547 78.15138224949999 L 369.0433024265547 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="378.5868308160547" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="389.9919287774805" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 467.6833373519147 45.694589846499994 L 539.6419456445866 45.694589846499994 L 539.6419456445866 78.15138224949999 L 467.6833373519147 78.15138224949999 L 467.6833373519147 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="477.2268657414147" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="482.410161945028" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 656.2631119589134 45.694589846499994 L 731.3280587525619 45.694589846499994 L 731.3280587525619 78.15138224949999 L 656.2631119589134 78.15138224949999 L 656.2631119589134 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="665.8066403484135" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="672.543105802515" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1175.6775938411793 45.694589846499994 L 1282.357103623109 45.694589846499994 L 1282.357103623109 78.15138224949999 L 1175.6775938411793 78.15138224949999 L 1175.6775938411793 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1185.2211222306792" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1212.426658119351" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1515.1194001352549 45.694589846499994 L 1578.7929589894502 45.694589846499994 L 1578.7929589894502 78.15138224949999 L 1515.1194001352549 78.15138224949999 L 1515.1194001352549 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1524.6629285247548" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1530.3654889495594" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1769.5533714230673 45.694589846499994 L 1880.3913589882002 45.694589846499994 L 1880.3913589882002 78.15138224949999 L 1769.5533714230673 78.15138224949999 L 1769.5533714230673 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1779.0968998125672" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1808.381735627997" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2168.1209523653915 45.694589846499994 L 2242.161103626813 45.694589846499994 L 2242.161103626813 78.15138224949999 L 2168.1209523653915 78.15138224949999 L 2168.1209523653915 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2177.6644807548914" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2188.5503984184656" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2438.1199369618603 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 2438.119934455035 32.143922998476604 M 2433.1062861028604 37.16258750749999 L 2433.1062861028604 47.893559521499995 M 2426.7732534388606 41.03277413549999 L 2439.43931876686 41.03277413549999 M 2433.1062861028604 47.893559521499995 L 2426.7732534388606 57.92086123949999 M 2433.1062861028604 47.893559521499995 L 2439.43931876686 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2413.409256989091" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2363.7442713323526" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com, bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 78.50038110255468 1815.8211988279984 A 5.013650858999999 5.013650858999999 0 1 1 78.50037859572947 1815.816185177975 M 73.48673024355469 1820.8348496869983 L 73.48673024355469 1831.5658217009982 M 67.15369757955469 1824.7050363149983 L 79.81976290755469 1824.7050363149983 M 73.48673024355469 1831.5658217009982 L 67.15369757955469 1841.5931234189982 M 73.48673024355469 1831.5658217009982 L 79.81976290755469 1841.5931234189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="49.90221944033203" y="1798.6252559694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com, alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 369.0433024265547 1789.8293772694983 L 444.1219363539922 1789.8293772694983 L 444.1219363539922 1822.2861696724983 L 369.0433024265547 1822.2861696724983 L 369.0433024265547 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="378.5868308160547" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="389.9919287774805" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 467.6833373519147 1789.8293772694983 L 539.6419456445866 1789.8293772694983 L 539.6419456445866 1822.2861696724983 L 467.6833373519147 1822.2861696724983 L 467.6833373519147 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="477.2268657414147" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="482.410161945028" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 656.2631119589134 1789.8293772694983 L 731.3280587525619 1789.8293772694983 L 731.3280587525619 1822.2861696724983 L 656.2631119589134 1822.2861696724983 L 656.2631119589134 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="665.8066403484135" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="672.543105802515" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1175.6775938411793 1789.8293772694983 L 1282.357103623109 1789.8293772694983 L 1282.357103623109 1822.2861696724983 L 1175.6775938411793 1822.2861696724983 L 1175.6775938411793 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1185.2211222306792" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1212.426658119351" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1515.1194001352549 1789.8293772694983 L 1578.7929589894502 1789.8293772694983 L 1578.7929589894502 1822.2861696724983 L 1515.1194001352549 1822.2861696724983 L 1515.1194001352549 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1524.6629285247548" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1530.3654889495594" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1769.5533714230673 1789.8293772694983 L 1880.3913589882002 1789.8293772694983 L 1880.3913589882002 1822.2861696724983 L 1769.5533714230673 1822.2861696724983 L 1769.5533714230673 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1779.0968998125672" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1808.381735627997" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2168.1209523653915 1789.8293772694983 L 2242.161103626813 1789.8293772694983 L 2242.161103626813 1822.2861696724983 L 2168.1209523653915 1822.2861696724983 L 2168.1209523653915 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2177.6644807548914" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2188.5503984184656" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2438.1199369618603 1815.8211988279984 A 5.013650858999999 5.013650858999999 0 1 1 2438.119934455035 1815.816185177975 M 2433.1062861028604 1820.8348496869983 L 2433.1062861028604 1831.5658217009982 M 2426.7732534388606 1824.7050363149983 L 2439.43931876686 1824.7050363149983 M 2433.1062861028604 1831.5658217009982 L 2426.7732534388606 1841.5931234189982 M 2433.1062861028604 1831.5658217009982 L 2439.43931876686 1841.5931234189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2413.409256989091" y="1798.6252559694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2363.7442713323526" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com, bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 138.40315134449997 L 77.88466959355469 138.40315134449997 M 77.88466959355469 119.49201213949999 L 385.4725105102735 119.49201213949999 L 393.38880134027346 127.40830296949999 L 393.38880134027346 157.3142905495 L 77.88466959355469 157.3142905495 L 77.88466959355469 119.49201213949999 M 385.4725105102735 119.49201213949999 L 385.4725105102735 127.40830296949999 L 393.38880134027346 127.40830296949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="131.80624231949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">If Alice uses an email provider (gmail) that does not support webfinger,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="140.60212101949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">she must set up her mailbox to automatically forward emails sent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="149.39799971949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">from challenge@foo.com to response@foo.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 974.1829311742143 207.4507991395 L 1483.8517662900736 207.4507991395 L 1483.8517662900736 227.68132014949998 L 974.1829311742143 227.68132014949998 L 974.1829311742143 207.4507991395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="986.4971613542143" y="219.76502931949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider can send email messages from addresses challenge@foo.com and retrieve from response@foo.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1273.337933269071 254.06895624950002 L 1812.6581350256336 254.06895624950002 L 1820.5744258556335 261.9852470795 L 1820.5744258556335 274.2994772595 L 1273.337933269071 274.2994772595 L 1273.337933269071 254.06895624950002 M 1812.6581350256336 254.06895624950002 L 1812.6581350256336 261.9852470795 L 1820.5744258556335 261.9852470795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1285.6521634490712" y="266.38318642950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at foo.com AuthN server and pre-registered as a universal AEMS public client at bar.com AuthZ server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1824.9723652056337 310.8023738645 L 1829.3703045556335 310.8023738645 M 1829.3703045556335 287.4932953095 L 2192.8267978161025 287.4932953095 L 2200.7430886461025 295.4095861395 L 2200.7430886461025 334.1114524195 L 1829.3703045556335 334.1114524195 L 1829.3703045556335 287.4932953095 M 2192.8267978161025 287.4932953095 L 2192.8267978161025 295.4095861395 L 2200.7430886461025 295.4095861395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1841.6845347356336" y="299.8075254895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com Admin has set up the Resource Server and registers it's resource set</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1841.6845347356336" y="308.6034041895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming' and 'Outgoing' with the bar.com AuthZ server with the associated scopes:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1841.6845347356336" y="317.3992828895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing': query, view</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1841.6845347356336" y="326.1951615895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming': create</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 996.362298239644 347.30527046949993 L 1453.7561083946441 347.30527046949993 L 1461.672399224644 355.2215612994999 L 1461.672399224644 367.53579147949995 L 996.362298239644 367.53579147949995 L 996.362298239644 347.30527046949993 M 1453.7561083946441 347.30527046949993 L 1453.7561083946441 355.2215612994999 L 1461.672399224644 355.2215612994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.676528419644" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1237.3206781999174" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1242.5039972917143" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com/.well-known/claims-provider-configuration</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1229.017348732144 390.84487003449993 L 1224.619409382144 390.84487003449993 M 766.4875920885503 380.7296095294999 L 1216.7031185521441 380.7296095294999 L 1224.619409382144 388.6459003594999 L 1224.619409382144 400.9601305394999 L 766.4875920885503 400.9601305394999 L 766.4875920885503 380.7296095294999 M 1216.7031185521441 380.7296095294999 L 1216.7031185521441 388.6459003594999 L 1224.619409382144 388.6459003594999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="778.8018222685503" y="393.04383970949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is registered at Alice's AuthN server and is assigned 'query-users', 'view-user' admin role</text></g><g><g><rect fill="white" stroke="none" x="778.3077737815472" y="414.1539485894999" width="63.8273622428125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="779.6271555865472" y="422.0702394194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 425.58859089949993 L 1539.7142394326856 425.58859089949993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1546.9561795623524,425.58859089949993) translate(-1546.9561795623524,-425.58859089949993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1539.6262806456857 421.9236414411666 L 1546.9561795623524 425.58859089949993 L 1539.6262806456857 429.2535403578333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1607.826676162489" y="438.78240894949994" width="156.27519244300782" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1607.826676162489" y="447.57828764949994" width="65.1163026725" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1609.146057967489" y="446.6986997794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1609.146057967489" y="455.4945784794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=create)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 459.01292995949996 L 1817.7304250759669 459.01292995949996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1824.9723652056337,459.01292995949996) translate(-1824.9723652056337,-459.01292995949996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1817.642466288967 455.3479805011666 L 1824.9723652056337 459.01292995949996 L 1817.642466288967 462.6778794178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1626.0593498075086" y="472.20674800949996" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1627.3787316125085" y="480.12303883949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1824.9723652056337 483.6413903195 L 1554.1981196920192 483.6413903195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1546.9561795623524,483.6413903195) translate(-1546.9561795623524,-483.6413903195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1554.2860784790191 479.9764408611666 L 1546.9561795623524 483.6413903195 L 1554.2860784790191 487.30633977783333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="858.7845513627191" y="520.5840808595" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="858.7845513627191" y="529.3799595595" width="235.9696962271875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="860.1039331677191" y="528.5003716895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="860.1039331677191" y="537.2962503895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 540.8146018694999 L 413.8245595199401 540.8146018694999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,540.8146018694999) translate(-406.58261939027346,-540.8146018694999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 537.1496524111666 L 406.58261939027346 540.8146018694999 L 413.9125183069401 544.4795513278333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="862.1619012162347" y="577.7572924094999" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="862.1619012162347" y="586.5531711094999" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="863.4812830212347" y="585.6735832394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="863.4812830212347" y="594.4694619394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 597.9878134194998 L 413.8245595199401 597.9878134194998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,597.9878134194998) translate(-406.58261939027346,-597.9878134194998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 594.3228639611665 L 406.58261939027346 597.9878134194998 L 413.9125183069401 601.6527628778332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="926.4499718949456" y="624.3754495194999" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.7693536999457" y="632.2917403494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 635.8100918294998 L 1539.7142394326856 635.8100918294998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1546.9561795623524,635.8100918294998) translate(-1546.9561795623524,-635.8100918294998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1539.6262806456857 632.1451423711665 L 1546.9561795623524 635.8100918294998 L 1539.6262806456857 639.4750412878332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 659.1191703844997 L 1542.5582402123525 659.1191703844997 M 1286.4207619080164 649.0039098794998 L 1534.6419493823523 649.0039098794998 L 1542.5582402123523 656.9202007094998 L 1542.5582402123523 669.2344308894998 L 1286.4207619080164 669.2344308894998 L 1286.4207619080164 649.0039098794998 M 1534.6419493823523 649.0039098794998 L 1534.6419493823523 656.9202007094998 L 1542.5582402123523 656.9202007094998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1298.7349920880165" y="661.3181400594997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 716.2923819344998 L 1542.5582402123525 716.2923819344998 M 1260.012238348446 706.1771214294998 L 1534.6419493823523 706.1771214294998 L 1542.5582402123523 714.0934122594998 L 1542.5582402123523 726.4076424394998 L 1260.012238348446 726.4076424394998 L 1260.012238348446 706.1771214294998 M 1534.6419493823523 706.1771214294998 L 1534.6419493823523 714.0934122594998 L 1542.5582402123523 714.0934122594998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1272.3264685284462" y="718.4913516094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice's email_address is in access_token returned at step 3. a)</text></g><g><g><rect fill="white" stroke="none" x="1319.0019541806273" y="739.6014604894998" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1319.0019541806273" y="748.3973391894998" width="137.9696199332422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1320.3213359856272" y="747.5177513194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1320.3213359856272" y="756.3136300194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 759.8319814994998 L 1236.2592888618108 759.8319814994998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1229.017348732144,759.8319814994998) translate(-1229.017348732144,-759.8319814994998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1236.3472476488107 756.1670320411664 L 1229.017348732144 759.8319814994998 L 1236.3472476488107 763.4969309578331 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 806.8899325444996 L 1542.5582402123525 806.8899325444996 M 1320.3900612244227 796.7746720394997 L 1534.6419493823523 796.7746720394997 L 1542.5582402123523 804.6909628694997 L 1542.5582402123523 817.0051930494997 L 1320.3900612244227 817.0051930494997 L 1320.3900612244227 796.7746720394997 M 1534.6419493823523 796.7746720394997 L 1534.6419493823523 804.6909628694997 L 1542.5582402123523 804.6909628694997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1332.7042914044227" y="809.0889022194996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is determined by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="1271.4503184384398" y="830.1990110994997" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1271.4503184384398" y="838.9948897994997" width="233.0728914176172" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1272.7697002434397" y="838.1153019294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1272.7697002434397" y="846.9111806294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Alice's email_address, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 850.4295321094996 L 1236.2592888618108 850.4295321094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1229.017348732144,850.4295321094996) translate(-1229.017348732144,-850.4295321094996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1236.3472476488107 846.7645826511663 L 1229.017348732144 850.4295321094996 L 1236.3472476488107 854.094481567833 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1229.017348732144 886.9324287144996 L 1224.619409382144 886.9324287144996 M 698.1935247057378 876.8171682094996 L 1216.7031185521441 876.8171682094996 L 1224.619409382144 884.7334590394996 L 1224.619409382144 897.0476892194996 L 698.1935247057378 897.0476892194996 L 698.1935247057378 876.8171682094996 M 1216.7031185521441 876.8171682094996 L 1216.7031185521441 884.7334590394996 L 1224.619409382144 884.7334590394996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="710.5077548857378" y="889.1313983894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users, view-users' admin role, thus can query and view any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="689.9745902933181" y="910.2415072694996" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="689.9745902933181" y="919.0373859694996" width="255.65078753578126" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="691.2939720983181" y="918.1577980994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="691.2939720983181" y="926.9536767994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1229.017348732144 930.4720282794996 L 413.8245595199401 930.4720282794996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,930.4720282794996) translate(-406.58261939027346,-930.4720282794996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 926.8070788211662 L 406.58261939027346 930.4720282794996 L 413.9125183069401 934.1369777378329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="767.4805564798415" y="943.6658463294996" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="768.7999382848416" y="951.5821371594996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 955.1004886394995 L 1221.7754086024772 955.1004886394995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1229.017348732144,955.1004886394995) translate(-1229.017348732144,-955.1004886394995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1221.6874498154773 951.4355391811662 L 1229.017348732144 955.1004886394995 L 1221.6874498154773 958.7654380978329 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1041.6091854466752 992.0431791794996 L 1408.5092211876126 992.0431791794996 L 1416.4255120176126 999.9594700094996 L 1416.4255120176126 1012.2737001894996 L 1041.6091854466752 1012.2737001894996 L 1041.6091854466752 992.0431791794996 M 1408.5092211876126 992.0431791794996 L 1408.5092211876126 999.9594700094996 L 1416.4255120176126 999.9594700094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1053.9234156266753" y="1004.3574093594995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alices's email_address extracted from access_token from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1072.9710018529252 1049.2163907294994 L 1377.1474047813626 1049.2163907294994 L 1385.0636956113626 1057.1326815594994 L 1385.0636956113626 1069.4469117394995 L 1072.9710018529252 1069.4469117394995 L 1072.9710018529252 1049.2163907294994 M 1377.1474047813626 1049.2163907294994 L 1377.1474047813626 1057.1326815594994 L 1385.0636956113626 1057.1326815594994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1085.2852320329253" y="1061.5306209094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alice's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="737.303043357283" y="1095.8345478394992" width="142.66552752601564" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="737.303043357283" y="1104.6304265394992" width="160.99388140785157" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="738.622425162283" y="1103.7508386694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Alice's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="738.622425162283" y="1112.5467173694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Alice's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1229.017348732144 1116.0650688494993 L 413.8245595199401 1116.0650688494993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,1116.0650688494993) translate(-406.58261939027346,-1116.0650688494993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 1112.400119391166 L 406.58261939027346 1116.0650688494993 L 413.9125183069401 1119.7300183078326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="756.4899330057204" y="1129.2588868994992" width="122.62010211097656" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="757.8093148107205" y="1137.1751777294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Alice's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 1140.6935292094993 L 1221.7754086024772 1140.6935292094993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1229.017348732144,1140.6935292094993) translate(-1229.017348732144,-1140.6935292094993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1221.6874498154773 1137.028579751166 L 1229.017348732144 1140.6935292094993 L 1221.6874498154773 1144.3584786678325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="813.4718203463627" y="1177.636219749499" width="295.86929339515626" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="813.4718203463627" y="1186.432098449499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="814.7912021513628" y="1185.552510579499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Send plain_message from challenge@foo.com to alice@gmail.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="814.7912021513628" y="1194.348389279499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1229.017348732144 1197.8667407594992 L 701.0375254854043 1197.8667407594992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(693.7955853557377,1197.8667407594992) translate(-693.7955853557377,-1197.8667407594992)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 701.1254842724044 1194.201791301166 L 693.7955853557377 1197.8667407594992 L 701.1254842724044 1201.5316902178324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="686.615507719377" y="1211.060558809499" width="359.44897479164064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="686.615507719377" y="1219.856437509499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="687.934889524377" y="1218.976849639499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Retrieve dkim_signed_message sent from alice@gmail.com to response@foo.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="687.934889524377" y="1227.772728339499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 503.66264149825065 1231.2910798194991 L 1221.7754086024772 1231.2910798194991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1229.017348732144,1231.2910798194991) translate(-1229.017348732144,-1231.2910798194991)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1221.6874498154773 1227.626130361166 L 1229.017348732144 1231.2910798194991 L 1221.6874498154773 1234.9560292778324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1239.425805193811" y="1257.678715919499" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1239.425805193811" y="1266.474594619499" width="229.42907733070314" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1239.425805193811" y="1275.270473319499" width="297.121917906875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1240.7451869988108" y="1265.595006749499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1240.7451869988108" y="1274.390885449499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Alice's user_claims, dkim_signed_message - optional)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1240.7451869988108" y="1283.186764149499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1229.017348732144 1286.705115629499 L 1539.7142394326856 1286.705115629499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1546.9561795623524,1286.705115629499) translate(-1546.9561795623524,-1286.705115629499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1539.6262806456857 1283.0401661711658 L 1546.9561795623524 1286.705115629499 L 1539.6262806456857 1290.3700650878322 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1797.0911680801846" y="1299.898933679499" width="98.06091326820312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1797.0911680801846" y="1308.694812379499" width="157.91487139808595" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1798.4105498851845" y="1307.8152245094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1798.4105498851845" y="1316.6111032094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 1320.129454689499 L 2197.899087866436 1320.129454689499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2205.1410279961024,1320.129454689499) translate(-2205.1410279961024,-1320.129454689499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2197.811129079436 1316.4645052311657 L 2205.1410279961024 1320.129454689499 L 2197.811129079436 1323.7944041478322 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2029.4955295055554 1333.3232727394989 L 2372.870235656649 1333.3232727394989 L 2380.786526486649 1341.2395635694988 L 2380.786526486649 1371.145551149499 L 2029.4955295055554 1371.145551149499 L 2029.4955295055554 1333.3232727394989 M 2372.870235656649 1333.3232727394989 L 2372.870235656649 1341.2395635694988 L 2380.786526486649 1341.2395635694988" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2041.8097596855555" y="1345.637502919499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2041.8097596855555" y="1354.433381619499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2041.8097596855555" y="1363.229260319499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2022.2285006969616 1431.8371141794987 L 2380.137264465243 1431.8371141794987 L 2388.053555295243 1439.7534050094987 L 2388.053555295243 1522.4346647894988 L 2022.2285006969616 1522.4346647894988 L 2022.2285006969616 1431.8371141794987 M 2380.137264465243 1431.8371141794987 L 2380.137264465243 1439.7534050094987 L 2388.053555295243 1439.7534050094987" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1444.1513443594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1452.9472230594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1461.7431017594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrup discovery of Claims Provider config url via Webfinger, if it doesn't work</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1470.5389804594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1479.3348591594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature </text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1488.1307378594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1496.9266165594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1505.7224952594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2034.5427308769617" y="1514.5183739594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate other optional claims e.g. recipient_info, file_info</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1999.1654666393445 1559.3773553294986 L 2403.20029852286 1559.3773553294986 L 2411.11658935286 1567.2936461594986 L 2411.11658935286 1649.9749059394987 L 1999.1654666393445 1649.9749059394987 L 1999.1654666393445 1559.3773553294986 M 2403.20029852286 1559.3773553294986 L 2403.20029852286 1567.2936461594986 L 2411.11658935286 1567.2936461594986" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1571.6915855094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract dkim_signed _message from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1580.4874642094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. verify DKIM signature of dkim_signed _message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1589.2833429094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. extract 'From:' part of dkim_signed_message e.g. Alice Henderson &lt;alice@gmail.com&gt;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1598.0792216094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. extract claims_provider_configuration_url and ticket_challenge from dkim_signed_message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1606.8751003094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1615.6709790094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1624.4668577094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1633.2627364094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2011.4796968193446" y="1642.0586151094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="1842.3266951187588" y="1689.5563600894984" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1843.6460769237588" y="1697.4726509194984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2205.1410279961024 1700.9910023994985 L 1554.1981196920192 1700.9910023994985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1546.9561795623524,1700.9910023994985) translate(-1546.9561795623524,-1700.9910023994985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1554.2860784790191 1697.3260529411652 L 1546.9561795623524 1700.9910023994985 L 1554.2860784790191 1704.6559518578317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1594.0826957547742" y="1714.1848204494984" width="183.7631532584375" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1594.0826957547742" y="1722.9806991494984" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1595.4020775597742" y="1722.1011112794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Post data into Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1595.4020775597742" y="1730.8969899794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.9561795623524 1734.4153414594984 L 1817.7304250759669 1734.4153414594984" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1824.9723652056337,1734.4153414594984) translate(-1824.9723652056337,-1734.4153414594984)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1817.642466288967 1730.7503920011652 L 1824.9723652056337 1734.4153414594984 L 1817.642466288967 1738.0802909178317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1651.1947639310438" y="1747.6091595094983" width="69.53901690589844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1652.5141457360437" y="1755.5254503394983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 201 Created</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1824.9723652056337 1759.0438018194984 L 1554.1981196920192 1759.0438018194984" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1546.9561795623524,1759.0438018194984) translate(-1546.9561795623524,-1759.0438018194984)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1554.2860784790191 1755.3788523611652 L 1546.9561795623524 1759.0438018194984 L 1554.2860784790191 1762.7087512778317 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 42.70115479355469 95.7431396495 L 397.78674069027346 95.7431396495 L 397.78674069027346 170.5081085995 L 42.70115479355469 170.5081085995 L 42.70115479355469 95.7431396495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 42.70115479355469 95.7431396495 L 42.70115479355469 106.29819408949999 L 71.88020772578125 106.29819408949999 L 77.15773494578124 101.02066686949999 L 77.15773494578124 95.7431396495 L 42.70115479355469 95.7431396495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="51.497033493554696" y="102.77984260949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="85.95361364578125" y="102.77984260949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 969.7849918242143 183.7019266495 L 1488.2497056400737 183.7019266495 L 1488.2497056400737 240.8751381995 L 969.7849918242143 240.8751381995 L 969.7849918242143 183.7019266495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 969.7849918242143 183.7019266495 L 969.7849918242143 194.2569810895 L 998.9640447564409 194.2569810895 L 1004.2415719764409 188.9794538695 L 1004.2415719764409 183.7019266495 L 969.7849918242143 183.7019266495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="978.5808705242143" y="190.73862960949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1013.0374506764409" y="190.73862960949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 496.8352083695 L 1577.7417550123523 496.8352083695 L 1577.7417550123523 611.1816314694998 L 375.79704394027345 611.1816314694998 L 375.79704394027345 496.8352083695 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 496.8352083695 L 375.79704394027345 507.3902628095 L 402.08655524652346 507.3902628095 L 407.3640824665235 502.1127355895 L 407.3640824665235 496.8352083695 L 375.79704394027345 496.8352083695" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="384.59292264027346" y="503.8719113295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="416.1599611665235" y="503.8719113295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Alice is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 554.0084199194998 L 1577.7417550123523 554.0084199194998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="416.1599611665235" y="561.0451228794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Alice is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1198.231773282144 682.4282489394998 L 1577.7417550123523 682.4282489394998 L 1577.7417550123523 863.6233501594996 L 1198.231773282144 863.6233501594996 L 1198.231773282144 682.4282489394998 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1198.231773282144 682.4282489394998 L 1198.231773282144 692.9833033794998 L 1224.521284588394 692.9833033794998 L 1229.798811808394 687.7057761594998 L 1229.798811808394 682.4282489394998 L 1198.231773282144 682.4282489394998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1207.027651982144" y="689.4649518994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1238.594690508394" y="689.4649518994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1198.231773282144 773.0257995494997 L 1577.7417550123523 773.0257995494997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1238.594690508394" y="780.0625025094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1037.2112460966753 968.2943066894995 L 1420.8234513676127 968.2943066894995 L 1420.8234513676127 1082.6407297894993 L 1037.2112460966753 1082.6407297894993 L 1037.2112460966753 968.2943066894995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1037.2112460966753 968.2943066894995 L 1037.2112460966753 978.8493611294996 L 1063.5007574029253 978.8493611294996 L 1068.7782846229252 973.5718339094996 L 1068.7782846229252 968.2943066894995 L 1037.2112460966753 968.2943066894995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1046.0071247966753" y="975.3310096494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1077.5741633229252" y="975.3310096494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1037.2112460966753 1025.4675182394994 L 1420.8234513676127 1025.4675182394994" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1077.5741633229252" y="1032.5042211994994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 472.87706604825064 1153.8873472594992 L 1259.802924182144 1153.8873472594992 L 1259.802924182144 1244.484897869499 L 472.87706604825064 1244.484897869499 L 472.87706604825064 1153.8873472594992 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 472.87706604825064 1153.8873472594992 L 472.87706604825064 1164.4424016994992 L 502.0561189804772 1164.4424016994992 L 507.33364620047723 1159.164874479499 L 507.33364620047723 1153.8873472594992 L 472.87706604825064 1153.8873472594992" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="481.67294474825064" y="1160.9240502194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="516.1295249004772" y="1160.9240502194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1985.9716485893446 1384.3393691994988 L 2424.31040740286 1384.3393691994988 L 2424.31040740286 1676.3625420394985 L 1985.9716485893446 1676.3625420394985 L 1985.9716485893446 1384.3393691994988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1985.9716485893446 1384.3393691994988 L 1985.9716485893446 1394.8944236394989 L 2082.2435054766493 1394.8944236394989 L 2087.5210326966494 1389.6168964194987 L 2087.5210326966494 1384.3393691994988 L 1985.9716485893446 1384.3393691994988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1994.7675272893446" y="1391.3760721594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1994.7675272893446 1408.0882416894988 L 2415.5145287028604 1408.0882416894988 L 2415.5145287028604 1663.1687239894986 L 1994.7675272893446 1663.1687239894986 L 1994.7675272893446 1408.0882416894988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1994.7675272893446 1408.0882416894988 L 1994.7675272893446 1418.6432961294988 L 2021.0570385955946 1418.6432961294988 L 2026.3345658155945 1413.3657689094987 L 2026.3345658155945 1408.0882416894988 L 1994.7675272893446 1408.0882416894988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2003.5634059893446" y="1415.1249446494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2035.1304445155945" y="1415.1249446494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Domain part of email_address or Webfinger is used to locate Claims Provider configuration url]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1994.7675272893446 1535.6284828394987 L 2415.5145287028604 1535.6284828394987" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2035.1304445155945" y="1542.6651857994987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g/></g></g></svg>