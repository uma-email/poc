<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2662" height="1847"><desc>%0ATitle%20UMA%20wide%20ecosystem%20-%20Alice%20to%20Bob%20(push%20data)%0A%0Aactor%20%22Alice%20(RqP)%5Cnalice%40gmail.com%2C%20alice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthN%20Server%5Cnfoo.com%22%20as%20authServer%20%23lightpink%0Aparticipant%20%22IMAP%20Server%5Cngmail.com%22%20as%20imapServer%20%23de5246%0Aparticipant%20%22SMTP%20Server%5Cngmail.com%22%20as%20smtpServer%20%23de5246%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnfoo.com%22%20as%20claimsProvider%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnfoo.com%22%20as%20rqpClient%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnbar.com%22%20as%20rsServer%20%23lightsteelblue%0Aparticipant%20%22AuthZ%20Server%5Cnbar.com%22%20as%20asServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RO)%5Cnbob%40outlook.com%2C%20bob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Anote%20right%20of%20Alice%3AIf%20Alice%20uses%20an%20email%20provider%20(gmail)%20that%20does%20not%20support%20webfinger%2C%5Cnshe%20must%20set%20up%20her%20mailbox%20to%20automatically%20forward%20emails%20sent%5Cnfrom%20challenge%40foo.com%20to%20response%40foo.com%0Aend%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Abox%20over%20claimsProvider%3AClaims%20Provider%20can%20send%20email%20messages%20from%20addresses%20challenge%40foo.com%20and%20retrieve%20from%20response%40foo.com%0Aend%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20foo.com%20AuthN%20server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20bar.com%20AuthZ%20server%0Anote%20right%20of%20rsServer%3Abar.com%20Admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%20set%5Cn'Incoming'%20and%20'Outgoing'%20with%20the%20bar.com%20AuthZ%20server%20with%20the%20associated%20scopes%3A%5Cn'Outgoing'%3A%20query%2C%20view%5Cn'Incoming'%3A%20create%0Anote%20over%20claimsProvider%3AClaims%20Provider%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Ffoo.com%2F.well-known%2Fclaims-provider-configuration%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20registered%20at%20Alice's%20AuthN%20server%20and%20is%20assigned%20'query-users'%2C%20'view-users'%20admin%20roles%0AAlice-%3ErqpClient%3AInitiate%20request%0ArqpClient-%3ErsServer%3A1.%20Request%20Bob's%20'Incoming'%20resource%5Cn(scope%3Dcreate)%0ArqpClient%3C-rsServer%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Alice%20is%20involved%0AauthServer%3C-rqpClient%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Alice%20is%20not%20involved%0AauthServer%3C-rqpClient%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0AauthServer-%3ErqpClient%3A4.%20Return%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%0Anote%20left%20of%20rqpClient%3Aticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0Aalt%20Get%20Claims%20%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20left%20of%20rqpClient%3AAlice's%20email_address%20is%20in%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%20returned%20in%20request%203.%20a)%20%2F%204.%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20ticket_challenge)%0Aelse%20Get%20Claims%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20left%20of%20rqpClient%3A%20The%20email_address%20is%20determined%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20Alice's%20email_address%2C%20ticket_challenge)%0Aend%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users%2C%20view-users'%20admin%20roles%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0AauthServer%3C-claimsProvider%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users%2C%20view-users)%0AauthServer-%3EclaimsProvider%3A7.%20Return%20access_token%20%22audience%22%3A%5B%22realm-management%22%5D%0A%0Aalt%20Prepare%20email_address%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20over%20claimsProvider%3AUse%20Alices's%20email_address%20extracted%20from%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20over%20claimsProvider%3AUse%20Alice's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Alice's%20user_claims%5Cn(access_token%20%22audience%22%3A%5B%22realm-management%22%5D%2C%20Alice's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Alice's%20user_claims%0A%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0AsmtpServer%3C-claimsProvider%3A10.%20Send%20plain_message%20from%20challenge%40foo.com%20to%20alice%40gmail.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0AimapServer-%3EclaimsProvider%3A11.%20Retrieve%20dkim_signed_message%20sent%20from%20alice%40gmail.com%20to%20response%40foo.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0Aend%0AclaimsProvider-%3ErqpClient%3A12.%20Return%20claims_token%5Cn(Alice's%20user_claims%2C%20dkim_signed_message%20-%20optional)%5Cnif%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Aalt%20Domain%20part%20of%20email_address%20or%20Webfinger%20is%20used%20to%20locate%20Claims%20Provider%20configuration%20url%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrap%20discovery%20of%20Claims%20Provider%20config%20url%20via%20Webfinger%2C%20if%20it%20doesn't%20work%5Cnbuild%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%20%5Cn5.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20evaluate%20user_claims%5Cn8.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aelse%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Anote%20over%20asServer%3A1.%20extract%20dkim_signed%20_message%20from%20claims_token%5Cn2.%20verify%20DKIM%20signature%20of%20dkim_signed%20_message%5Cn3.%20extract%20'From%3A'%20part%20of%20dkim_signed_message%20e.g.%20Alice%20Henderson%20%3Calice%40gmail.com%3E%5Cn4.%20extract%20claims_provider_configuration_url%20and%20ticket_challenge%20from%20dkim_signed_message%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20extract%20user_claims%20from%20claims_token%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArqpClient-%3ErsServer%3A15.%20Post%20data%20into%20Bob's%20'Incoming'%20resource%5Cn(RPT)%0ArqpClient%3C-rsServer%3A16.%20201%20Created</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2662" height="1847"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1182.7795424394706" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Alice to Bob (push data)</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 78.15138224949999 L 73.48673024355469 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 78.15138224949999 L 406.58261939027346 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 527.5113353459069 78.15138224949999 L 527.5113353459069 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 717.6442792033939 78.15138224949999 L 717.6442792033939 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1257.5301050798003 78.15138224949999 L 1257.5301050798003 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 78.15138224949999 L 1702.1031257804252 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1980.1193114237064 78.15138224949999 L 1980.1193114237064 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2360.2879742141754 78.15138224949999 L 2360.2879742141754 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2588.2532323209334 78.15138224949999 L 2588.2532323209334 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 78.50038110255468 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 78.50037859572947 32.143922998476604 M 73.48673024355469 37.16258750749999 L 73.48673024355469 47.893559521499995 M 67.15369757955469 41.03277413549999 L 79.81976290755469 41.03277413549999 M 73.48673024355469 47.893559521499995 L 67.15369757955469 57.92086123949999 M 73.48673024355469 47.893559521499995 L 79.81976290755469 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="49.90221944033203" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com, alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 369.0433024265547 45.694589846499994 L 444.1219363539922 45.694589846499994 L 444.1219363539922 78.15138224949999 L 369.0433024265547 78.15138224949999 L 369.0433024265547 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="378.5868308160547" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="389.9919287774805" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 491.53203119957095 45.694589846499994 L 563.4906394922428 45.694589846499994 L 563.4906394922428 78.15138224949999 L 491.53203119957095 78.15138224949999 L 491.53203119957095 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.07555958907096" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.25885579268424" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 680.1118058065697 45.694589846499994 L 755.1767526002182 45.694589846499994 L 755.1767526002182 78.15138224949999 L 680.1118058065697 78.15138224949999 L 680.1118058065697 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="689.6553341960697" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="696.3917996501713" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1204.1903501888355 45.694589846499994 L 1310.8698599707652 45.694589846499994 L 1310.8698599707652 78.15138224949999 L 1204.1903501888355 78.15138224949999 L 1204.1903501888355 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1213.7338785783354" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1240.9394144670073" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1670.2663463533277 45.694589846499994 L 1733.939905207523 45.694589846499994 L 1733.939905207523 78.15138224949999 L 1670.2663463533277 78.15138224949999 L 1670.2663463533277 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1679.8098747428276" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1685.5124351676322" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1924.7003176411401 45.694589846499994 L 2035.538305206273 45.694589846499994 L 2035.538305206273 78.15138224949999 L 1924.7003176411401 78.15138224949999 L 1924.7003176411401 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1934.24384603064" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.5286818460697" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2323.2678985834646 45.694589846499994 L 2397.308049844886 45.694589846499994 L 2397.308049844886 78.15138224949999 L 2323.2678985834646 78.15138224949999 L 2323.2678985834646 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2332.8114269729645" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2343.6973446365387" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2593.2668831799333 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 2593.266880673108 32.143922998476604 M 2588.2532323209334 37.16258750749999 L 2588.2532323209334 47.893559521499995 M 2581.9201996569336 41.03277413549999 L 2594.586264984933 41.03277413549999 M 2588.2532323209334 47.893559521499995 L 2581.9201996569336 57.92086123949999 M 2588.2532323209334 47.893559521499995 L 2594.586264984933 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2568.556203207164" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2518.8912175504256" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com, bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 78.50038110255468 1815.8211988279984 A 5.013650858999999 5.013650858999999 0 1 1 78.50037859572947 1815.816185177975 M 73.48673024355469 1820.8348496869983 L 73.48673024355469 1831.5658217009982 M 67.15369757955469 1824.7050363149983 L 79.81976290755469 1824.7050363149983 M 73.48673024355469 1831.5658217009982 L 67.15369757955469 1841.5931234189982 M 73.48673024355469 1831.5658217009982 L 79.81976290755469 1841.5931234189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="49.90221944033203" y="1798.6252559694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com, alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 369.0433024265547 1789.8293772694983 L 444.1219363539922 1789.8293772694983 L 444.1219363539922 1822.2861696724983 L 369.0433024265547 1822.2861696724983 L 369.0433024265547 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="378.5868308160547" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="389.9919287774805" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 491.53203119957095 1789.8293772694983 L 563.4906394922428 1789.8293772694983 L 563.4906394922428 1822.2861696724983 L 491.53203119957095 1822.2861696724983 L 491.53203119957095 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.07555958907096" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.25885579268424" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 680.1118058065697 1789.8293772694983 L 755.1767526002182 1789.8293772694983 L 755.1767526002182 1822.2861696724983 L 680.1118058065697 1822.2861696724983 L 680.1118058065697 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="689.6553341960697" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="696.3917996501713" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1204.1903501888355 1789.8293772694983 L 1310.8698599707652 1789.8293772694983 L 1310.8698599707652 1822.2861696724983 L 1204.1903501888355 1822.2861696724983 L 1204.1903501888355 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1213.7338785783354" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1240.9394144670073" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1670.2663463533277 1789.8293772694983 L 1733.939905207523 1789.8293772694983 L 1733.939905207523 1822.2861696724983 L 1670.2663463533277 1822.2861696724983 L 1670.2663463533277 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1679.8098747428276" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1685.5124351676322" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1924.7003176411401 1789.8293772694983 L 2035.538305206273 1789.8293772694983 L 2035.538305206273 1822.2861696724983 L 1924.7003176411401 1822.2861696724983 L 1924.7003176411401 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1934.24384603064" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.5286818460697" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2323.2678985834646 1789.8293772694983 L 2397.308049844886 1789.8293772694983 L 2397.308049844886 1822.2861696724983 L 2323.2678985834646 1822.2861696724983 L 2323.2678985834646 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2332.8114269729645" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2343.6973446365387" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2593.2668831799333 1815.8211988279984 A 5.013650858999999 5.013650858999999 0 1 1 2593.266880673108 1815.816185177975 M 2588.2532323209334 1820.8348496869983 L 2588.2532323209334 1831.5658217009982 M 2581.9201996569336 1824.7050363149983 L 2594.586264984933 1824.7050363149983 M 2588.2532323209334 1831.5658217009982 L 2581.9201996569336 1841.5931234189982 M 2588.2532323209334 1831.5658217009982 L 2594.586264984933 1841.5931234189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2568.556203207164" y="1798.6252559694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2518.8912175504256" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com, bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 138.40315134449997 L 77.88466959355469 138.40315134449997 M 77.88466959355469 119.49201213949999 L 385.4725105102735 119.49201213949999 L 393.38880134027346 127.40830296949999 L 393.38880134027346 157.3142905495 L 77.88466959355469 157.3142905495 L 77.88466959355469 119.49201213949999 M 385.4725105102735 119.49201213949999 L 385.4725105102735 127.40830296949999 L 393.38880134027346 127.40830296949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="131.80624231949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">If Alice uses an email provider (gmail) that does not support webfinger,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="140.60212101949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">she must set up her mailbox to automatically forward emails sent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="149.39799971949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">from challenge@foo.com to response@foo.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1002.6956875218706 207.4507991395 L 1512.3645226377298 207.4507991395 L 1512.3645226377298 227.68132014949998 L 1002.6956875218706 227.68132014949998 L 1002.6956875218706 207.4507991395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1015.0099177018706" y="219.76502931949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider can send email messages from addresses challenge@foo.com and retrieve from response@foo.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1428.4848794871439 254.06895624950002 L 1967.8050812437064 254.06895624950002 L 1975.7213720737063 261.9852470795 L 1975.7213720737063 274.2994772595 L 1428.4848794871439 274.2994772595 L 1428.4848794871439 254.06895624950002 M 1967.8050812437064 254.06895624950002 L 1967.8050812437064 261.9852470795 L 1975.7213720737063 261.9852470795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1440.799109667144" y="266.38318642950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at foo.com AuthN server and pre-registered as a universal AEMS public client at bar.com AuthZ server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1980.1193114237064 310.8023738645 L 1984.5172507737063 310.8023738645 M 1984.5172507737063 287.4932953095 L 2347.973744034175 287.4932953095 L 2355.890034864175 295.4095861395 L 2355.890034864175 334.1114524195 L 1984.5172507737063 334.1114524195 L 1984.5172507737063 287.4932953095 M 2347.973744034175 287.4932953095 L 2347.973744034175 295.4095861395 L 2355.890034864175 295.4095861395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1996.8314809537064" y="299.8075254895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com Admin has set up the Resource Server and registers it's resource set</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1996.8314809537064" y="308.6034041895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming' and 'Outgoing' with the bar.com AuthZ server with the associated scopes:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1996.8314809537064" y="317.3992828895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing': query, view</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1996.8314809537064" y="326.1951615895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming': create</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1024.8750545873002 347.30527046949993 L 1482.2688647423001 347.30527046949993 L 1490.1851555723001 355.2215612994999 L 1490.1851555723001 367.53579147949995 L 1024.8750545873002 367.53579147949995 L 1024.8750545873002 347.30527046949993 M 1482.2688647423001 347.30527046949993 L 1482.2688647423001 355.2215612994999 L 1490.1851555723001 355.2215612994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1037.1892847673003" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1265.8334345475737" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1271.0167536393706" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com/.well-known/claims-provider-configuration</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1257.5301050798003 390.84487003449993 L 1253.1321657298004 390.84487003449993 M 785.6722234362065 380.7296095294999 L 1245.2158748998004 380.7296095294999 L 1253.1321657298004 388.6459003594999 L 1253.1321657298004 400.9601305394999 L 785.6722234362065 400.9601305394999 L 785.6722234362065 380.7296095294999 M 1245.2158748998004 380.7296095294999 L 1245.2158748998004 388.6459003594999 L 1253.1321657298004 388.6459003594999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="797.9864536162065" y="393.04383970949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is registered at Alice's AuthN server and is assigned 'query-users', 'view-users' admin roles</text></g><g><g><rect fill="white" stroke="none" x="855.8812468905837" y="414.1539485894999" width="63.8273622428125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="857.2006286955838" y="422.0702394194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 425.58859089949993 L 1694.8611856507584 425.58859089949993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1702.1031257804252,425.58859089949993) translate(-1702.1031257804252,-425.58859089949993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1694.7732268637585 421.9236414411666 L 1702.1031257804252 425.58859089949993 L 1694.7732268637585 429.2535403578333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1762.9736223805621" y="438.78240894949994" width="156.27519244300782" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1762.9736223805621" y="447.57828764949994" width="65.1163026725" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1764.293004185562" y="446.6986997794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1764.293004185562" y="455.4945784794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=create)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 459.01292995949996 L 1972.8773712940397 459.01292995949996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1980.1193114237064,459.01292995949996) translate(-1980.1193114237064,-459.01292995949996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1972.7894125070397 455.3479805011666 L 1980.1193114237064 459.01292995949996 L 1972.7894125070397 462.6778794178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1781.2062960255817" y="472.20674800949996" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1782.5256778305816" y="480.12303883949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1980.1193114237064 483.6413903195 L 1709.345065910092 483.6413903195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1702.1031257804252,483.6413903195) translate(-1702.1031257804252,-483.6413903195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1709.433024697092 479.9764408611666 L 1702.1031257804252 483.6413903195 L 1709.433024697092 487.30633977783333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="936.3580244717556" y="520.5840808595" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="936.3580244717556" y="529.3799595595" width="235.9696962271875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.6774062767556" y="528.5003716895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.6774062767556" y="537.2962503895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 540.8146018694999 L 413.8245595199401 540.8146018694999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,540.8146018694999) translate(-406.58261939027346,-540.8146018694999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 537.1496524111666 L 406.58261939027346 540.8146018694999 L 413.9125183069401 544.4795513278333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="939.7353743252712" y="577.7572924094999" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="939.7353743252712" y="586.5531711094999" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="941.0547561302712" y="585.6735832394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="941.0547561302712" y="594.4694619394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 597.9878134194998 L 413.8245595199401 597.9878134194998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,597.9878134194998) translate(-406.58261939027346,-597.9878134194998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 594.3228639611665 L 406.58261939027346 597.9878134194998 L 413.9125183069401 601.6527628778332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="941.6665724453884" y="624.3754495194999" width="225.3526002799219" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="942.9859542503884" y="632.2917403494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token "audience":["claims-provider"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 635.8100918294998 L 1694.8611856507584 635.8100918294998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1702.1031257804252,635.8100918294998) translate(-1702.1031257804252,-635.8100918294998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1694.7732268637585 632.1451423711665 L 1702.1031257804252 635.8100918294998 L 1694.7732268637585 639.4750412878332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 659.1191703844997 L 1697.7051864304253 659.1191703844997 M 1441.5677081260892 649.0039098794998 L 1689.7888956004251 649.0039098794998 L 1697.705186430425 656.9202007094998 L 1697.705186430425 669.2344308894998 L 1441.5677081260892 669.2344308894998 L 1441.5677081260892 649.0039098794998 M 1689.7888956004251 649.0039098794998 L 1689.7888956004251 656.9202007094998 L 1697.705186430425 656.9202007094998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1453.8819383060893" y="661.3181400594997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 716.2923819344998 L 1697.7051864304253 716.2923819344998 M 1261.9280444298001 706.1771214294998 L 1689.7888956004251 706.1771214294998 L 1697.705186430425 714.0934122594998 L 1697.705186430425 726.4076424394998 L 1261.9280444298001 726.4076424394998 L 1261.9280444298001 706.1771214294998 M 1689.7888956004251 706.1771214294998 L 1689.7888956004251 714.0934122594998 L 1697.705186430425 714.0934122594998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1274.2422746098002" y="718.4913516094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice's email_address is in access_token "audience":["claims-provider"] returned in request 3. a) / 4.</text></g><g><g><rect fill="white" stroke="none" x="1348.4749252755034" y="739.6014604894998" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1348.4749252755034" y="748.3973391894998" width="262.68338030921876" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1349.7943070805034" y="747.5177513194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1349.7943070805034" y="756.3136300194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 759.8319814994998 L 1264.772045209467 759.8319814994998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1257.5301050798003,759.8319814994998) translate(-1257.5301050798003,-759.8319814994998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1264.860003996467 756.1670320411664 L 1257.5301050798003 759.8319814994998 L 1264.860003996467 763.4969309578331 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 806.8899325444996 L 1697.7051864304253 806.8899325444996 M 1475.5370074424955 796.7746720394997 L 1689.7888956004251 796.7746720394997 L 1697.705186430425 804.6909628694997 L 1697.705186430425 817.0051930494997 L 1475.5370074424955 817.0051930494997 L 1475.5370074424955 796.7746720394997 M 1689.7888956004251 796.7746720394997 L 1689.7888956004251 804.6909628694997 L 1697.705186430425 804.6909628694997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1487.8512376224955" y="809.0889022194996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is determined by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="1300.923289533316" y="830.1990110994997" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1300.923289533316" y="838.9948897994997" width="357.78665179359376" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1302.2426713383159" y="838.1153019294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1302.2426713383159" y="846.9111806294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], Alice's email_address, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 850.4295321094996 L 1264.772045209467 850.4295321094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1257.5301050798003,850.4295321094996) translate(-1257.5301050798003,-850.4295321094996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1264.860003996467 846.7645826511663 L 1257.5301050798003 850.4295321094996 L 1264.860003996467 854.094481567833 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1257.5301050798003 886.9324287144996 L 1253.1321657298004 886.9324287144996 M 722.042218553394 876.8171682094996 L 1245.2158748998004 876.8171682094996 L 1253.1321657298004 884.7334590394996 L 1253.1321657298004 897.0476892194996 L 722.042218553394 897.0476892194996 L 722.042218553394 876.8171682094996 M 1245.2158748998004 876.8171682094996 L 1245.2158748998004 884.7334590394996 L 1253.1321657298004 884.7334590394996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="734.356448733394" y="889.1313983894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users, view-users' admin roles, thus can query and view any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="704.2309684671462" y="910.2415072694996" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="704.2309684671462" y="919.0373859694996" width="255.65078753578126" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="705.5503502721463" y="918.1577980994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="705.5503502721463" y="926.9536767994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1257.5301050798003 930.4720282794996 L 413.8245595199401 930.4720282794996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,930.4720282794996) translate(-406.58261939027346,-930.4720282794996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 926.8070788211662 L 406.58261939027346 930.4720282794996 L 413.9125183069401 934.1369777378329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="710.559780112654" y="943.6658463294996" width="242.99316424476564" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="711.8791619176541" y="951.5821371594996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token "audience":["realm-management"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 955.1004886394995 L 1250.2881649501335 955.1004886394995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1257.5301050798003,955.1004886394995) translate(-1257.5301050798003,-955.1004886394995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1250.2002061631335 951.4355391811662 L 1257.5301050798003 955.1004886394995 L 1250.2002061631335 958.7654380978329 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1007.7650692357378 992.0431791794996 L 1499.3788500938629 992.0431791794996 L 1507.2951409238628 999.9594700094996 L 1507.2951409238628 1012.2737001894996 L 1007.7650692357378 1012.2737001894996 L 1007.7650692357378 992.0431791794996 M 1499.3788500938629 992.0431791794996 L 1499.3788500938629 999.9594700094996 L 1507.2951409238628 999.9594700094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1020.0792994157378" y="1004.3574093594995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alices's email_address extracted from access_token "audience":["claims-provider"] from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1101.4837582005814 1049.2163907294994 L 1405.660161129019 1049.2163907294994 L 1413.5764519590189 1057.1326815594994 L 1413.5764519590189 1069.4469117394995 L 1101.4837582005814 1069.4469117394995 L 1101.4837582005814 1049.2163907294994 M 1405.660161129019 1049.2163907294994 L 1405.660161129019 1057.1326815594994 L 1413.5764519590189 1057.1326815594994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1113.7979883805815" y="1061.5306209094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alice's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="680.38227461949" y="1095.8345478394992" width="142.66552752601564" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="680.38227461949" y="1104.6304265394992" width="303.34817523109376" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="681.70165642449" y="1103.7508386694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Alice's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="681.70165642449" y="1112.5467173694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["realm-management"], Alice's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1257.5301050798003 1116.0650688494993 L 413.8245595199401 1116.0650688494993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,1116.0650688494993) translate(-406.58261939027346,-1116.0650688494993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 1112.400119391166 L 406.58261939027346 1116.0650688494993 L 413.9125183069401 1119.7300183078326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="770.7463111795486" y="1129.2588868994992" width="122.62010211097656" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="772.0656929845486" y="1137.1751777294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Alice's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 1140.6935292094993 L 1250.2881649501335 1140.6935292094993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1257.5301050798003,1140.6935292094993) translate(-1257.5301050798003,-1140.6935292094993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1250.2002061631335 1137.028579751166 L 1257.5301050798003 1140.6935292094993 L 1250.2002061631335 1144.3584786678325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="839.652545444019" y="1177.636219749499" width="295.86929339515626" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="839.652545444019" y="1186.432098449499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="840.971927249019" y="1185.552510579499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Send plain_message from challenge@foo.com to alice@gmail.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="840.971927249019" y="1194.348389279499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1257.5301050798003 1197.8667407594992 L 724.8862193330606 1197.8667407594992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(717.6442792033939,1197.8667407594992) translate(-717.6442792033939,-1197.8667407594992)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 724.9741781200606 1194.201791301166 L 717.6442792033939 1197.8667407594992 L 724.9741781200606 1201.5316902178324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="712.7962328170332" y="1211.060558809499" width="359.44897479164064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="712.7962328170332" y="1219.856437509499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="714.1156146220333" y="1218.976849639499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Retrieve dkim_signed_message sent from alice@gmail.com to response@foo.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="714.1156146220333" y="1227.772728339499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 527.5113353459069 1231.2910798194991 L 1250.2881649501335 1231.2910798194991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1257.5301050798003,1231.2910798194991) translate(-1257.5301050798003,-1231.2910798194991)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1250.2002061631335 1227.626130361166 L 1257.5301050798003 1231.2910798194991 L 1250.2002061631335 1234.9560292778324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1331.2556564766753" y="1257.678715919499" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1331.2556564766753" y="1266.474594619499" width="229.42907733070314" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1331.2556564766753" y="1275.270473319499" width="297.121917906875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1332.5750382816752" y="1265.595006749499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1332.5750382816752" y="1274.390885449499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Alice's user_claims, dkim_signed_message - optional)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1332.5750382816752" y="1283.186764149499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1257.5301050798003 1286.705115629499 L 1694.8611856507584 1286.705115629499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1702.1031257804252,1286.705115629499) translate(-1702.1031257804252,-1286.705115629499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1694.7732268637585 1283.0401661711658 L 1702.1031257804252 1286.705115629499 L 1694.7732268637585 1290.3700650878322 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1952.2381142982574" y="1299.898933679499" width="98.06091326820312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1952.2381142982574" y="1308.694812379499" width="157.91487139808595" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1953.5574961032573" y="1307.8152245094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1953.5574961032573" y="1316.6111032094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 1320.129454689499 L 2353.046034084509 1320.129454689499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2360.2879742141754,1320.129454689499) translate(-2360.2879742141754,-1320.129454689499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2352.958075297509 1316.4645052311657 L 2360.2879742141754 1320.129454689499 L 2352.958075297509 1323.7944041478322 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2184.642475723628 1333.3232727394989 L 2528.017181874722 1333.3232727394989 L 2535.933472704722 1341.2395635694988 L 2535.933472704722 1371.145551149499 L 2184.642475723628 1371.145551149499 L 2184.642475723628 1333.3232727394989 M 2528.017181874722 1333.3232727394989 L 2528.017181874722 1341.2395635694988 L 2535.933472704722 1341.2395635694988" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2196.9567059036285" y="1345.637502919499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2196.9567059036285" y="1354.433381619499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2196.9567059036285" y="1363.229260319499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2177.3754469150344 1431.8371141794987 L 2535.284210683316 1431.8371141794987 L 2543.200501513316 1439.7534050094987 L 2543.200501513316 1522.4346647894988 L 2177.3754469150344 1522.4346647894988 L 2177.3754469150344 1431.8371141794987 M 2535.284210683316 1431.8371141794987 L 2535.284210683316 1439.7534050094987 L 2543.200501513316 1439.7534050094987" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1444.1513443594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1452.9472230594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1461.7431017594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrap discovery of Claims Provider config url via Webfinger, if it doesn't work</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1470.5389804594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1479.3348591594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature </text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1488.1307378594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1496.9266165594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1505.7224952594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2189.6896770950348" y="1514.5183739594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate other optional claims e.g. recipient_info, file_info</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2154.3124128574173 1559.3773553294986 L 2558.347244740933 1559.3773553294986 L 2566.263535570933 1567.2936461594986 L 2566.263535570933 1649.9749059394987 L 2154.3124128574173 1649.9749059394987 L 2154.3124128574173 1559.3773553294986 M 2558.347244740933 1559.3773553294986 L 2558.347244740933 1567.2936461594986 L 2566.263535570933 1567.2936461594986" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1571.6915855094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract dkim_signed _message from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1580.4874642094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. verify DKIM signature of dkim_signed _message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1589.2833429094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. extract 'From:' part of dkim_signed_message e.g. Alice Henderson &lt;alice@gmail.com&gt;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1598.0792216094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. extract claims_provider_configuration_url and ticket_challenge from dkim_signed_message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1606.8751003094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1615.6709790094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1624.4668577094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1633.2627364094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2166.6266430374176" y="1642.0586151094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="1997.4736413368316" y="1689.5563600894984" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1998.7930231418316" y="1697.4726509194984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2360.2879742141754 1700.9910023994985 L 1709.345065910092 1700.9910023994985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1702.1031257804252,1700.9910023994985) translate(-1702.1031257804252,-1700.9910023994985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1709.433024697092 1697.3260529411652 L 1702.1031257804252 1700.9910023994985 L 1709.433024697092 1704.6559518578317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1749.2296419728473" y="1714.1848204494984" width="183.7631532584375" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1749.2296419728473" y="1722.9806991494984" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1750.5490237778472" y="1722.1011112794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Post data into Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1750.5490237778472" y="1730.8969899794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1702.1031257804252 1734.4153414594984 L 1972.8773712940397 1734.4153414594984" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1980.1193114237064,1734.4153414594984) translate(-1980.1193114237064,-1734.4153414594984)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1972.7894125070397 1730.7503920011652 L 1980.1193114237064 1734.4153414594984 L 1972.7894125070397 1738.0802909178317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1806.3417101491168" y="1747.6091595094983" width="69.53901690589844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1807.6610919541167" y="1755.5254503394983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 201 Created</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1980.1193114237064 1759.0438018194984 L 1709.345065910092 1759.0438018194984" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1702.1031257804252,1759.0438018194984) translate(-1702.1031257804252,-1759.0438018194984)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1709.433024697092 1755.3788523611652 L 1702.1031257804252 1759.0438018194984 L 1709.433024697092 1762.7087512778317 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 42.70115479355469 95.7431396495 L 397.78674069027346 95.7431396495 L 397.78674069027346 170.5081085995 L 42.70115479355469 170.5081085995 L 42.70115479355469 95.7431396495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 42.70115479355469 95.7431396495 L 42.70115479355469 106.29819408949999 L 71.88020772578125 106.29819408949999 L 77.15773494578124 101.02066686949999 L 77.15773494578124 95.7431396495 L 42.70115479355469 95.7431396495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="51.497033493554696" y="102.77984260949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="85.95361364578125" y="102.77984260949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 998.2977481718706 183.7019266495 L 1516.76246198773 183.7019266495 L 1516.76246198773 240.8751381995 L 998.2977481718706 240.8751381995 L 998.2977481718706 183.7019266495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 998.2977481718706 183.7019266495 L 998.2977481718706 194.2569810895 L 1027.4768011040971 194.2569810895 L 1032.754328324097 188.9794538695 L 1032.754328324097 183.7019266495 L 998.2977481718706 183.7019266495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1007.0936268718706" y="190.73862960949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1041.550207024097" y="190.73862960949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 496.8352083695 L 1732.888701230425 496.8352083695 L 1732.888701230425 611.1816314694998 L 375.79704394027345 611.1816314694998 L 375.79704394027345 496.8352083695 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 496.8352083695 L 375.79704394027345 507.3902628095 L 402.08655524652346 507.3902628095 L 407.3640824665235 502.1127355895 L 407.3640824665235 496.8352083695 L 375.79704394027345 496.8352083695" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="384.59292264027346" y="503.8719113295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="416.1599611665235" y="503.8719113295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Alice is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 554.0084199194998 L 1732.888701230425 554.0084199194998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="416.1599611665235" y="561.0451228794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Alice is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1226.7445296298004 682.4282489394998 L 1732.888701230425 682.4282489394998 L 1732.888701230425 863.6233501594996 L 1226.7445296298004 863.6233501594996 L 1226.7445296298004 682.4282489394998 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1226.7445296298004 682.4282489394998 L 1226.7445296298004 692.9833033794998 L 1253.0340409360504 692.9833033794998 L 1258.3115681560503 687.7057761594998 L 1258.3115681560503 682.4282489394998 L 1226.7445296298004 682.4282489394998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1235.5404083298004" y="689.4649518994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1267.1074468560503" y="689.4649518994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1226.7445296298004 773.0257995494997 L 1732.888701230425 773.0257995494997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1267.1074468560503" y="780.0625025094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1003.3671298857378 968.2943066894995 L 1511.6930802738627 968.2943066894995 L 1511.6930802738627 1082.6407297894993 L 1003.3671298857378 1082.6407297894993 L 1003.3671298857378 968.2943066894995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1003.3671298857378 968.2943066894995 L 1003.3671298857378 978.8493611294996 L 1029.6566411919878 978.8493611294996 L 1034.9341684119877 973.5718339094996 L 1034.9341684119877 968.2943066894995 L 1003.3671298857378 968.2943066894995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1012.1630085857378" y="975.3310096494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1043.7300471119877" y="975.3310096494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1003.3671298857378 1025.4675182394994 L 1511.6930802738627 1025.4675182394994" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1043.7300471119877" y="1032.5042211994994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 496.7257598959069 1153.8873472594992 L 1288.3156805298001 1153.8873472594992 L 1288.3156805298001 1244.484897869499 L 496.7257598959069 1244.484897869499 L 496.7257598959069 1153.8873472594992 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 496.7257598959069 1153.8873472594992 L 496.7257598959069 1164.4424016994992 L 525.9048128281335 1164.4424016994992 L 531.1823400481335 1159.164874479499 L 531.1823400481335 1153.8873472594992 L 496.7257598959069 1153.8873472594992" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="505.5216385959069" y="1160.9240502194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="539.9782187481335" y="1160.9240502194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2141.1185948074176 1384.3393691994988 L 2579.457353620933 1384.3393691994988 L 2579.457353620933 1676.3625420394985 L 2141.1185948074176 1676.3625420394985 L 2141.1185948074176 1384.3393691994988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2141.1185948074176 1384.3393691994988 L 2141.1185948074176 1394.8944236394989 L 2237.3904516947223 1394.8944236394989 L 2242.6679789147224 1389.6168964194987 L 2242.6679789147224 1384.3393691994988 L 2141.1185948074176 1384.3393691994988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2149.9144735074174" y="1391.3760721594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2149.9144735074174 1408.0882416894988 L 2570.6614749209334 1408.0882416894988 L 2570.6614749209334 1663.1687239894986 L 2149.9144735074174 1663.1687239894986 L 2149.9144735074174 1408.0882416894988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2149.9144735074174 1408.0882416894988 L 2149.9144735074174 1418.6432961294988 L 2176.2039848136674 1418.6432961294988 L 2181.4815120336675 1413.3657689094987 L 2181.4815120336675 1408.0882416894988 L 2149.9144735074174 1408.0882416894988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2158.710352207417" y="1415.1249446494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2190.2773907336673" y="1415.1249446494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Domain part of email_address or Webfinger is used to locate Claims Provider configuration url]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2149.9144735074174 1535.6284828394987 L 2570.6614749209334 1535.6284828394987" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2190.2773907336673" y="1542.6651857994987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g/></g></g></svg>