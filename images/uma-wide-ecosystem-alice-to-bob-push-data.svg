<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1674" height="1436"><desc>Title%20UMA%20wide%20ecosystem%20-%20Alice%20to%20Bob%20(push%20data)%0A%0Aactor%20%22Alice%20(RqP)%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthN%20Server%5Cnfoo.com%22%20as%20authServer%20%23lightpink%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnfoo.com%22%20as%20claimsProvider%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnfoo.com%22%20as%20rqpClient%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnbar.com%22%20as%20rsServer%20%23lightsteelblue%0Aparticipant%20%22AuthZ%20Server%5Cnbar.com%22%20as%20asServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RO)%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20Alice's%20AuthN%20server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20Bob's%20AuthZ%20server%0Anote%20right%20of%20rsServer%3AResource%20Server%20registers%20it's%20resource%20set%20'Incoming'%20and%20'Outgoing'%5Cnwith%20the%20Bob's%20AuthZ%20server%20with%20the%20associated%20scopes%3A%5Cn'Outgoing'%3A%20query%5Cn'Incoming'%3A%20write%0Anote%20over%20claimsProvider%3AClaims%20Provider%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Ffoo.com%2F.well-known%2Fclaims-provider-configuration%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20registered%20at%20Alice's%20AuthN%20server%20and%20is%20assigned%20'query-users'%20admin%20role%0AAlice-%3ErqpClient%3AInitiate%20request%0ArqpClient-%3ErsServer%3A1.%20Request%20Bob's%20'Incoming'%20resource%0ArqpClient%3C-rsServer%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Alice%20is%20involved%0AauthServer%3C-rqpClient%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Alice%20is%20not%20involved%0AauthServer%3C-rqpClient%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0AauthServer-%3ErqpClient%3A4.%20Return%20access_token%0Anote%20left%20of%20rqpClient%3Aticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0Aalt%20Get%20Claims%20%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20left%20of%20rqpClient%3AAlice's%20email_address%20is%20in%20access_token%20returned%20at%20step%203.%20a)%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%2C%20ticket_challenge)%0Aelse%20Get%20Claims%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20left%20of%20rqpClient%3A%20The%20email_address%20is%20determined%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%2C%20Alice's%20email_address%2C%20ticket_challenge)%0Aend%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users'%20admin%20role%2C%20thus%20can%20query%20any%20user%20to%20get%20their%20claims%0AauthServer%3C-claimsProvider%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users)%0AauthServer-%3EclaimsProvider%3A7.%20Return%20access_token%0A%0Aalt%20Prepare%20email_address%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20over%20claimsProvider%3AUse%20Alices's%20email_address%20extracted%20from%20access_token%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20over%20claimsProvider%3AUse%20Alice's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%20Alice's%20user_claims%5Cn(access_token%2C%20Alice's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Alice's%20user_claims%0A%0AclaimsProvider-%3ErqpClient%3A10.%20Return%20claims_token%5Cn(Alice's%20user_claims%2C%20ticket_challenge)%0ArqpClient-%3EasServer%3A11.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token%20%2B%20metadata)%0Agroup%20Authorization%20process%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Anote%20over%20asServer%3AAuthZ%20Server%20uses%20domain%20part%20of%20Alice's%20email_address%20extracted%20from%20claims_token%5Cnto%20load%20Claims%20Provider%20configuration%20from%20URL%3A%5Cn'https%3A%2F%2F'%20%2B%20domain_part_of_email_address%20%2B%20'%2F.well-known%2Fclaims-provider-configuration'%0Anote%20over%20asServer%3AAuthZ%20Server%20evaluates%3A%5Cn1.%20domain%20part%20of%20email_address%20vs.%20claims%20issuer%5Cn2.%20ticket%5Cn3.%20ticket_challenge%20vs.%20ticket%5Cn4.%20claims_token%20signature%5Cn5.%20user_claims%5Cn6.%20other_claims%20(recipient_info%2C%20file_info)%0Aend%0ArqpClient%3C-asServer%3A12.%20Return%20RPT%0ArqpClient-%3ErsServer%3A13.%20Post%20data%20into%20Bob's%20'Incoming'%20resource%5Cn(RPT)%0ArqpClient%3C-rsServer%3A14.%20201%20Created</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1674" height="1436"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="689.0702723276406" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Alice to Bob (push data)</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 35.31561055361328 78.15138224949999 L 35.31561055361328 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 112.56847742094533 78.15138224949999 L 112.56847742094533 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 558.6217837661015 78.15138224949999 L 558.6217837661015 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 78.15138224949999 L 849.9636643300078 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1119.651496091453 78.15138224949999 L 1119.651496091453 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1435.2155446241093 78.15138224949999 L 1435.2155446241093 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1641.089613056746 78.15138224949999 L 1641.089613056746 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 32.143922998476604 M 35.31561055361328 37.16258750749999 L 35.31561055361328 47.893559521499995 M 28.98257788961328 41.03277413549999 L 41.648643217613284 41.03277413549999 M 35.31561055361328 47.893559521499995 L 28.98257788961328 57.92086123949999 M 35.31561055361328 47.893559521499995 L 41.648643217613284 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="11.731099750390626" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 75.02916045722657 45.694589846499994 L 150.1077943846641 45.694589846499994 L 150.1077943846641 78.15138224949999 L 75.02916045722657 78.15138224949999 L 75.02916045722657 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="84.57268884672658" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="95.97778680815236" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 505.2820288751367 45.694589846499994 L 611.9615386570664 45.694589846499994 L 611.9615386570664 78.15138224949999 L 505.2820288751367 78.15138224949999 L 505.2820288751367 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="514.8255572646367" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.0310931533086" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 818.1268849029101 45.694589846499994 L 881.8004437571054 45.694589846499994 L 881.8004437571054 78.15138224949999 L 818.1268849029101 78.15138224949999 L 818.1268849029101 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="827.6704132924101" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="833.3729737172148" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1064.2325023088868 45.694589846499994 L 1175.0704898740196 45.694589846499994 L 1175.0704898740196 78.15138224949999 L 1064.2325023088868 78.15138224949999 L 1064.2325023088868 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1073.7760306983866" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1103.0608665138163" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1398.1954689933984 45.694589846499994 L 1472.2356202548203 45.694589846499994 L 1472.2356202548203 78.15138224949999 L 1398.1954689933984 78.15138224949999 L 1398.1954689933984 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1407.7389973828983" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.6249150464726" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1646.103263915746 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 1646.1032614089208 32.143922998476604 M 1641.089613056746 37.16258750749999 L 1641.089613056746 47.893559521499995 M 1634.756580392746 41.03277413549999 L 1647.422645720746 41.03277413549999 M 1641.089613056746 47.893559521499995 L 1634.756580392746 57.92086123949999 M 1641.089613056746 47.893559521499995 L 1647.422645720746 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1621.3925839429764" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1611.9825192457108" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 1405.0536635379992 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 1405.048649887976 M 35.31561055361328 1410.067314396999 L 35.31561055361328 1420.798286410999 M 28.98257788961328 1413.9375010249992 L 41.648643217613284 1413.9375010249992 M 35.31561055361328 1420.798286410999 L 28.98257788961328 1430.825588128999 M 35.31561055361328 1420.798286410999 L 41.648643217613284 1430.825588128999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="11.731099750390626" y="1387.8577206794992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1396.6535993794992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 75.02916045722657 1379.0618419794991 L 150.1077943846641 1379.0618419794991 L 150.1077943846641 1411.5186343824992 L 75.02916045722657 1411.5186343824992 L 75.02916045722657 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="84.57268884672658" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="95.97778680815236" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 505.2820288751367 1379.0618419794991 L 611.9615386570664 1379.0618419794991 L 611.9615386570664 1411.5186343824992 L 505.2820288751367 1411.5186343824992 L 505.2820288751367 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="514.8255572646367" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="542.0310931533086" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 818.1268849029101 1379.0618419794991 L 881.8004437571054 1379.0618419794991 L 881.8004437571054 1411.5186343824992 L 818.1268849029101 1411.5186343824992 L 818.1268849029101 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="827.6704132924101" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="833.3729737172148" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1064.2325023088868 1379.0618419794991 L 1175.0704898740196 1379.0618419794991 L 1175.0704898740196 1411.5186343824992 L 1064.2325023088868 1411.5186343824992 L 1064.2325023088868 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1073.7760306983866" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1103.0608665138163" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1398.1954689933984 1379.0618419794991 L 1472.2356202548203 1379.0618419794991 L 1472.2356202548203 1411.5186343824992 L 1398.1954689933984 1411.5186343824992 L 1398.1954689933984 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1407.7389973828983" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1418.6249150464726" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1646.103263915746 1405.0536635379992 A 5.013650858999999 5.013650858999999 0 1 1 1646.1032614089208 1405.048649887976 M 1641.089613056746 1410.067314396999 L 1641.089613056746 1420.798286410999 M 1634.756580392746 1413.9375010249992 L 1647.422645720746 1413.9375010249992 M 1641.089613056746 1420.798286410999 L 1634.756580392746 1430.825588128999 M 1641.089613056746 1420.798286410999 L 1647.422645720746 1430.825588128999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1621.3925839429764" y="1387.8577206794992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1611.9825192457108" y="1396.6535993794992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 584.6737719185625 95.7431396495 L 1107.337265911453 95.7431396495 L 1115.253556741453 103.65943047949999 L 1115.253556741453 115.97366065949998 L 584.6737719185625 115.97366065949998 L 584.6737719185625 95.7431396495 M 1107.337265911453 95.7431396495 L 1107.337265911453 103.65943047949999 L 1115.253556741453 103.65943047949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="596.9880020985624" y="108.0573698295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at Alice's AuthN server and pre-registered as a universal AEMS public client at Bob's AuthZ server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1119.651496091453 152.4765572645 L 1124.049435441453 152.4765572645 M 1124.049435441453 129.1674787095 L 1422.9013144441092 129.1674787095 L 1430.8176052741092 137.0837695395 L 1430.8176052741092 175.7856358195 L 1124.049435441453 175.7856358195 L 1124.049435441453 129.1674787095 M 1422.9013144441092 129.1674787095 L 1422.9013144441092 137.0837695395 L 1430.8176052741092 137.0837695395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1136.363665621453" y="141.48170888950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server registers it's resource set 'Incoming' and 'Outgoing'</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1136.363665621453" y="150.27758758950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">with the Bob's AuthZ server with the associated scopes:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1136.363665621453" y="159.07346628950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing': query</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1136.363665621453" y="167.86934498950004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming': write</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 325.96673327360156 188.9794538695 L 783.3605434286017 188.9794538695 L 791.2768342586016 196.8957446995 L 791.2768342586016 209.20997487949998 L 325.96673327360156 209.20997487949998 L 325.96673327360156 188.9794538695 M 783.3605434286017 188.9794538695 L 783.3605434286017 196.8957446995 L 791.2768342586016 196.8957446995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="338.28096345360154" y="201.29368404949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="566.925113233875" y="201.29368404949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="572.1084323256719" y="201.29368404949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com/.well-known/claims-provider-configuration</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 558.6217837661015 232.51905343449997 L 554.2238444161015 232.51905343449997 M 144.75041335297652 222.40379292949999 L 546.3075535861016 222.40379292949999 L 554.2238444161015 230.3200837595 L 554.2238444161015 242.63431393949998 L 144.75041335297652 242.63431393949998 L 144.75041335297652 222.40379292949999 M 546.3075535861016 222.40379292949999 L 546.3075535861016 230.3200837595 L 554.2238444161015 230.3200837595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="157.06464353297656" y="234.71802310949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is registered at Alice's AuthN server and is assigned 'query-users' admin role</text></g><g><g><rect fill="white" stroke="none" x="410.7259563204043" y="255.8281319895" width="63.8273622428125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="412.04533812540427" y="263.7444228195" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 35.31561055361328 267.2627742995 L 842.7217242003411 267.2627742995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(849.9636643300078,267.2627742995) translate(-849.9636643300078,-267.2627742995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 842.633765413341 263.59782484116664 L 849.9636643300078 267.2627742995 L 842.633765413341 270.92772375783335 Z"/></g></g><g><g><rect fill="white" stroke="none" x="906.6699839892265" y="280.4565923495" width="156.27519244300782" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="907.9893657942265" y="288.3728831795" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Bob's 'Incoming' resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 291.8912346595 L 1112.4095559617863 291.8912346595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1119.651496091453,291.8912346595) translate(-1119.651496091453,-291.8912346595)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1112.3215971747863 288.22628520116666 L 1119.651496091453 291.8912346595 L 1112.3215971747863 295.55618411783337 Z"/></g></g><g><g><rect fill="white" stroke="none" x="924.902657634246" y="305.0850527095" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="926.222039439246" y="313.0013435395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1119.651496091453 316.51969501950003 L 857.2056044596744 316.51969501950003" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(849.9636643300078,316.51969501950003) translate(-849.9636643300078,-316.51969501950003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 857.2935632466745 312.8547455611667 L 849.9636643300078 316.51969501950003 L 857.2935632466745 320.1846444778334 Z"/></g></g><g><g><rect fill="white" stroke="none" x="363.2812227618828" y="353.4623855595" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="363.2812227618828" y="362.2582642595" width="235.9696962271875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="364.6006045668828" y="361.37867638949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="364.6006045668828" y="370.17455508949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 373.6929065695 L 119.81041755061199 373.6929065695" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(112.56847742094533,373.6929065695) translate(-112.56847742094533,-373.6929065695)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 119.89837633761199 370.02795711116664 L 112.56847742094533 373.6929065695 L 119.89837633761199 377.35785602783335 Z"/></g></g><g><g><rect fill="white" stroke="none" x="366.65857261539844" y="410.6355971095" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="366.65857261539844" y="419.4314758095" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="367.9779544203984" y="418.5518879395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="367.9779544203984" y="427.3477666395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 430.8661181195 L 119.81041755061199 430.8661181195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(112.56847742094533,430.8661181195) translate(-112.56847742094533,-430.8661181195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 119.89837633761199 427.20116866116666 L 112.56847742094533 430.8661181195 L 119.89837633761199 434.53106757783337 Z"/></g></g><g><g><rect fill="white" stroke="none" x="430.9466432941094" y="457.2537542195" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="432.26602509910936" y="465.1700450495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 112.56847742094533 468.68839652950004 L 842.7217242003411 468.68839652950004" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(849.9636643300078,468.68839652950004) translate(-849.9636643300078,-468.68839652950004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 842.633765413341 465.0234470711667 L 849.9636643300078 468.68839652950004 L 842.633765413341 472.3533459878334 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 491.9974750845001 L 845.5657249800078 491.9974750845001 M 589.4282466756719 481.88221457950004 L 837.6494341500079 481.88221457950004 L 845.5657249800079 489.7985054095 L 845.5657249800079 502.11273558950006 L 589.4282466756719 502.11273558950006 L 589.4282466756719 481.88221457950004 M 837.6494341500079 481.88221457950004 L 837.6494341500079 489.7985054095 L 845.5657249800079 489.7985054095" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="601.7424768556718" y="494.1964447595001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 549.1706866344999 L 845.5657249800078 549.1706866344999 M 563.0197231161015 539.0554261295 L 837.6494341500079 539.0554261295 L 845.5657249800079 546.9717169595 L 845.5657249800079 559.2859471395 L 563.0197231161015 559.2859471395 L 563.0197231161015 539.0554261295 M 837.6494341500079 539.0554261295 L 837.6494341500079 546.9717169595 L 845.5657249800079 546.9717169595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="575.3339532961015" y="551.3696563094999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice's email_address is in access_token returned at step 3. a)</text></g><g><g><rect fill="white" stroke="none" x="635.3079140814335" y="572.4797651895" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="635.3079140814335" y="581.2756438895" width="137.9696199332422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="636.6272958864336" y="580.3960560195" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="636.6272958864336" y="589.1919347195" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 592.7102861994999 L 565.8637238957682 592.7102861994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(558.6217837661015,592.7102861994999) translate(-558.6217837661015,-592.7102861994999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 565.9516826827683 589.0453367411666 L 558.6217837661015 592.7102861994999 L 565.9516826827683 596.3752356578333 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 639.7682372444998 L 845.5657249800078 639.7682372444998 M 623.3975459920781 629.6529767394999 L 837.6494341500078 629.6529767394999 L 845.5657249800078 637.5692675694999 L 845.5657249800078 649.8834977494998 L 623.3975459920781 649.8834977494998 L 623.3975459920781 629.6529767394999 M 837.6494341500078 629.6529767394999 L 837.6494341500078 637.5692675694999 L 845.5657249800078 637.5692675694999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="635.7117761720781" y="641.9672069194997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is determined by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="587.756278339246" y="663.0773157994998" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="587.756278339246" y="671.8731944994998" width="233.0728914176172" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.0756601442461" y="670.9936066294998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.0756601442461" y="679.7894853294998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Alice's email_address, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 683.3078368094998 L 565.8637238957682 683.3078368094998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(558.6217837661015,683.3078368094998) translate(-558.6217837661015,-683.3078368094998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 565.9516826827683 679.6428873511665 L 558.6217837661015 683.3078368094998 L 565.9516826827683 686.9727862678332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 558.6217837661015 719.8107334144997 L 554.2238444161015 719.8107334144997 M 116.96641677094527 709.6954729094998 L 546.3075535861016 709.6954729094998 L 554.2238444161015 717.6117637394998 L 554.2238444161015 729.9259939194998 L 116.96641677094527 729.9259939194998 L 116.96641677094527 709.6954729094998 M 546.3075535861016 709.6954729094998 L 546.3075535861016 717.6117637394998 L 554.2238444161015 717.6117637394998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="129.2806469509453" y="722.0097030894997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users' admin role, thus can query any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="232.65007740180468" y="743.1198119694998" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="232.65007740180468" y="751.9156906694998" width="205.8901063834375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="233.9694592068047" y="751.0361027994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="233.9694592068047" y="759.8319814994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 558.6217837661015 763.3503329794997 L 119.81041755061199 763.3503329794997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(112.56847742094533,763.3503329794997) translate(-112.56847742094533,-763.3503329794997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 119.89837633761199 759.6853835211664 L 112.56847742094533 763.3503329794997 L 119.89837633761199 767.0152824378331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="285.27570301215627" y="776.5441510294997" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="286.59508481715625" y="784.4604418594997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 112.56847742094533 787.9787933394997 L 551.3798436364349 787.9787933394997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(558.6217837661015,787.9787933394997) translate(-558.6217837661015,-787.9787933394997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 551.2918848494348 784.3138438811663 L 558.6217837661015 787.9787933394997 L 551.2918848494348 791.643742797833 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 371.2136204806328 824.9214838794998 L 738.1136562215704 824.9214838794998 L 746.0299470515704 832.8377747094997 L 746.0299470515704 845.1520048894997 L 371.2136204806328 845.1520048894997 L 371.2136204806328 824.9214838794998 M 738.1136562215704 824.9214838794998 L 738.1136562215704 832.8377747094997 L 746.0299470515704 832.8377747094997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="383.5278506606328" y="837.2357140594996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alices's email_address extracted from access_token from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 402.5754368868828 882.0946954294997 L 706.7518398153204 882.0946954294997 L 714.6681306453204 890.0109862594996 L 714.6681306453204 902.3252164394996 L 402.5754368868828 902.3252164394996 L 402.5754368868828 882.0946954294997 M 706.7518398153204 882.0946954294997 L 706.7518398153204 890.0109862594996 L 714.6681306453204 890.0109862594996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="414.8896670668828" y="894.4089256094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alice's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="255.09818988959765" y="928.7128525394996" width="120.02388018714844" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="255.09818988959765" y="937.5087312394996" width="160.99388140785157" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="256.41757169459765" y="936.6291433694996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query Alice's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="256.41757169459765" y="945.4250220694996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Alice's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 558.6217837661015 948.9433735494996 L 119.81041755061199 948.9433735494996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(112.56847742094533,948.9433735494996) translate(-112.56847742094533,-948.9433735494996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 119.89837633761199 945.2784240911662 L 112.56847742094533 948.9433735494996 L 119.89837633761199 952.608323007833 Z"/></g></g><g><g><rect fill="white" stroke="none" x="274.2850795380352" y="962.1371915994996" width="122.62010211097656" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="275.60446134303515" y="970.0534824294996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Alice's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 112.56847742094533 973.5718339094996 L 551.3798436364349 973.5718339094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(558.6217837661015,973.5718339094996) translate(-558.6217837661015,-973.5718339094996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 551.2918848494348 969.9068844511662 L 558.6217837661015 973.5718339094996 L 551.2918848494348 977.2367833678329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="624.3172906073124" y="986.7656519594996" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="624.3172906073124" y="995.5615306594996" width="159.9508668814844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="625.6366724123125" y="994.6819427894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="625.6366724123125" y="1003.4778214894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Alice's user_claims, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 558.6217837661015 1006.9961729694995 L 842.7217242003411 1006.9961729694995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(849.9636643300078,1006.9961729694995) translate(-849.9636643300078,-1006.9961729694995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 842.633765413341 1003.3312235111662 L 849.9636643300078 1006.9961729694995 L 842.633765413341 1010.6611224278329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1038.8702440343632" y="1020.1899910194996" width="97.36843890296875" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1038.8702440343632" y="1028.9858697194995" width="207.43872088539064" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1040.189625839363" y="1028.1062818494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1040.189625839363" y="1036.9021605494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token + metadata)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 1040.4205120294996 L 1427.9736044944425 1040.4205120294996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1435.2155446241093,1040.4205120294996) translate(-1435.2155446241093,-1040.4205120294996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1427.8856457074426 1036.7555625711664 L 1435.2155446241093 1040.4205120294996 L 1427.8856457074426 1044.0854614878328 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1259.5700461335623 1077.3632025694994 L 1602.944752284656 1077.3632025694994 L 1610.861043114656 1085.2794933994994 L 1610.861043114656 1115.1854809794995 L 1259.5700461335623 1115.1854809794995 L 1259.5700461335623 1077.3632025694994 M 1602.944752284656 1077.3632025694994 L 1602.944752284656 1085.2794933994994 L 1610.861043114656 1085.2794933994994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1271.8842763135624" y="1089.6774327494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1271.8842763135624" y="1098.4733114494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1271.8842763135624" y="1107.2691901494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1242.5352942414725 1128.3792990294994 L 1619.9795041767459 1128.3792990294994 L 1627.8957950067459 1136.2955898594994 L 1627.8957950067459 1166.2015774394995 L 1242.5352942414725 1166.2015774394995 L 1242.5352942414725 1128.3792990294994 M 1619.9795041767459 1128.3792990294994 L 1619.9795041767459 1136.2955898594994 L 1627.8957950067459 1136.2955898594994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1254.8495244214726" y="1140.6935292094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server uses domain part of Alice's email_address extracted from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1254.8495244214726" y="1149.4894079094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to load Claims Provider configuration from URL:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1254.8495244214726" y="1158.2852866094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1279.4452122876835" y="1158.2852866094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1284.6285313794804" y="1158.2852866094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">' + domain_part_of_email_address + '/.well-known/claims-provider-configuration'</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1320.7677771516287 1179.3953954894994 L 1541.7470212665896 1179.3953954894994 L 1549.6633120965896 1187.3116863194994 L 1549.6633120965896 1252.4011886994995 L 1320.7677771516287 1252.4011886994995 L 1320.7677771516287 1179.3953954894994 M 1541.7470212665896 1179.3953954894994 L 1541.7470212665896 1187.3116863194994 L 1549.6633120965896 1187.3116863194994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1333.0820073316288" y="1191.7096256694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server evaluates:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1333.0820073316288" y="1200.5055043694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. domain part of email_address vs. claims issuer</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1333.0820073316288" y="1209.3013830694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1333.0820073316288" y="1218.0972617694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. ticket_challenge vs. ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1333.0820073316288" y="1226.8931404694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1333.0820073316288" y="1235.6890191694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1333.0820073316288" y="1244.4848978694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. other_claims (recipient_info, file_info)</text></g><g><g><rect fill="white" stroke="none" x="1108.8676958165897" y="1278.7888247994993" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1110.1870776215897" y="1286.7051156294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1435.2155446241093 1290.2234671094993 L 857.2056044596744 1290.2234671094993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(849.9636643300078,1290.2234671094993) translate(-849.9636643300078,-1290.2234671094993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 857.2935632466745 1286.558517651166 L 849.9636643300078 1290.2234671094993 L 857.2935632466745 1293.8884165678326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="892.9260035815116" y="1303.4172851594992" width="183.7631532584375" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="892.9260035815116" y="1312.2131638594992" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="894.2453853865117" y="1311.3335759894992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Post data into Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="894.2453853865117" y="1320.1294546894992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 849.9636643300078 1323.6478061694993 L 1112.4095559617863 1323.6478061694993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1119.651496091453,1323.6478061694993) translate(-1119.651496091453,-1323.6478061694993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1112.3215971747863 1319.982856711166 L 1119.651496091453 1323.6478061694993 L 1112.3215971747863 1327.3127556278325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="950.0380717577812" y="1336.8416242194992" width="69.53901690589844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="951.3574535627812" y="1344.7579150494992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. 201 Created</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1119.651496091453 1348.2762665294993 L 857.2056044596744 1348.2762665294993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(849.9636643300078,1348.2762665294993) translate(-849.9636643300078,-1348.2762665294993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 857.2935632466745 1344.611317071166 L 849.9636643300078 1348.2762665294993 L 857.2935632466745 1351.9412159878325 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 81.78290197094533 329.71351306950004 L 880.7492397800078 329.71351306950004 L 880.7492397800078 444.0599361695 L 81.78290197094533 444.0599361695 L 81.78290197094533 329.71351306950004 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 81.78290197094533 329.71351306950004 L 81.78290197094533 340.26856750950003 L 108.07241327719532 340.26856750950003 L 113.34994049719532 334.99104028950006 L 113.34994049719532 329.71351306950004 L 81.78290197094533 329.71351306950004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="90.57878067094533" y="336.75021602950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="122.14581919719532" y="336.75021602950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Alice is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 81.78290197094533 386.8867246195 L 880.7492397800078 386.8867246195" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="122.14581919719532" y="393.9234275795" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Alice is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 527.8362083161015 515.3065536395 L 880.7492397800078 515.3065536395 L 880.7492397800078 696.5016548594998 L 527.8362083161015 696.5016548594998 L 527.8362083161015 515.3065536395 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 527.8362083161015 515.3065536395 L 527.8362083161015 525.8616080795 L 554.1257196223515 525.8616080795 L 559.4032468423516 520.5840808595 L 559.4032468423516 515.3065536395 L 527.8362083161015 515.3065536395" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="536.6320870161015" y="522.3432565995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="568.1991255423516" y="522.3432565995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 527.8362083161015 605.9041042494998 L 880.7492397800078 605.9041042494998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="568.1991255423516" y="612.9408072094999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 366.8156811306328 801.1726113894997 L 750.4278864015703 801.1726113894997 L 750.4278864015703 915.5190344894996 L 366.8156811306328 915.5190344894996 L 366.8156811306328 801.1726113894997 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 366.8156811306328 801.1726113894997 L 366.8156811306328 811.7276658294998 L 393.1051924368828 811.7276658294998 L 398.38271965688284 806.4501386094997 L 398.38271965688284 801.1726113894997 L 366.8156811306328 801.1726113894997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="375.6115598306328" y="808.2093143494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="407.17859835688284" y="808.2093143494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 366.8156811306328 858.3458229394996 L 750.4278864015703 858.3458229394996" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="407.17859835688284" y="865.3825258994997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1238.1373548914726 1053.6143300794995 L 1632.293734356746 1053.6143300794995 L 1632.293734356746 1265.5950067494994 L 1238.1373548914726 1265.5950067494994 L 1238.1373548914726 1053.6143300794995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1238.1373548914726 1053.6143300794995 L 1238.1373548914726 1064.1693845194995 L 1334.4092117787773 1064.1693845194995 L 1339.6867389987772 1058.8918572994994 L 1339.6867389987772 1053.6143300794995 L 1238.1373548914726 1053.6143300794995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1246.9332335914726" y="1060.6510330394995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g></g></g></svg>