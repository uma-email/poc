<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2286" height="1831"><desc>%0ATitle%20UMA%20wide%20ecosystem%20-%20Alice%20to%20Bob%20(push%20data)%0A%0Aactor%20%22Alice%20(RqP)%5Cnalice%40gmail.com%2C%20alice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthN%20Server%5Cnfoo.com%22%20as%20authServer%20%23lightpink%0Aparticipant%20%22IMAP%20Server%5Cngmail.com%22%20as%20imapServer%20%23de5246%0Aparticipant%20%22SMTP%20Server%5Cngmail.com%22%20as%20smtpServer%20%23de5246%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnfoo.com%22%20as%20claimsProvider%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnfoo.com%22%20as%20rqpClient%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnbar.com%22%20as%20rsServer%20%23lightsteelblue%0Aparticipant%20%22AuthZ%20Server%5Cnbar.com%22%20as%20asServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RO)%5Cnbob%40outlook.com%2C%20bob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Anote%20right%20of%20Alice%3AIf%20Alice%20uses%20an%20email%20provider%20(gmail)%20that%20does%20not%20support%20webfinger%2C%5Cnshe%20must%20set%20up%20her%20mailbox%20to%20automatically%20forward%20emails%20sent%5Cnfrom%20challenge%40foo.com%20to%20response%40foo.com%0Aend%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Abox%20over%20claimsProvider%3AClaims%20Provider%20can%20send%20email%20messages%20from%20addresses%20challenge%40foo.com%20and%20retrieve%20from%20response%40foo.com%0Aend%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20foo.com%20AuthN%20server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20bar.com%20AuthZ%20server%0Anote%20over%20rsServer%3Abar.com%20Admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%20set%5Cn'Incoming'%20and%20'Outgoing'%20with%20the%20bar.com%20AuthZ%20server%20with%20the%20associated%20scopes%3A%5Cn'Outgoing'%3A%20query%2C%20view%5Cn'Incoming'%3A%20create%0Anote%20over%20claimsProvider%3AClaims%20Provider%3A%5Cn1.%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Ffoo.com%2F.well-known%2Fclaims-provider-configuration%5Cn2.%20is%20registered%20at%20Alice's%20AuthN%20server%20and%20is%20assigned%20'query-users'%2C%20'view-users'%20admin%20roles%0AAlice-%3ErqpClient%3AInitiate%20request%0ArqpClient-%3ErsServer%3A1.%20Request%20Bob's%20'Incoming'%20resource%5Cn(scope%3Dcreate)%0ArqpClient%3C-rsServer%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Alice%20is%20involved%0AauthServer%3C-rqpClient%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Alice%20is%20not%20involved%0AauthServer%3C-rqpClient%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0AauthServer-%3ErqpClient%3A4.%20Return%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%0Anote%20left%20of%20rqpClient%3Aticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0Aalt%20Get%20Claims%20%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20left%20of%20rqpClient%3AAlice's%20email_address%20is%20in%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%20returned%20in%20request%203.%20a)%20%2F%204.%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20ticket_challenge)%0Aelse%20Get%20Claims%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20left%20of%20rqpClient%3A%20The%20email_address%20is%20specified%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20Alice's%20email_address%2C%20ticket_challenge)%0Aend%0Anote%20over%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users%2C%20view-users'%20admin%20roles%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0AauthServer%3C-claimsProvider%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users%2C%20view-users)%0AauthServer-%3EclaimsProvider%3A7.%20Return%20access_token%20%22audience%22%3A%5B%22realm-management%22%5D%0A%0Aalt%20Prepare%20email_address%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20over%20claimsProvider%3AUse%20Alices's%20email_address%20extracted%20from%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20over%20claimsProvider%3AUse%20Alice's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Alice's%20user_claims%5Cn(access_token%20%22audience%22%3A%5B%22realm-management%22%5D%2C%20Alice's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Alice's%20user_claims%0A%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0AsmtpServer%3C-claimsProvider%3A10.%20Send%20plain_message%20from%20challenge%40foo.com%20to%20alice%40gmail.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0AimapServer-%3EclaimsProvider%3A11.%20Retrieve%20dkim_signed_message%20sent%20from%20alice%40gmail.com%20to%20response%40foo.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0Aend%0AclaimsProvider-%3ErqpClient%3A12.%20Return%20claims_token%5Cn(Alice's%20user_claims%2C%20dkim_signed_message%20-%20optional)%5Cnif%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Aalt%20Domain%20part%20of%20email_address%20or%20Webfinger%20is%20used%20to%20locate%20Claims%20Provider%20configuration%20url%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrap%20discovery%20of%20Claims%20Provider%20config%20url%20via%20Webfinger%2C%20if%20it%20doesn't%20work%5Cnbuild%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%20%5Cn5.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20evaluate%20user_claims%5Cn8.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aelse%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Anote%20over%20asServer%3A1.%20extract%20dkim_signed%20_message%20from%20claims_token%5Cn2.%20verify%20DKIM%20signature%20of%20dkim_signed%20_message%5Cn3.%20extract%20'From%3A'%20part%20of%20dkim_signed_message%20e.g.%20Alice%20Henderson%20%3Calice%40gmail.com%3E%5Cn4.%20extract%20claims_provider_configuration_url%20and%20ticket_challenge%20from%20dkim_signed_message%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20extract%20user_claims%20from%20claims_token%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArqpClient-%3ErsServer%3A15.%20Post%20data%20into%20Bob's%20'Incoming'%20resource%5Cn(RPT)%0ArqpClient%3C-rsServer%3A16.%20201%20Created</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2286" height="1831"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.0780303186566" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Alice to Bob (push data)</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 78.15138224949999 L 73.48673024355469 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 78.15138224949999 L 406.58261939027346 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 527.5113353459069 78.15138224949999 L 527.5113353459069 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 717.6442792033939 78.15138224949999 L 717.6442792033939 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1034.3304855218835 78.15138224949999 L 1034.3304855218835 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 78.15138224949999 L 1478.9035062225084 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1756.9196918657897 78.15138224949999 L 1756.9196918657897 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1984.8849499725475 78.15138224949999 L 1984.8849499725475 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2212.8502080793055 78.15138224949999 L 2212.8502080793055 1773.9967956094983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 78.50038110255468 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 78.50037859572947 32.143922998476604 M 73.48673024355469 37.16258750749999 L 73.48673024355469 47.893559521499995 M 67.15369757955469 41.03277413549999 L 79.81976290755469 41.03277413549999 M 73.48673024355469 47.893559521499995 L 67.15369757955469 57.92086123949999 M 73.48673024355469 47.893559521499995 L 79.81976290755469 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="49.90221944033203" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com, alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 369.0433024265547 45.694589846499994 L 444.1219363539922 45.694589846499994 L 444.1219363539922 78.15138224949999 L 369.0433024265547 78.15138224949999 L 369.0433024265547 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="378.5868308160547" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="389.9919287774805" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 491.53203119957095 45.694589846499994 L 563.4906394922428 45.694589846499994 L 563.4906394922428 78.15138224949999 L 491.53203119957095 78.15138224949999 L 491.53203119957095 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.07555958907096" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.25885579268424" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 680.1118058065697 45.694589846499994 L 755.1767526002182 45.694589846499994 L 755.1767526002182 78.15138224949999 L 680.1118058065697 78.15138224949999 L 680.1118058065697 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="689.6553341960697" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="696.3917996501713" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 980.9907306309186 45.694589846499994 L 1087.6702404128482 45.694589846499994 L 1087.6702404128482 78.15138224949999 L 980.9907306309186 78.15138224949999 L 980.9907306309186 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="990.5342590204186" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1017.7397949090905" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1447.066726795411 45.694589846499994 L 1510.7402856496062 45.694589846499994 L 1510.7402856496062 78.15138224949999 L 1447.066726795411 78.15138224949999 L 1447.066726795411 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1456.6102551849108" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1462.3128156097155" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1701.5006980832234 45.694589846499994 L 1812.3386856483562 45.694589846499994 L 1812.3386856483562 78.15138224949999 L 1701.5006980832234 78.15138224949999 L 1701.5006980832234 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1711.0442264727233" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1740.329062288153" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1947.8648743418366 45.694589846499994 L 2021.9050256032585 45.694589846499994 L 2021.9050256032585 78.15138224949999 L 1947.8648743418366 78.15138224949999 L 1947.8648743418366 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1957.4084027313365" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1968.2943203949108" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2217.8638589383054 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 2217.86385643148 32.143922998476604 M 2212.8502080793055 37.16258750749999 L 2212.8502080793055 47.893559521499995 M 2206.5171754153057 41.03277413549999 L 2219.1832407433053 41.03277413549999 M 2212.8502080793055 47.893559521499995 L 2206.5171754153057 57.92086123949999 M 2212.8502080793055 47.893559521499995 L 2219.1832407433053 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2193.153178965536" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2143.4881933087977" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com, bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 78.50038110255468 1799.9886171679984 A 5.013650858999999 5.013650858999999 0 1 1 78.50037859572947 1799.983603517975 M 73.48673024355469 1805.0022680269983 L 73.48673024355469 1815.7332400409982 M 67.15369757955469 1808.8724546549984 L 79.81976290755469 1808.8724546549984 M 73.48673024355469 1815.7332400409982 L 67.15369757955469 1825.7605417589982 M 73.48673024355469 1815.7332400409982 L 79.81976290755469 1825.7605417589982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="49.90221944033203" y="1782.7926743094984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1791.5885530094984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com, alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 369.0433024265547 1773.9967956094983 L 444.1219363539922 1773.9967956094983 L 444.1219363539922 1806.4535880124984 L 369.0433024265547 1806.4535880124984 L 369.0433024265547 1773.9967956094983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="378.5868308160547" y="1788.8618306124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="389.9919287774805" y="1797.6577093124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 491.53203119957095 1773.9967956094983 L 563.4906394922428 1773.9967956094983 L 563.4906394922428 1806.4535880124984 L 491.53203119957095 1806.4535880124984 L 491.53203119957095 1773.9967956094983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.07555958907096" y="1788.8618306124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.25885579268424" y="1797.6577093124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 680.1118058065697 1773.9967956094983 L 755.1767526002182 1773.9967956094983 L 755.1767526002182 1806.4535880124984 L 680.1118058065697 1806.4535880124984 L 680.1118058065697 1773.9967956094983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="689.6553341960697" y="1788.8618306124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="696.3917996501713" y="1797.6577093124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 980.9907306309186 1773.9967956094983 L 1087.6702404128482 1773.9967956094983 L 1087.6702404128482 1806.4535880124984 L 980.9907306309186 1806.4535880124984 L 980.9907306309186 1773.9967956094983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="990.5342590204186" y="1788.8618306124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1017.7397949090905" y="1797.6577093124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1447.066726795411 1773.9967956094983 L 1510.7402856496062 1773.9967956094983 L 1510.7402856496062 1806.4535880124984 L 1447.066726795411 1806.4535880124984 L 1447.066726795411 1773.9967956094983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1456.6102551849108" y="1788.8618306124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1462.3128156097155" y="1797.6577093124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1701.5006980832234 1773.9967956094983 L 1812.3386856483562 1773.9967956094983 L 1812.3386856483562 1806.4535880124984 L 1701.5006980832234 1806.4535880124984 L 1701.5006980832234 1773.9967956094983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1711.0442264727233" y="1788.8618306124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1740.329062288153" y="1797.6577093124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1947.8648743418366 1773.9967956094983 L 2021.9050256032585 1773.9967956094983 L 2021.9050256032585 1806.4535880124984 L 1947.8648743418366 1806.4535880124984 L 1947.8648743418366 1773.9967956094983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1957.4084027313365" y="1788.8618306124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1968.2943203949108" y="1797.6577093124984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2217.8638589383054 1799.9886171679984 A 5.013650858999999 5.013650858999999 0 1 1 2217.86385643148 1799.983603517975 M 2212.8502080793055 1805.0022680269983 L 2212.8502080793055 1815.7332400409982 M 2206.5171754153057 1808.8724546549984 L 2219.1832407433053 1808.8724546549984 M 2212.8502080793055 1815.7332400409982 L 2206.5171754153057 1825.7605417589982 M 2212.8502080793055 1815.7332400409982 L 2219.1832407433053 1825.7605417589982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2193.153178965536" y="1782.7926743094984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2143.4881933087977" y="1791.5885530094984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com, bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 138.40315134449997 L 77.88466959355469 138.40315134449997 M 77.88466959355469 119.49201213949999 L 385.4725105102735 119.49201213949999 L 393.38880134027346 127.40830296949999 L 393.38880134027346 157.3142905495 L 77.88466959355469 157.3142905495 L 77.88466959355469 119.49201213949999 M 385.4725105102735 119.49201213949999 L 385.4725105102735 127.40830296949999 L 393.38880134027346 127.40830296949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="131.80624231949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">If Alice uses an email provider (gmail) that does not support webfinger,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="140.60212101949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">she must set up her mailbox to automatically forward emails sent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.1988997735547" y="149.39799971949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">from challenge@foo.com to response@foo.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 779.4960679639538 207.4507991395 L 1289.164903079813 207.4507991395 L 1289.164903079813 227.68132014949998 L 779.4960679639538 227.68132014949998 L 779.4960679639538 207.4507991395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="791.8102981439538" y="219.76502931949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider can send email messages from addresses challenge@foo.com and retrieve from response@foo.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1205.285259929227 254.06895624950002 L 1744.6054616857896 254.06895624950002 L 1752.5217525157896 261.9852470795 L 1752.5217525157896 274.2994772595 L 1205.285259929227 274.2994772595 L 1205.285259929227 254.06895624950002 M 1744.6054616857896 254.06895624950002 L 1744.6054616857896 261.9852470795 L 1752.5217525157896 261.9852470795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1217.5994901092272" y="266.38318642950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at foo.com AuthN server and pre-registered as a universal AEMS public client at bar.com AuthZ server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1571.2332998205552 287.4932953095 L 1934.689793081024 287.4932953095 L 1942.606083911024 295.4095861395 L 1942.606083911024 334.1114524195 L 1571.2332998205552 334.1114524195 L 1571.2332998205552 287.4932953095 M 1934.689793081024 287.4932953095 L 1934.689793081024 295.4095861395 L 1942.606083911024 295.4095861395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1583.5475300005553" y="299.8075254895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com Admin has set up the Resource Server and registers it's resource set</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1583.5475300005553" y="308.6034041895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming' and 'Outgoing' with the bar.com AuthZ server with the associated scopes:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1583.5475300005553" y="317.3992828895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing': query, view</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1583.5475300005553" y="326.1951615895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming': create</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 829.6256913770397 347.3052704695 L 1231.1189888367273 347.3052704695 L 1239.0352796667273 355.22156129949997 L 1239.0352796667273 385.12754887949995 L 829.6256913770397 385.12754887949995 L 829.6256913770397 347.3052704695 M 1231.1189888367273 347.3052704695 L 1231.1189888367273 355.22156129949997 L 1239.0352796667273 355.22156129949997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="841.9399215570397" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="841.9399215570397" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1012.533747850985" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1017.7170669427819" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com/.well-known/claims-provider-configuration</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="841.9399215570397" y="377.2112580495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. is registered at Alice's AuthN server and is assigned 'query-users', 'view-users' admin roles</text></g><g><g><rect fill="white" stroke="none" x="744.2814371116253" y="398.32136692949996" width="63.8273622428125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="745.6008189166254" y="406.23765775949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 409.7560092395 L 1471.6615660928417 409.7560092395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1478.9035062225084,409.7560092395) translate(-1478.9035062225084,-409.7560092395)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1471.5736073058417 406.0910597811666 L 1478.9035062225084 409.7560092395 L 1471.5736073058417 413.4209586978333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1539.7740028226453" y="422.9498272895" width="156.27519244300782" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1539.7740028226453" y="431.7457059895" width="65.1163026725" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1541.0933846276453" y="430.86611811949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1541.0933846276453" y="439.66199681949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=create)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 443.1803482995 L 1749.677751736123 443.1803482995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1756.9196918657897,443.1803482995) translate(-1756.9196918657897,-443.1803482995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1749.589792949123 439.51539884116664 L 1756.9196918657897 443.1803482995 L 1749.589792949123 446.84529775783335 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1558.0066764676649" y="456.3741663495" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1559.3260582726648" y="464.2904571795" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1756.9196918657897 467.8088086595 L 1486.1454463521752 467.8088086595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1478.9035062225084,467.8088086595) translate(-1478.9035062225084,-467.8088086595)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1486.2334051391751 464.14385920116666 L 1478.9035062225084 467.8088086595 L 1486.2334051391751 471.47375811783337 Z"/></g></g><g><g><rect fill="white" stroke="none" x="824.7582146927972" y="504.75149919949996" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="824.7582146927972" y="513.5473778994999" width="235.9696962271875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="826.0775964977972" y="512.6677900294999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="826.0775964977972" y="521.4636687294999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 524.9820202095 L 413.8245595199401 524.9820202095" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,524.9820202095) translate(-406.58261939027346,-524.9820202095)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 521.3170707511666 L 406.58261939027346 524.9820202095 L 413.9125183069401 528.6469696678333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="828.1355645463128" y="561.9247107494999" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="828.1355645463128" y="570.7205894494999" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="829.4549463513129" y="569.8410015794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="829.4549463513129" y="578.6368802794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 582.1552317594999 L 413.8245595199401 582.1552317594999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,582.1552317594999) translate(-406.58261939027346,-582.1552317594999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 578.4902823011665 L 406.58261939027346 582.1552317594999 L 413.9125183069401 585.8201812178332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="830.06676266643" y="608.5428678594999" width="225.3526002799219" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="831.38614447143" y="616.4591586894999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token "audience":["claims-provider"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 619.9775101694999 L 1471.6615660928417 619.9775101694999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1478.9035062225084,619.9775101694999) translate(-1478.9035062225084,-619.9775101694999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1471.5736073058417 616.3125607111665 L 1478.9035062225084 619.9775101694999 L 1471.5736073058417 623.6424596278332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 643.2865887244998 L 1474.5055668725086 643.2865887244998 M 1218.3680885681724 633.1713282194999 L 1466.5892760425083 633.1713282194999 L 1474.5055668725083 641.0876190494998 L 1474.5055668725083 653.4018492294998 L 1218.3680885681724 653.4018492294998 L 1218.3680885681724 633.1713282194999 M 1466.5892760425083 633.1713282194999 L 1466.5892760425083 641.0876190494998 L 1474.5055668725083 641.0876190494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1230.6823187481725" y="645.4855583994997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 700.4598002744998 L 1474.5055668725086 700.4598002744998 M 1038.7284248718834 690.3445397694999 L 1466.5892760425083 690.3445397694999 L 1474.5055668725083 698.2608305994999 L 1474.5055668725083 710.5750607794998 L 1038.7284248718834 710.5750607794998 L 1038.7284248718834 690.3445397694999 M 1466.5892760425083 690.3445397694999 L 1466.5892760425083 698.2608305994999 L 1474.5055668725083 698.2608305994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1051.0426550518835" y="702.6587699494997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice's email_address is in access_token "audience":["claims-provider"] returned in request 3. a) / 4.</text></g><g><g><rect fill="white" stroke="none" x="1125.2753057175867" y="723.7688788294998" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1125.2753057175867" y="732.5647575294998" width="262.68338030921876" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1126.5946875225866" y="731.6851696594998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1126.5946875225866" y="740.4810483594998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 743.9993998394998 L 1041.5724256515502 743.9993998394998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1034.3304855218835,743.9993998394998) translate(-1034.3304855218835,-743.9993998394998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1041.6603844385502 740.3344503811664 L 1034.3304855218835 743.9993998394998 L 1041.6603844385502 747.6643492978332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 791.0573508844997 L 1474.5055668725086 791.0573508844997 M 1262.1893165955162 780.9420903794997 L 1466.5892760425083 780.9420903794997 L 1474.5055668725083 788.8583812094997 L 1474.5055668725083 801.1726113894997 L 1262.1893165955162 801.1726113894997 L 1262.1893165955162 780.9420903794997 M 1466.5892760425083 780.9420903794997 L 1466.5892760425083 788.8583812094997 L 1474.5055668725083 788.8583812094997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1274.5035467755163" y="793.2563205594996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is specified by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="1077.7236699753992" y="814.3664294394997" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1077.7236699753992" y="823.1623081394997" width="357.78665179359376" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1079.043051780399" y="822.2827202694997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1079.043051780399" y="831.0785989694997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], Alice's email_address, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 834.5969504494997 L 1041.5724256515502 834.5969504494997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1034.3304855218835,834.5969504494997) translate(-1034.3304855218835,-834.5969504494997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1041.6603844385502 830.9320009911663 L 1034.3304855218835 834.5969504494997 L 1041.6603844385502 838.261899907833 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 768.7855119336804 860.9845865494997 L 1291.9591682800865 860.9845865494997 L 1299.8754591100865 868.9008773794997 L 1299.8754591100865 881.2151075594996 L 768.7855119336804 881.2151075594996 L 768.7855119336804 860.9845865494997 M 1291.9591682800865 860.9845865494997 L 1291.9591682800865 868.9008773794997 L 1299.8754591100865 868.9008773794997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="781.0997421136803" y="873.2988167294995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users, view-users' admin roles, thus can query and view any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="592.6311586881878" y="894.4089256094996" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="592.6311586881878" y="903.2048043094997" width="255.65078753578126" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="593.9505404931879" y="902.3252164394996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="593.9505404931879" y="911.1210951394996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1034.3304855218835 914.6394466194996 L 413.8245595199401 914.6394466194996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,914.6394466194996) translate(-406.58261939027346,-914.6394466194996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 910.9744971611663 L 406.58261939027346 914.6394466194996 L 413.9125183069401 918.304396077833 Z"/></g></g><g><g><rect fill="white" stroke="none" x="598.9599703336957" y="927.8332646694996" width="242.99316424476564" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="600.2793521386957" y="935.7495554994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token "audience":["realm-management"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 939.2679069794996 L 1027.0885453922167 939.2679069794996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1034.3304855218835,939.2679069794996) translate(-1034.3304855218835,-939.2679069794996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1027.0005866052168 935.6029575211662 L 1034.3304855218835 939.2679069794996 L 1027.0005866052168 942.9328564378329 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 784.565449677821 976.2105975194996 L 1276.179230535946 976.2105975194996 L 1284.095521365946 984.1268883494996 L 1284.095521365946 996.4411185294996 L 784.565449677821 996.4411185294996 L 784.565449677821 976.2105975194996 M 1276.179230535946 976.2105975194996 L 1276.179230535946 984.1268883494996 L 1284.095521365946 984.1268883494996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="796.879679857821" y="988.5248276994995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alices's email_address extracted from access_token "audience":["claims-provider"] from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 878.2841386426647 1033.3838090694994 L 1182.4605415711023 1033.3838090694994 L 1190.3768324011023 1041.3000998994994 L 1190.3768324011023 1053.6143300794995 L 878.2841386426647 1053.6143300794995 L 878.2841386426647 1033.3838090694994 M 1182.4605415711023 1033.3838090694994 L 1182.4605415711023 1041.3000998994994 L 1190.3768324011023 1041.3000998994994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="890.5983688226647" y="1045.6980392494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alice's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="568.7824648405316" y="1080.0019661794993" width="142.66552752601564" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="568.7824648405316" y="1088.7978448794993" width="303.34817523109376" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="570.1018466455316" y="1087.9182570094993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Alice's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="570.1018466455316" y="1096.7141357094993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["realm-management"], Alice's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1034.3304855218835 1100.2324871894994 L 413.8245595199401 1100.2324871894994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(406.58261939027346,1100.2324871894994) translate(-406.58261939027346,-1100.2324871894994)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 413.9125183069401 1096.567537731166 L 406.58261939027346 1100.2324871894994 L 413.9125183069401 1103.8974366478326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="659.1465014005902" y="1113.4263052394992" width="122.62010211097656" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="660.4658832055902" y="1121.3425960694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Alice's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 406.58261939027346 1124.8609475494993 L 1027.0885453922167 1124.8609475494993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1034.3304855218835,1124.8609475494993) translate(-1034.3304855218835,-1124.8609475494993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1027.0005866052168 1121.195998091166 L 1034.3304855218835 1124.8609475494993 L 1027.0005866052168 1128.5258970078326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="728.0527356650606" y="1161.8036380894991" width="295.86929339515626" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="728.0527356650606" y="1170.5995167894991" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="729.3721174700606" y="1169.7199289194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Send plain_message from challenge@foo.com to alice@gmail.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="729.3721174700606" y="1178.5158076194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1034.3304855218835 1182.0341590994992 L 724.8862193330606 1182.0341590994992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(717.6442792033939,1182.0341590994992) translate(-717.6442792033939,-1182.0341590994992)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 724.9741781200606 1178.369209641166 L 717.6442792033939 1182.0341590994992 L 724.9741781200606 1185.6991085578325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="601.1964230380748" y="1195.227977149499" width="359.44897479164064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="601.1964230380748" y="1204.0238558494991" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="602.5158048430749" y="1203.144267979499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Retrieve dkim_signed_message sent from alice@gmail.com to response@foo.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="602.5158048430749" y="1211.940146679499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 527.5113353459069 1215.4584981594992 L 1027.0885453922167 1215.4584981594992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1034.3304855218835,1215.4584981594992) translate(-1034.3304855218835,-1215.4584981594992)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1027.0005866052168 1211.793548701166 L 1034.3304855218835 1215.4584981594992 L 1027.0005866052168 1219.1234476178324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1108.0560369187585" y="1241.846134259499" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1108.0560369187585" y="1250.642012959499" width="229.42907733070314" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1108.0560369187585" y="1259.437891659499" width="297.121917906875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1109.3754187237585" y="1249.762425089499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1109.3754187237585" y="1258.558303789499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Alice's user_claims, dkim_signed_message - optional)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1109.3754187237585" y="1267.354182489499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1034.3304855218835 1270.872533969499 L 1471.6615660928417 1270.872533969499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1478.9035062225084,1270.872533969499) translate(-1478.9035062225084,-1270.872533969499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1471.5736073058417 1267.2075845111658 L 1478.9035062225084 1270.872533969499 L 1471.5736073058417 1274.5374834278323 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1652.936792398485" y="1284.066352019499" width="98.06091326820312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1652.936792398485" y="1292.862230719499" width="157.91487139808595" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1654.256174203485" y="1291.982642849499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1654.256174203485" y="1300.778521549499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 1304.296873029499 L 1977.6430098428807 1304.296873029499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1984.8849499725475,1304.296873029499) translate(-1984.8849499725475,-1304.296873029499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1977.5550510558808 1300.6319235711658 L 1984.8849499725475 1304.296873029499 L 1977.5550510558808 1307.9618224878323 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1809.2394514820005 1317.490691079499 L 2152.6141576330942 1317.490691079499 L 2160.530448463094 1325.4069819094989 L 2160.530448463094 1355.312969489499 L 1809.2394514820005 1355.312969489499 L 1809.2394514820005 1317.490691079499 M 2152.6141576330942 1317.490691079499 L 2152.6141576330942 1325.4069819094989 L 2160.530448463094 1325.4069819094989" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1821.5536816620006" y="1329.804921259499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1821.5536816620006" y="1338.600799959499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1821.5536816620006" y="1347.396678659499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1801.9724226734068 1416.0045325194988 L 2159.881186441688 1416.0045325194988 L 2167.797477271688 1423.9208233494987 L 2167.797477271688 1506.6020831294989 L 1801.9724226734068 1506.6020831294989 L 1801.9724226734068 1416.0045325194988 M 2159.881186441688 1416.0045325194988 L 2159.881186441688 1423.9208233494987 L 2167.797477271688 1423.9208233494987" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1428.3187626994988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1437.1146413994989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1445.9105200994989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrap discovery of Claims Provider config url via Webfinger, if it doesn't work</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1454.7063987994989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1463.5022774994989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature </text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1472.2981561994989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1481.0940348994989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1489.8899135994989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1814.2866528534068" y="1498.6857922994989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate other optional claims e.g. recipient_info, file_info</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1778.9093886157896 1543.5447736694987 L 2182.944220499305 1543.5447736694987 L 2190.860511329305 1551.4610644994987 L 2190.860511329305 1634.1423242794988 L 1778.9093886157896 1634.1423242794988 L 1778.9093886157896 1543.5447736694987 M 2182.944220499305 1543.5447736694987 L 2182.944220499305 1551.4610644994987 L 2190.860511329305 1551.4610644994987" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1555.8590038494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract dkim_signed _message from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1564.6548825494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. verify DKIM signature of dkim_signed _message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1573.4507612494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. extract 'From:' part of dkim_signed_message e.g. Alice Henderson &lt;alice@gmail.com&gt;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1582.2466399494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. extract claims_provider_configuration_url and ticket_challenge from dkim_signed_message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1591.0425186494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1599.8383973494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1608.6342760494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1617.4301547494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1791.2236187957897" y="1626.2260334494988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="1698.1723194370593" y="1673.7237784294985" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1699.4917012420592" y="1681.6400692594984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1984.8849499725475 1685.1584207394985 L 1486.1454463521752 1685.1584207394985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1478.9035062225084,1685.1584207394985) translate(-1478.9035062225084,-1685.1584207394985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1486.2334051391751 1681.4934712811653 L 1478.9035062225084 1685.1584207394985 L 1486.2334051391751 1688.8233701978318 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1526.0300224149305" y="1698.3522387894984" width="183.7631532584375" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1526.0300224149305" y="1707.1481174894984" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1527.3494042199304" y="1706.2685296194984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Post data into Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1527.3494042199304" y="1715.0644083194984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1478.9035062225084 1718.5827597994985 L 1749.677751736123 1718.5827597994985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1756.9196918657897,1718.5827597994985) translate(-1756.9196918657897,-1718.5827597994985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1749.589792949123 1714.9178103411653 L 1756.9196918657897 1718.5827597994985 L 1749.589792949123 1722.2477092578317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1583.1420905912" y="1731.7765778494984" width="69.53901690589844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1584.4614723962" y="1739.6928686794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 201 Created</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1756.9196918657897 1743.2112201594985 L 1486.1454463521752 1743.2112201594985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1478.9035062225084,1743.2112201594985) translate(-1478.9035062225084,-1743.2112201594985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1486.2334051391751 1739.5462707011652 L 1478.9035062225084 1743.2112201594985 L 1486.2334051391751 1746.8761696178317 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 42.70115479355469 95.7431396495 L 397.78674069027346 95.7431396495 L 397.78674069027346 170.5081085995 L 42.70115479355469 170.5081085995 L 42.70115479355469 95.7431396495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 42.70115479355469 95.7431396495 L 42.70115479355469 106.29819408949999 L 71.88020772578125 106.29819408949999 L 77.15773494578124 101.02066686949999 L 77.15773494578124 95.7431396495 L 42.70115479355469 95.7431396495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="51.497033493554696" y="102.77984260949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="85.95361364578125" y="102.77984260949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 775.0981286139538 183.7019266495 L 1293.5628424298131 183.7019266495 L 1293.5628424298131 240.8751381995 L 775.0981286139538 240.8751381995 L 775.0981286139538 183.7019266495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 775.0981286139538 183.7019266495 L 775.0981286139538 194.2569810895 L 804.2771815461804 194.2569810895 L 809.5547087661804 188.9794538695 L 809.5547087661804 183.7019266495 L 775.0981286139538 183.7019266495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="783.8940073139538" y="190.73862960949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="818.3505874661804" y="190.73862960949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 481.0026267095 L 1509.6890816725083 481.0026267095 L 1509.6890816725083 595.3490498094999 L 375.79704394027345 595.3490498094999 L 375.79704394027345 481.0026267095 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 481.0026267095 L 375.79704394027345 491.5576811495 L 402.08655524652346 491.5576811495 L 407.3640824665235 486.28015392950005 L 407.3640824665235 481.0026267095 L 375.79704394027345 481.0026267095" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="384.59292264027346" y="488.03932966950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="416.1599611665235" y="488.03932966950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Alice is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 375.79704394027345 538.1758382594999 L 1509.6890816725083 538.1758382594999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="416.1599611665235" y="545.2125412194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Alice is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1003.5449100718835 666.5956672794998 L 1509.6890816725083 666.5956672794998 L 1509.6890816725083 847.7907684994997 L 1003.5449100718835 847.7907684994997 L 1003.5449100718835 666.5956672794998 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1003.5449100718835 666.5956672794998 L 1003.5449100718835 677.1507217194999 L 1029.8344213781334 677.1507217194999 L 1035.1119485981333 671.8731944994998 L 1035.1119485981333 666.5956672794998 L 1003.5449100718835 666.5956672794998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1012.3407887718835" y="673.6323702394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1043.9078272981333" y="673.6323702394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1003.5449100718835 757.1932178894997 L 1509.6890816725083 757.1932178894997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1043.9078272981333" y="764.2299208494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 780.167510327821 952.4617250294996 L 1288.493460715946 952.4617250294996 L 1288.493460715946 1066.8081481294994 L 780.167510327821 1066.8081481294994 L 780.167510327821 952.4617250294996 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 780.167510327821 952.4617250294996 L 780.167510327821 963.0167794694996 L 806.457021634071 963.0167794694996 L 811.734548854071 957.7392522494996 L 811.734548854071 952.4617250294996 L 780.167510327821 952.4617250294996" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="788.963389027821" y="959.4984279894996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="820.530427554071" y="959.4984279894996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 780.167510327821 1009.6349365794995 L 1288.493460715946 1009.6349365794995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="820.530427554071" y="1016.6716395394996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 496.7257598959069 1138.0547655994992 L 1065.1160609718834 1138.0547655994992 L 1065.1160609718834 1228.652316209499 L 496.7257598959069 1228.652316209499 L 496.7257598959069 1138.0547655994992 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 496.7257598959069 1138.0547655994992 L 496.7257598959069 1148.6098200394993 L 525.9048128281335 1148.6098200394993 L 531.1823400481335 1143.3322928194991 L 531.1823400481335 1138.0547655994992 L 496.7257598959069 1138.0547655994992" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="505.5216385959069" y="1145.0914685594992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="539.9782187481335" y="1145.0914685594992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1765.7155705657897 1368.5067875394989 L 2204.0543293793053 1368.5067875394989 L 2204.0543293793053 1660.5299603794986 L 1765.7155705657897 1660.5299603794986 L 1765.7155705657897 1368.5067875394989 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1765.7155705657897 1368.5067875394989 L 1765.7155705657897 1379.061841979499 L 1861.9874274530944 1379.061841979499 L 1867.2649546730943 1373.7843147594988 L 1867.2649546730943 1368.5067875394989 L 1765.7155705657897 1368.5067875394989" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1774.5114492657897" y="1375.5434904994988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1774.5114492657897 1392.2556600294988 L 2195.2584506793055 1392.2556600294988 L 2195.2584506793055 1647.3361423294987 L 1774.5114492657897 1647.3361423294987 L 1774.5114492657897 1392.2556600294988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1774.5114492657897 1392.2556600294988 L 1774.5114492657897 1402.8107144694989 L 1800.8009605720397 1402.8107144694989 L 1806.0784877920396 1397.5331872494987 L 1806.0784877920396 1392.2556600294988 L 1774.5114492657897 1392.2556600294988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1783.3073279657897" y="1399.2923629894988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1814.8743664920396" y="1399.2923629894988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Domain part of email_address or Webfinger is used to locate Claims Provider configuration url]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1774.5114492657897 1519.7959011794987 L 2195.2584506793055 1519.7959011794987" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1814.8743664920396" y="1526.8326041394987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g/></g></g></svg>