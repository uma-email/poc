<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1580" height="1376"><desc>Title%20UMA%20wide%20ecosystem%20-%20Alice%20to%20Bob%20(push%20data)%0A%0Aactor%20%22Alice%20(RqP)%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthN%20Server%5Cnfoo.com%22%20as%20authServer%20%23lightpink%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnfoo.com%22%20as%20claimsProvider%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnfoo.com%22%20as%20rqpClient%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnbar.com%22%20as%20rsServer%20%23lightsteelblue%0Aparticipant%20%22AuthZ%20Server%5Cnbar.com%22%20as%20asServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RO)%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20Alice's%20AuthN%20server%20as%20a%20confidential%20client%20and%20is%20pre-registered%20at%20Bob's%20AuthZ%20server%20as%20a%20universal%20public%20client%0Anote%20over%20claimsProvider%3AClaims%20Provider%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Ffoo.com%2F.well-known%2Fclaims-provider-configuration%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20registered%20at%20Alice's%20AuthN%20server%20and%20is%20assigned%20'query-users'%20admin%20role%0AAlice-%3ErqpClient%3AInitiate%20request%0ArqpClient-%3ErsServer%3A1.%20Request%20bar.com%20'Incoming'%20resource%0ArqpClient%3C-rsServer%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Alice%20is%20involved%0AauthServer%3C-rqpClient%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Alice%20is%20not%20involved%0AauthServer%3C-rqpClient%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0AauthServer-%3ErqpClient%3A4.%20Return%20access_token%0Anote%20left%20of%20rqpClient%3ACreate%20ticket_digest%0Aalt%20Get%20Claims%20%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20left%20of%20rqpClient%3AAlice's%20email_address%20is%20in%20access_token%20returned%20at%20step%203.%20a)%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%2C%20ticket_digest)%0Aelse%20Get%20Claims%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20left%20of%20rqpClient%3A%20The%20email_address%20is%20determined%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%2C%20Alice's%20email_address%2C%20ticket_digest)%0Aend%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users'%20admin%20role%2C%20thus%20can%20query%20any%20user%20to%20get%20their%20claims%0AauthServer%3C-claimsProvider%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users)%0AauthServer-%3EclaimsProvider%3A7.%20Return%20access_token%0A%0Aalt%20Prepare%20email_address%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20left%20of%20claimsProvider%3AUse%20Alices's%20email_address%20extracted%20from%20access_token%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20left%20of%20claimsProvider%3AUse%20Alice's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%20Alice's%20user_claims%5Cn(access_token%2C%20Alice's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Alice's%20user_claims%0A%0AclaimsProvider-%3ErqpClient%3A10.%20Return%20claims_token%5Cn(Alice's%20user_claims%2C%20ticket_digest)%0ArqpClient-%3EasServer%3A11.%20Call%20token%20endpoint%5Cn(client_id%2C%20ticket%2C%20pushed_claims%3Dclaims_token%20%2B%20metadata)%0Agroup%20Authorization%20process%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Anote%20over%20asServer%3AAuthZ%20Server%20uses%20domain%20part%20of%20Alice's%20email_address%20extracted%20from%20claims_token%5Cnto%20load%20Claims%20Provider%20configuration%20from%20URL%3A%5Cn'https%3A%2F%2F'%20%2B%20domain_part_of_email_address%20%2B%20'%2F.well-known%2Fclaims-provider-configuration'%0Anote%20over%20asServer%3AAuthZ%20Server%20evaluates%3A%5Cn1.%20domain%20part%20of%20email_address%20vs.%20claims%20issuer%5Cn2.%20ticket%5Cn3.%20ticket_digest%20vs.%20ticket%5Cn4.%20claims_token%20signature%5Cn5.%20user_claims%5Cn6.%20other_claims%20(recipient_info%2C%20file_info)%0Aend%0ArqpClient%3C-asServer%3A12.%20Return%20RPT%0ArqpClient-%3ErsServer%3A13.%20Post%20data%20into%20bar.com%20'Incoming'%20resource%5Cn(RPT)%0ArqpClient%3C-rsServer%3A14.%20201%20Created</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1580" height="1376"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="648.0417040834468" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Alice to Bob (push data)</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.78127255617676 78.15138224949999 L 33.78127255617676 1319.2498668194992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 108.24567964567677 78.15138224949999 L 108.24567964567677 1319.2498668194992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 544.4866996138799 78.15138224949999 L 544.4866996138799 1319.2498668194992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 78.15138224949999 L 843.6071943391923 1319.2498668194992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1142.7276890645048 78.15138224949999 L 1142.7276890645048 1319.2498668194992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1345.7107445901133 78.15138224949999 L 1345.7107445901133 1319.2498668194992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1548.6938001157218 78.15138224949999 L 1548.6938001157218 1319.2498668194992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 38.79492341517676 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 38.794920908351536 32.143922998476604 M 33.78127255617676 37.16258750749999 L 33.78127255617676 47.893559521499995 M 27.44823989217676 41.03277413549999 L 40.11430522017676 41.03277413549999 M 33.78127255617676 47.893559521499995 L 27.44823989217676 57.92086123949999 M 33.78127255617676 47.893559521499995 L 40.11430522017676 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="12.047938968530275" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 71.96048446235352 45.694589846499994 L 144.53087482900003 45.694589846499994 L 144.53087482900003 78.15138224949999 L 71.96048446235352 78.15138224949999 L 71.96048446235352 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50401285185353" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="92.18734720243947" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 494.16816969850095 45.694589846499994 L 594.8052295292588 45.694589846499994 L 594.8052295292588 78.15138224949999 L 494.16816969850095 78.15138224949999 L 494.16816969850095 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.71169808800096" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="528.4283671706426" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 813.4886651867529 45.694589846499994 L 873.7257234916318 45.694589846499994 L 873.7257234916318 78.15138224949999 L 813.4886651867529 78.15138224949999 L 813.4886651867529 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="823.0321935762529" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="827.548861895955" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1090.7424950255909 45.694589846499994 L 1194.712883103419 45.694589846499994 L 1194.712883103419 78.15138224949999 L 1090.7424950255909 78.15138224949999 L 1090.7424950255909 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1100.2860234150908" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1126.6360218892119" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1309.6755494067902 45.694589846499994 L 1381.7459397734367 45.694589846499994 L 1381.7459397734367 78.15138224949999 L 1309.6755494067902 78.15138224949999 L 1309.6755494067902 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1319.21907779629" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1329.6190774148204" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1553.707450974722 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 1553.7074484678967 32.143922998476604 M 1548.6938001157218 37.16258750749999 L 1548.6938001157218 47.893559521499995 M 1542.3607674517218 41.03277413549999 L 1555.0268327797219 41.03277413549999 M 1548.6938001157218 47.893559521499995 L 1542.3607674517218 57.92086123949999 M 1548.6938001157218 47.893559521499995 L 1555.0268327797219 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1530.6354676724845" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1521.0688001157218" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 38.79492341517676 1345.2416883779993 A 5.013650858999999 5.013650858999999 0 1 1 38.794920908351536 1345.236674727976 M 33.78127255617676 1350.2553392369991 L 33.78127255617676 1360.986311250999 M 27.44823989217676 1354.1255258649992 L 40.11430522017676 1354.1255258649992 M 33.78127255617676 1360.986311250999 L 27.44823989217676 1371.013612968999 M 33.78127255617676 1360.986311250999 L 40.11430522017676 1371.013612968999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="12.047938968530275" y="1328.0457455194992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1336.8416242194992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 71.96048446235352 1319.2498668194992 L 144.53087482900003 1319.2498668194992 L 144.53087482900003 1351.7066592224992 L 71.96048446235352 1351.7066592224992 L 71.96048446235352 1319.2498668194992 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50401285185353" y="1334.1149018224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="92.18734720243947" y="1342.9107805224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 494.16816969850095 1319.2498668194992 L 594.8052295292588 1319.2498668194992 L 594.8052295292588 1351.7066592224992 L 494.16816969850095 1351.7066592224992 L 494.16816969850095 1319.2498668194992 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.71169808800096" y="1334.1149018224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="528.4283671706426" y="1342.9107805224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 813.4886651867529 1319.2498668194992 L 873.7257234916318 1319.2498668194992 L 873.7257234916318 1351.7066592224992 L 813.4886651867529 1351.7066592224992 L 813.4886651867529 1319.2498668194992 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="823.0321935762529" y="1334.1149018224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="827.548861895955" y="1342.9107805224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1090.7424950255909 1319.2498668194992 L 1194.712883103419 1319.2498668194992 L 1194.712883103419 1351.7066592224992 L 1090.7424950255909 1351.7066592224992 L 1090.7424950255909 1319.2498668194992 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1100.2860234150908" y="1334.1149018224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1126.6360218892119" y="1342.9107805224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1309.6755494067902 1319.2498668194992 L 1381.7459397734367 1319.2498668194992 L 1381.7459397734367 1351.7066592224992 L 1309.6755494067902 1351.7066592224992 L 1309.6755494067902 1319.2498668194992 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1319.21907779629" y="1334.1149018224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1329.6190774148204" y="1342.9107805224992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1553.707450974722 1345.2416883779993 A 5.013650858999999 5.013650858999999 0 1 1 1553.7074484678967 1345.236674727976 M 1548.6938001157218 1350.2553392369991 L 1548.6938001157218 1360.986311250999 M 1542.3607674517218 1354.1255258649992 L 1555.0268327797219 1354.1255258649992 M 1548.6938001157218 1360.986311250999 L 1542.3607674517218 1371.013612968999 M 1548.6938001157218 1360.986311250999 L 1555.0268327797219 1371.013612968999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1530.6354676724845" y="1328.0457455194992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1521.0688001157218" y="1336.8416242194992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 548.8846389638799 95.7431396495 L 1130.413458884505 95.7431396495 L 1138.329749714505 103.65943047949999 L 1138.329749714505 115.97366065949998 L 548.8846389638799 115.97366065949998 L 548.8846389638799 95.7431396495 M 1130.413458884505 95.7431396495 L 1130.413458884505 103.65943047949999 L 1138.329749714505 103.65943047949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="561.1988691438798" y="108.0573698295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at Alice's AuthN server as a confidential client and is pre-registered at Bob's AuthZ server as a universal public client</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 318.0141335097313 129.1674787095 L 763.0429748880285 129.1674787095 L 770.9592657180285 137.0837695395 L 770.9592657180285 149.39799971949998 L 318.0141335097313 149.39799971949998 L 318.0141335097313 129.1674787095 M 763.0429748880285 129.1674787095 L 763.0429748880285 137.0837695395 L 770.9592657180285 137.0837695395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="330.3283636897313" y="141.48170888949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="550.8283636897313" y="141.48170888949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="556.2283637850987" y="141.48170888949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com/.well-known/claims-provider-configuration</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 544.4866996138799 172.70707827449996 L 540.0887602638799 172.70707827449996 M 142.7269625015361 162.59181776949998 L 532.1724694338799 162.59181776949998 L 540.0887602638799 170.5081085995 L 540.0887602638799 182.82233877949997 L 142.7269625015361 182.82233877949997 L 142.7269625015361 162.59181776949998 M 532.1724694338799 162.59181776949998 L 532.1724694338799 170.5081085995 L 540.0887602638799 170.5081085995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="155.04119268153613" y="174.90604794949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is registered at Alice's AuthN server and is assigned 'query-users' admin role</text></g><g><g><rect fill="white" stroke="none" x="406.9248508797451" y="196.01615682949998" width="63.538765135878904" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="408.2442326847451" y="203.93244765949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.78127255617676 207.45079913949996 L 836.3652542095257 207.45079913949996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(843.6071943391923,207.45079913949996) translate(-843.6071943391923,-207.45079913949996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 836.2772954225256 203.78584968116664 L 843.6071943391923 207.45079913949996 L 836.2772954225256 211.1157485978333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="912.6480629486064" y="220.64461718949997" width="161.0387575064844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="913.9674447536064" y="228.56090801949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request bar.com 'Incoming' resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 232.07925949949995 L 1135.485748934838 232.07925949949995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1142.7276890645048,232.07925949949995) translate(-1142.7276890645048,-232.07925949949995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1135.3977901478381 228.41431004116663 L 1142.7276890645048 232.07925949949995 L 1135.3977901478381 235.74420895783328 Z"/></g></g><g><g><rect fill="white" stroke="none" x="933.9063942474345" y="245.27307754949996" width="118.52209490882812" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="935.2257760524345" y="253.18936837949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1142.7276890645048 256.70771985949995 L 850.849134468859 256.70771985949995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(843.6071943391923,256.70771985949995) translate(-843.6071943391923,-256.70771985949995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 850.937093255859 253.04277040116662 L 843.6071943391923 256.70771985949995 L 850.937093255859 260.3726693178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="359.7403864862627" y="293.6504103994999" width="93.50543231117187" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="359.7403864862627" y="302.4462890994999" width="232.37210101234376" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="361.0597682912627" y="301.56670122949987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="361.0597682912627" y="310.3625799294999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 313.8809314094999 L 115.48761977534343 313.8809314094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(108.24567964567677,313.8809314094999) translate(-108.24567964567677,-313.8809314094999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 115.57557856234344 310.21598195116655 L 108.24567964567677 313.8809314094999 L 115.57557856234344 317.54588086783326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="362.8403849603838" y="350.8236219494999" width="93.68876666175781" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="362.8403849603838" y="359.6195006494999" width="226.17210406410157" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="364.1597667653838" y="358.7399127794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="364.1597667653838" y="367.5357914794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 371.0541429594999 L 115.48761977534343 371.0541429594999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(108.24567964567677,371.0541429594999) translate(-108.24567964567677,-371.0541429594999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 115.57557856234344 367.3891935011666 L 108.24567964567677 371.0541429594999 L 115.57557856234344 374.7190924178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="428.31538724920216" y="397.44177905949994" width="95.22209948646484" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="429.63476905420214" y="405.3580698894999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 108.24567964567677 408.87642136949995 L 836.3652542095257 408.87642136949995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(843.6071943391923,408.87642136949995) translate(-843.6071943391923,-408.87642136949995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 836.2772954225256 405.2114719111666 L 843.6071943391923 408.87642136949995 L 836.2772954225256 412.5413708278333 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 432.1854999245 L 839.2092549891923 432.1854999245 M 734.7141259280205 422.07023941949996 L 831.2929641591924 422.07023941949996 L 839.2092549891923 429.98653024949994 L 839.2092549891923 442.3007604295 L 734.7141259280205 442.3007604295 L 734.7141259280205 422.07023941949996 M 831.2929641591924 422.07023941949996 L 831.2929641591924 429.98653024949994 L 839.2092549891923 429.98653024949994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="747.0283561080205" y="434.3844695995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create ticket_digest</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 489.3587114745 L 839.2092549891923 489.3587114745 M 566.1474602786064 479.2434509695 L 831.2929641591925 479.2434509695 L 839.2092549891925 487.15974179949995 L 839.2092549891925 499.4739719795 L 566.1474602786064 499.4739719795 L 566.1474602786064 479.2434509695 M 831.2929641591925 479.2434509695 L 831.2929641591925 487.15974179949995 L 839.2092549891925 487.15974179949995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="578.4616904586064" y="491.5576811495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice's email_address is in access_token returned at step 3. a)</text></g><g><g><rect fill="white" stroke="none" x="635.0275644085966" y="512.6677900295" width="92.25543231117187" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="635.0275644085966" y="521.4636687295" width="118.0387651358789" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="636.3469462135967" y="520.5840808595" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="636.3469462135967" y="529.3799595595" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, ticket_digest)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 532.8983110395 L 551.7286397435465 532.8983110395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(544.4866996138799,532.8983110395) translate(-544.4866996138799,-532.8983110395)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 551.8165985305466 529.2333615811666 L 544.4866996138799 532.8983110395 L 551.8165985305466 536.5632604978333 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 579.9562620844998 L 839.2092549891923 579.9562620844998 M 625.8474572268486 569.8410015794999 L 831.2929641591924 569.8410015794999 L 839.2092549891923 577.7572924094999 L 839.2092549891923 590.0715225894999 L 625.8474572268486 590.0715225894999 L 625.8474572268486 569.8410015794999 M 831.2929641591924 569.8410015794999 L 831.2929641591924 577.7572924094999 L 839.2092549891923 577.7572924094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="638.1616874068486" y="582.1552317594998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is determined by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="589.6692308209501" y="603.2653406394999" width="92.43876666175781" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="589.6692308209501" y="612.0612193394999" width="208.7554323111719" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="590.9886126259502" y="611.1816314694998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="590.9886126259502" y="619.9775101694999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Alice's email_address, ticket_digest)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 623.4958616494998 L 551.7286397435465 623.4958616494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(544.4866996138799,623.4958616494998) translate(-544.4866996138799,-623.4958616494998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 551.8165985305466 619.8309121911665 L 544.4866996138799 623.4958616494998 L 551.8165985305466 627.1608111078332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 544.4866996138799 659.9987582544998 L 540.0887602638799 659.9987582544998 M 112.64361899567672 649.8834977494998 L 532.1724694338799 649.8834977494998 L 540.0887602638799 657.7997885794998 L 540.0887602638799 670.1140187594998 L 112.64361899567672 670.1140187594998 L 112.64361899567672 649.8834977494998 M 532.1724694338799 649.8834977494998 L 532.1724694338799 657.7997885794998 L 540.0887602638799 657.7997885794998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="124.95784917567676" y="662.1977279294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users' admin role, thus can query any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="224.68013912360644" y="683.3078368094998" width="82.93876666175781" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="224.68013912360644" y="692.1037155094998" width="203.37210101234376" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="225.99952092860644" y="691.2241276394998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="225.99952092860644" y="700.0200063394998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 544.4866996138799 703.5383578194998 L 115.48761977534343 703.5383578194998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(108.24567964567677,703.5383578194998) translate(-108.24567964567677,-703.5383578194998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 115.57557856234344 699.8734083611664 L 108.24567964567677 703.5383578194998 L 115.57557856234344 707.2033072778331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="278.7551398865459" y="716.7321758694998" width="95.22209948646484" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="280.0745216915459" y="724.6484666994997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 108.24567964567677 728.1668181794997 L 537.2447594842132 728.1668181794997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(544.4866996138799,728.1668181794997) translate(-544.4866996138799,-728.1668181794997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 537.1568006972132 724.5018687211664 L 544.4866996138799 728.1668181794997 L 537.1568006972132 731.8317676378331 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 544.4866996138799 775.2247692244997 L 540.0887602638799 775.2247692244997 M 177.46029990387984 765.1095087194998 L 532.1724694338799 765.1095087194998 L 540.0887602638799 773.0257995494998 L 540.0887602638799 785.3400297294997 L 177.46029990387984 785.3400297294997 L 177.46029990387984 765.1095087194998 M 532.1724694338799 765.1095087194998 L 532.1724694338799 773.0257995494998 L 540.0887602638799 773.0257995494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="189.77453008387988" y="777.4237388994997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alices's email_address extracted from access_token from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 544.4866996138799 832.3979807744996 L 540.0887602638799 832.3979807744996 M 236.14361899567672 822.2827202694997 L 532.1724694338799 822.2827202694997 L 540.0887602638799 830.1990110994997 L 540.0887602638799 842.5132412794997 L 236.14361899567672 842.5132412794997 L 236.14361899567672 822.2827202694997 M 532.1724694338799 822.2827202694997 L 532.1724694338799 830.1990110994997 L 540.0887602638799 830.1990110994997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="248.45784917567676" y="834.5969504494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alice's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="249.9134765259502" y="868.9008773794997" width="114.93876666175781" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="249.9134765259502" y="877.6967560794997" width="152.90542620765626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="251.2328583309502" y="876.8171682094996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query Alice's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="251.2328583309502" y="885.6130469094996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Alice's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 544.4866996138799 889.1313983894996 L 115.48761977534343 889.1313983894996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(108.24567964567677,889.1313983894996) translate(-108.24567964567677,-889.1313983894996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 115.57557856234344 885.4664489311663 L 108.24567964567677 889.1313983894996 L 115.57557856234344 892.796347847833 Z"/></g></g><g><g><rect fill="white" stroke="none" x="267.7801414124248" y="902.3252164394996" width="117.17209643470703" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="269.0995232174248" y="910.2415072694996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Alice's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 108.24567964567677 913.7598587494996 L 537.2447594842132 913.7598587494996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(544.4866996138799,913.7598587494996) translate(-544.4866996138799,-913.7598587494996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 537.1568006972132 910.0949092911662 L 544.4866996138799 913.7598587494996 L 537.1568006972132 917.4248082078329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="624.0525621197783" y="926.9536767994996" width="99.05542773353515" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="624.0525621197783" y="935.7495554994996" width="139.98876971351564" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="625.3719439247783" y="934.8699676294996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="625.3719439247783" y="943.6658463294996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Alice's user_claims, ticket_digest)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 544.4866996138799 947.1841978094996 L 836.3652542095257 947.1841978094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(843.6071943391923,947.1841978094996) translate(-843.6071943391923,-947.1841978094996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 836.2772954225256 943.5192483511662 L 843.6071943391923 947.1841978094996 L 836.2772954225256 950.8491472678329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="973.2145876596527" y="960.3780158594996" width="95.75543231117187" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="973.2145876596527" y="969.1738945594996" width="242.88876361" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="974.5339694646527" y="968.2943066894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="974.5339694646527" y="977.0901853894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(client_id, ticket, pushed_claims=claims_token + metadata)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 980.6085368694995 L 1338.4688044604466 980.6085368694995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1345.7107445901133,980.6085368694995) translate(-1345.7107445901133,-980.6085368694995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1338.3808456734466 976.9435874111662 L 1345.7107445901133 980.6085368694995 L 1338.3808456734466 984.2734863278329 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1174.2215113583554 1017.5512274094996 L 1509.283686991871 1017.5512274094996 L 1517.199977821871 1025.4675182394997 L 1517.199977821871 1055.3735058194995 L 1174.2215113583554 1055.3735058194995 L 1174.2215113583554 1017.5512274094996 M 1509.283686991871 1017.5512274094996 L 1509.283686991871 1025.4675182394997 L 1517.199977821871 1025.4675182394997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1186.5357415383555" y="1029.8654575894996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1186.5357415383555" y="1038.6613362894996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1186.5357415383555" y="1047.4572149894996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1155.9215071145047 1068.5673238694994 L 1527.5836912357217 1068.5673238694994 L 1535.4999820657217 1076.4836146994994 L 1535.4999820657217 1106.3896022794995 L 1155.9215071145047 1106.3896022794995 L 1155.9215071145047 1068.5673238694994 M 1527.5836912357217 1068.5673238694994 L 1527.5836912357217 1076.4836146994994 L 1535.4999820657217 1076.4836146994994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1168.2357372945048" y="1080.8815540494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server uses domain part of Alice's email_address extracted from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1168.2357372945048" y="1089.6774327494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to load Claims Provider configuration from URL:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1168.2357372945048" y="1098.4733114494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1193.7190708821513" y="1098.4733114494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1199.1190709775187" y="1098.4733114494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">' + domain_part_of_email_address + '/.well-known/claims-provider-configuration'</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1234.3881831112851 1119.5834203294994 L 1449.1170152389413 1119.5834203294994 L 1457.0333060689413 1127.4997111594994 L 1457.0333060689413 1192.5892135394995 L 1234.3881831112851 1192.5892135394995 L 1234.3881831112851 1119.5834203294994 M 1449.1170152389413 1119.5834203294994 L 1449.1170152389413 1127.4997111594994 L 1457.0333060689413 1127.4997111594994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.7024132912852" y="1131.8976505094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server evaluates:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.7024132912852" y="1140.6935292094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. domain part of email_address vs. claims issuer</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.7024132912852" y="1149.4894079094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.7024132912852" y="1158.2852866094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. ticket_digest vs. ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.7024132912852" y="1167.0811653094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.7024132912852" y="1175.8770440094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.7024132912852" y="1184.6729227094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. other_claims (recipient_info, file_info)</text></g><g><g><rect fill="white" stroke="none" x="1063.5312552164155" y="1218.9768496394993" width="62.25542849647461" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1064.8506370214154" y="1226.8931404694993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1345.7107445901133 1230.4114919494994 L 850.849134468859 1230.4114919494994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(843.6071943391923,1230.4114919494994) translate(-843.6071943391923,-1230.4114919494994)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 850.937093255859 1226.746542491166 L 843.6071943391923 1230.4114919494994 L 850.937093255859 1234.0764414078326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="898.7647240203837" y="1243.6053099994992" width="188.8054353629297" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="898.7647240203837" y="1252.4011886994992" width="24.138763609999998" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="900.0841058253837" y="1251.5216008294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Post data into bar.com 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="900.0841058253837" y="1260.3174795294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 843.6071943391923 1263.8358310094993 L 1135.485748934838 1263.8358310094993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1142.7276890645048,1263.8358310094993) translate(-1142.7276890645048,-1263.8358310094993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1135.3977901478381 1260.170881551166 L 1142.7276890645048 1263.8358310094993 L 1135.3977901478381 1267.5007804678326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="959.4897263092021" y="1277.0296490594992" width="67.35543078529297" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="960.8091081142021" y="1284.9459398894992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. 201 Created</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1142.7276890645048 1288.4642913694993 L 850.849134468859 1288.4642913694993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(843.6071943391923,1288.4642913694993) translate(-843.6071943391923,-1288.4642913694993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 850.937093255859 1284.799341911166 L 843.6071943391923 1288.4642913694993 L 850.937093255859 1292.1292408278325 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 77.46010419567678 269.90153790949995 L 874.3927697891924 269.90153790949995 L 874.3927697891924 384.24796100949993 L 77.46010419567678 384.24796100949993 L 77.46010419567678 269.90153790949995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 77.46010419567678 269.90153790949995 L 77.46010419567678 280.45659234949994 L 104.63519461111866 280.45659234949994 L 109.91272183111866 275.1790651295 L 109.91272183111866 269.90153790949995 L 77.46010419567678 269.90153790949995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="86.25598289567678" y="276.93824086949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="118.70860053111866" y="276.93824086949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Alice is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 77.46010419567678 327.0747494594999 L 874.3927697891924 327.0747494594999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="118.70860053111866" y="334.1114524194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Alice is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 513.7011241638799 455.4945784795 L 874.3927697891924 455.4945784795 L 874.3927697891924 636.6896796994998 L 513.7011241638799 636.6896796994998 L 513.7011241638799 455.4945784795 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 513.7011241638799 455.4945784795 L 513.7011241638799 466.04963291949997 L 540.8762145793218 466.04963291949997 L 546.1537417993218 460.7721056995 L 546.1537417993218 455.4945784795 L 513.7011241638799 455.4945784795" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="522.4970028638799" y="462.5312814395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="554.9496204993218" y="462.5312814395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 513.7011241638799 546.0921290894998 L 874.3927697891924 546.0921290894998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="554.9496204993218" y="553.1288320494999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 173.06236055387984 741.3606362294997 L 575.2722750638799 741.3606362294997 L 575.2722750638799 855.7070593294997 L 173.06236055387984 855.7070593294997 L 173.06236055387984 741.3606362294997 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 173.06236055387984 741.3606362294997 L 173.06236055387984 751.9156906694998 L 200.23745096932174 751.9156906694998 L 205.51497818932174 746.6381634494998 L 205.51497818932174 741.3606362294997 L 173.06236055387984 741.3606362294997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="181.85823925387984" y="748.3973391894998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="214.31085688932174" y="748.3973391894998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 173.06236055387984 798.5338477794996 L 575.2722750638799 798.5338477794996" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="214.31085688932174" y="805.5705507394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1151.5235677645048 993.8023549194995 L 1539.8979214157218 993.8023549194995 L 1539.8979214157218 1205.7830315894994 L 1151.5235677645048 1205.7830315894994 L 1151.5235677645048 993.8023549194995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1151.5235677645048 993.8023549194995 L 1151.5235677645048 1004.3574093594996 L 1248.4819938656767 1004.3574093594996 L 1253.7595210856766 999.0798821394995 L 1253.7595210856766 993.8023549194995 L 1151.5235677645048 993.8023549194995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1160.3194464645048" y="1000.8390578794996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g></g></g></svg>