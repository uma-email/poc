<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2403" height="1873"><desc>%0ATitle%20UMA%20wide%20ecosystem%20-%20Alice%20to%20Bob%20(push%20data)%20with%20DKIM%20signed%20claims%0A%0Aactor%20%22Alice%20(RqP)%5Cnalice%40gmail.com%5Cnor%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthN%20Server%5Cnfoo.com%22%20as%20authServer%20%23lightpink%0Aparticipant%20%22IMAP%20Server%5Cngmail.com%22%20as%20imapServer%20%23de5246%0Aparticipant%20%22SMTP%20Server%5Cngmail.com%22%20as%20smtpServer%20%23de5246%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnfoo.com%22%20as%20claimsProvider%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnfoo.com%22%20as%20rqpClient%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnbar.com%22%20as%20rsServer%20%23lightsteelblue%0Aparticipant%20%22AuthZ%20Server%5Cnbar.com%22%20as%20asServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RO)%5Cnbob%40outlook.com%5Cnor%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Anote%20right%20of%20Alice%3AAlice%20has%20set%20up%20her%20mailbox%20to%20auto-forward%20emails%20sent%20from%5Cnchallenge%40foo.com%20to%20response%40foo.com%0Aend%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Abox%20over%20claimsProvider%3AClaims%20Provider%20can%20send%20email%20messages%20from%20addresses%20challenge%40foo.com%20and%20retrieve%20from%20response%40foo.com%0Aend%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20foo.com%20AuthN%20server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20bar.com%20AuthZ%20server%0Anote%20right%20of%20rsServer%3Abar.com%20Admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%20set%5Cn'Incoming'%20and%20'Outgoing'%20with%20the%20bar.com%20AuthZ%20server%20with%20the%20associated%20scopes%3A%5Cn'Outgoing'%3A%20query%2C%20view%5Cn'Incoming'%3A%20create%0Anote%20over%20claimsProvider%3AClaims%20Provider%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Ffoo.com%2F.well-known%2Fclaims-provider-configuration%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20registered%20at%20Alice's%20AuthN%20server%20and%20is%20assigned%20'query-users'%2C%20'view-user'%20admin%20role%0AAlice-%3ErqpClient%3AInitiate%20request%0ArqpClient-%3ErsServer%3A1.%20Request%20Bob's%20'Incoming'%20resource%5Cn(scope%3Dcreate)%0ArqpClient%3C-rsServer%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Alice%20is%20involved%0AauthServer%3C-rqpClient%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Alice%20is%20not%20involved%0AauthServer%3C-rqpClient%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0AauthServer-%3ErqpClient%3A4.%20Return%20access_token%0Anote%20left%20of%20rqpClient%3Aticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0Aalt%20Get%20Claims%20%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20left%20of%20rqpClient%3AAlice's%20email_address%20is%20in%20access_token%20returned%20at%20step%203.%20a)%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%2C%20ticket_challenge)%0Aelse%20Get%20Claims%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20left%20of%20rqpClient%3A%20The%20email_address%20is%20determined%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%2C%20Alice's%20email_address%2C%20ticket_challenge)%0Aend%0Anote%20left%20of%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users%2C%20view-users'%20admin%20role%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0AauthServer%3C-claimsProvider%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users%2C%20view-users)%0AauthServer-%3EclaimsProvider%3A7.%20Return%20access_token%0A%0Aalt%20Prepare%20email_address%20-%20Alice%20was%20involved%20at%20step%20%203.%20a)%0Anote%20over%20claimsProvider%3AUse%20Alices's%20email_address%20extracted%20from%20access_token%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Alice%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20over%20claimsProvider%3AUse%20Alice's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Alice's%20user_claims%5Cn(access_token%2C%20Alice's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Alice's%20user_claims%0A%0Aopt%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0AsmtpServer%3C-claimsProvider%3A10.%20Send%20plain_message%20from%20challenge%40foo.com%20to%20alice%40gmail.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0AimapServer-%3EclaimsProvider%3A11.%20Retrieve%20dkim_signed_message%20sent%20from%20alice%40gmail.com%20to%20response%40foo.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0Aend%0AclaimsProvider-%3ErqpClient%3A12.%20Return%20claims_token%5Cn(Alice's%20user_claims%2C%20dkim_signed_message%20-%20optional)%5Cnif%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Aalt%20Domain%20part%20of%20email_address%20or%20Webfinger%20is%20used%20to%20locate%20Claims%20Provider%20configuration%20url%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrup%20discovery%20of%20Claims%20Provider%20config%20url%20via%20Webfinger%2C%20if%20it%20doesn't%20work%5Cnbuild%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%20%5Cn5.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20evaluate%20user_claims%5Cn8.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aelse%20Alice%20has%20to%20demonstrate%20control%20of%20her%20mailbox%0Anote%20over%20asServer%3A1.%20extract%20dkim_signed%20_message%20from%20claims_token%5Cn2.%20verify%20DKIM%20signature%20of%20dkim_signed%20_message%5Cn3.%20extract%20'From%3A'%20part%20of%20dkim_signed_message%20e.g.%20Alice%20Henderson%20%3Calice%40gmail.com%3E%5Cn4.%20extract%20claims_provider_configuration_url%20and%20ticket_challenge%20from%20dkim_signed_message%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20extract%20user_claims%20from%20claims_token%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArqpClient-%3ErsServer%3A15.%20Post%20data%20into%20Bob's%20'Incoming'%20resource%5Cn(RPT)%0ArqpClient%3C-rsServer%3A16.%20201%20Created</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2403" height="1873"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="975.4784997503559" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Alice to Bob (push data) with DKIM signed claims</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 39.97739949404297 95.7431396495 L 39.97739949404297 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 335.2051398370508 95.7431396495 L 335.2051398370508 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 432.285161945028 95.7431396495 L 432.285161945028 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 622.418105802515 95.7431396495 L 622.418105802515 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1157.6398691789213 95.7431396495 L 1157.6398691789213 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 95.7431396495 L 1475.5787000091298 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1753.594885652411 95.7431396495 L 1753.594885652411 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2133.7635484428797 95.7431396495 L 2133.7635484428797 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2361.7288065496377 95.7431396495 L 2361.7288065496377 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 44.99105035304297 32.148936648500005 A 5.013650858999999 5.013650858999999 0 1 1 44.99104784621775 32.14392299847661 M 39.97739949404297 37.1625875075 L 39.97739949404297 47.893559521499995 M 33.64436683004297 41.032774135500006 L 46.31043215804297 41.032774135500006 M 39.97739949404297 47.893559521499995 L 33.64436683004297 57.9208612395 M 39.97739949404297 47.893559521499995 L 46.31043215804297 57.9208612395" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="16.392888690820314" y="66.7167399395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.5126186395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="35.83029713808594" y="84.30849733950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="9.059728290429689" y="93.10437603950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 297.66582287333205 63.2863472465 L 372.74445680076957 63.2863472465 L 372.74445680076957 95.7431396495 L 297.66582287333205 95.7431396495 L 297.66582287333205 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="307.20935126283206" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.61444922425784" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 396.30585779869205 63.2863472465 L 468.26446609136394 63.2863472465 L 468.26446609136394 95.7431396495 L 396.30585779869205 95.7431396495 L 396.30585779869205 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="405.84938618819206" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="411.03268239180534" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 584.8856324056908 63.2863472465 L 659.9505791993392 63.2863472465 L 659.9505791993392 95.7431396495 L 584.8856324056908 95.7431396495 L 584.8856324056908 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="594.4291607951908" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="601.1656262492924" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1104.3001142879566 63.2863472465 L 1210.9796240698863 63.2863472465 L 1210.9796240698863 95.7431396495 L 1104.3001142879566 95.7431396495 L 1104.3001142879566 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1113.8436426774565" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1141.0491785661284" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1443.7419205820322 63.2863472465 L 1507.4154794362275 63.2863472465 L 1507.4154794362275 95.7431396495 L 1443.7419205820322 95.7431396495 L 1443.7419205820322 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1453.285448971532" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1458.9880093963368" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1698.1758918698447 63.2863472465 L 1809.0138794349775 63.2863472465 L 1809.0138794349775 95.7431396495 L 1698.1758918698447 95.7431396495 L 1698.1758918698447 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1707.7194202593446" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1737.0042560747743" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2096.743472812169 63.2863472465 L 2170.7836240735905 63.2863472465 L 2170.7836240735905 95.7431396495 L 2096.743472812169 95.7431396495 L 2096.743472812169 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2106.2870012016688" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2117.172918865243" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2366.7424574086376 32.148936648500005 A 5.013650858999999 5.013650858999999 0 1 1 2366.7424549018124 32.14392299847661 M 2361.7288065496377 37.1625875075 L 2361.7288065496377 47.893559521499995 M 2355.395773885638 41.032774135500006 L 2368.0618392136375 41.032774135500006 M 2361.7288065496377 47.893559521499995 L 2355.395773885638 57.9208612395 M 2361.7288065496377 47.893559521499995 L 2368.0618392136375 57.9208612395" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2342.031777435868" y="66.7167399395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2324.0655451360635" y="75.5126186395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2357.5817041936807" y="84.30849733950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2332.6217127386026" y="93.10437603950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 44.99105035304297 1842.2088349279984 A 5.013650858999999 5.013650858999999 0 1 1 44.99104784621775 1842.203821277975 M 39.97739949404297 1847.2224857869983 L 39.97739949404297 1857.9534578009982 M 33.64436683004297 1851.0926724149983 L 46.31043215804297 1851.0926724149983 M 39.97739949404297 1857.9534578009982 L 33.64436683004297 1867.9807595189982 M 39.97739949404297 1857.9534578009982 L 46.31043215804297 1867.9807595189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="16.392888690820314" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1816.2170133694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="35.83029713808594" y="1825.0128920694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="9.059728290429689" y="1833.8087707694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 297.66582287333205 1798.6252559694983 L 372.74445680076957 1798.6252559694983 L 372.74445680076957 1831.0820483724983 L 297.66582287333205 1831.0820483724983 L 297.66582287333205 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="307.20935126283206" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.61444922425784" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 396.30585779869205 1798.6252559694983 L 468.26446609136394 1798.6252559694983 L 468.26446609136394 1831.0820483724983 L 396.30585779869205 1831.0820483724983 L 396.30585779869205 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="405.84938618819206" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="411.03268239180534" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="#de5246" stroke="black" paint-order="fill stroke markers" d=" M 584.8856324056908 1798.6252559694983 L 659.9505791993392 1798.6252559694983 L 659.9505791993392 1831.0820483724983 L 584.8856324056908 1831.0820483724983 L 584.8856324056908 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="594.4291607951908" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="601.1656262492924" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">gmail.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1104.3001142879566 1798.6252559694983 L 1210.9796240698863 1798.6252559694983 L 1210.9796240698863 1831.0820483724983 L 1104.3001142879566 1831.0820483724983 L 1104.3001142879566 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1113.8436426774565" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1141.0491785661284" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 1443.7419205820322 1798.6252559694983 L 1507.4154794362275 1798.6252559694983 L 1507.4154794362275 1831.0820483724983 L 1443.7419205820322 1831.0820483724983 L 1443.7419205820322 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1453.285448971532" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1458.9880093963368" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1698.1758918698447 1798.6252559694983 L 1809.0138794349775 1798.6252559694983 L 1809.0138794349775 1831.0820483724983 L 1698.1758918698447 1831.0820483724983 L 1698.1758918698447 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1707.7194202593446" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1737.0042560747743" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2096.743472812169 1798.6252559694983 L 2170.7836240735905 1798.6252559694983 L 2170.7836240735905 1831.0820483724983 L 2096.743472812169 1831.0820483724983 L 2096.743472812169 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2106.2870012016688" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2117.172918865243" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2366.7424574086376 1842.2088349279984 A 5.013650858999999 5.013650858999999 0 1 1 2366.7424549018124 1842.203821277975 M 2361.7288065496377 1847.2224857869983 L 2361.7288065496377 1857.9534578009982 M 2355.395773885638 1851.0926724149983 L 2368.0618392136375 1851.0926724149983 M 2361.7288065496377 1857.9534578009982 L 2355.395773885638 1867.9807595189982 M 2361.7288065496377 1857.9534578009982 L 2368.0618392136375 1867.9807595189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2342.031777435868" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2324.0655451360635" y="1816.2170133694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2357.5817041936807" y="1825.0128920694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2332.6217127386026" y="1833.8087707694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 39.97739949404297 151.59696939449998 L 44.37533884404297 151.59696939449998 M 44.37533884404297 137.0837695395 L 314.0950309570508 137.0837695395 L 322.0113217870508 145.0000603695 L 322.0113217870508 166.1101692495 L 44.37533884404297 166.1101692495 L 44.37533884404297 137.0837695395 M 314.0950309570508 137.0837695395 L 314.0950309570508 145.0000603695 L 322.0113217870508 145.0000603695" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="56.68956902404298" y="149.39799971949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice has set up her mailbox to auto-forward emails sent from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="56.68956902404298" y="158.19387841949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">challenge@foo.com to response@foo.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 902.8054516209917 216.2466778395 L 1412.474286736851 216.2466778395 L 1412.474286736851 236.47719884949998 L 902.8054516209917 236.47719884949998 L 902.8054516209917 216.2466778395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="915.1196818009917" y="228.56090801949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider can send email messages from addresses challenge@foo.com and retrieve from response@foo.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1201.9604537158484 262.8648349495 L 1741.280655472411 262.8648349495 L 1749.1969463024109 270.7811257795 L 1749.1969463024109 283.0953559595 L 1201.9604537158484 283.0953559595 L 1201.9604537158484 262.8648349495 M 1741.280655472411 262.8648349495 L 1741.280655472411 270.7811257795 L 1749.1969463024109 270.7811257795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1214.2746838958485" y="275.17906512950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at foo.com AuthN server and pre-registered as a universal AEMS public client at bar.com AuthZ server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1753.594885652411 319.5982525645 L 1757.9928250024109 319.5982525645 M 1757.9928250024109 296.2891740095 L 2121.44931826288 296.2891740095 L 2129.36560909288 304.2054648395 L 2129.36560909288 342.9073311195 L 1757.9928250024109 342.9073311195 L 1757.9928250024109 296.2891740095 M 2121.44931826288 296.2891740095 L 2121.44931826288 304.2054648395 L 2129.36560909288 304.2054648395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1770.307055182411" y="308.6034041895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com Admin has set up the Resource Server and registers it's resource set</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1770.307055182411" y="317.3992828895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming' and 'Outgoing' with the bar.com AuthZ server with the associated scopes:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1770.307055182411" y="326.1951615895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing': query, view</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1770.307055182411" y="334.9910402895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming': create</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 924.9848186864214 356.10114916949993 L 1382.3786288414215 356.10114916949993 L 1390.2949196714214 364.0174399994999 L 1390.2949196714214 376.33167017949995 L 924.9848186864214 376.33167017949995 L 924.9848186864214 356.10114916949993 M 1382.3786288414215 356.10114916949993 L 1382.3786288414215 364.0174399994999 L 1390.2949196714214 364.0174399994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.2990488664213" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1165.9431986466948" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1171.1265177384917" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com/.well-known/claims-provider-configuration</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1157.6398691789213 399.64074873449994 L 1153.2419298289215 399.64074873449994 M 695.1101125353276 389.5254882294999 L 1145.3256389989215 389.5254882294999 L 1153.2419298289215 397.4417790594999 L 1153.2419298289215 409.7560092394999 L 695.1101125353276 409.7560092394999 L 695.1101125353276 389.5254882294999 M 1145.3256389989215 389.5254882294999 L 1145.3256389989215 397.4417790594999 L 1153.2419298289215 397.4417790594999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="707.4243427153276" y="401.83971840949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is registered at Alice's AuthN server and is assigned 'query-users', 'view-user' admin role</text></g><g><g><rect fill="white" stroke="none" x="725.86436863018" y="422.9498272894999" width="63.8273622428125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="727.1837504351801" y="430.8661181194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 39.97739949404297 434.38446959949994 L 1468.336759879463 434.38446959949994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1475.5787000091298,434.38446959949994) translate(-1475.5787000091298,-434.38446959949994)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1468.248801092463 430.7195201411666 L 1475.5787000091298 434.38446959949994 L 1468.248801092463 438.0494190578333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1536.4491966092664" y="447.57828764949994" width="156.27519244300782" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1536.4491966092664" y="456.37416634949994" width="65.1163026725" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1537.7685784142664" y="455.4945784794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1537.7685784142664" y="464.2904571794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=create)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 467.80880865949996 L 1746.3529455227442 467.80880865949996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1753.594885652411,467.80880865949996) translate(-1753.594885652411,-467.80880865949996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1746.2649867357443 464.1438592011666 L 1753.594885652411 467.80880865949996 L 1746.2649867357443 471.4737581178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1554.681870254286" y="481.00262670949996" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1556.001252059286" y="488.91891753949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1753.594885652411 492.4372690195 L 1482.8206401387965 492.4372690195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1475.5787000091298,492.4372690195) translate(-1475.5787000091298,-492.4372690195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1482.9085989257965 488.7723195611666 L 1475.5787000091298 492.4372690195 L 1482.9085989257965 496.10221847783333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="787.4070718094964" y="529.3799595595" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="787.4070718094964" y="538.1758382595" width="235.9696962271875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="788.7264536144964" y="537.2962503895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="788.7264536144964" y="546.0921290895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 549.6104805694999 L 342.44707996671747 549.6104805694999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(335.2051398370508,549.6104805694999) translate(-335.2051398370508,-549.6104805694999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 342.53503875371746 545.9455311111666 L 335.2051398370508 549.6104805694999 L 342.53503875371746 553.2754300278333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="790.784421663012" y="586.5531711094999" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="790.784421663012" y="595.3490498094999" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="792.1038034680121" y="594.4694619394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="792.1038034680121" y="603.2653406394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 606.7836921194998 L 342.44707996671747 606.7836921194998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(335.2051398370508,606.7836921194998) translate(-335.2051398370508,-606.7836921194998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 342.53503875371746 603.1187426611665 L 335.2051398370508 606.7836921194998 L 342.53503875371746 610.4486415778332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="855.072492341723" y="633.1713282194999" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.391874146723" y="641.0876190494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 335.2051398370508 644.6059705294998 L 1468.336759879463 644.6059705294998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1475.5787000091298,644.6059705294998) translate(-1475.5787000091298,-644.6059705294998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1468.248801092463 640.9410210711665 L 1475.5787000091298 644.6059705294998 L 1468.248801092463 648.2709199878332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 667.9150490844997 L 1471.1807606591299 667.9150490844997 M 1215.0432823547937 657.7997885794998 L 1463.2644698291297 657.7997885794998 L 1471.1807606591296 665.7160794094998 L 1471.1807606591296 678.0303095894998 L 1215.0432823547937 678.0303095894998 L 1215.0432823547937 657.7997885794998 M 1463.2644698291297 657.7997885794998 L 1463.2644698291297 665.7160794094998 L 1471.1807606591296 665.7160794094998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.3575125347938" y="670.1140187594997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 725.0882606344998 L 1471.1807606591299 725.0882606344998 M 1188.6347587952234 714.9730001294998 L 1463.2644698291297 714.9730001294998 L 1471.1807606591296 722.8892909594998 L 1471.1807606591296 735.2035211394998 L 1188.6347587952234 735.2035211394998 L 1188.6347587952234 714.9730001294998 M 1463.2644698291297 714.9730001294998 L 1463.2644698291297 722.8892909594998 L 1471.1807606591296 722.8892909594998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1200.9489889752235" y="727.2872303094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice's email_address is in access_token returned at step 3. a)</text></g><g><g><rect fill="white" stroke="none" x="1247.6244746274047" y="748.3973391894998" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1247.6244746274047" y="757.1932178894998" width="137.9696199332422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1248.9438564324046" y="756.3136300194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1248.9438564324046" y="765.1095087194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 768.6278601994998 L 1164.8818093085881 768.6278601994998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1157.6398691789213,768.6278601994998) translate(-1157.6398691789213,-768.6278601994998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1164.969768095588 764.9629107411664 L 1157.6398691789213 768.6278601994998 L 1164.969768095588 772.2928096578331 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 815.6858112444996 L 1471.1807606591299 815.6858112444996 M 1249.0125816712 805.5705507394997 L 1463.2644698291297 805.5705507394997 L 1471.1807606591296 813.4868415694997 L 1471.1807606591296 825.8010717494997 L 1249.0125816712 825.8010717494997 L 1249.0125816712 805.5705507394997 M 1463.2644698291297 805.5705507394997 L 1463.2644698291297 813.4868415694997 L 1471.1807606591296 813.4868415694997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1261.3268118512" y="817.8847809194996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is determined by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="1200.0728388852172" y="838.9948897994997" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1200.0728388852172" y="847.7907684994997" width="233.0728914176172" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.392220690217" y="846.9111806294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.392220690217" y="855.7070593294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Alice's email_address, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 859.2254108094996 L 1164.8818093085881 859.2254108094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1157.6398691789213,859.2254108094996) translate(-1157.6398691789213,-859.2254108094996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1164.969768095588 855.5604613511663 L 1157.6398691789213 859.2254108094996 L 1164.969768095588 862.890360267833 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1157.6398691789213 895.7283074144996 L 1153.2419298289215 895.7283074144996 M 626.8160451525151 885.6130469094996 L 1145.3256389989215 885.6130469094996 L 1153.2419298289215 893.5293377394996 L 1153.2419298289215 905.8435679194996 L 626.8160451525151 905.8435679194996 L 626.8160451525151 885.6130469094996 M 1145.3256389989215 885.6130469094996 L 1145.3256389989215 893.5293377394996 L 1153.2419298289215 893.5293377394996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="639.1302753325151" y="897.9272770894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users, view-users' admin role, thus can query and view any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="618.5971107400954" y="919.0373859694996" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="618.5971107400954" y="927.8332646694996" width="255.65078753578126" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="619.9164925450955" y="926.9536767994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="619.9164925450955" y="935.7495554994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1157.6398691789213 939.2679069794996 L 342.44707996671747 939.2679069794996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(335.2051398370508,939.2679069794996) translate(-335.2051398370508,-939.2679069794996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 342.53503875371746 935.6029575211662 L 335.2051398370508 939.2679069794996 L 342.53503875371746 942.9328564378329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="696.1030769266189" y="952.4617250294996" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="697.4224587316189" y="960.3780158594996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 335.2051398370508 963.8963673394995 L 1150.3979290492546 963.8963673394995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1157.6398691789213,963.8963673394995) translate(-1157.6398691789213,-963.8963673394995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1150.3099702622546 960.2314178811662 L 1157.6398691789213 963.8963673394995 L 1150.3099702622546 967.5613167978329 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 970.2317058934526 1000.8390578794996 L 1337.1317416343902 1000.8390578794996 L 1345.0480324643902 1008.7553487094996 L 1345.0480324643902 1021.0695788894996 L 970.2317058934526 1021.0695788894996 L 970.2317058934526 1000.8390578794996 M 1337.1317416343902 1000.8390578794996 L 1337.1317416343902 1008.7553487094996 L 1345.0480324643902 1008.7553487094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="982.5459360734526" y="1013.1532880594995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alices's email_address extracted from access_token from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1001.5935222997026 1058.0122694294994 L 1305.7699252281402 1058.0122694294994 L 1313.6862160581402 1065.9285602594994 L 1313.6862160581402 1078.2427904394995 L 1001.5935222997026 1078.2427904394995 L 1001.5935222997026 1058.0122694294994 M 1305.7699252281402 1058.0122694294994 L 1305.7699252281402 1065.9285602594994 L 1313.6862160581402 1065.9285602594994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.9077524797026" y="1070.3264996094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Alice's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="665.9255638040603" y="1104.6304265394992" width="142.66552752601564" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="665.9255638040603" y="1113.4263052394992" width="160.99388140785157" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="667.2449456090603" y="1112.5467173694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Alice's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="667.2449456090603" y="1121.3425960694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Alice's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1157.6398691789213 1124.8609475494993 L 342.44707996671747 1124.8609475494993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(335.2051398370508,1124.8609475494993) translate(-335.2051398370508,-1124.8609475494993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 342.53503875371746 1121.195998091166 L 335.2051398370508 1124.8609475494993 L 342.53503875371746 1128.5258970078326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="685.1124534524978" y="1138.0547655994992" width="122.62010211097656" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="686.4318352574978" y="1145.9710564294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Alice's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 335.2051398370508 1149.4894079094993 L 1150.3979290492546 1149.4894079094993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1157.6398691789213,1149.4894079094993) translate(-1157.6398691789213,-1149.4894079094993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1150.3099702622546 1145.824458451166 L 1157.6398691789213 1149.4894079094993 L 1150.3099702622546 1153.1543573678325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="742.0943407931401" y="1186.432098449499" width="295.86929339515626" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="742.0943407931401" y="1195.227977149499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="743.4137225981401" y="1194.348389279499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Send plain_message from challenge@foo.com to alice@gmail.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="743.4137225981401" y="1203.144267979499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1157.6398691789213 1206.6626194594992 L 629.6600459321817 1206.6626194594992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(622.418105802515,1206.6626194594992) translate(-622.418105802515,-1206.6626194594992)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 629.7480047191817 1202.997670001166 L 622.418105802515 1206.6626194594992 L 629.7480047191817 1210.3275689178324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="615.2380281661543" y="1219.856437509499" width="359.44897479164064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="615.2380281661543" y="1228.652316209499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="616.5574099711544" y="1227.772728339499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Retrieve dkim_signed_message sent from alice@gmail.com to response@foo.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="616.5574099711544" y="1236.568607039499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 432.285161945028 1240.0869585194991 L 1150.3979290492546 1240.0869585194991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1157.6398691789213,1240.0869585194991) translate(-1157.6398691789213,-1240.0869585194991)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1150.3099702622546 1236.422009061166 L 1157.6398691789213 1240.0869585194991 L 1150.3099702622546 1243.7519079778324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1168.0483256405882" y="1266.474594619499" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1168.0483256405882" y="1275.270473319499" width="229.42907733070314" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1168.0483256405882" y="1284.066352019499" width="297.121917906875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1169.3677074455882" y="1274.390885449499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1169.3677074455882" y="1283.186764149499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Alice's user_claims, dkim_signed_message - optional)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1169.3677074455882" y="1291.982642849499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1157.6398691789213 1295.500994329499 L 1468.336759879463 1295.500994329499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1475.5787000091298,1295.500994329499) translate(-1475.5787000091298,-1295.500994329499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1468.248801092463 1291.8360448711658 L 1475.5787000091298 1295.500994329499 L 1468.248801092463 1299.1659437878322 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1725.713688526962" y="1308.694812379499" width="98.06091326820312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1725.713688526962" y="1317.490691079499" width="157.91487139808595" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1727.0330703319619" y="1316.6111032094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1727.0330703319619" y="1325.4069819094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 1328.925333389499 L 2126.521608313213 1328.925333389499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2133.7635484428797,1328.925333389499) translate(-2133.7635484428797,-1328.925333389499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2126.4336495262132 1325.2603839311657 L 2133.7635484428797 1328.925333389499 L 2126.4336495262132 1332.5902828478322 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1958.1180499523327 1342.1191514394989 L 2301.4927561034265 1342.1191514394989 L 2309.4090469334265 1350.0354422694988 L 2309.4090469334265 1379.941429849499 L 1958.1180499523327 1379.941429849499 L 1958.1180499523327 1342.1191514394989 M 2301.4927561034265 1342.1191514394989 L 2301.4927561034265 1350.0354422694988 L 2309.4090469334265 1350.0354422694988" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1970.4322801323328" y="1354.433381619499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1970.4322801323328" y="1363.229260319499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1970.4322801323328" y="1372.025139019499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1950.851021143739 1440.6329928794987 L 2308.75978491202 1440.6329928794987 L 2316.67607574202 1448.5492837094987 L 2316.67607574202 1531.2305434894988 L 1950.851021143739 1531.2305434894988 L 1950.851021143739 1440.6329928794987 M 2308.75978491202 1440.6329928794987 L 2308.75978491202 1448.5492837094987 L 2316.67607574202 1448.5492837094987" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1452.9472230594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1461.7431017594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1470.5389804594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrup discovery of Claims Provider config url via Webfinger, if it doesn't work</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1479.3348591594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1488.1307378594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature </text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1496.9266165594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1505.7224952594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1514.5183739594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1963.165251323739" y="1523.3142526594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate other optional claims e.g. recipient_info, file_info</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1927.7879870861218 1568.1732340294986 L 2331.8228189696374 1568.1732340294986 L 2339.7391097996374 1576.0895248594986 L 2339.7391097996374 1658.7707846394987 L 1927.7879870861218 1658.7707846394987 L 1927.7879870861218 1568.1732340294986 M 2331.8228189696374 1568.1732340294986 L 2331.8228189696374 1576.0895248594986 L 2339.7391097996374 1576.0895248594986" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1580.4874642094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract dkim_signed _message from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1589.2833429094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. verify DKIM signature of dkim_signed _message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1598.0792216094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. extract 'From:' part of dkim_signed_message e.g. Alice Henderson &lt;alice@gmail.com&gt;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1606.8751003094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. extract claims_provider_configuration_url and ticket_challenge from dkim_signed_message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1615.6709790094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1624.4668577094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1633.2627364094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1642.0586151094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.102217266122" y="1650.8544938094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="1770.9492155655362" y="1698.3522387894984" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1772.268597370536" y="1706.2685296194984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2133.7635484428797 1709.7868810994985 L 1482.8206401387965 1709.7868810994985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1475.5787000091298,1709.7868810994985) translate(-1475.5787000091298,-1709.7868810994985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1482.9085989257965 1706.1219316411652 L 1475.5787000091298 1709.7868810994985 L 1482.9085989257965 1713.4518305578317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1522.7052162015516" y="1722.9806991494984" width="183.7631532584375" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1522.7052162015516" y="1731.7765778494984" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1524.0245980065515" y="1730.8969899794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Post data into Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1524.0245980065515" y="1739.6928686794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1475.5787000091298 1743.2112201594985 L 1746.3529455227442 1743.2112201594985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1753.594885652411,1743.2112201594985) translate(-1753.594885652411,-1743.2112201594985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1746.2649867357443 1739.5462707011652 L 1753.594885652411 1743.2112201594985 L 1746.2649867357443 1746.8761696178317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1579.8172843778211" y="1756.4050382094983" width="69.53901690589844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1581.136666182821" y="1764.3213290394983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 201 Created</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1753.594885652411 1767.8396805194984 L 1482.8206401387965 1767.8396805194984" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1475.5787000091298,1767.8396805194984) translate(-1475.5787000091298,-1767.8396805194984)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1482.9085989257965 1764.1747310611652 L 1475.5787000091298 1767.8396805194984 L 1482.9085989257965 1771.5046299778317 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 9.191824044042974 113.3348970495 L 326.4092611370508 113.3348970495 L 326.4092611370508 179.3039872995 L 9.191824044042974 179.3039872995 L 9.191824044042974 113.3348970495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 9.191824044042974 113.3348970495 L 9.191824044042974 123.88995148949999 L 38.370876976269535 123.88995148949999 L 43.64840419626954 118.6124242695 L 43.64840419626954 113.3348970495 L 9.191824044042974 113.3348970495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="17.987702744042974" y="120.37160000949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="52.44428289626954" y="120.37160000949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 898.4075122709917 192.4978053495 L 1416.872226086851 192.4978053495 L 1416.872226086851 249.6710168995 L 898.4075122709917 249.6710168995 L 898.4075122709917 192.4978053495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 898.4075122709917 192.4978053495 L 898.4075122709917 203.0528597895 L 927.5865652032182 203.0528597895 L 932.8640924232183 197.7753325695 L 932.8640924232183 192.4978053495 L 898.4075122709917 192.4978053495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="907.2033909709917" y="199.53450830949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="941.6599711232183" y="199.53450830949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 304.4195643870508 505.6310870695 L 1506.3642754591297 505.6310870695 L 1506.3642754591297 619.9775101694999 L 304.4195643870508 619.9775101694999 L 304.4195643870508 505.6310870695 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 304.4195643870508 505.6310870695 L 304.4195643870508 516.1861415095 L 330.7090756933008 516.1861415095 L 335.9866029133008 510.9086142895 L 335.9866029133008 505.6310870695 L 304.4195643870508 505.6310870695" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="313.2154430870508" y="512.6677900295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="344.78248161330083" y="512.6677900295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Alice is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 304.4195643870508 562.8042986194998 L 1506.3642754591297 562.8042986194998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="344.78248161330083" y="569.8410015794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Alice is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.8542937289214 691.2241276394998 L 1506.3642754591297 691.2241276394998 L 1506.3642754591297 872.4192288594996 L 1126.8542937289214 872.4192288594996 L 1126.8542937289214 691.2241276394998 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1126.8542937289214 691.2241276394998 L 1126.8542937289214 701.7791820794998 L 1153.1438050351715 701.7791820794998 L 1158.4213322551714 696.5016548594998 L 1158.4213322551714 691.2241276394998 L 1126.8542937289214 691.2241276394998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1135.6501724289215" y="698.2608305994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1167.2172109551714" y="698.2608305994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.8542937289214 781.8216782494997 L 1506.3642754591297 781.8216782494997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1167.2172109551714" y="788.8583812094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 965.8337665434526 977.0901853894995 L 1349.44597181439 977.0901853894995 L 1349.44597181439 1091.4366084894993 L 965.8337665434526 1091.4366084894993 L 965.8337665434526 977.0901853894995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 965.8337665434526 977.0901853894995 L 965.8337665434526 987.6452398294996 L 992.1232778497026 987.6452398294996 L 997.4008050697026 982.3677126094996 L 997.4008050697026 977.0901853894995 L 965.8337665434526 977.0901853894995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="974.6296452434526" y="984.1268883494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1006.1966837697026" y="984.1268883494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 965.8337665434526 1034.2633969394994 L 1349.44597181439 1034.2633969394994" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1006.1966837697026" y="1041.3000998994994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Alice was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 401.499586495028 1162.6832259594992 L 1188.4254446289212 1162.6832259594992 L 1188.4254446289212 1253.280776569499 L 401.499586495028 1253.280776569499 L 401.499586495028 1162.6832259594992 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 401.499586495028 1162.6832259594992 L 401.499586495028 1173.2382803994992 L 430.67863942725455 1173.2382803994992 L 435.9561666472546 1167.960753179499 L 435.9561666472546 1162.6832259594992 L 401.499586495028 1162.6832259594992" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="410.295465195028" y="1169.7199289194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="444.7520453472546" y="1169.7199289194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1914.594169036122 1393.1352478994988 L 2352.9329278496375 1393.1352478994988 L 2352.9329278496375 1685.1584207394985 L 1914.594169036122 1685.1584207394985 L 1914.594169036122 1393.1352478994988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1914.594169036122 1393.1352478994988 L 1914.594169036122 1403.6903023394989 L 2010.8660259234266 1403.6903023394989 L 2016.1435531434265 1398.4127751194987 L 2016.1435531434265 1393.1352478994988 L 1914.594169036122 1393.1352478994988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1923.390047736122" y="1400.1719508594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1923.390047736122 1416.8841203894988 L 2344.1370491496377 1416.8841203894988 L 2344.1370491496377 1671.9646026894986 L 1923.390047736122 1671.9646026894986 L 1923.390047736122 1416.8841203894988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1923.390047736122 1416.8841203894988 L 1923.390047736122 1427.4391748294988 L 1949.679559042372 1427.4391748294988 L 1954.9570862623718 1422.1616476094987 L 1954.9570862623718 1416.8841203894988 L 1923.390047736122 1416.8841203894988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1932.185926436122" y="1423.9208233494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1963.7529649623718" y="1423.9208233494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Domain part of email_address or Webfinger is used to locate Claims Provider configuration url]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1923.390047736122 1544.4243615394987 L 2344.1370491496377 1544.4243615394987" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1963.7529649623718" y="1551.4610644994987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Alice has to demonstrate control of her mailbox]</text></g><g/></g></g></svg>