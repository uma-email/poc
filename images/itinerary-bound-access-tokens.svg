<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1620" height="1176"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20over%20client%2CAS%3AHMAC(HMAC(K2%2C%20HMAC(K1%2C%20m1))%2C%20m2)%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Anote%20right%20of%20RS%3ARS%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Aclient-%3EAS%3A1.%20Authorization%20Grant%0AAS-%3EAS%3A2.%20AS%3A%5Cn%E2%80%A2%20creates%20an%20opaque%20Access%20Token%20using%20high%20entropy%20nonce%20data%20string%0Aclient%3C-AS%3A3.%20Access%20Token%0Aclient-%3Eclient%3A4.%20Client%3A%5Cn%E2%80%A2%20generates%20the%20Route-JWT%20with%20a%20payload%20including%20the%20Access%20Token%20and%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20Route-JWT%20is%20generated%20as%3A%5CnRoute-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url(%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D)%5Cnpayload%20%3D%20base64url(%7B%22token%22%3AAccess%20Token%2C%22ts%22%3Atimestamp%7D)%5Cnsignature%20%3D%20base64url(HMAC-SHA256(K1%2C%20m1))%5Cnwhere%5Cnm1%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnK1%20%3D%20SHA256(client's%20client%20secret)%0Aclient-%3ERS%3A5.%20Route-JWT%0ARS-%3ERS%3A6.%20RS%3A%5Cn%E2%80%A2%20generates%20the%20next%20Route-JWT%20(additional%20claims%20can%20be%20added%20to%20the%20JWT%20payload)%0Anote%20right%20of%20RS%3AThe%20Route-JWT%20is%20generated%20as%3A%5CnRoute-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20previous%20Route-JWT%20header%5Cnpayload%20%3D%20previous%20Route-JWT%20payload%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key%2C%20m2))%5Cnwhere%5Cnm2%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey%20%3D%20HMAC-SHA256(K2%2C%20message)%5Cnwhere%5CnK2%20%3D%20SHA256(RS's%20client%20secret)%5Cnmessage%20%3D%20base64url%20decoded%20previous%20Route-JWT%20signature%0ARS-%3EAS%3A7.%20Route-JWT%0Anote%20right%20of%20RS%3ARS%20sends%20the%20Route-JWT%20in%20the%20Authorization%20header%5Cnto%20authenticate%20itself%20to%20the%20AS%20introspection%20endpoint%0AAS-%3EAS%3A8.%20AS%3A%5Cn%20a)%20looks%20up%20the%20Access%20Token%20data%20using%20the%20token%20claim%20value%20from%20the%20Route-JWT%2C%20and%20checks%20the%20token%20state%5Cn%20b)%20generates%20the%20Itinerary-JWT%20in%20an%20analogous%20manner%20as%20the%20Route-JWT%20using%20the%20payload%20from%20the%20Route-JWT%5Cn%20c)%20compares%20the%20Itinerary-JWT%20signature%20with%20the%20Route-JWT%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20Access%20Token%20route%20and%20the%20Route-JWT%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20value%20from%20the%20Route-JWT%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20return%20the%20Access%20Token%20introspection%20response%0ARS%3C-AS%3A9.%20Access%20Token%20introspection%20response%0ARS-%3ERS%3A10.%20RS%3A%5Cn%E2%80%A2%20verifies%20the%20Access%20Token%20introspection%20response%2C%20if%20true%2C%5Cn%20%20%20the%20RS%20may%20return%20the%20protected%20resource%0Aclient%3C-RS%3A11.%20Protected%20Resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1620" height="1176"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 38.111285853 L 33.37474404576514 1136.213913843" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 38.111285853 L 523.8745492934214 1136.213913843" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 998.2076980469371 38.111285853 L 998.2076980469371 1136.213913843" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 7.690111091999997 L 61.09499464153028 7.690111091999997 L 61.09499464153028 38.111285853 L 5.654493450000004 38.111285853 L 5.654493450000004 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 454.9792985069214 7.690111091999997 L 592.7698000799214 7.690111091999997 L 592.7698000799214 38.111285853 L 454.9792985069214 38.111285853 L 454.9792985069214 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="467.2495492934214" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 918.1041113839723 7.690111091999997 L 1078.3112847099019 7.690111091999997 L 1078.3112847099019 38.111285853 L 918.1041113839723 38.111285853 L 918.1041113839723 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="930.3743621704723" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 1136.213913843 L 61.09499464153028 1136.213913843 L 61.09499464153028 1166.635088604 L 5.654493450000004 1166.635088604 L 5.654493450000004 1136.213913843 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="1155.326101704" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 454.9792985069214 1136.213913843 L 592.7698000799214 1136.213913843 L 592.7698000799214 1166.635088604 L 454.9792985069214 1166.635088604 L 454.9792985069214 1136.213913843 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="467.2495492934214" y="1155.326101704" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 918.1041113839723 1136.213913843 L 1078.3112847099019 1136.213913843 L 1078.3112847099019 1166.635088604 L 918.1041113839723 1166.635088604 L 918.1041113839723 1136.213913843 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="930.3743621704723" y="1155.326101704" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 23.196655835765142 60.729259653 L 998.207698046937 60.729259653 L 1008.3857862569371 70.907347863 L 1008.3857862569371 86.739929523 L 23.196655835765142 86.739929523 L 23.196655835765142 60.729259653 M 998.207698046937 60.729259653 L 998.207698046937 70.907347863 L 1008.3857862569371 70.907347863" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="414.44955387105813" y="76.561841313" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">HMAC(HMAC(K2, HMAC(K1, m1)), m2)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 122.363238258 L 39.029237495765145 122.363238258 M 39.029237495765145 103.703409873 L 437.7663126057651 103.703409873 L 447.9444008157651 113.881498083 L 447.9444008157651 141.023066643 L 39.029237495765145 141.023066643 L 39.029237495765145 103.703409873 M 437.7663126057651 103.703409873 L 437.7663126057651 113.881498083 L 447.9444008157651 113.881498083" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="119.53599153299999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="130.844978433" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 176.646375378 L 529.5290427434214 176.646375378 M 529.5290427434214 157.986546993 L 928.2661178534214 157.986546993 L 938.4442060634215 168.164635203 L 938.4442060634215 195.30620376299998 L 529.5290427434214 195.30620376299998 L 529.5290427434214 157.986546993 M 928.2661178534214 157.986546993 L 928.2661178534214 168.164635203 L 938.4442060634215 168.164635203" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="173.81912865299998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="185.128115553" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><g><g><rect fill="white" stroke="none" x="454.7948737742905" y="212.26968411299998" width="121.9926945441211" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="456.49122180929055" y="222.44777232299998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Authorization Grant</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 226.971367083 L 988.8966321659371 226.971367083" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(998.2076980469371,226.971367083) translate(-998.2076980469371,-226.971367083)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 988.7835422969372 222.25928920799998 L 998.2076980469371 226.971367083 L 988.7835422969372 231.683444958 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="243.93484743300002" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="255.24383433300002" width="387.2093769782031" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="254.11293564300001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="265.421922543" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• creates an opaque Access Token using high entropy nonce data string</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 998.2076980469371 269.94551730300003 L 1043.443645646937 269.94551730300003 L 1043.443645646937 284.647200273 L 1007.5187639279371 284.647200273" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(998.2076980469371,284.647200273) translate(-998.2076980469371,-284.647200273)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1007.6318537969371 279.93512239800003 L 998.2076980469371 284.647200273 L 1007.6318537969371 289.359278148 Z"/></g></g><g><g><rect fill="white" stroke="none" x="472.1448722484116" y="301.610680623" width="87.2926975958789" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="473.84122028341164" y="311.788768833" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Access Token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 998.2076980469371 316.312363593 L 42.685809926765145 316.312363593" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,316.312363593) translate(-33.37474404576514,-316.312363593)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 311.600285718 L 33.37474404576514 316.312363593 L 42.79889979576514 321.02444146799996 Z"/></g></g><g><g><rect fill="white" stroke="none" x="46.75704521076514" y="333.275843943" width="51.47602813176758" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="344.58483084299996" width="473.15935866765625" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="343.453932153" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="354.76291905299996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the Route-JWT with a payload including the Access Token and a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 359.286513813 L 78.61069164576514 359.286513813 L 78.61069164576514 373.988196783 L 42.685809926765145 373.988196783" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,373.988196783) translate(-33.37474404576514,-373.988196783)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 369.276118908 L 33.37474404576514 373.988196783 L 42.79889979576514 378.70027465799996 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 449.19295966799996 L 39.029237495765145 449.19295966799996 M 39.029237495765145 390.951677133 L 391.449631697562 390.951677133 L 401.627719907562 401.129765343 L 401.627719907562 507.434242203 L 39.029237495765145 507.434242203 L 39.029237495765145 390.951677133 M 391.449631697562 390.951677133 L 391.449631697562 401.129765343 L 401.627719907562 401.129765343" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="406.78425879299994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="418.0932456929999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="429.4022325929999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="440.7112194929999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url({"typ":"JWT","alg":"HS256"})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="452.02020639299985" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url({"token":Access Token,"ts":timestamp})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="463.32919329299983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(K1, m1))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="474.6381801929998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="485.9471670929998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">m1 = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="497.25615399299977" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">K1 = SHA256(client's client secret)</text></g><g><g><rect fill="white" stroke="none" x="242.31163374811868" y="524.397722553" width="72.62602584294922" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="244.00798178311868" y="534.575810763" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 539.099405523 L 514.5634834124214 539.099405523" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(523.8745492934214,539.099405523) translate(-523.8745492934214,-539.099405523)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 514.4503935434215 534.387327648 L 523.8745492934214 539.099405523 L 514.4503935434215 543.811483398 Z"/></g></g><g><g><rect fill="white" stroke="none" x="537.2568504584214" y="556.062885873" width="34.75936286382324" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="537.2568504584214" y="567.3718727730001" width="456.9927021735156" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="566.2409740830001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="577.5499609830001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the next Route-JWT (additional claims can be added to the JWT payload)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 582.073555743 L 569.1104968934214 582.073555743 L 569.1104968934214 596.775238713 L 533.1856151744214 596.775238713" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(523.8745492934214,596.775238713) translate(-523.8745492934214,-596.775238713)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 533.2987050434214 592.063160838 L 523.8745492934214 596.775238713 L 533.2987050434214 601.487316588 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 688.943481948 L 529.5290427434214 688.943481948 M 529.5290427434214 613.738719063 L 878.8327987616245 613.738719063 L 889.0108869716246 623.916807273 L 889.0108869716246 764.148244833 L 529.5290427434214 764.148244833 L 529.5290427434214 613.738719063 M 878.8327987616245 613.738719063 L 878.8327987616245 623.916807273 L 889.0108869716246 623.916807273" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="629.571300723" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="640.8802876230001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="652.1892745230001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="663.4982614230001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = previous Route-JWT header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="674.8072483230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = previous Route-JWT payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="686.1162352230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key, m2))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="697.4252221230003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="708.7342090230003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">m2 = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="720.0431959230003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = HMAC-SHA256(K2, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="731.3521828230004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="742.6611697230004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">K2 = SHA256(RS's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="753.9701566230004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = base64url decoded previous Route-JWT signature</text></g><g><g><rect fill="white" stroke="none" x="724.7281107487047" y="781.1117251830001" width="72.62602584294922" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="726.4244587837047" y="791.2898133930001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 795.8134081530001 L 988.8966321659371 795.8134081530001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(998.2076980469371,795.8134081530001) translate(-998.2076980469371,-795.8134081530001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 988.7835422969372 791.1013302780001 L 998.2076980469371 795.8134081530001 L 988.7835422969372 800.525486028 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 831.4367168880001 L 529.5290427434214 831.4367168880001 M 529.5290427434214 812.776888503 L 838.8494613592808 812.776888503 L 849.0275495692808 822.9549767130001 L 849.0275495692808 850.0965452730001 L 529.5290427434214 850.0965452730001 L 529.5290427434214 812.776888503 M 838.8494613592808 812.776888503 L 838.8494613592808 822.9549767130001 L 849.0275495692808 822.9549767130001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="828.6094701630002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS sends the Route-JWT in the Authorization header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="839.9184570630002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to authenticate itself to the AS introspection endpoint</text></g><g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="867.060025623" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="878.369012523" width="598.6260334723438" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="889.6779994230001" width="604.7260090582813" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="900.9869863230001" width="467.69268386296875" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="912.2959732230001" width="353.39269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="923.6049601230002" width="429.2926899664844" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1011.5899992119371" y="934.9139470230002" width="337.7926899664844" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="877.238113833" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="888.5471007330001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the Access Token data using the token claim value from the Route-JWT, and checks the token state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="899.8560876330001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates the Itinerary-JWT in an analogous manner as the Route-JWT using the payload from the Route-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="911.1650745330002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) compares the Itinerary-JWT signature with the Route-JWT signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="922.4740614330002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the Access Token route and the Route-JWT have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="933.7830483330002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim value from the Route-JWT, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.2863472469371" y="945.0920352330003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may return the Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 998.2076980469371 949.6156299930001 L 1043.443645646937 949.6156299930001 L 1043.443645646937 964.3173129630001 L 1007.5187639279371 964.3173129630001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(998.2076980469371,964.3173129630001) translate(-998.2076980469371,-964.3173129630001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1007.6318537969371 959.6052350880001 L 998.2076980469371 964.3173129630001 L 1007.6318537969371 969.029390838 Z"/></g></g><g><g><rect fill="white" stroke="none" x="654.8447756351793" y="981.2807933130001" width="212.39269607" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="656.5411236701793" y="991.4588815230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 998.2076980469371 995.9824762830001 L 533.1856151744214 995.9824762830001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(523.8745492934214,995.9824762830001) translate(-523.8745492934214,-995.9824762830001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 533.2987050434214 991.2703984080001 L 523.8745492934214 995.9824762830001 L 533.2987050434214 1000.6945541580001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="537.2568504584214" y="1012.9459566330002" width="41.542697595878906" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="537.2568504584214" y="1024.2549435330002" width="314.12603347234375" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="537.2568504584214" y="1035.5639304330002" width="236.8426930182422" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="1023.1240448430002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="1034.4330317430001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• verifies the Access Token introspection response, if true,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="1045.7420186430002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the RS may return the protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 1050.265613403 L 569.1104968934214 1050.265613403 L 569.1104968934214 1064.9672963730002 L 533.1856151744214 1064.9672963730002" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(523.8745492934214,1064.9672963730002) translate(-523.8745492934214,-1064.9672963730002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 533.2987050434214 1060.2552184980002 L 523.8745492934214 1064.9672963730002 L 533.2987050434214 1069.6793742480002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="215.03663222223977" y="1081.930776723" width="127.17602889470703" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="216.73298025723977" y="1092.108864933" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Protected Resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 1096.632459693 L 42.685809926765145 1096.632459693" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,1096.632459693) translate(-33.37474404576514,-1096.632459693)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 1091.9203818180001 L 33.37474404576514 1096.632459693 L 42.79889979576514 1101.344537568 Z"/></g></g></g></g></svg>