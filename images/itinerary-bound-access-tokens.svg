<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1613" height="1133"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Anote%20right%20of%20RS%3ARS%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Aclient-%3EAS%3A1.%20Authorization%20Grant%0AAS-%3EAS%3A2.%20AS%3A%5Cn%E2%80%A2%20creates%20an%20opaque%20Access%20Token%20using%20high%20entropy%20nonce%20data%20string%0Aclient%3C-AS%3A3.%20Access%20Token%0Aclient-%3Eclient%3A4.%20Client%3A%5Cn%E2%80%A2%20generates%20the%20Route-JWT%20with%20a%20payload%20including%20the%20Access%20Token%20and%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20Route-JWT%20is%20generated%20as%3A%5CnRoute-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url(%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D)%5Cnpayload%20%3D%20base64url(%7B%22token%22%3AAccess%20Token%2C%22ts%22%3Atimestamp%7D)%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key%2C%20message))%5Cnwhere%5Cnmessage%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey%20%3D%20SHA256(client's%20client%20secret)%0Aclient-%3ERS%3A5.%20Route-JWT%0ARS-%3ERS%3A6.%20RS%3A%5Cn%E2%80%A2%20generates%20the%20next%20Route-JWT%20(aditional%20claims%20can%20be%20added%20to%20the%20JWT%20payload)%0Anote%20right%20of%20RS%3AThe%20Route-JWT%20is%20generated%20as%3A%5CnRoute-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20previous%20Route-JWT%20header%5Cnpayload%20%3D%20previous%20Route-JWT%20payload%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key2%2C%20message2))%5Cnwhere%5Cnmessage2%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey2%20%3D%20HMAC-SHA256(Key1%2C%20message1)%5Cnwhere%5CnKey1%20%3D%20SHA256(RS's%20client%20secret)%5Cnmessage1%20%3D%20base64url%20decoded%20previous%20Route-JWT%20signature%0ARS-%3EAS%3A7.%20Route-JWT%0Anote%20right%20of%20RS%3ARS%20sends%20the%20Route-JWT%20in%20the%20Authorization%20header%5Cnto%20authenticate%20itself%20to%20the%20AS%20introspection%20endpoint%0AAS-%3EAS%3A8.%20AS%3A%5Cn%20a)%20looks%20up%20the%20Access%20Token%20data%20using%20the%20token%20claim%20value%20from%20the%20Route-JWT%2C%20and%20checks%20the%20token%20state%5Cn%20b)%20generates%20the%20Itinerary-JWT%20in%20an%20analogous%20manner%20as%20the%20Route-JWT%20using%20the%20payload%20from%20the%20Route-JWT%5Cn%20c)%20compares%20the%20Itinerary-JWT%20signature%20with%20the%20Route-JWT%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20Access%20Token%20route%20and%20the%20Route-JWT%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20value%20from%20the%20Route-JWT%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20return%20the%20Access%20Token%20introspection%20response%0ARS%3C-AS%3A9.%20Access%20Token%20introspection%20response%0ARS-%3ERS%3A10.%20RS%3A%5Cn%E2%80%A2%20verifies%20the%20Access%20Token%20introspection%20response%2C%20if%20true%2C%5Cn%20%20%20the%20RS%20may%20return%20the%20protected%20resource%0Aclient%3C-RS%3A11.%20Protected%20Resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1613" height="1133"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 38.111285853 L 33.37474404576514 1093.239763623" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 38.111285853 L 523.8745492934214 1093.239763623" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 991.4410354492809 38.111285853 L 991.4410354492809 1093.239763623" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 7.690111091999997 L 61.09499464153028 7.690111091999997 L 61.09499464153028 38.111285853 L 5.654493450000004 38.111285853 L 5.654493450000004 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 454.9792985069214 7.690111091999997 L 592.7698000799214 7.690111091999997 L 592.7698000799214 38.111285853 L 454.9792985069214 38.111285853 L 454.9792985069214 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="467.2495492934214" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 911.337448786316 7.690111091999997 L 1071.5446221122456 7.690111091999997 L 1071.5446221122456 38.111285853 L 911.337448786316 38.111285853 L 911.337448786316 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="923.607699572816" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 1093.239763623 L 61.09499464153028 1093.239763623 L 61.09499464153028 1123.660938384 L 5.654493450000004 1123.660938384 L 5.654493450000004 1093.239763623 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="1112.351951484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 454.9792985069214 1093.239763623 L 592.7698000799214 1093.239763623 L 592.7698000799214 1123.660938384 L 454.9792985069214 1123.660938384 L 454.9792985069214 1093.239763623 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="467.2495492934214" y="1112.351951484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 911.337448786316 1093.239763623 L 1071.5446221122456 1093.239763623 L 1071.5446221122456 1123.660938384 L 911.337448786316 1123.660938384 L 911.337448786316 1093.239763623 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="923.607699572816" y="1112.351951484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 79.38908803800001 L 39.029237495765145 79.38908803800001 M 39.029237495765145 60.72925965300001 L 437.7663126057651 60.72925965300001 L 447.9444008157651 70.90734786300001 L 447.9444008157651 98.04891642300001 L 39.029237495765145 98.04891642300001 L 39.029237495765145 60.72925965300001 M 437.7663126057651 60.72925965300001 L 437.7663126057651 70.90734786300001 L 447.9444008157651 70.90734786300001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="76.561841313" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="87.87082821300001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 133.67222515800003 L 529.5290427434214 133.67222515800003 M 529.5290427434214 115.01239677300003 L 928.2661178534214 115.01239677300003 L 938.4442060634215 125.19048498300003 L 938.4442060634215 152.33205354300003 L 529.5290427434214 152.33205354300003 L 529.5290427434214 115.01239677300003 M 928.2661178534214 115.01239677300003 L 928.2661178534214 125.19048498300003 L 938.4442060634215 125.19048498300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="130.84497843300002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="142.15396533300003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><g><g><rect fill="white" stroke="none" x="451.4115424754624" y="169.29553389300003" width="121.9926945441211" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="453.1078905104624" y="179.47362210300003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Authorization Grant</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 183.99721686300003 L 982.1299695682809 183.99721686300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(991.4410354492809,183.99721686300003) translate(-991.4410354492809,-183.99721686300003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 982.0168796992809 179.28513898800003 L 991.4410354492809 183.99721686300003 L 982.0168796992809 188.70929473800004 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="200.96069721300006" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="212.26968411300007" width="387.2093769782031" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="211.13878542300006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="222.44777232300007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• creates an opaque Access Token using high entropy nonce data string</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 991.4410354492809 226.97136708300005 L 1036.6769830492808 226.97136708300005 L 1036.6769830492808 241.67305005300005 L 1000.7521013302809 241.67305005300005" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(991.4410354492809,241.67305005300005) translate(-991.4410354492809,-241.67305005300005)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1000.8651911992808 236.96097217800005 L 991.4410354492809 241.67305005300005 L 1000.8651911992808 246.38512792800006 Z"/></g></g><g><g><rect fill="white" stroke="none" x="468.7615409495835" y="258.63653040300005" width="87.2926975958789" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="470.4578889845835" y="268.81461861300005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Access Token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 991.4410354492809 273.33821337300003 L 42.685809926765145 273.33821337300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,273.33821337300003) translate(-33.37474404576514,-273.33821337300003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 268.62613549800005 L 33.37474404576514 273.33821337300003 L 42.79889979576514 278.050291248 Z"/></g></g><g><g><rect fill="white" stroke="none" x="46.75704521076514" y="290.301693723" width="51.47602813176758" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="301.610680623" width="473.15935866765625" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="300.479781933" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="311.788768833" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the Route-JWT with a payload including the Access Token and a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 316.31236359300004 L 78.61069164576514 316.31236359300004 L 78.61069164576514 331.014046563 L 42.685809926765145 331.014046563" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,331.014046563) translate(-33.37474404576514,-331.014046563)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 326.30196868800004 L 33.37474404576514 331.014046563 L 42.79889979576514 335.726124438 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 406.218809448 L 39.029237495765145 406.218809448 M 39.029237495765145 347.977526913 L 391.449631697562 347.977526913 L 401.627719907562 358.155615123 L 401.627719907562 464.46009198300004 L 39.029237495765145 464.46009198300004 L 39.029237495765145 347.977526913 M 391.449631697562 347.977526913 L 391.449631697562 358.155615123 L 401.627719907562 358.155615123" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="363.810108573" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="375.11909547299996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="386.42808237299994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="397.7370692729999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url({"typ":"JWT","alg":"HS256"})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="409.0460561729999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url({"token":Access Token,"ts":timestamp})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="420.3550430729999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key, message))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="431.66402997299986" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="442.97301687299984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="454.2820037729998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(client's client secret)</text></g><g><g><rect fill="white" stroke="none" x="242.31163374811868" y="481.42357233300004" width="72.62602584294922" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="244.00798178311868" y="491.60166054300004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 496.125255303 L 514.5634834124214 496.125255303" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(523.8745492934214,496.125255303) translate(-523.8745492934214,-496.125255303)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 514.4503935434215 491.41317742800004 L 523.8745492934214 496.125255303 L 514.4503935434215 500.837333178 Z"/></g></g><g><g><rect fill="white" stroke="none" x="537.2568504584214" y="513.0887356530001" width="34.75936286382324" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="537.2568504584214" y="524.3977225530001" width="450.2260395758594" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="523.2668238630001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="534.5758107630002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the next Route-JWT (aditional claims can be added to the JWT payload)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 539.0994055230001 L 569.1104968934214 539.0994055230001 L 569.1104968934214 553.8010884930001 L 533.1856151744214 553.8010884930001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(523.8745492934214,553.8010884930001) translate(-523.8745492934214,-553.8010884930001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 533.2987050434214 549.0890106180001 L 523.8745492934214 553.8010884930001 L 533.2987050434214 558.513166368 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 645.969331728 L 529.5290427434214 645.969331728 M 529.5290427434214 570.764568843 L 885.616123956937 570.764568843 L 895.7942121669371 580.9426570530001 L 895.7942121669371 721.1740946130001 L 529.5290427434214 721.1740946130001 L 529.5290427434214 570.764568843 M 885.616123956937 570.764568843 L 885.616123956937 580.9426570530001 L 895.7942121669371 580.9426570530001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="586.5971505030001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="597.9061374030001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="609.2151243030002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="620.5241112030002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = previous Route-JWT header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="631.8330981030002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = previous Route-JWT payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="643.1420850030003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key2, message2))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="654.4510719030003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="665.7600588030003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message2 = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="677.0690457030004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key2 = HMAC-SHA256(Key1, message1)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="688.3780326030004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="699.6870195030004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key1 = SHA256(RS's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="710.9960064030005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message1 = base64url decoded previous Route-JWT signature</text></g><g><g><rect fill="white" stroke="none" x="721.3447794498766" y="738.1375749630001" width="72.62602584294922" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="723.0411274848766" y="748.3156631730002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 752.8392579330001 L 982.1299695682809 752.8392579330001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(991.4410354492809,752.8392579330001) translate(-991.4410354492809,-752.8392579330001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 982.0168796992809 748.1271800580001 L 991.4410354492809 752.8392579330001 L 982.0168796992809 757.5513358080001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 788.4625666680001 L 529.5290427434214 788.4625666680001 M 529.5290427434214 769.802738283 L 838.8494613592808 769.802738283 L 849.0275495692808 779.9808264930001 L 849.0275495692808 807.1223950530001 L 529.5290427434214 807.1223950530001 L 529.5290427434214 769.802738283 M 838.8494613592808 769.802738283 L 838.8494613592808 779.9808264930001 L 849.0275495692808 779.9808264930001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="785.6353199430002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS sends the Route-JWT in the Authorization header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="545.3616244034214" y="796.9443068430003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to authenticate itself to the AS introspection endpoint</text></g><g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="824.085875403" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="835.3948623030001" width="598.6260334723438" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="846.7038492030001" width="604.7260090582813" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="858.0128361030002" width="467.69268386296875" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="869.3218230030002" width="353.39269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="880.6308099030002" width="429.2926899664844" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1004.8233366142808" y="891.9397968030003" width="337.7926899664844" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="834.2639636130001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="845.5729505130001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the Access Token data using the token claim value from the Route-JWT, and checks the token state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="856.8819374130002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates the Itinerary-JWT in an analogous manner as the Route-JWT using the payload from the Route-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="868.1909243130002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) compares the Itinerary-JWT signature with the Route-JWT signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="879.4999112130002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the Access Token route and the Route-JWT have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="890.8088981130003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim value from the Route-JWT, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1006.5196846492809" y="902.1178850130003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may return the Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 991.4410354492809 906.6414797730001 L 1036.6769830492808 906.6414797730001 L 1036.6769830492808 921.3431627430001 L 1000.7521013302809 921.3431627430001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(991.4410354492809,921.3431627430001) translate(-991.4410354492809,-921.3431627430001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1000.8651911992808 916.6310848680001 L 991.4410354492809 921.3431627430001 L 1000.8651911992808 926.0552406180001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="651.4614443363512" y="938.3066430930002" width="212.39269607" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="653.1577923713512" y="948.4847313030002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 991.4410354492809 953.0083260630001 L 533.1856151744214 953.0083260630001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(523.8745492934214,953.0083260630001) translate(-523.8745492934214,-953.0083260630001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 533.2987050434214 948.2962481880002 L 523.8745492934214 953.0083260630001 L 533.2987050434214 957.7204039380001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="537.2568504584214" y="969.9718064130001" width="41.542697595878906" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="537.2568504584214" y="981.2807933130001" width="314.12603347234375" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="537.2568504584214" y="992.5897802130002" width="236.8426930182422" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="980.1498946230001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="991.4588815230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• verifies the Access Token introspection response, if true,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="538.9531984934214" y="1002.7678684230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the RS may return the protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 1007.2914631830001 L 569.1104968934214 1007.2914631830001 L 569.1104968934214 1021.9931461530001 L 533.1856151744214 1021.9931461530001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(523.8745492934214,1021.9931461530001) translate(-523.8745492934214,-1021.9931461530001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 533.2987050434214 1017.2810682780001 L 523.8745492934214 1021.9931461530001 L 533.2987050434214 1026.7052240280002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="215.03663222223977" y="1038.956626503" width="127.17602889470703" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="216.73298025723977" y="1049.134714713" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Protected Resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 523.8745492934214 1053.6583094730001 L 42.685809926765145 1053.6583094730001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,1053.6583094730001) translate(-33.37474404576514,-1053.6583094730001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 1048.9462315980002 L 33.37474404576514 1053.6583094730001 L 42.79889979576514 1058.3703873480001 Z"/></g></g></g></g></svg>