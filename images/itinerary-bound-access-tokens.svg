<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1493" height="1286"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Anote%20right%20of%20RS%3ARS%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Aclient-%3EAS%3A1.%20Authorization%20Grant%0AAS-%3EAS%3A2.%20AS%3A%5Cn%E2%80%A2%20creates%20an%20opaque%20Access%20Token%20using%20high%20entropy%20nonce%20data%20string%0Aclient%3C-AS%3A3.%20Access%20Token%0Aclient-%3Eclient%3A4.%20Client%3A%5Cn%20a)%20computes%20the%20intermediary%20Route-MAC%5Cn%20b)%20generates%20the%20intermadiary%20Route-JWT%20with%20a%20payload%20including%5Cn%20%20%20%20%20the%20Access%20Token%20and%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20Route-MAC%20is%20computed%20as%3A%5CnRoute-MAC%20%3D%20HMAC-SHA256(Key%2C%20message)%5Cnwhere%5CnKey%20%3D%20SHA256(client's%20client%20secret)%5Cnmessage%20%3D%20Access%20Token%0Anote%20right%20of%20client%3AThe%20Route-JWT%20is%20generated%20as%3A%5CnRoute-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url(%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D)%5Cnpayload%20%3D%20base64url(%7B%22token%22%3AAccess%20Token%2C%22ts%22%3Atimestamp%7D)%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key%2C%20message))%5Cnwhere%5Cnmessage%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey%20%3D%20Route-MAC%0Aclient-%3ERS%3A5.%20Route-JWT%0ARS-%3ERS%3A6.%20RS%3A%5Cn%20a)%20computes%20the%20destination%20Route-MAC%5Cn%20b)%20creates%20the%20destination%20Route-JWT%20by%20replacing%20the%20Route-JWT%20signature%5Cn%20%20%20%20%20with%20the%20base64url%20encoded%20Route-MAC%20value%0Anote%20right%20of%20RS%3AThe%20Route-MAC%20is%20computed%20as%3A%5CnRoute-MAC%20%3D%20HMAC-SHA256(Key%2C%20message)%5Cnwhere%5CnKey%20%3D%20SHA256(RS's%20client%20secret)%5Cnmessage%20%3D%20Route-JWT%20signature%0ARS-%3EAS%3A7.%20Route-JWT%0Anote%20right%20of%20RS%3ARS%20sends%20the%20destination%20Route-JWT%20in%20the%20Authorization%20header%5Cnto%20authenticate%20itself%20to%20the%20AS%20introspection%20endpoint%0AAS-%3EAS%3A8.%20AS%3A%5Cn%20a)%20looks%20up%20the%20Access%20Token%20data%20using%20the%20token%20claim%20value%20from%20the%20Route-JWT%2C%20and%20checks%20the%20token%20state%5Cn%20b)%20computes%20the%20itermediary%20Itinerary-MAC%5Cn%20c)%20generates%20the%20intermediary%20Itinerary-JWT%20with%20the%20payload%20from%20the%20Route-JWT%5Cn%20d)%20computes%20the%20destination%20Itinerary-MAC%5Cn%20e)%20creates%20the%20destination%20Itinerary-JWT%20by%20replacing%20the%20Itinerary-JWT%20signature%5Cn%20%20%20%20%20with%20the%20base64url%20encoded%20Itinerary-MAC%20value%5Cn%20f)%20%20compares%20the%20destination%20Itinerary-JWT%20signature%20with%20the%20Route-JWT%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20Access%20Token%20route%20and%20the%20Route-JWT%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20value%20from%20the%20Route-JWT%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20return%20the%20Access%20Token%20introspection%20response%0Anote%20right%20of%20AS%3AItinerary-MAC%20and%20Itinerary-JWT%20are%20computed%2C%20generated%20and%20created%20in%20an%20analogous%20manner%5Cnas%20Route-MAC%20and%20Route-JWT.%0ARS%3C-AS%3A9.%20Access%20Token%20introspection%20response%0ARS-%3ERS%3A10.%20RS%3A%5Cn%E2%80%A2%20verifies%20the%20Access%20Token%20introspection%20response%2C%20if%20true%2C%5Cn%20%20%20the%20RS%20may%20return%20the%20protected%20resource%0Aclient%3C-RS%3A11.%20Protected%20Resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1493" height="1286"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 38.111285853 L 33.37474404576514 1247.041985463" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 38.111285853 L 453.5988942657651 1247.041985463" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.5320491227965 38.111285853 L 877.5320491227965 1247.041985463" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 7.690111091999997 L 61.09499464153028 7.690111091999997 L 61.09499464153028 38.111285853 L 5.654493450000004 38.111285853 L 5.654493450000004 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 384.7036434792651 7.690111091999997 L 522.4941450522651 7.690111091999997 L 522.4941450522651 38.111285853 L 384.7036434792651 38.111285853 L 384.7036434792651 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="396.9738942657651" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 797.4284624598316 7.690111091999997 L 957.6356357857613 7.690111091999997 L 957.6356357857613 38.111285853 L 797.4284624598316 38.111285853 L 797.4284624598316 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.6987132463316" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 1247.041985463 L 61.09499464153028 1247.041985463 L 61.09499464153028 1277.463160224 L 5.654493450000004 1277.463160224 L 5.654493450000004 1247.041985463 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="1266.1541733239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 384.7036434792651 1247.041985463 L 522.4941450522651 1247.041985463 L 522.4941450522651 1277.463160224 L 384.7036434792651 1277.463160224 L 384.7036434792651 1247.041985463 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="396.9738942657651" y="1266.1541733239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 797.4284624598316 1247.041985463 L 957.6356357857613 1247.041985463 L 957.6356357857613 1277.463160224 L 797.4284624598316 1277.463160224 L 797.4284624598316 1247.041985463 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.6987132463316" y="1266.1541733239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 79.38908803800001 L 39.029237495765145 79.38908803800001 M 39.029237495765145 60.72925965300001 L 437.7663126057651 60.72925965300001 L 447.9444008157651 70.90734786300001 L 447.9444008157651 98.04891642300001 L 39.029237495765145 98.04891642300001 L 39.029237495765145 60.72925965300001 M 437.7663126057651 60.72925965300001 L 437.7663126057651 70.90734786300001 L 447.9444008157651 70.90734786300001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="76.561841313" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="87.87082821300001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 133.67222515800003 L 459.25338771576514 133.67222515800003 M 459.25338771576514 115.01239677300003 L 857.9904628257651 115.01239677300003 L 868.1685510357652 125.19048498300003 L 868.1685510357652 152.33205354300003 L 459.25338771576514 152.33205354300003 L 459.25338771576514 115.01239677300003 M 857.9904628257651 115.01239677300003 L 857.9904628257651 125.19048498300003 L 868.1685510357652 125.19048498300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="130.84497843300002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="142.15396533300003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><g><g><rect fill="white" stroke="none" x="394.4570493122202" y="169.29553389300003" width="121.9926945441211" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="396.1533973472202" y="179.47362210300003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Authorization Grant</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 183.99721686300003 L 868.2209832417965 183.99721686300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(877.5320491227965,183.99721686300003) translate(-877.5320491227965,-183.99721686300003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 868.1078933727965 179.28513898800003 L 877.5320491227965 183.99721686300003 L 868.1078933727965 188.70929473800004 Z"/></g></g><g><g><rect fill="white" stroke="none" x="890.9143502877964" y="200.96069721300006" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="212.26968411300007" width="387.2093769782031" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="211.13878542300006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="222.44777232300007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• creates an opaque Access Token using high entropy nonce data string</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.5320491227965 226.97136708300005 L 922.7679967227965 226.97136708300005 L 922.7679967227965 241.67305005300005 L 886.8431150037965 241.67305005300005" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(877.5320491227965,241.67305005300005) translate(-877.5320491227965,-241.67305005300005)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 886.9562048727964 236.96097217800005 L 877.5320491227965 241.67305005300005 L 886.9562048727964 246.38512792800006 Z"/></g></g><g><g><rect fill="white" stroke="none" x="411.8070477863413" y="258.63653040300005" width="87.2926975958789" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="413.5033958213413" y="268.81461861300005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Access Token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.5320491227965 273.33821337300003 L 42.685809926765145 273.33821337300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,273.33821337300003) translate(-33.37474404576514,-273.33821337300003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 268.62613549800005 L 33.37474404576514 273.33821337300003 L 42.79889979576514 278.050291248 Z"/></g></g><g><g><rect fill="white" stroke="none" x="46.75704521076514" y="290.301693723" width="51.47602813176758" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="301.610680623" width="228.4760243170703" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="312.919667523" width="360.7760273688281" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="324.22865442299997" width="209.39269607" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="300.479781933" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="311.788768833" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) computes the intermediary Route-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="323.097755733" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates the intermadiary Route-JWT with a payload including</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="334.40674263299996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the Access Token and a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 338.93033739300006 L 78.61069164576514 338.93033739300006 L 78.61069164576514 353.63202036300004 L 42.685809926765145 353.63202036300004" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,353.63202036300004) translate(-33.37474404576514,-353.63202036300004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 348.91994248800006 L 33.37474404576514 353.63202036300004 L 42.79889979576514 358.344098238 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 406.218809448 L 39.029237495765145 406.218809448 M 39.029237495765145 370.59550071300004 L 295.38298130693704 370.59550071300004 L 305.56106951693704 380.77358892300003 L 305.56106951693704 441.842118183 L 39.029237495765145 441.842118183 L 39.029237495765145 370.59550071300004 M 295.38298130693704 370.59550071300004 L 295.38298130693704 380.77358892300003 L 305.56106951693704 380.77358892300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="386.428082373" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC is computed as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="397.737069273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC = HMAC-SHA256(Key, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="409.04605617299995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="420.35504307299993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(client's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="431.6640299729999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = Access Token</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 517.0468810680001 L 39.029237495765145 517.0468810680001 M 39.029237495765145 458.805598533 L 391.449631697562 458.805598533 L 401.627719907562 468.983686743 L 401.627719907562 575.288163603 L 39.029237495765145 575.288163603 L 39.029237495765145 458.805598533 M 391.449631697562 458.805598533 L 391.449631697562 468.983686743 L 401.627719907562 468.983686743" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="474.63818019300004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="485.947167093" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="497.256153993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="508.565140893" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url({"typ":"JWT","alg":"HS256"})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="519.874127793" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url({"token":Access Token,"ts":timestamp})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="531.183114693" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key, message))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="542.492101593" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="553.8010884930001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="565.1100753930001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = Route-MAC</text></g><g><g><rect fill="white" stroke="none" x="207.1738062342905" y="592.2516439530001" width="72.62602584294922" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="208.8701542692905" y="602.4297321630002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 606.9533269230001 L 444.28782838476513 606.9533269230001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(453.5988942657651,606.9533269230001) translate(-453.5988942657651,-606.9533269230001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 444.1747385157651 602.2412490480001 L 453.5988942657651 606.9533269230001 L 444.1747385157651 611.665404798 Z"/></g></g><g><g><rect fill="white" stroke="none" x="466.9811954307651" y="623.9168072730001" width="34.75936286382324" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="635.2257941730002" width="219.65935866765625" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="646.5347810730002" width="406.59270827703125" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="657.8437679730002" width="264.2593647711719" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="634.0948954830002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="645.4038823830002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) computes the destination Route-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="656.7128692830003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) creates the destination Route-JWT by replacing the Route-JWT signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="668.0218561830003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     with the base64url encoded Route-MAC value</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 672.5454509430001 L 498.83484186576516 672.5454509430001 L 498.83484186576516 687.2471339130001 L 462.9099601467651 687.2471339130001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(453.5988942657651,687.2471339130001) translate(-453.5988942657651,-687.2471339130001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 463.02305001576514 682.5350560380001 L 453.5988942657651 687.2471339130001 L 463.02305001576514 691.9592117880001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 739.833922998 L 459.25338771576514 739.833922998 M 459.25338771576514 704.210614263 L 715.607131526937 704.210614263 L 725.785219736937 714.3887024730001 L 725.785219736937 775.4572317330001 L 459.25338771576514 775.4572317330001 L 459.25338771576514 704.210614263 M 715.607131526937 704.210614263 L 715.607131526937 714.3887024730001 L 725.785219736937 714.3887024730001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="720.0431959230001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC is computed as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="731.3521828230001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC = HMAC-SHA256(Key, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="742.6611697230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="753.9701566230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(RS's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="765.2791435230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = Route-JWT signature</text></g><g><g><rect fill="white" stroke="none" x="629.2524587728062" y="792.4207120830001" width="72.62602584294922" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="630.9488068078062" y="802.5988002930002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 807.1223950530001 L 868.2209832417965 807.1223950530001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(877.5320491227965,807.1223950530001) translate(-877.5320491227965,-807.1223950530001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 868.1078933727965 802.4103171780001 L 877.5320491227965 807.1223950530001 L 868.1078933727965 811.8344729280001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 842.7457037880001 L 459.25338771576514 842.7457037880001 M 459.25338771576514 824.085875403 L 822.6404567222495 824.085875403 L 832.8185449322496 834.2639636130001 L 832.8185449322496 861.4055321730001 L 459.25338771576514 861.4055321730001 L 459.25338771576514 824.085875403 M 822.6404567222495 824.085875403 L 822.6404567222495 834.2639636130001 L 832.8185449322496 834.2639636130001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="839.9184570630002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS sends the destination Route-JWT in the Authorization header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="851.2274439630003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to authenticate itself to the AS introspection endpoint</text></g><g><g><rect fill="white" stroke="none" x="890.9143502877964" y="878.369012523" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="889.6779994230001" width="598.6260334723438" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="900.9869863230001" width="236.02602736882812" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="912.2959732230001" width="441.1760212653125" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="923.6049601230002" width="233.9760243170703" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="934.9139470230002" width="434.5593525641406" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="946.2229339230003" width="278.34270827703125" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="957.5319208230003" width="532.1760212653126" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="968.8409077230003" width="353.39269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="980.1498946230004" width="429.2926899664844" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="890.9143502877964" y="991.4588815230004" width="337.7926899664844" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="888.5471007330001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="899.8560876330001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the Access Token data using the token claim value from the Route-JWT, and checks the token state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="911.1650745330002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) computes the itermediary Itinerary-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="922.4740614330002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) generates the intermediary Itinerary-JWT with the payload from the Route-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="933.7830483330002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> d) computes the destination Itinerary-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="945.0920352330003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> e) creates the destination Itinerary-JWT by replacing the Itinerary-JWT signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="956.4010221330003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     with the base64url encoded Itinerary-MAC value</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="967.7100090330003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> f)  compares the destination Itinerary-JWT signature with the Route-JWT signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="979.0189959330004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the Access Token route and the Route-JWT have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="990.3279828330004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim value from the Route-JWT, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="892.6106983227965" y="1001.6369697330005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may return the Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.5320491227965 1006.1605644930002 L 922.7679967227965 1006.1605644930002 L 922.7679967227965 1020.8622474630001 L 886.8431150037965 1020.8622474630001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(877.5320491227965,1020.8622474630001) translate(-877.5320491227965,-1020.8622474630001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 886.9562048727964 1016.1501695880002 L 877.5320491227965 1020.8622474630001 L 886.9562048727964 1025.574325338 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 877.5320491227965 1056.485556198 L 883.1865425727965 1056.485556198 M 883.1865425727965 1037.8257278130002 L 1414.273623786312 1037.8257278130002 L 1424.451711996312 1048.0038160230001 L 1424.451711996312 1075.1453845830001 L 883.1865425727965 1075.1453845830001 L 883.1865425727965 1037.8257278130002 M 1414.273623786312 1037.8257278130002 L 1414.273623786312 1048.0038160230001 L 1424.451711996312 1048.0038160230001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="899.0191242327965" y="1053.658309473" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Itinerary-MAC and Itinerary-JWT are computed, generated and created in an analogous manner</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="899.0191242327965" y="1064.967296373" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">as Route-MAC and Route-JWT.</text></g><g><g><rect fill="white" stroke="none" x="559.3691236592808" y="1092.108864933" width="212.39269607" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="561.0654716942809" y="1102.286953143" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.5320491227965 1106.810547903 L 462.9099601467651 1106.810547903" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(453.5988942657651,1106.810547903) translate(-453.5988942657651,-1106.810547903)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 463.02305001576514 1102.098470028 L 453.5988942657651 1106.810547903 L 463.02305001576514 1111.522625778 Z"/></g></g><g><g><rect fill="white" stroke="none" x="466.9811954307651" y="1123.774028253" width="41.542697595878906" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="1135.0830151530001" width="314.12603347234375" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="1146.3920020530002" width="236.8426930182422" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="1133.952116463" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="1145.261103363" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• verifies the Access Token introspection response, if true,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="1156.570090263" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the RS may return the protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 1161.093685023 L 498.83484186576516 1161.093685023 L 498.83484186576516 1175.7953679930001 L 462.9099601467651 1175.7953679930001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(453.5988942657651,1175.7953679930001) translate(-453.5988942657651,-1175.7953679930001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 463.02305001576514 1171.0832901180001 L 453.5988942657651 1175.7953679930001 L 463.02305001576514 1180.507445868 Z"/></g></g><g><g><rect fill="white" stroke="none" x="179.8988047084116" y="1192.758848343" width="127.17602889470703" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="181.5951527434116" y="1202.936936553" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Protected Resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 1207.460531313 L 42.685809926765145 1207.460531313" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,1207.460531313) translate(-33.37474404576514,-1207.460531313)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 1202.748453438 L 33.37474404576514 1207.460531313 L 42.79889979576514 1212.172609188 Z"/></g></g></g></g></svg>