<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1489" height="1409"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Anote%20right%20of%20RS%3ARS%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Aclient-%3EAS%3A1.%20Authorization%20Grant%0AAS-%3EAS%3A2.%20AS%3A%5Cn%E2%80%A2%20creates%20an%20opaque%20Access%20Token%20using%20high%20entropy%20nonce%20data%20string%0Aclient%3C-AS%3A3.%20Access%20Token%0Aclient-%3Eclient%3A4.%20Client%3A%5Cn%20a)%20computes%20the%20intermediary%20Route-MAC%5Cn%20b)%20generates%20the%20intermediary%20Route-JWT%20with%20a%20payload%20including%5Cn%20%20%20%20%20the%20Access%20Token%20and%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20Route-MAC%20is%20computed%20as%3A%5CnRoute-MAC%20%3D%20HMAC-SHA256(Key%2C%20message)%5Cnwhere%5CnKey%20%3D%20SHA256(client's%20client%20secret)%5Cnmessage%20%3D%20Access%20Token%0Anote%20right%20of%20client%3AThe%20Route-JWT%20is%20generated%20as%3A%5CnRoute-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url(%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D)%5Cnpayload%20%3D%20base64url(%7B%22token%22%3AAccess%20Token%2C%22ts%22%3Atimestamp%7D)%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key%2C%20message))%5Cnwhere%5Cnmessage%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey%20%3D%20Route-MAC%0Aclient-%3ERS%3A5.%20Route-JWT%0ARS-%3ERS%3A6.%20RS%3A%5Cn%20a)%20computes%20the%20destination%20Route-MAC%5Cn%20b)%20generates%20the%20destination%20Route-JWT%20from%20the%20previous%20Route-JWT%5Cn%20%20%20%20%20(aditional%20claims%20can%20be%20added%20to%20the%20JWT%20payload)%0Anote%20right%20of%20RS%3AThe%20Route-MAC%20is%20computed%20as%3A%5CnRoute-MAC%20%3D%20HMAC-SHA256(Key%2C%20message)%5Cnwhere%5CnKey%20%3D%20SHA256(RS's%20client%20secret)%5Cnmessage%20%3D%20previous%20Route-JWT%0Anote%20right%20of%20RS%3AThe%20Route-JWT%20is%20generated%20as%3A%5CnRoute-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20previous%20Route-JWT%20header%5Cnpayload%20%3D%20previous%20Route-JWT%20payload%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key%2C%20message))%5Cnwhere%5Cnmessage%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey%20%3D%20Route-MAC%0ARS-%3EAS%3A7.%20Route-JWT%0Anote%20right%20of%20RS%3ARS%20sends%20the%20destination%20Route-JWT%20in%20the%20Authorization%20header%5Cnto%20authenticate%20itself%20to%20the%20AS%20introspection%20endpoint%0AAS-%3EAS%3A8.%20AS%3A%5Cn%20a)%20looks%20up%20the%20Access%20Token%20data%20using%20the%20token%20claim%20value%20from%20the%20Route-JWT%2C%20and%20checks%20the%20token%20state%5Cn%20b)%20computes%20the%20itermediary%20Itinerary-MAC%5Cn%20c)%20generates%20the%20intermediary%20Itinerary-JWT%20with%20the%20payload%20from%20the%20Route-JWT%5Cn%20d)%20computes%20the%20destination%20Itinerary-MAC%5Cn%20e)%20generates%20the%20destination%20Itinerary-JWT%20from%20the%20previous%20Itinerary-JWT%5Cn%20f)%20%20compares%20the%20destination%20Itinerary-JWT%20signature%20with%20the%20Route-JWT%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20Access%20Token%20route%20and%20the%20Route-JWT%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20value%20from%20the%20Route-JWT%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20return%20the%20Access%20Token%20introspection%20response%0Anote%20right%20of%20AS%3AItinerary-MAC%20and%20Itinerary-JWT%20are%20computed%20and%20generated%20in%20an%20analogous%20manner%5Cnas%20Route-MAC%20and%20Route-JWT.%0ARS%3C-AS%3A9.%20Access%20Token%20introspection%20response%0ARS-%3ERS%3A10.%20RS%3A%5Cn%E2%80%A2%20verifies%20the%20Access%20Token%20introspection%20response%2C%20if%20true%2C%5Cn%20%20%20the%20RS%20may%20return%20the%20protected%20resource%0Aclient%3C-RS%3A11.%20Protected%20Resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1489" height="1409"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 38.111285853 L 33.37474404576514 1369.179043983" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 38.111285853 L 453.5988942657651 1369.179043983" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 873.8230444857651 38.111285853 L 873.8230444857651 1369.179043983" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 7.690111091999997 L 61.09499464153028 7.690111091999997 L 61.09499464153028 38.111285853 L 5.654493450000004 38.111285853 L 5.654493450000004 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 384.7036434792651 7.690111091999997 L 522.4941450522651 7.690111091999997 L 522.4941450522651 38.111285853 L 384.7036434792651 38.111285853 L 384.7036434792651 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="396.9738942657651" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 793.7194578228002 7.690111091999997 L 953.9266311487299 7.690111091999997 L 953.9266311487299 38.111285853 L 793.7194578228002 38.111285853 L 793.7194578228002 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="805.9897086093002" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 1369.179043983 L 61.09499464153028 1369.179043983 L 61.09499464153028 1399.600218744 L 5.654493450000004 1399.600218744 L 5.654493450000004 1369.179043983 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="1388.2912318439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 384.7036434792651 1369.179043983 L 522.4941450522651 1369.179043983 L 522.4941450522651 1399.600218744 L 384.7036434792651 1399.600218744 L 384.7036434792651 1369.179043983 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="396.9738942657651" y="1388.2912318439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 793.7194578228002 1369.179043983 L 953.9266311487299 1369.179043983 L 953.9266311487299 1399.600218744 L 793.7194578228002 1399.600218744 L 793.7194578228002 1369.179043983 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="805.9897086093002" y="1388.2912318439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 79.38908803800001 L 39.029237495765145 79.38908803800001 M 39.029237495765145 60.72925965300001 L 437.7663126057651 60.72925965300001 L 447.9444008157651 70.90734786300001 L 447.9444008157651 98.04891642300001 L 39.029237495765145 98.04891642300001 L 39.029237495765145 60.72925965300001 M 437.7663126057651 60.72925965300001 L 437.7663126057651 70.90734786300001 L 447.9444008157651 70.90734786300001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="76.561841313" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="87.87082821300001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 133.67222515800003 L 459.25338771576514 133.67222515800003 M 459.25338771576514 115.01239677300003 L 857.9904628257651 115.01239677300003 L 868.1685510357652 125.19048498300003 L 868.1685510357652 152.33205354300003 L 459.25338771576514 152.33205354300003 L 459.25338771576514 115.01239677300003 M 857.9904628257651 115.01239677300003 L 857.9904628257651 125.19048498300003 L 868.1685510357652 125.19048498300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="130.84497843300002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="142.15396533300003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><g><g><rect fill="white" stroke="none" x="392.60254699370455" y="169.29553389300003" width="121.9926945441211" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="394.2988950287046" y="179.47362210300003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Authorization Grant</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 183.99721686300003 L 864.5119786047651 183.99721686300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(873.8230444857651,183.99721686300003) translate(-873.8230444857651,-183.99721686300003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 864.3988887357651 179.28513898800003 L 873.8230444857651 183.99721686300003 L 864.3988887357651 188.70929473800004 Z"/></g></g><g><g><rect fill="white" stroke="none" x="887.205345650765" y="200.96069721300006" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="212.26968411300007" width="387.2093769782031" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="211.13878542300006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="222.44777232300007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• creates an opaque Access Token using high entropy nonce data string</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 873.8230444857651 226.97136708300005 L 919.0589920857651 226.97136708300005 L 919.0589920857651 241.67305005300005 L 883.1341103667651 241.67305005300005" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(873.8230444857651,241.67305005300005) translate(-873.8230444857651,-241.67305005300005)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 883.247200235765 236.96097217800005 L 873.8230444857651 241.67305005300005 L 883.247200235765 246.38512792800006 Z"/></g></g><g><g><rect fill="white" stroke="none" x="409.95254546782564" y="258.63653040300005" width="87.2926975958789" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="411.6488935028257" y="268.81461861300005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Access Token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 873.8230444857651 273.33821337300003 L 42.685809926765145 273.33821337300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,273.33821337300003) translate(-33.37474404576514,-273.33821337300003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 268.62613549800005 L 33.37474404576514 273.33821337300003 L 42.79889979576514 278.050291248 Z"/></g></g><g><g><rect fill="white" stroke="none" x="46.75704521076514" y="290.301693723" width="51.47602813176758" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="301.610680623" width="228.4760243170703" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="312.919667523" width="360.8093525641406" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="324.22865442299997" width="209.39269607" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="300.479781933" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="311.788768833" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) computes the intermediary Route-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="323.097755733" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates the intermediary Route-JWT with a payload including</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="334.40674263299996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the Access Token and a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 338.93033739300006 L 78.61069164576514 338.93033739300006 L 78.61069164576514 353.63202036300004 L 42.685809926765145 353.63202036300004" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,353.63202036300004) translate(-33.37474404576514,-353.63202036300004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 348.91994248800006 L 33.37474404576514 353.63202036300004 L 42.79889979576514 358.344098238 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 406.218809448 L 39.029237495765145 406.218809448 M 39.029237495765145 370.59550071300004 L 295.38298130693704 370.59550071300004 L 305.56106951693704 380.77358892300003 L 305.56106951693704 441.842118183 L 39.029237495765145 441.842118183 L 39.029237495765145 370.59550071300004 M 295.38298130693704 370.59550071300004 L 295.38298130693704 380.77358892300003 L 305.56106951693704 380.77358892300003" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="386.428082373" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC is computed as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="397.737069273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC = HMAC-SHA256(Key, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="409.04605617299995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="420.35504307299993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(client's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="431.6640299729999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = Access Token</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 517.0468810680001 L 39.029237495765145 517.0468810680001 M 39.029237495765145 458.805598533 L 391.449631697562 458.805598533 L 401.627719907562 468.983686743 L 401.627719907562 575.288163603 L 39.029237495765145 575.288163603 L 39.029237495765145 458.805598533 M 391.449631697562 458.805598533 L 391.449631697562 468.983686743 L 401.627719907562 468.983686743" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="474.63818019300004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="485.947167093" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="497.256153993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="508.565140893" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url({"typ":"JWT","alg":"HS256"})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="519.874127793" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url({"token":Access Token,"ts":timestamp})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="531.183114693" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key, message))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="542.492101593" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="553.8010884930001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="565.1100753930001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = Route-MAC</text></g><g><g><rect fill="white" stroke="none" x="207.1738062342905" y="592.2516439530001" width="72.62602584294922" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="208.8701542692905" y="602.4297321630002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 606.9533269230001 L 444.28782838476513 606.9533269230001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(453.5988942657651,606.9533269230001) translate(-453.5988942657651,-606.9533269230001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 444.1747385157651 602.2412490480001 L 453.5988942657651 606.9533269230001 L 444.1747385157651 611.665404798 Z"/></g></g><g><g><rect fill="white" stroke="none" x="466.9811954307651" y="623.9168072730001" width="34.75936286382324" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="635.2257941730002" width="219.65935866765625" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="646.5347810730002" width="375.4260212653125" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="657.8437679730002" width="293.2093769782031" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="634.0948954830002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="645.4038823830002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) computes the destination Route-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="656.7128692830003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates the destination Route-JWT from the previous Route-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="668.0218561830003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     (aditional claims can be added to the JWT payload)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 672.5454509430001 L 498.83484186576516 672.5454509430001 L 498.83484186576516 687.2471339130001 L 462.9099601467651 687.2471339130001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(453.5988942657651,687.2471339130001) translate(-453.5988942657651,-687.2471339130001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 463.02305001576514 682.5350560380001 L 453.5988942657651 687.2471339130001 L 463.02305001576514 691.9592117880001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 739.833922998 L 459.25338771576514 739.833922998 M 459.25338771576514 704.210614263 L 715.607131526937 704.210614263 L 725.785219736937 714.3887024730001 L 725.785219736937 775.4572317330001 L 459.25338771576514 775.4572317330001 L 459.25338771576514 704.210614263 M 715.607131526937 704.210614263 L 715.607131526937 714.3887024730001 L 725.785219736937 714.3887024730001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="720.0431959230001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC is computed as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="731.3521828230001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC = HMAC-SHA256(Key, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="742.6611697230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="753.9701566230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(RS's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="765.2791435230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = previous Route-JWT</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 850.6619946180001 L 459.25338771576514 850.6619946180001 M 459.25338771576514 792.4207120830001 L 768.7238002281089 792.4207120830001 L 778.9018884381089 802.5988002930002 L 778.9018884381089 908.9032771530001 L 459.25338771576514 908.9032771530001 L 459.25338771576514 792.4207120830001 M 768.7238002281089 792.4207120830001 L 768.7238002281089 802.5988002930002 L 778.9018884381089 802.5988002930002" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="808.2532937430002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="819.5622806430002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="830.8712675430003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="842.1802544430003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = previous Route-JWT header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="853.4892413430003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = previous Route-JWT payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="864.7982282430004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key, message))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="876.1072151430004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="887.4162020430005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="898.7251889430005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = Route-MAC</text></g><g><g><rect fill="white" stroke="none" x="627.3979564542905" y="925.8667575030001" width="72.62602584294922" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="629.0943044892905" y="936.0448457130002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 940.5684404730001 L 864.5119786047651 940.5684404730001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(873.8230444857651,940.5684404730001) translate(-873.8230444857651,-940.5684404730001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 864.3988887357651 935.8563625980001 L 873.8230444857651 940.5684404730001 L 864.3988887357651 945.2805183480001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 976.1917492080001 L 459.25338771576514 976.1917492080001 M 459.25338771576514 957.5319208230001 L 822.6404567222495 957.5319208230001 L 832.8185449322496 967.7100090330001 L 832.8185449322496 994.8515775930001 L 459.25338771576514 994.8515775930001 L 459.25338771576514 957.5319208230001 M 822.6404567222495 957.5319208230001 L 822.6404567222495 967.7100090330001 L 832.8185449322496 967.7100090330001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="973.3645024830003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS sends the destination Route-JWT in the Authorization header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="475.0859693757651" y="984.6734893830003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to authenticate itself to the AS introspection endpoint</text></g><g><g><rect fill="white" stroke="none" x="887.205345650765" y="1011.815057943" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1023.1240448430001" width="598.6260334723438" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1034.4330317430001" width="236.02602736882812" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1045.7420186430002" width="441.1760212653125" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1057.0510055430002" width="233.9760243170703" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1068.3599924430002" width="403.39269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1079.6689793430003" width="532.1760212653126" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1090.9779662430003" width="353.39269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1102.2869531430003" width="429.2926899664844" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="887.205345650765" y="1113.5959400430004" width="337.7926899664844" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1021.9931461530001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1033.302133053" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the Access Token data using the token claim value from the Route-JWT, and checks the token state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1044.611119953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) computes the itermediary Itinerary-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1055.920106853" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) generates the intermediary Itinerary-JWT with the payload from the Route-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1067.2290937530001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> d) computes the destination Itinerary-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1078.5380806530002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> e) generates the destination Itinerary-JWT from the previous Itinerary-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1089.8470675530002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> f)  compares the destination Itinerary-JWT signature with the Route-JWT signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1101.1560544530003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the Access Token route and the Route-JWT have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1112.4650413530003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim value from the Route-JWT, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.901693685765" y="1123.7740282530003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may return the Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 873.8230444857651 1128.297623013 L 919.0589920857651 1128.297623013 L 919.0589920857651 1142.999305983 L 883.1341103667651 1142.999305983" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(873.8230444857651,1142.999305983) translate(-873.8230444857651,-1142.999305983)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 883.247200235765 1138.2872281080001 L 873.8230444857651 1142.999305983 L 883.247200235765 1147.711383858 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 873.8230444857651 1178.622614718 L 879.4775379357651 1178.622614718 M 879.4775379357651 1159.9627863330002 L 1363.1312695399058 1159.9627863330002 L 1373.3093577499058 1170.140874543 L 1373.3093577499058 1197.282443103 L 879.4775379357651 1197.282443103 L 879.4775379357651 1159.9627863330002 M 1363.1312695399058 1159.9627863330002 L 1363.1312695399058 1170.140874543 L 1373.3093577499058 1170.140874543" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="895.3101195957652" y="1175.795367993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Itinerary-MAC and Itinerary-JWT are computed and generated in an analogous manner</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="895.3101195957652" y="1187.104354893" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">as Route-MAC and Route-JWT.</text></g><g><g><rect fill="white" stroke="none" x="557.5146213407651" y="1214.245923453" width="212.39269607" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="559.2109693757651" y="1224.4240116629999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 873.8230444857651 1228.947606423 L 462.9099601467651 1228.947606423" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(453.5988942657651,1228.947606423) translate(-453.5988942657651,-1228.947606423)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 463.02305001576514 1224.235528548 L 453.5988942657651 1228.947606423 L 463.02305001576514 1233.659684298 Z"/></g></g><g><g><rect fill="white" stroke="none" x="466.9811954307651" y="1245.911086773" width="41.542697595878906" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="1257.2200736730001" width="314.12603347234375" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="466.9811954307651" y="1268.5290605730002" width="236.8426930182422" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="1256.089174983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="1267.398161883" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• verifies the Access Token introspection response, if true,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.67754346576515" y="1278.707148783" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the RS may return the protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 1283.230743543 L 498.83484186576516 1283.230743543 L 498.83484186576516 1297.932426513 L 462.9099601467651 1297.932426513" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(453.5988942657651,1297.932426513) translate(-453.5988942657651,-1297.932426513)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 463.02305001576514 1293.2203486380001 L 453.5988942657651 1297.932426513 L 463.02305001576514 1302.644504388 Z"/></g></g><g><g><rect fill="white" stroke="none" x="179.8988047084116" y="1314.895906863" width="127.17602889470703" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="181.5951527434116" y="1325.0739950729999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Protected Resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.5988942657651 1329.597589833 L 42.685809926765145 1329.597589833" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,1329.597589833) translate(-33.37474404576514,-1329.597589833)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 1324.885511958 L 33.37474404576514 1329.597589833 L 42.79889979576514 1334.309667708 Z"/></g></g></g></g></svg>