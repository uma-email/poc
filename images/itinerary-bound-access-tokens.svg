<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1334" height="1133"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Anote%20right%20of%20RS%3ARS%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Aclient-%3EAS%3A1.%20Authorization%20Grant%0AAS-%3EAS%3A2.%20AS%3A%5Cn%E2%80%A2%20creates%20an%20opaque%20Access%20Token%20using%20high%20entropy%20nonce%20data%20string%0Aclient%3C-AS%3A3.%20Access%20Token%0Aclient-%3Eclient%3A4.%20Client%3A%5Cn%20a)%20computes%20the%20intermediary%20Route-MAC%5Cn%20b)%20generates%20the%20intermadiary%20Route-JWT%20with%20a%20payload%20including%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20Route-MAC%20is%20computed%20as%3A%5CnRoute-MAC%20%3D%20HMAC-SHA256(Key%2C%20message)%5Cnwhere%5CnKey%20%3D%20SHA256(client's%20client%20secret)%5Cnmessage%20%3D%20Access%20Token%0Anote%20right%20of%20client%3AThe%20Route-JWT%20is%20generated%20as%3A%5CnRoute-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url(%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D)%5Cnpayload%20%3D%20base64url(%7B%22token%22%3AAccess%20Token%2C%22ts%22%3Atimestamp%7D)%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key%2C%20message))%5Cnwhere%5Cnmessage%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey%20%3D%20Route-MAC%0Aclient-%3ERS%3A5.%20Route-JWT%0ARS-%3ERS%3A6.%20RS%3A%5Cn%20a)%20computes%20the%20destination%20Route-MAC%5Cn%20b)%20creates%20the%20destination%20Route-JWT%20by%20replacing%20the%20Route-JWT%20signature%5Cn%20%20%20%20%20with%20the%20base64url%20encoded%20Route-MAC%20value%0Anote%20right%20of%20RS%3AThe%20Route-MAC%20is%20computed%20as%3A%5CnRoute-MAC%20%3D%20HMAC-SHA256(Key%2C%20message)%5Cnwhere%5CnKey%20%3D%20SHA256(RS's%20client%20secret)%5Cnmessage%20%3D%20Route-JWT%20signature%0ARS-%3EAS%3A7.%20Route-JWT%0Anote%20right%20of%20RS%3ARS%20sends%20the%20destination%20Route-JWT%20in%20the%20Authorization%20header%5Cnto%20authenticate%20itself%20to%20the%20AS%20introspection%20endpoint%0AAS-%3EAS%3A8.%20AS%3A%5Cn%20a)%20looks%20up%20the%20Access%20Token%20data%20using%20the%20token%20claim%20value%20from%20the%20Route-JWT%2C%20and%20checks%20the%20token%20state%5Cn%20b)%20computes%20the%20itermediary%20Itinerary-MAC%5Cn%20c)%20generates%20the%20intermediary%20Itinerary-JWT%20with%20the%20payload%20from%20the%20Route-JWT%5Cn%20d)%20computes%20the%20destination%20Itinerary-MAC%5Cn%20e)%20creates%20the%20destination%20Itinerary-JWT%20by%20replacing%20the%20Itinerary-JWT%20signature%5Cn%20%20%20%20%20with%20the%20base64url%20encoded%20Itinerary-MAC%20value%5Cn%20f)%20%20compares%20the%20destination%20Itinerary-JWT%20signature%20with%20the%20Route-JWT%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20Access%20Token%20route%20and%20the%20Route-JWT%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20value%20from%20the%20Route-JWT%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20return%20the%20Access%20Token%20introspection%20response%0Anote%20right%20of%20AS%3AItinerary-MAC%20and%20Itinerary-JWT%20are%20computed%2C%20generated%20and%20created%20in%20an%20analogous%20manner%5Cnas%20Route-MAC%20and%20Route-JWT.%0ARS%3C-AS%3A9.%20Access%20Token%20introspection%20response%0ARS-%3ERS%3A10.%20RS%3A%5Cn%E2%80%A2%20verifies%20the%20Access%20Token%20introspection%20response%2C%20if%20true%2C%5Cn%20%20%20the%20RS%20may%20return%20the%20protected%20resource%0Aclient%3C-RS%3A11.%20Protected%20Resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1334" height="1133"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 33.876698536 L 29.42477278182324 1098.4293320560002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 424.9709016163285 33.876698536 L 424.9709016163285 1098.4293320560002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6503617496619 33.876698536 L 795.6503617496619 1098.4293320560002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.026216399999999 6.835654304000002 L 53.82332916364648 6.835654304000002 L 53.82332916364648 33.876698536 L 5.026216399999999 33.876698536 L 5.026216399999999 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="15.933105987999998" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 364.5890135542074 6.835654304000002 L 485.35278967844954 6.835654304000002 L 485.35278967844954 33.876698536 L 364.5890135542074 33.876698536 L 364.5890135542074 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="375.4959031422074" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 725.4851370481365 6.835654304000002 L 865.8155864511873 6.835654304000002 L 865.8155864511873 33.876698536 L 725.4851370481365 33.876698536 L 725.4851370481365 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="736.3920266361365" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.026216399999999 1098.4293320560002 L 53.82332916364648 1098.4293320560002 L 53.82332916364648 1125.4703762880004 L 5.026216399999999 1125.4703762880004 L 5.026216399999999 1098.4293320560002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="15.933105987999998" y="1115.417943488" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 364.5890135542074 1098.4293320560002 L 485.35278967844954 1098.4293320560002 L 485.35278967844954 1125.4703762880004 L 364.5890135542074 1125.4703762880004 L 364.5890135542074 1098.4293320560002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="375.4959031422074" y="1115.417943488" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 725.4851370481365 1098.4293320560002 L 865.8155864511873 1098.4293320560002 L 865.8155864511873 1125.4703762880004 L 725.4851370481365 1125.4703762880004 L 725.4851370481365 1098.4293320560002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="736.3920266361365" y="1115.417943488" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 70.568078256 L 34.45098918182324 70.568078256 M 34.45098918182324 53.98156413600001 L 383.1506176053388 53.98156413600001 L 392.19780712533884 63.028753656000006 L 392.19780712533884 87.15459237600001 L 34.45098918182324 87.15459237600001 L 34.45098918182324 53.98156413600001 M 383.1506176053388 53.98156413600001 L 383.1506176053388 63.028753656000006 L 392.19780712533884 63.028753656000006" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="68.054970056" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="78.10740285600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 424.9709016163285 118.81975569600002 L 429.9971180163285 118.81975569600002 M 429.9971180163285 102.23324157600001 L 778.6967464398441 102.23324157600001 L 787.7439359598441 111.28043109600002 L 787.7439359598441 135.40626981600002 L 429.9971180163285 135.40626981600002 L 429.9971180163285 102.23324157600001 M 778.6967464398441 102.23324157600001 L 778.6967464398441 111.28043109600002 L 787.7439359598441 111.28043109600002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="116.30664749600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="126.35908029600003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><g><g><rect fill="white" stroke="none" x="359.2130366963286" y="150.48491901600002" width="106.64906113882813" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="360.72090161632855" y="159.532108536" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Authorization Grant</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 163.55308165600002 L 787.3738587443286 163.55308165600002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(795.6503617496619,163.55308165600002) translate(-795.6503617496619,-163.55308165600002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 787.2733344163286 159.36456798933335 L 795.6503617496619 163.55308165600002 L 787.2733344163286 167.74159532266668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="807.5457405629952" y="178.631730856" width="30.332397396762694" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="188.68416365599998" width="338.39906113882813" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="187.67892037599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="197.73135317599997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• creates an opaque Access Token using high entropy nonce data string</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6503617496619 201.752326296 L 835.8600929496619 201.752326296 L 835.8600929496619 214.820488936 L 803.9268647549952 214.820488936" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(795.6503617496619,214.820488936) translate(-795.6503617496619,-214.820488936)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 804.0273890829952 210.63197526933334 L 795.6503617496619 214.820488936 L 804.0273890829952 219.00900260266667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="374.3713695210356" y="229.899138136" width="76.33239548941407" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="375.8792344410356" y="238.946327656" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Access Token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6503617496619 242.967300776 L 37.701275787156575 242.967300776" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,242.967300776) translate(-29.42477278182324,-242.967300776)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 238.77878710933334 L 29.42477278182324 242.967300776 L 37.801800115156574 247.15581444266667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="41.320151595156574" y="258.045949976" width="45.01572984" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="41.320151595156574" y="268.098382776" width="199.64906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="41.320151595156574" y="278.150815576" width="380.1323985411719" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="42.82801651515658" y="267.093139496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="42.82801651515658" y="277.145572296" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) computes the intermediary Route-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="42.82801651515658" y="287.19800509600003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates the intermadiary Route-JWT with a payload including a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 291.218978216 L 69.63450398182324 291.218978216 L 69.63450398182324 304.287140856 L 37.701275787156575 304.287140856" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,304.287140856) translate(-29.42477278182324,-304.287140856)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 300.09862718933334 L 29.42477278182324 304.287140856 L 37.801800115156574 308.4756545226667 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 351.030953376 L 34.45098918182324 351.030953376 M 34.45098918182324 319.365790056 L 258.81727409947945 319.365790056 L 267.86446361947947 328.412979576 L 267.86446361947947 382.696116696 L 34.45098918182324 382.696116696 L 34.45098918182324 319.365790056 M 258.81727409947945 319.365790056 L 258.81727409947945 328.412979576 L 267.86446361947947 328.412979576" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="333.439195976" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC is computed as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="343.491628776" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC = HMAC-SHA256(Key, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="353.54406157600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="363.59649437600007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(client's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="373.6489271760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = Access Token</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 449.544794816 L 34.45098918182324 449.544794816 M 34.45098918182324 397.77476589599996 L 342.6506176053388 397.77476589599996 L 351.69780712533884 406.821955416 L 351.69780712533884 501.314823736 L 34.45098918182324 501.314823736 L 34.45098918182324 397.77476589599996 M 342.6506176053388 397.77476589599996 L 342.6506176053388 406.821955416 L 351.69780712533884 406.821955416" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="411.848171816" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="421.900604616" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="431.95303741600003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="442.00547021600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url({"typ":"JWT","alg":"HS256"})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="452.05790301600007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url({"token":Access Token,"ts":timestamp})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="462.1103358160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key, message))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="472.1627686160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="482.2152014160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="492.26763421600015" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = Route-MAC</text></g><g><g><rect fill="white" stroke="none" x="195.4483054852526" y="516.3934729360001" width="63.49906342764648" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="196.9561704052526" y="525.4406624560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 529.461635576 L 416.69439861099517 529.461635576" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(424.9709016163285,529.461635576) translate(-424.9709016163285,-529.461635576)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 416.59387428299516 525.2731219093333 L 424.9709016163285 529.461635576 L 416.59387428299516 533.6501492426668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="436.86628042966186" y="544.540284776" width="30.432395870883788" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="436.86628042966186" y="554.592717576" width="191.94906419058594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="436.86628042966186" y="564.6451503760001" width="355.26572984" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="436.86628042966186" y="574.6975831760001" width="230.9324015929297" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.37414534966183" y="553.5874742960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.37414534966183" y="563.6399070960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) computes the destination Route-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.37414534966183" y="573.6923398960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) creates the destination Route-JWT by replacing the Route-JWT signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.37414534966183" y="583.7447726960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     with the base64url encoded Route-MAC value</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 424.9709016163285 587.765745816 L 465.1806328163285 587.765745816 L 465.1806328163285 600.833908456 L 433.2474046216618 600.833908456" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(424.9709016163285,600.833908456) translate(-424.9709016163285,-600.833908456)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 433.3479289496618 596.6453947893333 L 424.9709016163285 600.833908456 L 433.3479289496618 605.0224221226667 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 424.9709016163285 647.577720976 L 429.9971180163285 647.577720976 M 429.9971180163285 615.9125576560001 L 654.3634029339847 615.9125576560001 L 663.4105924539847 624.9597471760001 L 663.4105924539847 679.242884296 L 429.9971180163285 679.242884296 L 429.9971180163285 615.9125576560001 M 654.3634029339847 615.9125576560001 L 654.3634029339847 624.9597471760001 L 663.4105924539847 624.9597471760001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="629.9859635760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC is computed as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="640.0383963760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC = HMAC-SHA256(Key, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="650.0908291760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="660.1432619760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(RS's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="670.1956947760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = Route-JWT signature</text></g><g><g><rect fill="white" stroke="none" x="578.561099969172" y="694.3215334960001" width="63.49906342764648" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="580.068964889172" y="703.3687230160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Route-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 424.9709016163285 707.3896961360001 L 787.3738587443286 707.3896961360001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(795.6503617496619,707.3896961360001) translate(-795.6503617496619,-707.3896961360001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 787.2733344163286 703.2011824693334 L 795.6503617496619 707.3896961360001 L 787.2733344163286 711.5782098026668 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 424.9709016163285 739.0548594560001 L 429.9971180163285 739.0548594560001 M 429.9971180163285 722.4683453360001 L 747.7800594281254 722.4683453360001 L 756.8272489481253 731.515534856 L 756.8272489481253 755.6413735760001 L 429.9971180163285 755.6413735760001 L 429.9971180163285 722.4683453360001 M 747.7800594281254 722.4683453360001 L 747.7800594281254 731.515534856 L 756.8272489481253 731.515534856" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="736.5417512560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS sends the destination Route-JWT in the Authorization header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="444.0705239363285" y="746.5941840560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to authenticate itself to the AS introspection endpoint</text></g><g><g><rect fill="white" stroke="none" x="807.5457405629952" y="770.7200227760001" width="30.332397396762694" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="780.7724555760001" width="522.9990672423437" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="790.8248883760001" width="206.23238938589844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="800.8773211760001" width="385.43238633414063" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="810.9297539760001" width="204.44906419058594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="820.9821867760002" width="379.68238633414063" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="831.0346195760002" width="243.23238938589844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="841.0870523760002" width="464.96574204703126" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="851.1394851760002" width="308.78239243765626" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="861.1919179760002" width="374.99906724234376" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="807.5457405629952" y="871.2443507760003" width="295.14906113882813" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="779.7672122960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="789.8196450960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the Access Token data using the token claim value from the Route-JWT, and checks the token state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="799.8720778960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) computes the itermediary Itinerary-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="809.9245106960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) generates the intermediary Itinerary-JWT with the payload from the Route-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="819.9769434960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> d) computes the destination Itinerary-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="830.0293762960002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> e) creates the destination Itinerary-JWT by replacing the Itinerary-JWT signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="840.0818090960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     with the base64url encoded Itinerary-MAC value</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="850.1342418960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> f)  compares the destination Itinerary-JWT signature with the Route-JWT signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="860.1866746960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the Access Token route and the Route-JWT have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="870.2391074960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim value from the Route-JWT, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.0536054829952" y="880.2915402960003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may return the Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6503617496619 884.3125134160001 L 835.8600929496619 884.3125134160001 L 835.8600929496619 897.3806760560001 L 803.9268647549952 897.3806760560001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(795.6503617496619,897.3806760560001) translate(-795.6503617496619,-897.3806760560001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 804.0273890829952 893.1921623893334 L 795.6503617496619 897.3806760560001 L 804.0273890829952 901.5691897226668 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 795.6503617496619 929.0458393760001 L 800.6765781496619 929.0458393760001 M 800.6765781496619 912.459325256 L 1265.0761882626305 912.459325256 L 1274.1233777826305 921.506514776 L 1274.1233777826305 945.6323534960001 L 800.6765781496619 945.6323534960001 L 800.6765781496619 912.459325256 M 1265.0761882626305 912.459325256 L 1265.0761882626305 921.506514776 L 1274.1233777826305 921.506514776" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="814.7499840696619" y="926.5327311760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Itinerary-MAC and Itinerary-JWT are computed, generated and created in an analogous manner</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="814.7499840696619" y="936.5851639760002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">as Route-MAC and Route-JWT.</text></g><g><g><rect fill="white" stroke="none" x="517.5027637112374" y="960.7110026960002" width="185.61573594351563" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="519.0106286312374" y="969.7581922160002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6503617496619 973.7791653360001 L 433.2474046216618 973.7791653360001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(424.9709016163285,973.7791653360001) translate(-424.9709016163285,-973.7791653360001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 433.3479289496618 969.5906516693334 L 424.9709016163285 973.7791653360001 L 433.3479289496618 977.9676790026668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="436.86628042966186" y="988.8578145360002" width="36.36572831412109" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="436.86628042966186" y="998.9102473360002" width="274.46574204703126" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="436.86628042966186" y="1008.9626801360002" width="206.9657267882422" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.37414534966183" y="997.9050040560003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.37414534966183" y="1007.9574368560003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• verifies the Access Token introspection response, if true,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.37414534966183" y="1018.0098696560003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the RS may return the protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 424.9709016163285 1022.0308427760002 L 465.1806328163285 1022.0308427760002 L 465.1806328163285 1035.0990054160002 L 433.2474046216618 1035.0990054160002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(424.9709016163285,1035.0990054160002) translate(-424.9709016163285,-1035.0990054160002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 433.3479289496618 1030.9104917493335 L 424.9709016163285 1035.0990054160002 L 433.3479289496618 1039.287519082667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="171.60664021730827" y="1050.1776546160002" width="111.18239396353516" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="173.11450513730827" y="1059.224844136" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Protected Resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 424.9709016163285 1063.2458172560002 L 37.701275787156575 1063.2458172560002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,1063.2458172560002) translate(-29.42477278182324,-1063.2458172560002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 1059.0573035893335 L 29.42477278182324 1063.2458172560002 L 37.801800115156574 1067.434330922667 Z"/></g></g></g></g></svg>