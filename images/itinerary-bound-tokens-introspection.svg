<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1442" height="1182"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Anote%20right%20of%20RS%3ARS%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Aclient-%3EAS%3A1.%20Authorization%20Grant%0AAS-%3EAS%3A2.%20AS%3A%5Cn%E2%80%A2%20creates%20a%20bearer%20Access%20Token%20using%20high%20entropy%20nonce%20data%20string%0Aclient%3C-AS%3A3.%20Access%20Token%0Aclient-%3Eclient%3A4.%20Client%3A%5Cn%20a)%20computes%20the%20intermediary%20Route-MAC%5Cn%20b)%20generates%20the%20intermadiary%20Route-MAC-JWT%20with%20a%20payload%20including%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20Route-MAC%20is%20computed%20as%3A%5CnRoute-MAC%20%3D%20HMAC-SHA256(Key%2C%20message)%5Cnwhere%5CnKey%20%3D%20SHA256(client's%20client%20secret)%5Cnmessage%20%3D%20Access%20Token%0Anote%20right%20of%20client%3AThe%20Route-MAC-JWT%20is%20generated%20as%3A%5CnRoute-MAC-JWT%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url(%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D)%5Cnpayload%20%3D%20base64url(%7B%22ts%22%3Atimestamp%7D)%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key%2C%20message))%5Cnwhere%5Cnmessage%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey%20%3D%20Route-MAC%0Aclient-%3ERS%3A5.%20Access%20Token%2C%20%22Route-MAC-JWT%22%0Anote%20right%20of%20client%3AClient%20sends%20the%20intermediary%20Route-MAC-JWT%20in%20the%20%22Route-MAC-JWT%22%20request%20header%20field%0ARS-%3ERS%3A6.%20RS%3A%5Cn%20a)%20computes%20the%20destination%20Route-MAC%5Cn%20b)%20creates%20the%20destination%20Route-MAC-JWT%20by%20replacing%20the%20Route-MAC-JWT%20signature%5Cn%20%20%20%20%20with%20the%20base64url%20encoded%20Route-MAC%20value%0Anote%20right%20of%20RS%3AThe%20Route-MAC%20is%20computed%20as%3A%5CnRoute-MAC%20%3D%20HMAC-SHA256(Key%2C%20message)%5Cnwhere%5CnKey%20%3D%20SHA256(RS's%20client%20secret)%5CnRoute-MAC-JWT%20%3D%20%22Route-MAC-JWT%22%20request%20header%20field%20value%5Cnmessage%20%3D%20Route-MAC-JWT%20signature%0ARS-%3EAS%3A7.%20Access%20Token%2C%20Route-MAC-JWT%0Anote%20right%20of%20RS%3ARS%20sends%20the%20Access%20Token%20in%20the%20token%20field%20and%20the%20destination%20Route-MAC-JWT%5Cnin%20the%20Authorization%20header%20to%20authenticate%20itself%20to%20the%20AS%20introspection%20endpoint%0AAS-%3EAS%3A8.%20AS%3A%5Cn%20a)%20looks%20up%20the%20Access%20Token%20data%20and%20checks%20the%20token%20state%2C%20if%20active%5Cn%20b)%20computes%20the%20itermediary%20Itinerary-MAC%5Cn%20c)%20generates%20the%20intermediary%20Itinerary-MAC-JWT%20with%20the%20payload%20from%20the%20Route-MAC-JWT%5Cn%20d)%20computes%20the%20destination%20Itinerary-MAC%5Cn%20e)%20creates%20the%20destination%20Itinerary-MAC-JWT%20by%20replacing%20the%20Itinerary-MAC-JWT%20signature%5Cn%20%20%20%20%20with%20the%20base64url%20encoded%20Itinerary-MAC%20value%5Cn%20f)%20%20compares%20the%20destination%20Itinerary-MAC-JWT%20signature%20with%20the%20Route-MAC-JWT%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20Access%20Token%20route%20and%20the%20Route-MAC-JWT%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20value%20from%20the%20Route-MAC-JWT%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20return%20the%20Access%20Token%20introspection%20response%0Anote%20right%20of%20AS%3AItinerary-MAC%20and%20Itinerary-MAC-JWT%20are%20computed%2C%20generated%20and%20created%20in%20an%20analogous%20manner%5Cnas%20Route-MAC%20and%20Route-MAC-JWT.%0ARS%3C-AS%3A9.%20Access%20Token%20introspection%20response%0ARS-%3ERS%3A10.%20RS%3A%5Cn%E2%80%A2%20verifies%20the%20Access%20Token%20introspection%20response%2C%20if%20true%2C%5Cn%20%20%20the%20RS%20may%20return%20the%20protected%20resource%0Aclient%3C-RS%3A11.%20Protected%20Resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1442" height="1182"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 33.876698536 L 29.42477278182324 1146.6810094960001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 493.1240174218233 33.876698536 L 493.1240174218233 1146.6810094960001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 913.6899307629951 33.876698536 L 913.6899307629951 1146.6810094960001" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray="7.732640615384615,3.3508109333333334"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.026216399999999 6.835654304000002 L 53.82332916364648 6.835654304000002 L 53.82332916364648 33.876698536 L 5.026216399999999 33.876698536 L 5.026216399999999 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="15.933105987999998" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 432.7421293597022 6.835654304000002 L 553.5059054839444 6.835654304000002 L 553.5059054839444 33.876698536 L 432.7421293597022 33.876698536 L 432.7421293597022 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="443.6490189477022" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 843.5247060614697 6.835654304000002 L 983.8551554645205 6.835654304000002 L 983.8551554645205 33.876698536 L 843.5247060614697 33.876698536 L 843.5247060614697 6.835654304000002 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="854.4315956494697" y="23.824265736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.026216399999999 1146.6810094960001 L 53.82332916364648 1146.6810094960001 L 53.82332916364648 1173.7220537280002 L 5.026216399999999 1173.7220537280002 L 5.026216399999999 1146.6810094960001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="15.933105987999998" y="1163.6696209279999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 432.7421293597022 1146.6810094960001 L 553.5059054839444 1146.6810094960001 L 553.5059054839444 1173.7220537280002 L 432.7421293597022 1173.7220537280002 L 432.7421293597022 1146.6810094960001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="443.6490189477022" y="1163.6696209279999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 843.5247060614697 1146.6810094960001 L 983.8551554645205 1146.6810094960001 L 983.8551554645205 1173.7220537280002 L 843.5247060614697 1173.7220537280002 L 843.5247060614697 1146.6810094960001 Z" stroke-miterlimit="10" stroke-width="1.608389248" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="854.4315956494697" y="1163.6696209279999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 70.568078256 L 34.45098918182324 70.568078256 M 34.45098918182324 53.98156413600001 L 383.1506176053388 53.98156413600001 L 392.19780712533884 63.028753656000006 L 392.19780712533884 87.15459237600001 L 34.45098918182324 87.15459237600001 L 34.45098918182324 53.98156413600001 M 383.1506176053388 53.98156413600001 L 383.1506176053388 63.028753656000006 L 392.19780712533884 63.028753656000006" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="68.054970056" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="78.10740285600001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 493.1240174218233 118.81975569600002 L 498.1502338218233 118.81975569600002 M 498.1502338218233 102.23324157600001 L 846.849862245339 102.23324157600001 L 855.8970517653389 111.28043109600002 L 855.8970517653389 135.40626981600002 L 498.1502338218233 135.40626981600002 L 498.1502338218233 102.23324157600001 M 846.849862245339 102.23324157600001 L 846.849862245339 111.28043109600002 L 855.8970517653389 111.28043109600002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="116.30664749600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="126.35908029600003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><g><g><rect fill="white" stroke="none" x="418.2328212029952" y="150.48491901600002" width="106.64906113882813" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="419.74068612299516" y="159.532108536" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Authorization Grant</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 163.55308165600002 L 905.4134277576618 163.55308165600002" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(913.6899307629951,163.55308165600002) translate(-913.6899307629951,-163.55308165600002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 905.3129034296618 159.36456798933335 L 913.6899307629951 163.55308165600002 L 905.3129034296618 167.74159532266668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="925.5853095763284" y="178.631730856" width="30.332397396762694" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="188.68416365599998" width="328.14906113882813" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="187.67892037599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="197.73135317599997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• creates a bearer Access Token using high entropy nonce data string</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 913.6899307629951 201.752326296 L 953.8996619629951 201.752326296 L 953.8996619629951 214.820488936 L 921.9664337683284 214.820488936" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(913.6899307629951,214.820488936) translate(-913.6899307629951,-214.820488936)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 922.0669580963284 210.63197526933334 L 913.6899307629951 214.820488936 L 922.0669580963284 219.00900260266667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="433.3911540277022" y="229.899138136" width="76.33239548941407" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="434.8990189477022" y="238.946327656" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Access Token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 913.6899307629951 242.967300776 L 37.701275787156575 242.967300776" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,242.967300776) translate(-29.42477278182324,-242.967300776)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 238.77878710933334 L 29.42477278182324 242.967300776 L 37.801800115156574 247.15581444266667 Z"/></g></g><g><g><rect fill="white" stroke="none" x="41.320151595156574" y="258.045949976" width="45.01572984" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="41.320151595156574" y="268.098382776" width="199.64906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="41.320151595156574" y="278.150815576" width="404.28239243765626" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="42.82801651515658" y="267.093139496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="42.82801651515658" y="277.145572296" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) computes the intermediary Route-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="42.82801651515658" y="287.19800509600003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates the intermadiary Route-MAC-JWT with a payload including a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 291.218978216 L 69.63450398182324 291.218978216 L 69.63450398182324 304.287140856 L 37.701275787156575 304.287140856" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,304.287140856) translate(-29.42477278182324,-304.287140856)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 300.09862718933334 L 29.42477278182324 304.287140856 L 37.801800115156574 308.4756545226667 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 351.030953376 L 34.45098918182324 351.030953376 M 34.45098918182324 319.365790056 L 258.81727409947945 319.365790056 L 267.86446361947947 328.412979576 L 267.86446361947947 382.696116696 L 34.45098918182324 382.696116696 L 34.45098918182324 319.365790056 M 258.81727409947945 319.365790056 L 258.81727409947945 328.412979576 L 267.86446361947947 328.412979576" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="333.439195976" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC is computed as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="343.491628776" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC = HMAC-SHA256(Key, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="353.54406157600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="363.59649437600007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(client's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="373.6489271760001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = Access Token</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 449.544794816 L 34.45098918182324 449.544794816 M 34.45098918182324 397.77476589599996 L 325.9172802029951 397.77476589599996 L 334.9644697229951 406.821955416 L 334.9644697229951 501.314823736 L 34.45098918182324 501.314823736 L 34.45098918182324 397.77476589599996 M 325.9172802029951 397.77476589599996 L 325.9172802029951 406.821955416 L 334.9644697229951 406.821955416" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="411.848171816" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC-JWT is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="421.900604616" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC-JWT = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="431.95303741600003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="442.00547021600005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url({"typ":"JWT","alg":"HS256"})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="452.05790301600007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url({"ts":timestamp})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="462.1103358160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key, message))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="472.1627686160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="482.2152014160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="492.26763421600015" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = Route-MAC</text></g><g><g><rect fill="white" stroke="none" x="179.4748660582881" y="516.3934729360001" width="163.59905808707032" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="180.9827309782881" y="525.4406624560002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Access Token, "Route-MAC-JWT"</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 529.461635576 L 484.84751441648996 529.461635576" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(493.1240174218233,529.461635576) translate(-493.1240174218233,-529.461635576)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 484.74699008848995 525.2731219093333 L 493.1240174218233 529.461635576 L 484.74699008848995 533.6501492426668 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 29.42477278182324 556.100582496 L 34.45098918182324 556.100582496 M 34.45098918182324 544.540284776 L 479.0506115018232 544.540284776 L 488.0978010218232 553.587474296 L 488.0978010218232 567.660880216 L 34.45098918182324 567.660880216 L 34.45098918182324 544.540284776 M 479.0506115018232 544.540284776 L 479.0506115018232 553.587474296 L 488.0978010218232 553.587474296" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.524395101823245" y="558.613690696" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client sends the intermediary Route-MAC-JWT in the "Route-MAC-JWT" request header field</text></g><g><g><rect fill="white" stroke="none" x="505.01939623515665" y="582.739529416" width="30.432395870883788" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="505.01939623515665" y="592.791962216" width="191.94906419058594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="505.01939623515665" y="602.844395016" width="403.56571763296876" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="505.01939623515665" y="612.896827816" width="230.9324015929297" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.5272611551566" y="591.786718936" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.5272611551566" y="601.8391517360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) computes the destination Route-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.5272611551566" y="611.8915845360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) creates the destination Route-MAC-JWT by replacing the Route-MAC-JWT signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.5272611551566" y="621.9440173360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     with the base64url encoded Route-MAC value</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 493.1240174218233 625.964990456 L 533.3337486218232 625.964990456 L 533.3337486218232 639.033153096 L 501.4005204271566 639.033153096" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(493.1240174218233,639.033153096) translate(-493.1240174218233,-639.033153096)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 501.5010447551566 634.8446394293333 L 493.1240174218233 639.033153096 L 501.5010447551566 643.2216667626667 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 493.1240174218233 690.8031820159999 L 498.1502338218233 690.8031820159999 M 498.1502338218233 654.111802296 L 810.849862245339 654.111802296 L 819.8970517653389 663.1589918159999 L 819.8970517653389 727.4945617359999 L 498.1502338218233 727.4945617359999 L 498.1502338218233 654.111802296 M 810.849862245339 654.111802296 L 810.849862245339 663.1589918159999 L 819.8970517653389 663.1589918159999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="668.185208216" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The Route-MAC is computed as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="678.237641016" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC = HMAC-SHA256(Key, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="688.290073816" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="698.342506616" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = SHA256(RS's client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="708.394939416" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Route-MAC-JWT = "Route-MAC-JWT" request header field value</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="718.4473722160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = Route-MAC-JWT signature</text></g><g><g><rect fill="white" stroke="none" x="625.8907778735811" y="742.573210936" width="155.03239243765626" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="627.3986427935811" y="751.6204004560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Access Token, Route-MAC-JWT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 493.1240174218233 755.641373576 L 905.4134277576618 755.641373576" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(913.6899307629951,755.641373576) translate(-913.6899307629951,-755.641373576)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 905.3129034296618 751.4528599093333 L 913.6899307629951 755.641373576 L 905.3129034296618 759.8298872426667 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 493.1240174218233 787.306536896 L 498.1502338218233 787.306536896 M 498.1502338218233 770.720022776 L 899.6165248429952 770.720022776 L 908.6637143629952 779.7672122959999 L 908.6637143629952 803.893051016 L 498.1502338218233 803.893051016 L 498.1502338218233 770.720022776 M 899.6165248429952 770.720022776 L 899.6165248429952 779.7672122959999 L 908.6637143629952 779.7672122959999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="784.7934286960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS sends the Access Token in the token field and the destination Route-MAC-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.2236397418233" y="794.8458614960001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">in the Authorization header to authenticate itself to the AS introspection endpoint</text></g><g><g><rect fill="white" stroke="none" x="925.5853095763284" y="818.9717002159999" width="30.332397396762694" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="829.024133016" width="336.64906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="839.076565816" width="206.23238938589844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="849.128998616" width="433.7324046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="859.181431416" width="204.44906419058594" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="869.233864216" width="427.9824046446875" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="879.286297016" width="243.23238938589844" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="889.3387298160001" width="513.26572984" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="899.3911626160001" width="332.93238633414063" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="909.4435954160001" width="399.14906113882813" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="925.5853095763284" y="919.4960282160001" width="295.14906113882813" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="828.018889736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="838.071322536" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the Access Token data and checks the token state, if active</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="848.123755336" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) computes the itermediary Itinerary-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="858.1761881360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) generates the intermediary Itinerary-MAC-JWT with the payload from the Route-MAC-JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="868.2286209360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> d) computes the destination Itinerary-MAC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="878.2810537360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> e) creates the destination Itinerary-MAC-JWT by replacing the Itinerary-MAC-JWT signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="888.3334865360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     with the base64url encoded Itinerary-MAC value</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="898.3859193360001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> f)  compares the destination Itinerary-MAC-JWT signature with the Route-MAC-JWT signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="908.4383521360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the Access Token route and the Route-MAC-JWT have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="918.4907849360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim value from the Route-MAC-JWT, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="927.0931744963284" y="928.5432177360002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may return the Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 913.6899307629951 932.564190856 L 953.8996619629951 932.564190856 L 953.8996619629951 945.632353496 L 921.9664337683284 945.632353496" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(913.6899307629951,945.632353496) translate(-913.6899307629951,-945.632353496)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 922.0669580963284 941.4438398293332 L 913.6899307629951 945.632353496 L 922.0669580963284 949.8208671626667 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 913.6899307629951 977.297516816 L 918.7161471629951 977.297516816 M 918.7161471629951 960.7110026959999 L 1407.2657816900262 960.7110026959999 L 1416.3129712100263 969.7581922159999 L 1416.3129712100263 993.8840309359999 L 918.7161471629951 993.8840309359999 L 918.7161471629951 960.7110026959999 M 1407.2657816900262 960.7110026959999 L 1407.2657816900262 969.7581922159999 L 1416.3129712100263 969.7581922159999" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.7895530829951" y="974.7844086160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Itinerary-MAC and Itinerary-MAC-JWT are computed, generated and created in an analogous manner</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="932.7895530829951" y="984.8368414160001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">as Route-MAC and Route-MAC-JWT.</text></g><g><g><rect fill="white" stroke="none" x="610.5991061206514" y="1008.962680136" width="185.61573594351563" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="612.1069710406514" y="1018.0098696560001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Access Token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 913.6899307629951 1022.030842776 L 501.4005204271566 1022.030842776" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(493.1240174218233,1022.030842776) translate(-493.1240174218233,-1022.030842776)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 501.5010447551566 1017.8423291093333 L 493.1240174218233 1022.030842776 L 501.5010447551566 1026.2193564426666 Z"/></g></g><g><g><rect fill="white" stroke="none" x="505.01939623515665" y="1037.109491976" width="36.36572831412109" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="505.01939623515665" y="1047.161924776" width="274.46574204703126" height="13.06816264"/></g><g><rect fill="white" stroke="none" x="505.01939623515665" y="1057.2143575759999" width="206.9657267882422" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.5272611551566" y="1046.156681496" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.5272611551566" y="1056.2091142959998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• verifies the Access Token introspection response, if true,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="506.5272611551566" y="1066.2615470959997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the RS may return the protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 493.1240174218233 1070.282520216 L 533.3337486218232 1070.282520216 L 533.3337486218232 1083.350682856 L 501.4005204271566 1083.350682856" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(493.1240174218233,1083.350682856) translate(-493.1240174218233,-1083.350682856)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 501.5010447551566 1079.1621691893333 L 493.1240174218233 1083.350682856 L 501.5010447551566 1087.5391965226668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="205.68319812005566" y="1098.429332056" width="111.18239396353516" height="13.06816264"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="207.19106304005567" y="1107.4765215759999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Protected Resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 493.1240174218233 1111.497494696 L 37.701275787156575 1111.497494696" stroke-miterlimit="10" stroke-width="0.8377027333333333" stroke-dasharray=""/><g transform="translate(29.42477278182324,1111.497494696) translate(-29.42477278182324,-1111.497494696)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 37.801800115156574 1107.3089810293334 L 29.42477278182324 1111.497494696 L 37.801800115156574 1115.6860083626668 Z"/></g></g></g></g></svg>