<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1431" height="881"><desc>Title%20UMA-compliant%20communications%20platform%20-%20Bob%20from%20Alice%20(pull%20data)%20-%20Bob%20involved%0A%0Aactor%20%22Alice%20(RO)%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22UMA%20Server%5Cnfoo.com%22%20as%20asServer%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnfoo.com%22%20as%20rsServer%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnbar.com%22%20as%20rqpClient%20%23lightsteelblue%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnbar.com%22%20as%20claimsProvider%20%23lightsteelblue%0Aparticipant%20%22IAM%20Server%5Cnbar.com%22%20as%20authServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RqP)%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Anote%20over%20claimsProvider%3AClaims%20Provider%3A%5Cn%E2%80%A2%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Fbar.com%2F.well-known%2Fclaims-provider-configuration%5Cn%E2%80%A2%20is%20registered%20at%20Bob's%20IAM%20Server%20and%20is%20assigned%20'query-users'%2C%20'view-users'%20admin%20roles%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0Anote%20over%20rqpClient%3ARqP%20Client%3A%5Cn%E2%80%A2%20is%20registered%20at%20bar.com%20IAM%20Server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20foo.com%20UMA%20Server%0Anote%20over%20rsServer%3Afoo.com%20admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%5Cn'Outgoing'%20at%20the%20foo.com%20UMA%20Server%20with%20the%20associated%20scopes%20'query'%2C%20'view'%0ArqpClient%3C-Bob%3AInitiate%20the%20request%0ArsServer%3C-rqpClient%3A1.%20Request%20Alice's%20'Outgoing'%20resource%5Cn(scope%3Dquery%2C%20view)%0ArsServer-%3ErqpClient%3A2.%20401%20with%20permission%20ticket%0ArqpClient-%3EauthServer%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0ArqpClient%3C-authServer%3A4.%20Return%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%0Anote%20over%20rqpClient%3A%E2%80%A2%20ticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0AclaimsProvider%3C-rqpClient%3A5.%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%5Cn%20ticket_challenge%2C%20scope%3Daems-app)%0A%0A%0ArqpClient%3C-claimsProvider%3A6.%20Return%20claims_token%5Cn(Bob's%20user_claims%2C%20audience%3A%5Baems-app%5D)%5Cn%20if%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A7.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token%20%22audience%22%3A%5B%22aems-app%22%5D)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn%E2%80%A2%20recipient_info%20(email%20address%2C%20fullname)%5Cn%E2%80%A2%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrap%20discovery%20of%20Claims%20Provider%20config%20url%20from%20email%20address%20via%20WebFinger%3B%5Cn%20%20%20%20if%20this%20doesn't%20work%2C%20build%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%5Cn5.%20check%20audience%3Daems-agent%5Cn6.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn7.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0ArqpClient%3C-asServer%3A8.%20Return%20RPT%0ArsServer%3C-rqpClient%3A9.%20Get%20data%20from%20Alice's%20'Outgoing'%20resource%5Cn(RPT)%0ArsServer-%3ErqpClient%3A10.%20200%20OK</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1431" height="881"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="457.2472281572566" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA-compliant communications platform - Bob from Alice (pull data) - Bob involved</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 35.31561055361328 78.15138224949999 L 35.31561055361328 824.0418960094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 239.59776767033205 78.15138224949999 L 239.59776767033205 824.0418960094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 443.8799247870508 78.15138224949999 L 443.8799247870508 824.0418960094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 78.15138224949999 L 696.0432661920509 824.0418960094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1016.5737107917905 78.15138224949999 L 1016.5737107917905 824.0418960094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1327.6369850581186 78.15138224949999 L 1327.6369850581186 824.0418960094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1398.4083684659781 78.15138224949999 L 1398.4083684659781 824.0418960094999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 32.143922998476604 M 35.31561055361328 37.16258750749999 L 35.31561055361328 47.893559521499995 M 28.98257788961328 41.03277413549999 L 41.648643217613284 41.03277413549999 M 35.31561055361328 47.893559521499995 L 28.98257788961328 57.92086123949999 M 35.31561055361328 47.893559521499995 L 41.648643217613284 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="13.808065082421876" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 204.65694619001172 45.694589846499994 L 274.53858915065234 45.694589846499994 L 274.53858915065234 78.15138224949999 L 204.65694619001172 78.15138224949999 L 204.65694619001172 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="214.20047457951173" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.00707705753908" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 388.4609310044844 45.694589846499994 L 499.29891856961723 45.694589846499994 L 499.29891856961723 78.15138224949999 L 388.4609310044844 78.15138224949999 L 388.4609310044844 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.0044593939844" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="427.28923417425784" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 664.2064867649532 45.694589846499994 L 727.8800456191485 45.694589846499994 L 727.8800456191485 78.15138224949999 L 664.2064867649532 78.15138224949999 L 664.2064867649532 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="673.7500151544532" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="679.4526366144141" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 963.2339559008257 45.694589846499994 L 1069.9134656827553 45.694589846499994 L 1069.9134656827553 78.15138224949999 L 963.2339559008257 78.15138224949999 L 963.2339559008257 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="972.7774842903257" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="999.9830812141538" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1294.7685741612945 45.694589846499994 L 1360.505395954943 45.694589846499994 L 1360.505395954943 78.15138224949999 L 1294.7685741612945 78.15138224949999 L 1294.7685741612945 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1304.3121025507944" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IAM Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1311.046355480482" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1403.4220193249782 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 1403.422016818153 32.143922998476604 M 1398.4083684659781 37.16258750749999 L 1398.4083684659781 47.893559521499995 M 1392.075335801978 41.03277413549999 L 1404.7414011299782 41.03277413549999 M 1398.4083684659781 47.893559521499995 L 1392.075335801978 57.92086123949999 M 1398.4083684659781 47.893559521499995 L 1404.7414011299782 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1376.6343740201773" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1369.301274654943" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 850.0337175679998 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 850.0287039179764 M 35.31561055361328 855.0473684269998 L 35.31561055361328 865.7783404409998 M 28.98257788961328 858.9175550549999 L 41.648643217613284 858.9175550549999 M 35.31561055361328 865.7783404409998 L 28.98257788961328 875.8056421589998 M 35.31561055361328 865.7783404409998 L 41.648643217613284 875.8056421589998" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="13.808065082421876" y="832.8377747094999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="841.6336534094999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 204.65694619001172 824.0418960094999 L 274.53858915065234 824.0418960094999 L 274.53858915065234 856.4986884124999 L 204.65694619001172 856.4986884124999 L 204.65694619001172 824.0418960094999 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="214.20047457951173" y="838.9069310124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.00707705753908" y="847.7028097124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 388.4609310044844 824.0418960094999 L 499.29891856961723 824.0418960094999 L 499.29891856961723 856.4986884124999 L 388.4609310044844 856.4986884124999 L 388.4609310044844 824.0418960094999 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.0044593939844" y="838.9069310124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="427.28923417425784" y="847.7028097124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 664.2064867649532 824.0418960094999 L 727.8800456191485 824.0418960094999 L 727.8800456191485 856.4986884124999 L 664.2064867649532 856.4986884124999 L 664.2064867649532 824.0418960094999 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="673.7500151544532" y="838.9069310124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="679.4526366144141" y="847.7028097124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 963.2339559008257 824.0418960094999 L 1069.9134656827553 824.0418960094999 L 1069.9134656827553 856.4986884124999 L 963.2339559008257 856.4986884124999 L 963.2339559008257 824.0418960094999 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="972.7774842903257" y="838.9069310124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="999.9830812141538" y="847.7028097124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1294.7685741612945 824.0418960094999 L 1360.505395954943 824.0418960094999 L 1360.505395954943 856.4986884124999 L 1294.7685741612945 856.4986884124999 L 1294.7685741612945 824.0418960094999 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1304.3121025507944" y="838.9069310124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IAM Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1311.046355480482" y="847.7028097124999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1403.4220193249782 850.0337175679998 A 5.013650858999999 5.013650858999999 0 1 1 1403.422016818153 850.0287039179764 M 1398.4083684659781 855.0473684269998 L 1398.4083684659781 865.7783404409998 M 1392.075335801978 858.9175550549999 L 1404.7414011299782 858.9175550549999 M 1398.4083684659781 865.7783404409998 L 1392.075335801978 875.8056421589998 M 1398.4083684659781 865.7783404409998 L 1404.7414011299782 875.8056421589998" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1376.6343740201773" y="832.8377747094999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1369.301274654943" y="841.6336534094999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 709.9083758754624 95.7431396495 L 1315.3227548781188 95.7431396495 L 1323.2390457081187 103.65943047949999 L 1323.2390457081187 133.5654180595 L 709.9083758754624 133.5654180595 L 709.9083758754624 95.7431396495 M 1315.3227548781188 95.7431396495 L 1315.3227548781188 103.65943047949999 L 1323.2390457081187 103.65943047949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="722.2226060554624" y="108.0573698295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="722.2226060554624" y="116.85324852950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.3026689216733" y="116.85324852950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="893.4859880134702" y="116.85324852950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com/.well-known/claims-provider-configuration</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="722.2226060554624" y="125.64912722950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at Bob's IAM Server and is assigned 'query-users', 'view-users' admin roles, thus can query and view any user to get their claims</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 448.27786413705087 146.7592361095 L 935.892377417051 146.7592361095 L 943.808668247051 154.6755269395 L 943.808668247051 175.7856358195 L 448.27786413705087 175.7856358195 L 448.27786413705087 146.7592361095 M 935.892377417051 146.7592361095 L 935.892377417051 154.6755269395 L 943.808668247051 154.6755269395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="460.59209431705085" y="159.07346628949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="460.59209431705085" y="167.86934498949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at bar.com IAM Server and pre-registered as a universal AEMS public client at foo.com UMA Server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 267.8268030054883 188.9794538695 L 612.0167557386133 188.9794538695 L 619.9330465686132 196.8957446995 L 619.9330465686132 218.00585357949998 L 267.8268030054883 218.00585357949998 L 267.8268030054883 188.9794538695 M 612.0167557386133 188.9794538695 L 612.0167557386133 196.8957446995 L 619.9330465686132 196.8957446995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="280.1410331854883" y="201.29368404949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com admin has set up the Resource Server and registers it's resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="280.1410331854883" y="210.08956274949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing' at the foo.com UMA Server with the associated scopes 'query', 'view'</text></g><g><g><rect fill="white" stroke="none" x="1007.5326104507723" y="231.1996716295" width="79.38641375648437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1008.8519922557723" y="239.1159624595" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate the request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1398.4083684659781 242.63431393949998 L 703.2852063217175 242.63431393949998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,242.63431393949998) translate(-696.0432661920509,-242.63431393949998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 703.3731651087176 238.96936448116665 L 696.0432661920509 242.63431393949998 L 703.3731651087176 246.2992633978333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="490.0089205326954" y="255.82813198949995" width="159.90534991371095" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="490.0089205326954" y="264.6240106894999" width="85.67631548988281" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="491.3283023376954" y="263.74442281949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="491.3283023376954" y="272.54030151949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=query, view)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 276.05865299949994 L 451.12186491671747 276.05865299949994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(443.8799247870508,276.05865299949994) translate(-443.8799247870508,-276.05865299949994)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.20982370371746 272.3937035411666 L 443.8799247870508 276.05865299949994 L 451.20982370371746 279.7236024578333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="510.0566729130665" y="289.25247104949995" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="511.3760547180665" y="297.1687618794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 443.8799247870508 300.68711335949996 L 688.8013260623842 300.68711335949996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,300.68711335949996) translate(-696.0432661920509,-300.68711335949996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.7133672753841 297.0221639011666 L 696.0432661920509 300.68711335949996 L 688.7133672753841 304.3520628178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="897.2326273650066" y="313.88093140949996" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="897.2326273650066" y="322.67681010949997" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="898.5520091700066" y="321.79722223949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="898.5520091700066" y="330.59310093949995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 334.1114524195 L 1320.3950449284519 334.1114524195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1327.6369850581186,334.1114524195) translate(-1327.6369850581186,-334.1114524195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1320.307086141452 330.44650296116663 L 1327.6369850581186 334.1114524195 L 1320.307086141452 337.77640187783334 Z"/></g></g><g><g><rect fill="white" stroke="none" x="899.1638254851238" y="347.3052704695" width="225.3526002799219" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="900.4832072901238" y="355.22156129949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token "audience":["claims-provider"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1327.6369850581186 358.7399127795 L 703.2852063217175 358.7399127795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,358.7399127795) translate(-696.0432661920509,-358.7399127795)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 703.3731651087176 355.07496332116665 L 696.0432661920509 358.7399127795 L 703.3731651087176 362.40486223783336 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 565.0458161023829 371.9337308295 L 819.1244254517189 371.9337308295 L 827.0407162817189 379.8500216595 L 827.0407162817189 392.1642518395 L 565.0458161023829 392.1642518395 L 565.0458161023829 371.9337308295 M 819.1244254517189 371.9337308295 L 819.1244254517189 379.8500216595 L 827.0407162817189 379.8500216595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="577.3600462823829" y="384.24796100950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><g><g><rect fill="white" stroke="none" x="761.2636504491277" y="405.3580698895" width="85.07527178871094" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="761.2636504491277" y="414.1539485895" width="190.08967608558595" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="761.2636504491277" y="422.9498272895" width="152.23510760414064" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="762.5830322541277" y="413.27436071949995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="762.5830322541277" y="422.07023941949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"],</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="762.5830322541277" y="430.86611811949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> ticket_challenge, scope=aems-app)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 434.3844695995 L 1009.3317706621239 434.3844695995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1016.5737107917905,434.3844695995) translate(-1016.5737107917905,-434.3844695995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1009.2438118751238 430.71952014116664 L 1016.5737107917905 434.3844695995 L 1009.2438118751238 438.04941905783335 Z"/></g></g><g><g><rect fill="white" stroke="none" x="706.4517226537175" y="447.57828764949994" width="98.03810137855469" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="706.4517226537175" y="456.37416634949994" width="176.55293292152345" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="706.4517226537175" y="465.17004504949995" width="299.71353167640626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="707.7711044587176" y="455.4945784794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="707.7711044587176" y="464.2904571794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Bob's user_claims, audience:[aems-app])</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="707.7711044587176" y="473.0863358794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1016.5737107917905 476.60468735949996 L 703.2852063217175 476.60468735949996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,476.60468735949996) translate(-696.0432661920509,-476.60468735949996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 703.3731651087176 472.9397379011666 L 696.0432661920509 476.60468735949996 L 703.3731651087176 480.2696368178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="337.38522936447276" y="489.7985054094999" width="92.87304705726562" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="337.38522936447276" y="498.5943841094999" width="260.8705751334375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="338.70461116947274" y="497.7147962394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="338.70461116947274" y="506.5106749394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token "audience":["aems-app"])</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 510.0290264194999 L 246.8397077999987 510.0290264194999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(239.59776767033205,510.0290264194999) translate(-239.59776767033205,-510.0290264194999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 246.92766658699873 506.3640769611666 L 239.59776767033205 510.0290264194999 L 246.92766658699873 513.6939758778333 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 63.95226917978516 523.2228444694999 L 407.32697533087895 523.2228444694999 L 415.24326616087893 531.1391352994999 L 415.24326616087893 561.0451228794999 L 63.95226917978516 561.0451228794999 L 63.95226917978516 523.2228444694999 M 407.32697533087895 523.2228444694999 L 407.32697533087895 531.1391352994999 L 415.24326616087893 531.1391352994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="76.26649935978517" y="535.5370746494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="76.26649935978517" y="544.3329533494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="76.26649935978517" y="553.1288320494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 48.50942860361329 597.9878134195 L 422.7698159070508 597.9878134195 L 430.6861067370508 605.9041042494999 L 430.6861067370508 697.3812427295 L 48.50942860361329 697.3812427295 L 48.50942860361329 597.9878134195 M 422.7698159070508 597.9878134195 L 422.7698159070508 605.9041042494999 L 430.6861067370508 605.9041042494999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="610.3020435994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="619.0979222994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="627.8938009994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrap discovery of Claims Provider config url from email address via WebFinger;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="636.6896796994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    if this doesn't work, build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="645.4855583994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="654.2814370994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. check audience=aems-agent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="663.0773157994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="671.8731944994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="680.6690731994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="689.4649518994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="436.6925413761915" y="723.7688788295" width="62.25595111" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.0119231811915" y="731.6851696594999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 239.59776767033205 735.2035211394999 L 688.8013260623842 735.2035211394999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,735.2035211394999) translate(-696.0432661920509,-735.2035211394999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.7133672753841 731.5385716811666 L 696.0432661920509 735.2035211394999 L 688.7133672753841 738.8684705978333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="478.8657091679493" y="748.3973391894999" width="182.19177264320314" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="478.8657091679493" y="757.1932178894999" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="480.1850909729493" y="756.3136300194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Get data from Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="480.1850909729493" y="765.1095087194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 768.6278601994999 L 451.12186491671747 768.6278601994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(443.8799247870508,768.6278601994999) translate(-443.8799247870508,-768.6278601994999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.20982370371746 764.9629107411665 L 443.8799247870508 768.6278601994999 L 451.20982370371746 772.2928096578332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="545.0463045658985" y="781.8216782494999" width="49.830581847304686" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="546.3656863708985" y="789.7379690794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. 200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 443.8799247870508 793.2563205594998 L 688.8013260623842 793.2563205594998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,793.2563205594998) translate(-696.0432661920509,-793.2563205594998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.7133672753841 789.5913711011665 L 696.0432661920509 793.2563205594998 L 688.7133672753841 796.9212700178332 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.111489253613286 574.2389409294999 L 435.0840460870508 574.2389409294999 L 435.0840460870508 710.5750607795 L 44.111489253613286 710.5750607795 L 44.111489253613286 574.2389409294999 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 44.111489253613286 574.2389409294999 L 44.111489253613286 584.7939953695 L 140.38334614091798 584.7939953695 L 145.66087336091798 579.5164681494999 L 145.66087336091798 574.2389409294999 L 44.111489253613286 574.2389409294999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="52.90736795361329" y="581.2756438895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g></g></g></svg>