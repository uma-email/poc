<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1822" height="1264"><desc>participant%20%22Client%22%20as%20client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22Authorization%20Server%20(AS)%22%20as%20AS%0A%0Abottomparticipants%0A%0Anote%20over%20client%2CAS%3AHMAC(HMAC(K2%2C%20HMAC(K1%2C%20m1))%2C%20m2)%0Anote%20right%20of%20client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Anote%20right%20of%20RS%3ARS%3A%5Cn%E2%80%A2%20is%20registered%20at%20the%20AS%20as%20a%20confidential%20client%20and%20has%20a%20client%20secret%0Aclient-%3EAS%3A1.%20authorization%20grant%0AAS-%3EAS%3A2.%20AS%3A%5Cn%20a)%20issues%20an%20opaque%20access%20token%20using%20a%20high%20entropy%20nonce%20data%20string%5Cn%20b)%20maps%20the%20corresponding%20client%20secrets%20to%20the%20issued%20token%20and%20stores%20the%20token%20data%20in%20a%20database%0Aclient%3C-AS%3A3.%20access%20token%0Aclient-%3Eclient%3A4.%20Client%3A%5Cn%E2%80%A2%20generates%20the%20pocop-jwt%20with%20a%20payload%20including%20the%20access%20token%2C%20issuer%20and%20a%20timestamp%20%0Anote%20right%20of%20client%3AThe%20pocop-jwt%20is%20generated%20as%3A%5Cnpocop-jwt%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20base64url(%7B%22typ%22%3A%22JWT%22%2C%22alg%22%3A%22HS256%22%7D)%5Cnpayload%20%3D%20base64url(%7B%22token%22%3Aaccess%20token%2C%22iss%22%3Aclient%20name%2C%22ts%22%3Atimestamp%7D)%5Cnsignature%20%3D%20base64url(HMAC-SHA256(K1%2C%20m1))%5Cnwhere%5Cnm1%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnK1%20%3D%20SHA256(client%20secret)%0Aclient-%3ERS%3A5.%20pocop-jwt%0ARS-%3ERS%3A6.%20RS%3A%5Cn%E2%80%A2%20generates%20the%20next%20pocop-jwt%20with%20a%20compound%20payload%0Anote%20right%20of%20RS%3A%E2%80%A2%20a%20new%20required%20claim%20%7B%22iss%22%3Aclient%20name%7D%20must%20be%20added%20to%20the%20previous%20pocop-jwt%20payload%20as%20a%20nested%20object%5Cn%20%20%20to%20form%20a%20new%20compound%20payload%5Cn%E2%80%A2%20the%20nested%20object%20may%20contain%20additional%20optional%20claims%20e.g.%2C%20%22resource_id%22%2C%20%22resource_scopes%22%0Anote%20right%20of%20RS%3AThe%20pocop-jwt%20is%20generated%20as%3A%5Cnpocop-jwt%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%20%7C%7C%20%22.%22%20%7C%7C%20signature%5Cnwhere%5Cnheader%20%3D%20previous%20pocop-jwt%20header%5Cnpayload%20%3D%20base64url%20encoded%20%5Bprevious%20pocop-jwt%20payload(pocop-jwt%20payload)%5D%5Cnsignature%20%3D%20base64url(HMAC-SHA256(Key%2C%20m2))%5Cnwhere%5Cnpocop-jwt%20payload%20%3D%20%7B%22iss%22%3Aclient%20name%7D%5Cnm2%20%3D%20header%20%7C%7C%20%22.%22%20%7C%7C%20payload%5CnKey%20%3D%20HMAC-SHA256(K2%2C%20message)%5Cnwhere%5CnK2%20%3D%20SHA256(client%20secret)%5Cnmessage%20%3D%20base64url%20decoded%20previous%20pocop-jwt%20signature%0ARS-%3EAS%3A7.%20pocop-jwt%0Anote%20right%20of%20RS%3ARS%20sends%20the%20pocop-jwt%20in%20the%20Authorization%20header%5Cnto%20authenticate%20itself%20to%20the%20AS%20introspection%20endpoint%0AAS-%3EAS%3A8.%20AS%3A%5Cn%20a)%20looks%20up%20the%20access%20token%20data%20using%20the%20token%20claim%20value%20from%20the%20pocop-jwt%2C%20and%20checks%20the%20token%20state%5Cn%20b)%20generates%20a%20pocop-jwt%20replica%20using%20the%20pocop-jwt%20payload%20data%2C%20token%20data%20and%20corresponding%20client%20secrets%5Cn%20c)%20compares%20the%20pocop-jwt%20replica%20signature%20with%20the%20pocop-jwt%20signature%2C%20they%20are%20equal%2C%5Cn%20%20%20%20%20the%20chronological%20record%20of%20all%20the%20possessors%20of%20the%20POCOP%20token%20and%20the%20changes%20have%20been%20verified%2C%5Cn%20%20%20%20%20the%20AS%20validates%20the%20ts%20(timestamp)%20claim%20value%20from%20the%20pocop-jwt%2C%20if%20valid%2C%5Cn%20%20%20%20%20the%20AS%20may%20return%20the%20access%20token%20introspection%20response%0ARS%3C-AS%3A9.%20access%20token%20introspection%20response%0ARS-%3ERS%3A10.%20RS%3A%5Cn%E2%80%A2%20verifies%20the%20access%20token%20introspection%20response%2C%20if%20true%2C%5Cn%20%20%20the%20RS%20may%20return%20the%20protected%20resource%0Aclient%3C-RS%3A11.%20protected%20resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1822" height="1264"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 38.111285853 L 33.37474404576514 1224.4240116629999" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 38.111285853 L 557.9412302016245 1224.4240116629999" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1201.198705616937 38.111285853 L 1201.198705616937 1224.4240116629999" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray="8.699220692307692,3.7696623000000002"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 7.690111091999997 L 61.09499464153028 7.690111091999997 L 61.09499464153028 38.111285853 L 5.654493450000004 38.111285853 L 5.654493450000004 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 489.0459794151245 7.690111091999997 L 626.8364809881245 7.690111091999997 L 626.8364809881245 38.111285853 L 489.0459794151245 38.111285853 L 489.0459794151245 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.31623020162453" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1121.0951189539724 7.690111091999997 L 1281.302292279902 7.690111091999997 L 1281.302292279902 38.111285853 L 1121.0951189539724 38.111285853 L 1121.0951189539724 7.690111091999997 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1133.3653697404723" y="26.802298953" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 5.654493450000004 1224.4240116629999 L 61.09499464153028 1224.4240116629999 L 61.09499464153028 1254.8451864239998 L 5.654493450000004 1254.8451864239998 L 5.654493450000004 1224.4240116629999 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="17.924744236500004" y="1243.5361995239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 489.0459794151245 1224.4240116629999 L 626.8364809881245 1224.4240116629999 L 626.8364809881245 1254.8451864239998 L 489.0459794151245 1254.8451864239998 L 489.0459794151245 1224.4240116629999 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.31623020162453" y="1243.5361995239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1121.0951189539724 1224.4240116629999 L 1281.302292279902 1224.4240116629999 L 1281.302292279902 1254.8451864239998 L 1121.0951189539724 1254.8451864239998 L 1121.0951189539724 1224.4240116629999 Z" stroke-miterlimit="10" stroke-width="1.8094379040000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1133.3653697404723" y="1243.5361995239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization Server (AS)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 23.196655835765142 60.729259653 L 1201.1987056169373 60.729259653 L 1211.3767938269373 70.907347863 L 1211.3767938269373 86.739929523 L 23.196655835765142 86.739929523 L 23.196655835765142 60.729259653 M 1201.1987056169373 60.729259653 L 1201.1987056169373 70.907347863 L 1211.3767938269373 70.907347863" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="515.9450576560582" y="76.561841313" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">HMAC(HMAC(K2, HMAC(K1, m1)), m2)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 122.363238258 L 39.029237495765145 122.363238258 M 39.029237495765145 103.703409873 L 437.7663126057651 103.703409873 L 447.9444008157651 113.881498083 L 447.9444008157651 141.023066643 L 39.029237495765145 141.023066643 L 39.029237495765145 103.703409873 M 437.7663126057651 103.703409873 L 437.7663126057651 113.881498083 L 447.9444008157651 113.881498083" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="119.53599153299999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576512" y="130.844978433" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 176.646375378 L 563.5957236516246 176.646375378 M 563.5957236516246 157.986546993 L 962.3327987616245 157.986546993 L 972.5108869716246 168.164635203 L 972.5108869716246 195.30620376299998 L 563.5957236516246 195.30620376299998 L 563.5957236516246 157.986546993 M 962.3327987616245 157.986546993 L 962.3327987616245 168.164635203 L 972.5108869716246 168.164635203" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="173.81912865299998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="185.128115553" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at the AS as a confidential client and has a client secret</text></g><g><g><rect fill="white" stroke="none" x="557.4237088581187" y="212.26968411299998" width="119.72603194646484" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="559.1200568931188" y="222.44777232299998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. authorization grant</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 226.971367083 L 1191.887639735937 226.971367083" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(1201.198705616937,226.971367083) translate(-1201.198705616937,-226.971367083)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1191.7745498669372 222.25928920799998 L 1201.198705616937 226.971367083 L 1191.7745498669372 231.683444958 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1214.581006781937" y="243.934847433" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1214.581006781937" y="255.243834333" width="397.40935866765625" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1214.581006781937" y="266.552821233" width="548.326045679375" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="254.112935643" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="265.421922543" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) issues an opaque access token using a high entropy nonce data string</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="276.730909443" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) maps the corresponding client secrets to the issued token and stores the token data in a database</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1201.198705616937 281.254504203 L 1246.434653216937 281.254504203 L 1246.434653216937 295.956187173 L 1210.5097714979372 295.956187173" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(1201.198705616937,295.956187173) translate(-1201.198705616937,-295.956187173)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1210.622861366937 291.244109298 L 1201.198705616937 295.956187173 L 1210.622861366937 300.66826504799997 Z"/></g></g><g><g><rect fill="white" stroke="none" x="574.1903752704723" y="312.919667523" width="86.19269912175781" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="575.8867233054723" y="323.097755733" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1201.198705616937 327.62135049299997 L 42.685809926765145 327.62135049299997" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,327.62135049299997) translate(-33.37474404576514,-327.62135049299997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 322.909272618 L 33.37474404576514 327.62135049299997 L 42.79889979576514 332.33342836799994 Z"/></g></g><g><g><rect fill="white" stroke="none" x="46.75704521076514" y="344.58483084299996" width="51.47602813176758" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="46.75704521076514" y="355.89381774299994" width="507.2260395758594" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="354.76291905299996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="48.45339324576514" y="366.07190595299994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the pocop-jwt with a payload including the access token, issuer and a timestamp </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 370.595500713 L 78.61069164576514 370.595500713 L 78.61069164576514 385.29718368299996 L 42.685809926765145 385.29718368299996" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,385.29718368299996) translate(-33.37474404576514,-385.29718368299996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 380.585105808 L 33.37474404576514 385.29718368299996 L 42.79889979576514 390.00926155799993 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 460.501946568 L 39.029237495765145 460.501946568 M 39.029237495765145 402.26066403299995 L 484.2663126057651 402.26066403299995 L 494.4444008157651 412.43875224299995 L 494.4444008157651 518.743229103 L 39.029237495765145 518.743229103 L 39.029237495765145 402.26066403299995 M 484.2663126057651 402.26066403299995 L 484.2663126057651 412.43875224299995 L 494.4444008157651 412.43875224299995" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="418.093245693" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The pocop-jwt is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="429.40223259299995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">pocop-jwt = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="440.71121949299993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="452.0202063929999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = base64url({"typ":"JWT","alg":"HS256"})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="463.3291932929999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url({"token":access token,"iss":client name,"ts":timestamp})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="474.63818019299987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(K1, m1))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="485.94716709299985" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="497.2561539929998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">m1 = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="54.86181915576515" y="508.5651408929998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">K1 = SHA256(client secret)</text></g><g><g><rect fill="white" stroke="none" x="261.0699726763413" y="535.706709453" width="69.17602889470703" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.76632071134134" y="545.8847976630001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. pocop-jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 33.37474404576514 550.408392423 L 548.6301643206245 550.408392423" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(557.9412302016245,550.408392423) translate(-557.9412302016245,-550.408392423)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 548.5170744516246 545.696314548 L 557.9412302016245 550.408392423 L 548.5170744516246 555.120470298 Z"/></g></g><g><g><rect fill="white" stroke="none" x="571.3235313666245" y="567.3718727730001" width="34.75936286382324" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="571.3235313666245" y="578.6808596730001" width="312.15935866765625" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="573.0198794016245" y="577.5499609830001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="573.0198794016245" y="588.8589478830002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• generates the next pocop-jwt with a compound payload</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 593.3825426430001 L 603.1771778016246 593.3825426430001 L 603.1771778016246 608.0842256130001 L 567.2522960826245 608.0842256130001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(557.9412302016245,608.0842256130001) translate(-557.9412302016245,-608.0842256130001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 567.3653859516245 603.3721477380001 L 557.9412302016245 608.0842256130001 L 567.3653859516245 612.796303488 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 649.3620277980001 L 563.5957236516246 649.3620277980001 M 563.5957236516246 625.0477059630001 L 1185.3661239569371 625.0477059630001 L 1195.544212166937 635.2257941730002 L 1195.544212166937 673.6763496330001 L 563.5957236516246 673.6763496330001 L 563.5957236516246 625.0477059630001 M 1185.3661239569371 625.0477059630001 L 1185.3661239569371 635.2257941730002 L 1195.544212166937 635.2257941730002" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116246" y="640.8802876230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• a new required claim {"iss":client name} must be added to the previous pocop-jwt payload as a nested object</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116246" y="652.1892745230002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   to form a new compound payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116246" y="663.4982614230003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the nested object may contain additional optional claims e.g., "resource_id", "resource_scopes"</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 771.4990863180001 L 563.5957236516246 771.4990863180001 M 563.5957236516246 690.639829983 L 1010.7327926581089 690.639829983 L 1020.910880868109 700.8179181930001 L 1020.910880868109 852.3583426530001 L 563.5957236516246 852.3583426530001 L 563.5957236516246 690.639829983 M 1010.7327926581089 690.639829983 L 1010.7327926581089 700.8179181930001 L 1020.910880868109 700.8179181930001" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="706.4724116430001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The pocop-jwt is generated as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="717.7813985430001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">pocop-jwt = header || "." || payload || "." || signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="729.0903854430002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="740.3993723430002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">header = previous pocop-jwt header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="751.7083592430002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">payload = base64url encoded [previous pocop-jwt payload(pocop-jwt payload)]</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="763.0173461430003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signature = base64url(HMAC-SHA256(Key, m2))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="774.3263330430003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="785.6353199430004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">pocop-jwt payload = {"iss":client name}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="796.9443068430004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">m2 = header || "." || payload</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="808.2532937430004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Key = HMAC-SHA256(K2, message)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="819.5622806430005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="830.8712675430005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">K2 = SHA256(client secret)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="842.1802544430005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">message = base64url decoded previous pocop-jwt signature</text></g><g><g><rect fill="white" stroke="none" x="844.9819534619273" y="869.3218230030002" width="69.17602889470703" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="846.6783014969274" y="879.4999112130002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. pocop-jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 884.0235059730002 L 1191.887639735937 884.0235059730002" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(1201.198705616937,884.0235059730002) translate(-1201.198705616937,-884.0235059730002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1191.7745498669372 879.3114280980002 L 1201.198705616937 884.0235059730002 L 1191.7745498669372 888.7355838480001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 919.6468147080002 L 563.5957236516246 919.6468147080002 M 563.5957236516246 900.9869863230001 L 872.9161422674839 900.9869863230001 L 883.094230477484 911.1650745330002 L 883.094230477484 938.3066430930002 L 563.5957236516246 938.3066430930002 L 563.5957236516246 900.9869863230001 M 872.9161422674839 900.9869863230001 L 872.9161422674839 911.1650745330002 L 883.094230477484 911.1650745330002" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="916.8195679830003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RS sends the pocop-jwt in the Authorization header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.4283053116245" y="928.1285548830003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to authenticate itself to the AS introspection endpoint</text></g><g><g><rect fill="white" stroke="none" x="1214.581006781937" y="955.2701234430001" width="34.64269607" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1214.581006781937" y="966.5791103430001" width="594.076045679375" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1214.581006781937" y="977.8880972430002" width="603.4926716559376" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1214.581006781937" y="989.1970841430002" width="485.9260212653125" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1214.581006781937" y="1000.5060710430002" width="570.209346460625" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1214.581006781937" y="1011.8150579430003" width="425.84270827703125" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="1214.581006781937" y="1023.1240448430003" width="336.69268386296875" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="965.4482116530002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. AS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="976.7571985530002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> a) looks up the access token data using the token claim value from the pocop-jwt, and checks the token state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="988.0661854530002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> b) generates a pocop-jwt replica using the pocop-jwt payload data, token data and corresponding client secrets</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="999.3751723530003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> c) compares the pocop-jwt replica signature with the pocop-jwt signature, they are equal,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="1010.6841592530003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the chronological record of all the possessors of the POCOP token and the changes have been verified,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="1021.9931461530003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS validates the ts (timestamp) claim value from the pocop-jwt, if valid,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.277354816937" y="1033.3021330530003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     the AS may return the access token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1201.198705616937 1037.825727813 L 1246.434653216937 1037.825727813 L 1246.434653216937 1052.527410783 L 1210.5097714979372 1052.527410783" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(1201.198705616937,1052.527410783) translate(-1201.198705616937,-1052.527410783)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1210.622861366937 1047.815332908 L 1201.198705616937 1052.527410783 L 1210.622861366937 1057.239488658 Z"/></g></g><g><g><rect fill="white" stroke="none" x="773.9236229260387" y="1069.4908911329999" width="211.29268996648437" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="775.6199709610387" y="1079.6689793429998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. access token introspection response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1201.198705616937 1084.192574103 L 567.2522960826245 1084.192574103" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(557.9412302016245,1084.192574103) translate(-557.9412302016245,-1084.192574103)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 567.3653859516245 1079.480496228 L 557.9412302016245 1084.192574103 L 567.3653859516245 1088.904651978 Z"/></g></g><g><g><rect fill="white" stroke="none" x="571.3235313666245" y="1101.156054453" width="41.542697595878906" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="571.3235313666245" y="1112.465041353" width="313.0260273688281" height="14.70168297"/></g><g><rect fill="white" stroke="none" x="571.3235313666245" y="1123.774028253" width="236.8426930182422" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="573.0198794016245" y="1111.334142663" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. RS:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="573.0198794016245" y="1122.643129563" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• verifies the access token introspection response, if true,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="573.0198794016245" y="1133.952116463" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the RS may return the protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 1138.475711223 L 603.1771778016246 1138.475711223 L 603.1771778016246 1153.177394193 L 567.2522960826245 1153.177394193" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(557.9412302016245,1153.177394193) translate(-557.9412302016245,-1153.177394193)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 567.3653859516245 1148.465316318 L 557.9412302016245 1153.177394193 L 567.3653859516245 1157.889472068 Z"/></g></g><g><g><rect fill="white" stroke="none" x="233.20330397516946" y="1170.1408745429999" width="124.90936629705078" height="14.70168297"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8pt" font-style="normal" font-weight="normal" text-decoration="normal" x="234.89965201016946" y="1180.3189627529998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 557.9412302016245 1184.842557513 L 42.685809926765145 1184.842557513" stroke-miterlimit="10" stroke-width="0.9424155750000001" stroke-dasharray=""/><g transform="translate(33.37474404576514,1184.842557513) translate(-33.37474404576514,-1184.842557513)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 42.79889979576514 1180.130479638 L 33.37474404576514 1184.842557513 L 42.79889979576514 1189.554635388 Z"/></g></g></g></g></svg>