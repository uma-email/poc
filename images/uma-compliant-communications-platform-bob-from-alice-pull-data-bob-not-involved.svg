<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1513" height="1032"><desc>Title%20UMA-compliant%20communications%20platform%20-%20Bob%20from%20Alice%20(pull%20data)%20-%20Bob%20not%20involved%0A%0Aactor%20%22Alice%20(RO)%5Cnsender%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22UMA%20Server%5Cnfoo.com%22%20as%20asServer%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnfoo.com%22%20as%20rsServer%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnbar.com%22%20as%20rqpClient%20%23lightsteelblue%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnbar.com%22%20as%20claimsProvider%20%23lightsteelblue%0Aparticipant%20%22IAM%20Server%5Cnbar.com%22%20as%20authServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RqP)%5Cnrecipient%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Anote%20over%20claimsProvider%3AClaims%20Provider%3A%5Cn%E2%80%A2%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Fbar.com%2F.well-known%2Fclaims-provider-configuration%5Cn%E2%80%A2%20is%20registered%20at%20Bob's%20IAM%20Server%20and%20is%20assigned%20'query-users'%2C%20'view-users'%20admin%20roles%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0Anote%20over%20rqpClient%3ARqP%20Client%3A%5Cn%E2%80%A2%20is%20registered%20at%20bar.com%20IAM%20Server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20foo.com%20UMA%20Server%5Cn%E2%80%A2%20is%20an%20agent%20that%20can%20act%20on%20behalf%20of%20any%20user%20registered%20at%20bar.com%20IAM%20Server%0Anote%20over%20rsServer%3Afoo.com%20admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%5Cn'Outgoing'%20at%20the%20foo.com%20UMA%20Server%20with%20the%20associated%20scopes%20'query'%2C%20'view'%0ArqpClient%3C--Bob%3AInitiate%20the%20request%20asynchronously%20via%20the%20message%20queue%0ArsServer%3C-rqpClient%3A1.%20Request%20Alice's%20'Outgoing'%20resource%5Cn(scope%3Dquery%2C%20view)%0ArsServer-%3ErqpClient%3A2.%20401%20with%20permission%20ticket%0ArqpClient-%3EauthServer%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0ArqpClient%3C-authServer%3A4.%20Return%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%0Anote%20over%20rqpClient%3A%E2%80%A2%20ticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%5Cn%E2%80%A2%20the%20email_address%20is%20specified%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20Bob's%20email_address%2C%5Cn%20ticket_challenge%2C%20scope%3Daems-agent)%0AclaimsProvider-%3EauthServer%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Drealm-management%2C%20role%3Dquery-users%2C%20view-users)%0AclaimsProvider%3C-authServer%3A7.%20Return%20access_token%20%22audience%22%3A%5B%22realm-management%22%5D%0A%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Bob's%20user_claims%5Cn(access_token%20%22audience%22%3A%5B%22realm-management%22%5D%2C%20Bob's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Bob's%20user_claims%0A%0ArqpClient%3C-claimsProvider%3A12.%20Return%20claims_token%5Cn(Bob's%20user_claims%2C%20audience%3A%5Baems-agent%5D)%5Cn%20if%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token%20%22audience%22%3A%5B%22aems-agent%22%5D)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn%E2%80%A2%20recipient_info%20(email%20address%2C%20fullname)%5Cn%E2%80%A2%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrap%20discovery%20of%20Claims%20Provider%20config%20url%20from%20email%20address%20via%20WebFinger%3B%5Cn%20%20%20%20if%20this%20doesn't%20work%2C%20build%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%5Cn5.%20check%20audience%3Daems-agent%5Cn6.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn7.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArsServer%3C-rqpClient%3A15.%20Get%20data%20from%20Alice's%20'Outgoing'%20resource%5Cn(RPT)%0ArsServer-%3ErqpClient%3A16.%20200%20OK</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1513" height="1032"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="486.47431307982174" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA-compliant communications platform - Bob from Alice (pull data) - Bob not involved</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 35.31561055361328 86.94726094949999 L 35.31561055361328 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 239.59776767033205 86.94726094949999 L 239.59776767033205 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 443.8799247870508 86.94726094949999 L 443.8799247870508 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 86.94726094949999 L 696.0432661920509 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1016.5737107917905 86.94726094949999 L 1016.5737107917905 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1409.442717403249 86.94726094949999 L 1409.442717403249 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1480.2141008111084 86.94726094949999 L 1480.2141008111084 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 32.143922998476604 M 35.31561055361328 37.16258750749999 L 35.31561055361328 47.893559521499995 M 28.98257788961328 41.03277413549999 L 41.648643217613284 41.03277413549999 M 35.31561055361328 47.893559521499995 L 28.98257788961328 57.92086123949999 M 35.31561055361328 47.893559521499995 L 41.648643217613284 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="13.808065082421876" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="21.05467763125" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sender</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="84.3084973395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 204.65694619001172 54.4904685465 L 274.53858915065234 54.4904685465 L 274.53858915065234 86.94726094949999 L 204.65694619001172 86.94726094949999 L 204.65694619001172 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="214.20047457951173" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.00707705753908" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 388.4609310044844 54.4904685465 L 499.29891856961723 54.4904685465 L 499.29891856961723 86.94726094949999 L 388.4609310044844 86.94726094949999 L 388.4609310044844 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.0044593939844" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="427.28923417425784" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 664.2064867649532 54.4904685465 L 727.8800456191485 54.4904685465 L 727.8800456191485 86.94726094949999 L 664.2064867649532 86.94726094949999 L 664.2064867649532 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="673.7500151544532" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="679.4526366144141" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 963.2339559008257 54.4904685465 L 1069.9134656827553 54.4904685465 L 1069.9134656827553 86.94726094949999 L 963.2339559008257 86.94726094949999 L 963.2339559008257 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="972.7774842903257" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="999.9830812141538" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1376.5743065064248 54.4904685465 L 1442.3111283000733 54.4904685465 L 1442.3111283000733 86.94726094949999 L 1376.5743065064248 86.94726094949999 L 1376.5743065064248 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1386.1178348959247" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IAM Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1392.8520878256122" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1485.2277516701085 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 1485.2277491632833 32.143922998476604 M 1480.2141008111084 37.16258750749999 L 1480.2141008111084 47.893559521499995 M 1473.8810681471084 41.03277413549999 L 1486.5471334751085 41.03277413549999 M 1480.2141008111084 47.893559521499995 L 1473.8810681471084 57.92086123949999 M 1480.2141008111084 47.893559521499995 L 1486.5471334751085 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1458.4401063653077" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1462.5849199029053" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">recipient</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1451.1070070000733" y="84.3084973395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 1001.3228312079996 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 1001.3178175579761 M 35.31561055361328 1006.3364820669996 L 35.31561055361328 1017.0674540809996 M 28.98257788961328 1010.2066686949996 L 41.648643217613284 1010.2066686949996 M 35.31561055361328 1017.0674540809996 L 28.98257788961328 1027.0947557989996 M 35.31561055361328 1017.0674540809996 L 41.648643217613284 1027.0947557989996" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="13.808065082421876" y="975.3310096494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="21.05467763125" y="984.1268883494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sender</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="992.9227670494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 204.65694619001172 966.5351309494998 L 274.53858915065234 966.5351309494998 L 274.53858915065234 998.9919233524998 L 204.65694619001172 998.9919233524998 L 204.65694619001172 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="214.20047457951173" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="223.00707705753908" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 388.4609310044844 966.5351309494998 L 499.29891856961723 966.5351309494998 L 499.29891856961723 998.9919233524998 L 388.4609310044844 998.9919233524998 L 388.4609310044844 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="398.0044593939844" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="427.28923417425784" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 664.2064867649532 966.5351309494998 L 727.8800456191485 966.5351309494998 L 727.8800456191485 998.9919233524998 L 664.2064867649532 998.9919233524998 L 664.2064867649532 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="673.7500151544532" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="679.4526366144141" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 963.2339559008257 966.5351309494998 L 1069.9134656827553 966.5351309494998 L 1069.9134656827553 998.9919233524998 L 963.2339559008257 998.9919233524998 L 963.2339559008257 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="972.7774842903257" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="999.9830812141538" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1376.5743065064248 966.5351309494998 L 1442.3111283000733 966.5351309494998 L 1442.3111283000733 998.9919233524998 L 1376.5743065064248 998.9919233524998 L 1376.5743065064248 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1386.1178348959247" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IAM Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1392.8520878256122" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1485.2277516701085 1001.3228312079996 A 5.013650858999999 5.013650858999999 0 1 1 1485.2277491632833 1001.3178175579761 M 1480.2141008111084 1006.3364820669996 L 1480.2141008111084 1017.0674540809996 M 1473.8810681471084 1010.2066686949996 L 1486.5471334751085 1010.2066686949996 M 1480.2141008111084 1017.0674540809996 L 1473.8810681471084 1027.0947557989996 M 1480.2141008111084 1017.0674540809996 L 1486.5471334751085 1027.0947557989996" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1458.4401063653077" y="975.3310096494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1462.5849199029053" y="984.1268883494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">recipient</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1451.1070070000733" y="992.9227670494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 709.9083758754624 104.5390183495 L 1315.3227548781188 104.5390183495 L 1323.2390457081187 112.45530917949999 L 1323.2390457081187 142.3612967595 L 709.9083758754624 142.3612967595 L 709.9083758754624 104.5390183495 M 1315.3227548781188 104.5390183495 L 1315.3227548781188 112.45530917949999 L 1323.2390457081187 112.45530917949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="722.2226060554624" y="116.85324852950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="722.2226060554624" y="125.64912722950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.3026689216733" y="125.64912722950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="893.4859880134702" y="125.64912722950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com/.well-known/claims-provider-configuration</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="722.2226060554624" y="134.4450059295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at Bob's IAM Server and is assigned 'query-users', 'view-users' admin roles, thus can query and view any user to get their claims</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 448.27786413705087 155.5551148095 L 935.892377417051 155.5551148095 L 943.808668247051 163.4714056395 L 943.808668247051 193.3773932195 L 448.27786413705087 193.3773932195 L 448.27786413705087 155.5551148095 M 935.892377417051 155.5551148095 L 935.892377417051 163.4714056395 L 943.808668247051 163.4714056395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="460.59209431705085" y="167.8693449895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="460.59209431705085" y="176.6652236895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at bar.com IAM Server and pre-registered as a universal AEMS public client at foo.com UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="460.59209431705085" y="185.4611023895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is an agent that can act on behalf of any user registered at bar.com IAM Server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 267.8268030054883 206.5712112695 L 612.0167557386133 206.5712112695 L 619.9330465686132 214.4875020995 L 619.9330465686132 235.5976109795 L 267.8268030054883 235.5976109795 L 267.8268030054883 206.5712112695 M 612.0167557386133 206.5712112695 L 612.0167557386133 214.4875020995 L 619.9330465686132 214.4875020995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="280.1410331854883" y="218.88544144949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com admin has set up the Resource Server and registers it's resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="280.1410331854883" y="227.68132014949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing' at the foo.com UMA Server with the associated scopes 'query', 'view'</text></g><g><g><rect fill="white" stroke="none" x="965.2087310178687" y="248.7914290295" width="245.8399049674219" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="966.5281128228687" y="256.7077198595" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate the request asynchronously via the message queue</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1480.2141008111084 260.2260713395 L 703.2852063217175 260.2260713395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="3.5183514799999998"/><g transform="translate(696.0432661920509,260.2260713395) translate(-696.0432661920509,-260.2260713395)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 703.3731651087176 256.5611218811666 L 696.0432661920509 260.2260713395 L 703.3731651087176 263.89102079783333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="490.0089205326954" y="273.41988938949993" width="159.90534991371095" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="490.0089205326954" y="282.21576808949993" width="85.67631548988281" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="491.3283023376954" y="281.3361802194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="491.3283023376954" y="290.1320589194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=query, view)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 293.65041039949995 L 451.12186491671747 293.65041039949995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(443.8799247870508,293.65041039949995) translate(-443.8799247870508,-293.65041039949995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.20982370371746 289.9854609411666 L 443.8799247870508 293.65041039949995 L 451.20982370371746 297.3153598578333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="510.0566729130665" y="306.84422844949995" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="511.3760547180665" y="314.76051927949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 443.8799247870508 318.27887075949997 L 688.8013260623842 318.27887075949997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,318.27887075949997) translate(-696.0432661920509,-318.27887075949997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.7133672753841 314.6139213011666 L 696.0432661920509 318.27887075949997 L 688.7133672753841 321.9438202178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="938.1354935375717" y="331.47268880949997" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="938.1354935375717" y="340.2685675095" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="939.4548753425718" y="339.38897963949995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="939.4548753425718" y="348.18485833949995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 351.7032098195 L 1402.2007772735822 351.7032098195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1409.442717403249,351.7032098195) translate(-1409.442717403249,-351.7032098195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1402.1128184865822 348.03826036116664 L 1409.442717403249 351.7032098195 L 1402.1128184865822 355.36815927783334 Z"/></g></g><g><g><rect fill="white" stroke="none" x="940.0666916576889" y="364.8970278695" width="225.3526002799219" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="941.386073462689" y="372.8133186995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token "audience":["claims-provider"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1409.442717403249 376.3316701795 L 703.2852063217175 376.3316701795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,376.3316701795) translate(-696.0432661920509,-376.3316701795)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 703.3731651087176 372.66672072116666 L 696.0432661920509 376.3316701795 L 703.3731651087176 379.99661963783336 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 565.0458161023829 389.5254882295 L 819.1244254517189 389.5254882295 L 827.0407162817189 397.4417790595 L 827.0407162817189 418.55188793950003 L 565.0458161023829 418.55188793950003 L 565.0458161023829 389.5254882295 M 819.1244254517189 389.5254882295 L 819.1244254517189 397.4417790595 L 827.0407162817189 397.4417790595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="577.3600462823829" y="401.83971840950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• ticket_challenge = Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="577.3600462823829" y="410.63559710950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the email_address is specified by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="715.5225234349675" y="431.7457059895" width="85.07527178871094" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="715.5225234349675" y="440.5415846895" width="281.57193011390626" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="715.5225234349675" y="449.3374633895" width="160.01463336097657" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="716.8419052399676" y="439.66199681949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="716.8419052399676" y="448.45787551949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], Bob's email_address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="716.8419052399676" y="457.25375421949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> ticket_challenge, scope=aems-agent)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 460.7721056995 L 1009.3317706621239 460.7721056995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1016.5737107917905,460.7721056995) translate(-1016.5737107917905,-460.7721056995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1009.2438118751238 457.10715624116665 L 1016.5737107917905 460.7721056995 L 1009.2438118751238 464.43705515783336 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1026.9821672534572" y="473.96592374949995" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1026.9821672534572" y="482.76180244949995" width="372.052093688125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1028.301549058457" y="481.88221457949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1028.301549058457" y="490.67809327949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=realm-management, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1016.5737107917905 494.19644475949997 L 1402.2007772735822 494.19644475949997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1409.442717403249,494.19644475949997) translate(-1409.442717403249,-494.19644475949997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1402.1128184865822 490.5314953011666 L 1409.442717403249 494.19644475949997 L 1402.1128184865822 497.8613942178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1091.5116319751369" y="507.3902628094999" width="242.99316424476564" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1092.8310137801368" y="515.3065536394998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token "audience":["realm-management"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1409.442717403249 518.8249051194999 L 1023.8156509214572 518.8249051194999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1016.5737107917905,518.8249051194999) translate(-1016.5737107917905,-518.8249051194999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1023.9036097084572 515.1599556611666 L 1016.5737107917905 518.8249051194999 L 1023.9036097084572 522.4898545778333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1063.1446428393947" y="532.0187231694999" width="139.0444948111719" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1063.1446428393947" y="540.8146018694999" width="299.72714251625" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1064.4640246443946" y="539.9350139994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Bob's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1064.4640246443946" y="548.7308926994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["realm-management"], Bob's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1016.5737107917905 552.2492441794999 L 1402.2007772735822 552.2492441794999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1409.442717403249,552.2492441794999) translate(-1409.442717403249,-552.2492441794999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1402.1128184865822 548.5842947211665 L 1409.442717403249 552.2492441794999 L 1402.1128184865822 555.9141936378333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1153.5086793994533" y="565.4430622294999" width="118.99906939613281" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1154.8280612044532" y="573.3593530594999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Bob's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1409.442717403249 576.8777045394999 L 1023.8156509214572 576.8777045394999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1016.5737107917905,576.8777045394999) translate(-1016.5737107917905,-576.8777045394999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1023.9036097084572 573.2127550811665 L 1016.5737107917905 576.8777045394999 L 1023.9036097084572 580.5426539978332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="706.4517226537175" y="590.0715225894999" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="706.4517226537175" y="598.8674012894999" width="184.3324586783594" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="706.4517226537175" y="607.6632799894999" width="299.71353167640626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="707.7711044587176" y="597.9878134194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="707.7711044587176" y="606.7836921194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Bob's user_claims, audience:[aems-agent])</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="707.7711044587176" y="615.5795708194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1016.5737107917905 619.0979222994998 L 703.2852063217175 619.0979222994998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,619.0979222994998) translate(-696.0432661920509,-619.0979222994998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 703.3731651087176 615.4329728411665 L 696.0432661920509 619.0979222994998 L 703.3731651087176 622.7628717578332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="333.4954741154493" y="632.2917403494998" width="98.06091326820312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="333.4954741154493" y="641.0876190494998" width="268.6500856314844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="334.8148559204493" y="640.2080311794998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="334.8148559204493" y="649.0039098794998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token "audience":["aems-agent"])</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 652.5222613594998 L 246.8397077999987 652.5222613594998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(239.59776767033205,652.5222613594998) translate(-239.59776767033205,-652.5222613594998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 246.92766658699873 648.8573119011664 L 239.59776767033205 652.5222613594998 L 246.92766658699873 656.1872108178331 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 63.95226917978516 665.7160794094998 L 407.32697533087895 665.7160794094998 L 415.24326616087893 673.6323702394998 L 415.24326616087893 703.5383578194998 L 63.95226917978516 703.5383578194998 L 63.95226917978516 665.7160794094998 M 407.32697533087895 665.7160794094998 L 407.32697533087895 673.6323702394998 L 415.24326616087893 673.6323702394998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="76.26649935978517" y="678.0303095894997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="76.26649935978517" y="686.8261882894997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="76.26649935978517" y="695.6220669894997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 48.50942860361329 740.4810483594998 L 422.7698159070508 740.4810483594998 L 430.6861067370508 748.3973391894998 L 430.6861067370508 839.8744776694998 L 48.50942860361329 839.8744776694998 L 48.50942860361329 740.4810483594998 M 422.7698159070508 740.4810483594998 L 422.7698159070508 748.3973391894998 L 430.6861067370508 748.3973391894998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="752.7952785394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="761.5911572394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="770.3870359394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrap discovery of Claims Provider config url from email address via WebFinger;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="779.1829146394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    if this doesn't work, build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="787.9787933394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="796.7746720394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. check audience=aems-agent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="805.5705507394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="814.3664294394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="823.1623081394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="831.9581868394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="434.09860827072276" y="866.2621137694998" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="435.41799007572274" y="874.1784045994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 239.59776767033205 877.6967560794998 L 688.8013260623842 877.6967560794998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,877.6967560794998) translate(-696.0432661920509,-877.6967560794998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.7133672753841 874.0318066211664 L 696.0432661920509 877.6967560794998 L 688.7133672753841 881.3617055378331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="476.27177606248057" y="890.8905741294998" width="187.37963885414064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="476.27177606248057" y="899.6864528294998" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="477.59115786748055" y="898.8068649594998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Get data from Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="477.59115786748055" y="907.6027436594998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 696.0432661920509 911.1210951394997 L 451.12186491671747 911.1210951394997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(443.8799247870508,911.1210951394997) translate(-443.8799247870508,-911.1210951394997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.20982370371746 907.4561456811664 L 443.8799247870508 911.1210951394997 L 451.20982370371746 914.7860445978331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="545.0463045658985" y="924.3149131894997" width="49.830581847304686" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="546.3656863708985" y="932.2312040194997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 443.8799247870508 935.7495554994997 L 688.8013260623842 935.7495554994997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(696.0432661920509,935.7495554994997) translate(-696.0432661920509,-935.7495554994997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.7133672753841 932.0846060411664 L 696.0432661920509 935.7495554994997 L 688.7133672753841 939.4145049578331 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.111489253613286 716.7321758694998 L 435.0840460870508 716.7321758694998 L 435.0840460870508 853.0682957194998 L 44.111489253613286 853.0682957194998 L 44.111489253613286 716.7321758694998 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 44.111489253613286 716.7321758694998 L 44.111489253613286 727.2872303094998 L 140.38334614091798 727.2872303094998 L 145.66087336091798 722.0097030894998 L 145.66087336091798 716.7321758694998 L 44.111489253613286 716.7321758694998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="52.90736795361329" y="723.7688788294998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g></g></g></svg>