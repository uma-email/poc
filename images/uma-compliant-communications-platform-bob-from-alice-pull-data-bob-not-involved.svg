<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1298" height="885"><desc>Title%20UMA-compliant%20communications%20platform%20-%20Bob%20from%20Alice%20(pull%20data)%20-%20Bob%20not%20involved%0A%0Aactor%20%22Alice%20(RO)%5Cnsender%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22UMA%20Server%5Cnfoo.com%22%20as%20asServer%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnfoo.com%22%20as%20rsServer%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnbar.com%22%20as%20rqpClient%20%23lightsteelblue%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnbar.com%22%20as%20claimsProvider%20%23lightsteelblue%0Aparticipant%20%22IAM%20Server%5Cnbar.com%22%20as%20authServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RqP)%5Cnrecipient%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Anote%20over%20claimsProvider%3AClaims%20Provider%3A%5Cn%E2%80%A2%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Fbar.com%2F.well-known%2Fclaims-provider-configuration%5Cn%E2%80%A2%20is%20registered%20at%20Bob's%20IAM%20Server%20and%20is%20assigned%20'query-users'%2C%20'view-users'%20admin%20roles%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0Anote%20over%20rqpClient%3ARqP%20Client%3A%5Cn%E2%80%A2%20is%20registered%20at%20bar.com%20IAM%20Server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20foo.com%20UMA%20Server%5Cn%E2%80%A2%20is%20an%20agent%20that%20can%20act%20on%20behalf%20of%20any%20user%20registered%20at%20bar.com%20IAM%20Server%0Anote%20over%20rsServer%3Afoo.com%20admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%5Cn'Outgoing'%20at%20the%20foo.com%20UMA%20Server%20with%20the%20associated%20scopes%20'query'%2C%20'view'%0ArqpClient%3C--Bob%3AInitiate%20the%20request%20asynchronously%20via%20the%20message%20queue%0ArsServer%3C-rqpClient%3A1.%20Request%20Alice's%20'Outgoing'%20resource%5Cn(scope%3Dquery%2C%20view)%0ArsServer-%3ErqpClient%3A2.%20401%20with%20permission%20ticket%0ArqpClient-%3EauthServer%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0ArqpClient%3C-authServer%3A4.%20Return%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%0Anote%20over%20rqpClient%3A%E2%80%A2%20ticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%5Cn%E2%80%A2%20the%20email_address%20is%20specified%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20Bob's%20email_address%2C%5Cn%20ticket_challenge%2C%20scope%3Daems-agent)%0AclaimsProvider-%3EauthServer%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Drealm-management%2C%20role%3Dquery-users%2C%20view-users)%0AclaimsProvider%3C-authServer%3A7.%20Return%20access_token%20%22audience%22%3A%5B%22realm-management%22%5D%0A%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Bob's%20user_claims%5Cn(access_token%20%22audience%22%3A%5B%22realm-management%22%5D%2C%20Bob's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Bob's%20user_claims%0A%0ArqpClient%3C-claimsProvider%3A12.%20Return%20claims_token%5Cn(Bob's%20user_claims%2C%20audience%3A%5Baems-agent%5D)%5Cn%20if%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token%20%22audience%22%3A%5B%22aems-agent%22%5D)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn%E2%80%A2%20sender_info%20(email%20address%2C%20fullname)%5Cn%E2%80%A2%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrap%20discovery%20of%20Claims%20Provider%20config%20url%20from%20email%20address%20via%20WebFinger%3B%5Cn%20%20%20%20if%20this%20doesn't%20work%2C%20build%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%5Cn5.%20check%20audience%3Daems-agent%5Cn6.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn7.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArsServer%3C-rqpClient%3A15.%20Get%20data%20from%20Alice's%20'Outgoing'%20resource%5Cn(RPT)%0ArsServer-%3ErqpClient%3A16.%20200%20OK</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1298" height="885"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="9pt" font-style="normal" font-weight="normal" text-decoration="normal" x="417.3055953805" y="11.3089869" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA-compliant communications platform - Bob from Alice (pull data) - Bob not involved</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 30.2852873 74.526223671 L 30.2852873 828.458683671" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray="5.799480461538462,2.5131082"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 205.46964113999996 74.526223671 L 205.46964113999996 828.458683671" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray="5.799480461538462,2.5131082"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 380.65399497999994 74.526223671 L 380.65399497999994 828.458683671" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray="5.799480461538462,2.5131082"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 596.9064460949999 74.526223671 L 596.9064460949999 828.458683671" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray="5.799480461538462,2.5131082"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 871.7886554449999 74.526223671 L 871.7886554449999 828.458683671" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray="5.799480461538462,2.5131082"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1208.709927295 74.526223671 L 1208.709927295 828.458683671" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray="5.799480461538462,2.5131082"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1269.396215961 74.526223671 L 1269.396215961 828.458683671" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray="5.799480461538462,2.5131082"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 34.582702322 27.55623141299999 A 4.297415022 4.297415022 0 1 1 34.582700173292665 27.55193399869422 M 30.2852873 31.853646434999987 L 30.2852873 41.051622446999986 M 24.856973588 35.17094925899999 L 35.713601012 35.17094925899999 M 30.2852873 41.051622446999986 L 24.856973588 49.64645249099999 M 30.2852873 41.051622446999986 L 35.713601012 49.64645249099999" stroke-miterlimit="10" stroke-width="1.2816851820000001" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="11.8399748" y="57.18577709099999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="18.05481855" y="64.72510169099999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sender</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3.7696623000000002" y="72.26442629099999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 175.50822394899996 46.706115897 L 235.43105833099995 46.706115897 L 235.43105833099995 74.526223671 L 175.50822394899996 74.526223671 L 175.50822394899996 46.706115897 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="183.68839113999996" y="59.447574470999996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="191.24112551499996" y="66.986899071" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 333.1300777889999 46.706115897 L 428.17791217099995 46.706115897 L 428.17791217099995 74.526223671 L 333.1300777889999 74.526223671 L 333.1300777889999 46.706115897 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="341.31024497999994" y="59.447574470999996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="366.42547935499994" y="66.986899071" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 569.6071382789999 46.706115897 L 624.2057539109999 46.706115897 L 624.2057539109999 74.526223671 L 569.6071382789999 74.526223671 L 569.6071382789999 46.706115897 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="577.7873054699999" y="59.447574470999996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="582.6779304699999" y="66.986899071" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 826.0479413789999 46.706115897 L 917.5293695109999 46.706115897 L 917.5293695109999 74.526223671 L 826.0479413789999 74.526223671 L 826.0479413789999 46.706115897 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="834.2281085699999" y="59.447574470999996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="857.5601398199999" y="66.986899071" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1180.525853854 46.706115897 L 1236.894000736 46.706115897 L 1236.894000736 74.526223671 L 1180.525853854 74.526223671 L 1180.525853854 46.706115897 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1188.706021045" y="59.447574470999996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IAM Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.48141167" y="66.986899071" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1273.693630983 27.55623141299999 A 4.297415022 4.297415022 0 1 1 1273.6936288342927 27.55193399869422 M 1269.396215961 31.853646434999987 L 1269.396215961 41.051622446999986 M 1263.967902249 35.17094925899999 L 1274.8245296730001 35.17094925899999 M 1269.396215961 41.051622446999986 L 1263.967902249 49.64645249099999 M 1269.396215961 41.051622446999986 L 1274.8245296730001 49.64645249099999" stroke-miterlimit="10" stroke-width="1.2816851820000001" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1250.722387836" y="57.18577709099999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1254.277075336" y="64.72510169099999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">recipient</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1244.433325336" y="72.26442629099999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 34.582702322 858.2767124640001 A 4.297415022 4.297415022 0 1 1 34.582700173292665 858.2724150496944 M 30.2852873 862.5741274860001 L 30.2852873 871.7721034980001 M 24.856973588 865.89143031 L 35.713601012 865.89143031 M 30.2852873 871.7721034980001 L 24.856973588 880.3669335420001 M 30.2852873 871.7721034980001 L 35.713601012 880.3669335420001" stroke-miterlimit="10" stroke-width="1.2816851820000001" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="11.8399748" y="835.998008271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="18.05481855" y="843.537332871" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sender</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="3.7696623000000002" y="851.076657471" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 175.50822394899996 828.458683671 L 235.43105833099995 828.458683671 L 235.43105833099995 856.278791445 L 175.50822394899996 856.278791445 L 175.50822394899996 828.458683671 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="183.68839113999996" y="841.2001422449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="191.24112551499996" y="848.7394668449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 333.1300777889999 828.458683671 L 428.17791217099995 828.458683671 L 428.17791217099995 856.278791445 L 333.1300777889999 856.278791445 L 333.1300777889999 828.458683671 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="341.31024497999994" y="841.2001422449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="366.42547935499994" y="848.7394668449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 569.6071382789999 828.458683671 L 624.2057539109999 828.458683671 L 624.2057539109999 856.278791445 L 569.6071382789999 856.278791445 L 569.6071382789999 828.458683671 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="577.7873054699999" y="841.2001422449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="582.6779304699999" y="848.7394668449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 826.0479413789999 828.458683671 L 917.5293695109999 828.458683671 L 917.5293695109999 856.278791445 L 826.0479413789999 856.278791445 L 826.0479413789999 828.458683671 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="834.2281085699999" y="841.2001422449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="857.5601398199999" y="848.7394668449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1180.525853854 828.458683671 L 1236.894000736 828.458683671 L 1236.894000736 856.278791445 L 1180.525853854 856.278791445 L 1180.525853854 828.458683671 Z" stroke-miterlimit="10" stroke-width="1.2062919360000002" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1188.706021045" y="841.2001422449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IAM Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1194.48141167" y="848.7394668449999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1273.693630983 858.2767124640001 A 4.297415022 4.297415022 0 1 1 1273.6936288342927 858.2724150496944 M 1269.396215961 862.5741274860001 L 1269.396215961 871.7721034980001 M 1263.967902249 865.89143031 L 1274.8245296730001 865.89143031 M 1269.396215961 871.7721034980001 L 1263.967902249 880.3669335420001 M 1269.396215961 871.7721034980001 L 1274.8245296730001 880.3669335420001" stroke-miterlimit="10" stroke-width="1.2816851820000001" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1250.722387836" y="835.998008271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1254.277075336" y="843.537332871" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">recipient</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1244.433325336" y="851.076657471" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 608.792194755 89.60487287100001 L 1127.9997239949998 89.60487287100001 L 1134.785116135 96.39026501100001 L 1134.785116135 122.02396865100002 L 608.792194755 122.02396865100002 L 608.792194755 89.60487287100001 M 1127.9997239949998 89.60487287100001 L 1127.9997239949998 96.39026501100001 L 1134.785116135 96.39026501100001" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="619.3472491949999" y="100.159927311" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="619.3472491949999" y="107.699251911" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="761.7808429449999" y="107.699251911" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="766.2261554449999" y="107.699251911" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com/.well-known/claims-provider-configuration</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="619.3472491949999" y="115.238576511" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at Bob's IAM Server and is assigned 'query-users', 'view-users' admin roles, thus can query and view any user to get their claims</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 384.4236572799999 133.332955551 L 802.6038427699999 133.332955551 L 809.3892349099999 140.118347691 L 809.3892349099999 165.75205133100002 L 384.4236572799999 165.75205133100002 L 384.4236572799999 133.332955551 M 802.6038427699999 133.332955551 L 802.6038427699999 140.118347691 L 809.3892349099999 140.118347691" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="394.97871171999986" y="143.88800999100005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="394.97871171999986" y="151.42733459100003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at bar.com IAM Server and pre-registered as a universal AEMS public client at foo.com UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="394.97871171999986" y="158.96665919100002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is an agent that can act on behalf of any user registered at bar.com IAM Server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 229.67315928999994 177.06103823100003 L 524.8494385299999 177.06103823100003 L 531.6348306699999 183.84643037100003 L 531.6348306699999 201.94080941100003 L 229.67315928999994 201.94080941100003 L 229.67315928999994 177.06103823100003 M 524.8494385299999 177.06103823100003 L 524.8494385299999 183.84643037100003 L 531.6348306699999 183.84643037100003" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="240.22821372999994" y="187.61609267100005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com admin has set up the Resource Server and registers it's resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="240.22821372999994" y="195.15541727100003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing' at the foo.com UMA Server with the associated scopes 'query', 'view'</text></g><g><g><rect fill="white" stroke="none" x="827.733322963" y="213.24979631100004" width="210.83601613" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="828.864221653" y="220.03518845100007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate the request asynchronously via the message queue</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1269.396215961 223.05091829100004 L 603.1138233489999 223.05091829100004" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray="3.01572984"/><g transform="translate(596.9064460949999,223.05091829100004) translate(-596.9064460949999,-223.05091829100004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 603.1892165949998 219.90953304100003 L 596.9064460949999 223.05091829100004 L 603.1892165949998 226.19230354100006 Z"/></g></g><g><g><rect fill="white" stroke="none" x="420.2118218474999" y="234.35990519100005" width="137.13679738" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="420.2118218474999" y="241.89922979100004" width="73.47664113" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="421.3427205374999" y="241.14529733100005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="421.3427205374999" y="248.68462193100004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=query, view)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 596.9064460949999 251.70035177100004 L 386.86137223399993 251.70035177100004" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(380.65399497999994,251.70035177100004) translate(-380.65399497999994,-251.70035177100004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 386.93676547999996 248.55896652100003 L 380.65399497999994 251.70035177100004 L 386.93676547999996 254.84173702100006 Z"/></g></g><g><g><rect fill="white" stroke="none" x="437.4051812224999" y="263.009338671" width="102.75007863" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="438.5360799124999" y="269.794730811" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 380.65399497999994 272.810460651 L 590.6990688409999 272.810460651" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(596.9064460949999,272.810460651) translate(-596.9064460949999,-272.810460651)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 590.6236755949999 269.66907540100004 L 596.9064460949999 272.810460651 L 590.6236755949999 275.951845901 Z"/></g></g><g><g><rect fill="white" stroke="none" x="804.5190848799999" y="284.11944755100006" width="84.52742238" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="804.5190848799999" y="291.65877215100005" width="196.57820363" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="805.6499835699999" y="290.90483969100006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="805.6499835699999" y="298.44416429100005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 596.9064460949999 301.45989413100006 L 1202.502550041 301.45989413100006" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(1208.709927295,301.45989413100006) translate(-1208.709927295,-301.45989413100006)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1202.427156795 298.31850888100007 L 1208.709927295 301.45989413100006 L 1202.427156795 304.60127938100004 Z"/></g></g><g><g><rect fill="white" stroke="none" x="806.1753348799999" y="312.76888103100003" width="193.26570363" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="807.3062335699999" y="319.55427317100003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token "audience":["claims-provider"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1208.709927295 322.57000301100004 L 603.1138233489999 322.57000301100004" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(596.9064460949999,322.57000301100004) translate(-596.9064460949999,-322.57000301100004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 603.1892165949998 319.42861776100005 L 596.9064460949999 322.57000301100004 L 603.1892165949998 325.711388261 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 484.5662354049999 333.8789899110001 L 702.4612646449999 333.8789899110001 L 709.2466567849999 340.6643820510001 L 709.2466567849999 358.75876109100005 L 484.5662354049999 358.75876109100005 L 484.5662354049999 333.8789899110001 M 702.4612646449999 333.8789899110001 L 702.4612646449999 340.6643820510001 L 709.2466567849999 340.6643820510001" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="495.12128984499986" y="344.434044351" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• ticket_challenge = Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="495.12128984499986" y="351.973368951" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the email_address is specified by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="613.6072770799999" y="370.0677479910001" width="72.96101613" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="613.6072770799999" y="377.6070725910001" width="241.48054738" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="613.6072770799999" y="385.14639719100006" width="137.23054738" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="614.7381757699999" y="376.8531401310001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="614.7381757699999" y="384.3924647310001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], Bob's email_address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="614.7381757699999" y="391.93178933100006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> ticket_challenge, scope=aems-agent)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 596.9064460949999 394.94751917100007 L 865.5812781909999 394.94751917100007" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(871.7886554449999,394.94751917100007) translate(-871.7886554449999,-394.94751917100007)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 865.5058849449999 391.8061339210001 L 871.7886554449999 394.94751917100007 L 865.5058849449999 398.08890442100005 Z"/></g></g><g><g><rect fill="white" stroke="none" x="880.7101895549998" y="406.2565060710001" width="75.19148488" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="880.7101895549998" y="413.7958306710001" width="319.07820363" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="881.8410882449998" y="413.0418982110001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="881.8410882449998" y="420.5812228110001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=realm-management, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 871.7886554449999 423.5969526510001 L 1202.502550041 423.5969526510001" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(1208.709927295,423.5969526510001) translate(-1208.709927295,-423.5969526510001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1202.427156795 420.4555674010001 L 1208.709927295 423.5969526510001 L 1202.427156795 426.7383379010001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="936.0519864299998" y="434.9059395510001" width="208.39460988" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.1828851199998" y="441.6913316910001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token "audience":["realm-management"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1208.709927295 444.7070615310001 L 877.9960326989999 444.7070615310001" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(871.7886554449999,444.7070615310001) translate(-871.7886554449999,-444.7070615310001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 878.0714259449999 441.5656762810001 L 871.7886554449999 444.7070615310001 L 878.0714259449999 447.84844678100006 Z"/></g></g><g><g><rect fill="white" stroke="none" x="911.7238614299998" y="456.0160484310001" width="119.24617238" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="911.7238614299998" y="463.5553730310001" width="257.05085988" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="912.8547601199998" y="462.8014405710001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Bob's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="912.8547601199998" y="470.3407651710001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["realm-management"], Bob's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 871.7886554449999 473.3564950110001 L 1202.502550041 473.3564950110001" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(1208.709927295,473.3564950110001) translate(-1208.709927295,-473.3564950110001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1202.427156795 470.2151097610001 L 1208.709927295 473.3564950110001 L 1202.427156795 476.4978802610001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="989.2219083049998" y="484.6654819110001" width="102.05476613" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="990.3528069949998" y="491.4508740510001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Bob's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1208.709927295 494.4666038910001 L 877.9960326989999 494.4666038910001" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(871.7886554449999,494.4666038910001) translate(-871.7886554449999,-494.4666038910001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 878.0714259449999 491.3252186410001 L 871.7886554449999 494.4666038910001 L 878.0714259449999 497.6079891410001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="605.8279802049999" y="505.77559079100007" width="88.52742238" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="605.8279802049999" y="513.3149153910001" width="158.08601613" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="605.8279802049999" y="520.8542399910001" width="257.03914113" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="606.9588788949999" y="512.5609829310001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="606.9588788949999" y="520.1003075310001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Bob's user_claims, audience:[aems-agent])</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="606.9588788949999" y="527.6396321310001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 871.7886554449999 530.655361971 L 603.1138233489999 530.655361971" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(596.9064460949999,530.655361971) translate(-596.9064460949999,-530.655361971)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 603.1892165949998 527.5139767210001 L 596.9064460949999 530.655361971 L 603.1892165949998 533.796747221 Z"/></g></g><g><g><rect fill="white" stroke="none" x="285.98878555249996" y="541.964348871" width="84.09773488" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="285.98878555249996" y="549.503673471" width="230.39851613" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="287.11968424249994" y="548.749741011" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="287.11968424249994" y="556.289065611" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token "audience":["aems-agent"])</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 596.9064460949999 559.304795451 L 211.67701839399996 559.304795451" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(205.46964113999996,559.304795451) translate(-205.46964113999996,-559.304795451)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 211.75241163999996 556.163410201 L 205.46964113999996 559.304795451 L 211.75241163999996 562.446180701 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 54.83841482499998 570.613782351 L 349.31547531499996 570.613782351 L 356.10086745499996 577.399174491 L 356.10086745499996 603.0328781310001 L 54.83841482499998 603.0328781310001 L 54.83841482499998 570.613782351 M 349.31547531499996 570.613782351 L 349.31547531499996 577.399174491 L 356.10086745499996 577.399174491" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.39346926499996" y="581.1688367910001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.39346926499996" y="588.7081613910001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• sender_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.39346926499996" y="596.2474859910001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 41.59427419999998 634.698041451 L 362.55961593999996 634.698041451 L 369.34500807999996 641.483433591 L 369.34500807999996 719.892409431 L 41.59427419999998 719.892409431 L 41.59427419999998 634.698041451 M 362.55961593999996 634.698041451 L 362.55961593999996 641.483433591 L 369.34500807999996 641.483433591" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="645.253095891" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="652.792420491" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="660.331745091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrap discovery of Claims Provider config url from email address via WebFinger;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="667.871069691" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    if this doesn't work, build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="675.410394291" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="682.949718891" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. check audience=aems-agent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="690.489043491" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="698.028368091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="705.5676926909999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="52.149328639999965" y="713.1070172909999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="372.26808242749996" y="742.5103832310001" width="57.83992238" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="373.39898111749994" y="749.2957753710001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 205.46964113999996 752.311505211 L 590.6990688409999 752.311505211" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(596.9064460949999,752.311505211) translate(-596.9064460949999,-752.311505211)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 590.6236755949999 749.1701199610001 L 596.9064460949999 752.311505211 L 590.6236755949999 755.452890461 Z"/></g></g><g><g><rect fill="white" stroke="none" x="408.4305718474999" y="763.620492111" width="160.69929738" height="9.801121980000001"/></g><g><rect fill="white" stroke="none" x="408.4305718474999" y="771.159816711" width="23.58992238" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="409.5614705374999" y="770.405884251" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Get data from Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="409.5614705374999" y="777.945208851" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 596.9064460949999 780.960938691 L 386.86137223399993 780.960938691" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(380.65399497999994,780.960938691) translate(-380.65399497999994,-780.960938691)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 386.93676547999996 777.819553441 L 380.65399497999994 780.960938691 L 386.93676547999996 784.102323941 Z"/></g></g><g><g><rect fill="white" stroke="none" x="467.4129937224999" y="792.2699255910001" width="42.73445363" height="9.801121980000001"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="6pt" font-style="normal" font-weight="normal" text-decoration="normal" x="468.5438924124999" y="799.0553177310001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 380.65399497999994 802.071047571 L 590.6990688409999 802.071047571" stroke-miterlimit="10" stroke-width="0.62827705" stroke-dasharray=""/><g transform="translate(596.9064460949999,802.071047571) translate(-596.9064460949999,-802.071047571)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 590.6236755949999 798.929662321 L 596.9064460949999 802.071047571 L 590.6236755949999 805.212432821 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 37.82461189999998 614.3418650310001 L 373.11467037999995 614.3418650310001 L 373.11467037999995 731.2013963310001 L 37.82461189999998 731.2013963310001 L 37.82461189999998 614.3418650310001 Z" stroke-miterlimit="10" stroke-width="1.0770463714285714" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 37.82461189999998 614.3418650310001 L 37.82461189999998 623.3890545510001 L 120.36692992324217 623.3890545510001 L 124.89052468324216 618.8654597910001 L 124.89052468324216 614.3418650310001 L 37.82461189999998 614.3418650310001" stroke-miterlimit="10" stroke-width="1.0770463714285714" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="4.800000000000001pt" font-style="normal" font-weight="bold" text-decoration="normal" x="45.36393649999998" y="620.3733247110001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g></g></g></svg>