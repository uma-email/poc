<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2662" height="1847"><desc>Title%20UMA%20wide%20ecosystem%20-%20Bob%20from%20Alice%20(pull%20data)%0A%0Aactor%20%22Alice%20(RO)%5Cnalice%40gmail.com%2C%20alice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthZ%20Server%5Cnfoo.com%22%20as%20asServer%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnfoo.com%22%20as%20rsServer%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnbar.com%22%20as%20rqpClient%20%23lightsteelblue%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnbar.com%22%20as%20claimsProvider%20%23lightsteelblue%0Aparticipant%20%22SMTP%20Server%5Cnoutlook.com%22%20as%20smtpServer%20%2300a2ed%0Aparticipant%20%22IMAP%20Server%5Cnoutlook.com%22%20as%20imapServer%20%2300a2ed%0Aparticipant%20%22AuthN%20Server%5Cnbar.com%22%20as%20authServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RqP)%5Cnbob%40outlook.com%2C%20bob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Aopt%20Bob%20has%20to%20demonstrate%20control%20of%20his%20mailbox%0Anote%20left%20of%20Bob%3AIf%20Bob%20uses%20an%20email%20provider%20(outlook)%20that%20does%20not%20support%20webfinger%2C%5Cnhe%20must%20set%20up%20his%20mailbox%20to%20automatically%20forward%20emails%20sent%5Cnfrom%20challenge%40bar.com%20to%20response%40bar.com%0Aend%0Aopt%20Bob%20has%20to%20demonstrate%20control%20of%20his%20mailbox%0Abox%20over%20claimsProvider%3AClaims%20Provider%20can%20send%20email%20messages%20from%20addresses%20challenge%40bar.com%20and%20retrieve%20from%20response%40bar.com%0Aend%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20bar.com%20AuthN%20server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20foo.com%20AuthZ%20server%0Anote%20left%20of%20rsServer%3Afoo.com%20Admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%20set%5Cn'Incoming'%20and%20'Outgoing'%20with%20the%20foo.com%20AuthZ%20server%20with%20the%20associated%20scopes%3A%5Cn'Outgoing'%3A%20query%2C%20view%5Cn'Incoming'%3A%20create%0Anote%20over%20claimsProvider%3AClaims%20Provider%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Fbar.com%2F.well-known%2Fclaims-provider-configuration%0Anote%20right%20of%20claimsProvider%3AClaims%20Provider%20is%20registered%20at%20Bob's%20AuthN%20server%20and%20is%20assigned%20'query-users'%2C%20'view-users'%20admin%20roles%0ArqpClient%3C-Bob%3AInitiate%20request%0ArsServer%3C-rqpClient%3A1.%20Request%20Alice's%20'Outgoing'%20resource%5Cn(scope%3Dquery%2C%20view)%0ArsServer-%3ErqpClient%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Bob%20is%20involved%0ArqpClient-%3EauthServer%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Bob%20is%20not%20involved%0ArqpClient-%3EauthServer%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0ArqpClient%3C-authServer%3A4.%20Return%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%0Anote%20right%20of%20rqpClient%3Aticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0Aalt%20Get%20Claims%20%20-%20Bob%20was%20involved%20at%20step%20%203.%20a)%0Anote%20right%20of%20rqpClient%3ABob's%20email_address%20is%20in%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%20returned%20in%20request%203.%20a)%20%2F%204.%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20ticket_challenge)%0Aelse%20Get%20Claims%20-%20Bob%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20right%20of%20rqpClient%3A%20The%20email_address%20is%20determined%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20Bob's%20email_address%2C%20ticket_challenge)%0Aend%0Anote%20right%20of%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users%2C%20view-users'%20admin%20roles%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0AclaimsProvider-%3EauthServer%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users%2C%20view-users)%0AclaimsProvider%3C-authServer%3A7.%20Return%20access_token%20%22audience%22%3A%5B%22realm-management%22%5D%0A%0Aalt%20Prepare%20email_address%20-%20Bob%20was%20involved%20at%20step%20%203.%20a)%0Anote%20over%20claimsProvider%3AUse%20Bob's%20email_address%20extracted%20from%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Bob%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20over%20claimsProvider%3AUse%20Bob's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Bob's%20user_claims%5Cn(access_token%20%22audience%22%3A%5B%22realm-management%22%5D%2C%20Bob's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Bob's%20user_claims%0A%0Aopt%20Bob%20has%20to%20demonstrate%20control%20of%20his%20mailbox%0AsmtpServer%3C-claimsProvider%3A10.%20Send%20plain_message%20from%20challenge%40bar.com%20to%20bob%40outlook.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0AimapServer-%3EclaimsProvider%3A11.%20Retrieve%20dkim_signed_message%20sent%20from%20bob%40outlook.com%20to%20response%40bar.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0Aend%0ArqpClient%3C-claimsProvider%3A12.%20Return%20claims_token%5Cn(Bob's%20user_claims%2C%20dkim_signed_message%20-%20optional)%5Cnif%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Aalt%20Domain%20part%20of%20email_address%20or%20Webfinger%20is%20used%20to%20locate%20Claims%20Provider%20configuration%20url%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrap%20discovery%20of%20Claims%20Provider%20config%20url%20via%20Webfinger%2C%20if%20it%20doesn't%20work%5Cnbuild%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%20%5Cn5.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20evaluate%20user_claims%5Cn8.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aelse%20Bob%20has%20to%20demonstrate%20control%20of%20his%20mailbox%0Anote%20over%20asServer%3A1.%20extract%20dkim_signed%20_message%20from%20claims_token%5Cn2.%20verify%20DKIM%20signature%20of%20dkim_signed%20_message%5Cn3.%20extract%20'From%3A'%20part%20of%20dkim_signed_message%20e.g.%20Bob%20Sanders%20%3Cbob%40outlook.com%3E%5Cn4.%20extract%20claims_provider_configuration_url%20and%20ticket_challenge%20from%20dkim_signed_message%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20extract%20user_claims%20from%20claims_token%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArsServer%3C-rqpClient%3A15.%20Get%20data%20from%20Alice's%20'Outgoing'%20resource%5Cn(RPT)%0ArsServer-%3ErqpClient%3A16.%20200%20OK</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2662" height="1847"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1179.3101057939625" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Bob from Alice (pull data)</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 73.48673024355469 78.15138224949999 L 73.48673024355469 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 301.4519883503125 78.15138224949999 L 301.4519883503125 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 681.6207732110938 78.15138224949999 L 681.6207732110938 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 78.15138224949999 L 959.636958854375 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1400.5889468401563 78.15138224949999 L 1400.5889468401563 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1940.4747727165625 78.15138224949999 L 1940.4747727165625 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2132.6914568084244 78.15138224949999 L 2132.6914568084244 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2251.809656406636 78.15138224949999 L 2251.809656406636 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2589.0731480924173 78.15138224949999 L 2589.0731480924173 1789.8293772694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 78.50038110255468 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 78.50037859572947 32.143922998476604 M 73.48673024355469 37.16258750749999 L 73.48673024355469 47.893559521499995 M 67.15369757955469 41.03277413549999 L 79.81976290755469 41.03277413549999 M 73.48673024355469 47.893559521499995 L 67.15369757955469 57.92086123949999 M 73.48673024355469 47.893559521499995 L 79.81976290755469 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="51.97918477236328" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com, alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 264.43191271960154 45.694589846499994 L 338.47206398102344 45.694589846499994 L 338.47206398102344 78.15138224949999 L 264.43191271960154 78.15138224949999 L 264.43191271960154 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="273.97544110910155" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="284.8612977375195" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 626.2017794285274 45.694589846499994 L 737.0397669936602 45.694589846499994 L 737.0397669936602 78.15138224949999 L 626.2017794285274 78.15138224949999 L 626.2017794285274 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="635.7453078180274" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="665.0300825983009" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 927.8001794272774 45.694589846499994 L 991.4737382814727 45.694589846499994 L 991.4737382814727 78.15138224949999 L 927.8001794272774 78.15138224949999 L 927.8001794272774 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.3437078167774" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.0463292767383" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1347.2491919491915 45.694589846499994 L 1453.9287017311212 45.694589846499994 L 1453.9287017311212 78.15138224949999 L 1347.2491919491915 78.15138224949999 L 1347.2491919491915 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1356.7927203386914" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1383.9983172625195" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="#00a2ed" stroke="black" paint-order="fill stroke markers" d=" M 1902.9422993197384 45.694589846499994 L 1978.0072461133868 45.694589846499994 L 1978.0072461133868 78.15138224949999 L 1902.9422993197384 78.15138224949999 L 1902.9422993197384 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1912.4858277092383" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1915.3279755363867" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">outlook.com</text></g><path fill="none" stroke="none"/><g><path fill="#00a2ed" stroke="black" paint-order="fill stroke markers" d=" M 2096.7121526620886 45.694589846499994 L 2168.67076095476 45.694589846499994 L 2168.67076095476 78.15138224949999 L 2096.7121526620886 78.15138224949999 L 2096.7121526620886 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2106.2556810515885" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2107.5446596282486" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">outlook.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2214.2703394429172 45.694589846499994 L 2289.3489733703545 45.694589846499994 L 2289.3489733703545 78.15138224949999 L 2214.2703394429172 78.15138224949999 L 2214.2703394429172 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2223.813867832417" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2235.219026828999" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2594.086798951417 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 2594.086796444592 32.143922998476604 M 2589.0731480924173 37.16258750749999 L 2589.0731480924173 47.893559521499995 M 2582.7401154284175 41.03277413549999 L 2595.406180756417 41.03277413549999 M 2589.0731480924173 47.893559521499995 L 2582.7401154284175 57.92086123949999 M 2589.0731480924173 47.893559521499995 L 2595.406180756417 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2567.2991536466166" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2519.7111333219095" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com, bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 78.50038110255468 1815.8211988279984 A 5.013650858999999 5.013650858999999 0 1 1 78.50037859572947 1815.816185177975 M 73.48673024355469 1820.8348496869983 L 73.48673024355469 1831.5658217009982 M 67.15369757955469 1824.7050363149983 L 79.81976290755469 1824.7050363149983 M 73.48673024355469 1831.5658217009982 L 67.15369757955469 1841.5931234189982 M 73.48673024355469 1831.5658217009982 L 79.81976290755469 1841.5931234189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="51.97918477236328" y="1798.6252559694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com, alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 264.43191271960154 1789.8293772694983 L 338.47206398102344 1789.8293772694983 L 338.47206398102344 1822.2861696724983 L 264.43191271960154 1822.2861696724983 L 264.43191271960154 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="273.97544110910155" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="284.8612977375195" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 626.2017794285274 1789.8293772694983 L 737.0397669936602 1789.8293772694983 L 737.0397669936602 1822.2861696724983 L 626.2017794285274 1822.2861696724983 L 626.2017794285274 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="635.7453078180274" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="665.0300825983009" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 927.8001794272774 1789.8293772694983 L 991.4737382814727 1789.8293772694983 L 991.4737382814727 1822.2861696724983 L 927.8001794272774 1822.2861696724983 L 927.8001794272774 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.3437078167774" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.0463292767383" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1347.2491919491915 1789.8293772694983 L 1453.9287017311212 1789.8293772694983 L 1453.9287017311212 1822.2861696724983 L 1347.2491919491915 1822.2861696724983 L 1347.2491919491915 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1356.7927203386914" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1383.9983172625195" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="#00a2ed" stroke="black" paint-order="fill stroke markers" d=" M 1902.9422993197384 1789.8293772694983 L 1978.0072461133868 1789.8293772694983 L 1978.0072461133868 1822.2861696724983 L 1902.9422993197384 1822.2861696724983 L 1902.9422993197384 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1912.4858277092383" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1915.3279755363867" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">outlook.com</text></g><path fill="none" stroke="none"/><g><path fill="#00a2ed" stroke="black" paint-order="fill stroke markers" d=" M 2096.7121526620886 1789.8293772694983 L 2168.67076095476 1789.8293772694983 L 2168.67076095476 1822.2861696724983 L 2096.7121526620886 1822.2861696724983 L 2096.7121526620886 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2106.2556810515885" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2107.5446596282486" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">outlook.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2214.2703394429172 1789.8293772694983 L 2289.3489733703545 1789.8293772694983 L 2289.3489733703545 1822.2861696724983 L 2214.2703394429172 1822.2861696724983 L 2214.2703394429172 1789.8293772694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2223.813867832417" y="1804.6944122724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2235.219026828999" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2594.086798951417 1815.8211988279984 A 5.013650858999999 5.013650858999999 0 1 1 2594.086796444592 1815.816185177975 M 2589.0731480924173 1820.8348496869983 L 2589.0731480924173 1831.5658217009982 M 2582.7401154284175 1824.7050363149983 L 2595.406180756417 1824.7050363149983 M 2589.0731480924173 1831.5658217009982 L 2582.7401154284175 1841.5931234189982 M 2589.0731480924173 1831.5658217009982 L 2595.406180756417 1841.5931234189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2567.2991536466166" y="1798.6252559694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2519.7111333219095" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com, bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2589.0731480924173 138.40315134449997 L 2584.6752087424175 138.40315134449997 M 2265.003474456636 119.49201213949999 L 2576.7589179124175 119.49201213949999 L 2584.6752087424175 127.40830296949999 L 2584.6752087424175 157.3142905495 L 2265.003474456636 157.3142905495 L 2265.003474456636 119.49201213949999 M 2576.7589179124175 119.49201213949999 L 2576.7589179124175 127.40830296949999 L 2584.6752087424175 127.40830296949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2277.3177046366363" y="131.80624231949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">If Bob uses an email provider (outlook) that does not support webfinger,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2277.3177046366363" y="140.60212101949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">he must set up his mailbox to automatically forward emails sent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2277.3177046366363" y="149.39799971949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">from challenge@bar.com to response@bar.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1145.754651352539 207.4507991395 L 1655.4232423277733 207.4507991395 L 1655.4232423277733 227.68132014949998 L 1145.754651352539 227.68132014949998 L 1145.754651352539 207.4507991395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1158.068881532539" y="219.76502931949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider can send email messages from addresses challenge@bar.com and retrieve from response@bar.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 686.0187125610938 254.06895624950002 L 1225.3389143176564 254.06895624950002 L 1233.2552051476564 261.9852470795 L 1233.2552051476564 274.2994772595 L 686.0187125610938 274.2994772595 L 686.0187125610938 254.06895624950002 M 1225.3389143176564 254.06895624950002 L 1225.3389143176564 261.9852470795 L 1233.2552051476564 261.9852470795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="698.3329427410938" y="266.38318642950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at bar.com AuthN server and pre-registered as a universal AEMS public client at foo.com AuthZ server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 681.6207732110938 310.8023738645 L 677.2228338610938 310.8023738645 M 305.84992770031255 287.4932953095 L 669.3065430310938 287.4932953095 L 677.2228338610938 295.4095861395 L 677.2228338610938 334.1114524195 L 305.84992770031255 334.1114524195 L 305.84992770031255 287.4932953095 M 669.3065430310938 287.4932953095 L 669.3065430310938 295.4095861395 L 677.2228338610938 295.4095861395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.1641578803126" y="299.8075254895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com Admin has set up the Resource Server and registers it's resource set</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.1641578803126" y="308.6034041895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming' and 'Outgoing' with the foo.com AuthZ server with the associated scopes:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.1641578803126" y="317.3992828895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing': query, view</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="318.1641578803126" y="326.1951615895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming': create</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1167.9339573828124 347.30527046949993 L 1625.3276454675 347.30527046949993 L 1633.2439362974999 355.2215612994999 L 1633.2439362974999 367.53579147949995 L 1167.9339573828124 367.53579147949995 L 1167.9339573828124 347.30527046949993 M 1625.3276454675 347.30527046949993 L 1625.3276454675 355.2215612994999 L 1633.2439362974999 355.2215612994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1180.2481875628125" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1408.892337343086" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1414.0756564348828" y="359.61950064949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com/.well-known/claims-provider-configuration</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1400.5889468401563 390.84487003449993 L 1404.9868861901562 390.84487003449993 M 1404.9868861901562 380.7296095294999 L 1860.9095049389061 380.7296095294999 L 1868.8257957689061 388.6459003594999 L 1868.8257957689061 400.9601305394999 L 1404.9868861901562 400.9601305394999 L 1404.9868861901562 380.7296095294999 M 1860.9095049389061 380.7296095294999 L 1860.9095049389061 388.6459003594999 L 1868.8257957689061 388.6459003594999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1417.3011163701563" y="393.04383970949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is registered at Bob's AuthN server and is assigned 'query-users', 'view-users' admin roles</text></g><g><g><rect fill="white" stroke="none" x="1742.4413723519901" y="414.1539485894999" width="63.8273622428125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1743.76075415699" y="422.0702394194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2589.0731480924173 425.58859089949993 L 966.8788989840417 425.58859089949993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(959.636958854375,425.58859089949993) translate(-959.636958854375,-425.58859089949993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 966.9668577710418 421.9236414411666 L 959.636958854375 425.58859089949993 L 966.9668577710418 429.2535403578333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="740.6761910758789" y="438.78240894949994" width="159.90534991371095" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="740.6761910758789" y="447.57828764949994" width="85.67631548988281" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="741.995572880879" y="446.6986997794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="741.995572880879" y="455.4945784794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=query, view)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 459.01292995949996 L 688.8627133407605 459.01292995949996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(681.6207732110938,459.01292995949996) translate(-681.6207732110938,-459.01292995949996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.9506721277605 455.3479805011666 L 681.6207732110938 459.01292995949996 L 688.9506721277605 462.6778794178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="760.72394345625" y="472.20674800949996" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="762.0433252612501" y="480.12303883949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 681.6207732110938 483.6413903195 L 952.3950187247084 483.6413903195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(959.636958854375,483.6413903195) translate(-959.636958854375,-483.6413903195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 952.3070599377083 479.9764408611666 L 959.636958854375 483.6413903195 L 952.3070599377083 487.30633977783333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1487.738459516912" y="520.5840808595" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1487.738459516912" y="529.3799595595" width="235.9696962271875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1489.0578413219118" y="528.5003716895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1489.0578413219118" y="537.2962503895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 540.8146018694999 L 2244.5677162769693 540.8146018694999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2251.809656406636,540.8146018694999) translate(-2251.809656406636,-540.8146018694999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2244.4797574899694 537.1496524111666 L 2251.809656406636 540.8146018694999 L 2244.4797574899694 544.4795513278333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1491.1158093704275" y="577.7572924094999" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1491.1158093704275" y="586.5531711094999" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1492.4351911754275" y="585.6735832394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1492.4351911754275" y="594.4694619394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 597.9878134194998 L 2244.5677162769693 597.9878134194998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2251.809656406636,597.9878134194998) translate(-2251.809656406636,-597.9878134194998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2244.4797574899694 594.3228639611665 L 2251.809656406636 597.9878134194998 L 2244.4797574899694 601.6527628778332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1493.0470074905447" y="624.3754495194999" width="225.3526002799219" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1494.3663892955446" y="632.2917403494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token "audience":["claims-provider"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2251.809656406636 635.8100918294998 L 966.8788989840417 635.8100918294998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(959.636958854375,635.8100918294998) translate(-959.636958854375,-635.8100918294998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 966.9668577710418 632.1451423711665 L 959.636958854375 635.8100918294998 L 966.9668577710418 639.4750412878332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 659.1191703844997 L 964.034898204375 659.1191703844997 M 964.034898204375 649.0039098794998 L 1212.256085678711 649.0039098794998 L 1220.172376508711 656.9202007094998 L 1220.172376508711 669.2344308894998 L 964.034898204375 669.2344308894998 L 964.034898204375 649.0039098794998 M 1212.256085678711 649.0039098794998 L 1212.256085678711 656.9202007094998 L 1220.172376508711 656.9202007094998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="976.349128384375" y="661.3181400594997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 716.2923819344998 L 964.034898204375 716.2923819344998 M 964.034898204375 706.1771214294998 L 1388.2747166601564 706.1771214294998 L 1396.1910074901564 714.0934122594998 L 1396.1910074901564 726.4076424394998 L 964.034898204375 726.4076424394998 L 964.034898204375 706.1771214294998 M 1388.2747166601564 706.1771214294998 L 1388.2747166601564 714.0934122594998 L 1396.1910074901564 714.0934122594998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="976.349128384375" y="718.4913516094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob's email_address is in access_token "audience":["claims-provider"] returned in request 3. a) / 4.</text></g><g><g><rect fill="white" stroke="none" x="1048.7712626926564" y="739.6014604894998" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1048.7712626926564" y="748.3973391894998" width="262.68338030921876" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1050.0906444976563" y="747.5177513194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1050.0906444976563" y="756.3136300194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 759.8319814994998 L 1393.3470067104895 759.8319814994998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1400.5889468401563,759.8319814994998) translate(-1400.5889468401563,-759.8319814994998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1393.2590479234896 756.1670320411664 L 1400.5889468401563 759.8319814994998 L 1393.2590479234896 763.4969309578331 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 806.8899325444996 L 964.034898204375 806.8899325444996 M 964.034898204375 796.7746720394997 L 1178.2867863623048 796.7746720394997 L 1186.2030771923048 804.6909628694997 L 1186.2030771923048 817.0051930494997 L 964.034898204375 817.0051930494997 L 964.034898204375 796.7746720394997 M 1178.2867863623048 796.7746720394997 L 1178.2867863623048 804.6909628694997 L 1186.2030771923048 804.6909628694997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="976.349128384375" y="809.0889022194996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is determined by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="1003.0301433078906" y="830.1990110994997" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1003.0301433078906" y="838.9948897994997" width="354.16561907875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1004.3495251128907" y="838.1153019294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1004.3495251128907" y="846.9111806294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], Bob's email_address, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 850.4295321094996 L 1393.3470067104895 850.4295321094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1400.5889468401563,850.4295321094996) translate(-1400.5889468401563,-850.4295321094996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1393.2590479234896 846.7645826511663 L 1400.5889468401563 850.4295321094996 L 1393.2590479234896 854.094481567833 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1400.5889468401563 886.9324287144996 L 1404.9868861901562 886.9324287144996 M 1404.9868861901562 876.8171682094996 L 1928.1605425365624 876.8171682094996 L 1936.0768333665624 884.7334590394996 L 1936.0768333665624 897.0476892194996 L 1404.9868861901562 897.0476892194996 L 1404.9868861901562 876.8171682094996 M 1928.1605425365624 876.8171682094996 L 1928.1605425365624 884.7334590394996 L 1936.0768333665624 884.7334590394996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1417.3011163701563" y="889.1313983894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users, view-users' admin roles, thus can query and view any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="1698.3739078555054" y="910.2415072694996" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1698.3739078555054" y="919.0373859694996" width="255.65078753578126" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1699.6932896605053" y="918.1577980994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1699.6932896605053" y="926.9536767994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1400.5889468401563 930.4720282794996 L 2244.5677162769693 930.4720282794996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2251.809656406636,930.4720282794996) translate(-2251.809656406636,-930.4720282794996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2244.4797574899694 926.8070788211662 L 2251.809656406636 930.4720282794996 L 2244.4797574899694 934.1369777378329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1704.7027195010132" y="943.6658463294996" width="242.99316424476564" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1706.0221013060132" y="951.5821371594996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token "audience":["realm-management"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2251.809656406636 955.1004886394995 L 1407.830886969823 955.1004886394995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1400.5889468401563,955.1004886394995) translate(-1400.5889468401563,-955.1004886394995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1407.918845756823 951.4355391811662 L 1400.5889468401563 955.1004886394995 L 1407.918845756823 958.7654380978329 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1154.9664586035155 992.0431791794996 L 1638.2951442467968 992.0431791794996 L 1646.2114350767968 999.9594700094996 L 1646.2114350767968 1012.2737001894996 L 1154.9664586035155 1012.2737001894996 L 1154.9664586035155 992.0431791794996 M 1638.2951442467968 992.0431791794996 L 1638.2951442467968 999.9594700094996 L 1646.2114350767968 999.9594700094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1167.2806887835156" y="1004.3574093594995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Bob's email_address extracted from access_token "audience":["claims-provider"] from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1246.3531163183593 1049.2163907294994 L 1546.908486531953 1049.2163907294994 L 1554.824777361953 1057.1326815594994 L 1554.824777361953 1069.4469117394995 L 1246.3531163183593 1069.4469117394995 L 1246.3531163183593 1049.2163907294994 M 1546.908486531953 1049.2163907294994 L 1546.908486531953 1057.1326815594994 L 1554.824777361953 1057.1326815594994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1258.6673464983594" y="1061.5306209094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Bob's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="1676.335730365271" y="1095.8345478394992" width="139.0444948111719" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1676.335730365271" y="1104.6304265394992" width="299.72714251625" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1677.655112170271" y="1103.7508386694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Bob's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1677.655112170271" y="1112.5467173694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["realm-management"], Bob's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1400.5889468401563 1116.0650688494993 L 2244.5677162769693 1116.0650688494993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2251.809656406636,1116.0650688494993) translate(-2251.809656406636,-1116.0650688494993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2244.4797574899694 1112.400119391166 L 2251.809656406636 1116.0650688494993 L 2244.4797574899694 1119.7300183078326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1766.6997669253296" y="1129.2588868994992" width="118.99906939613281" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1768.0191487303296" y="1137.1751777294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Bob's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2251.809656406636 1140.6935292094993 L 1407.830886969823 1140.6935292094993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1400.5889468401563,1140.6935292094993) translate(-1400.5889468401563,-1140.6935292094993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1407.918845756823 1137.028579751166 L 1400.5889468401563 1140.6935292094993 L 1407.918845756823 1144.3584786678325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1520.5134728464063" y="1177.636219749499" width="300.03677386390626" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1520.5134728464063" y="1186.432098449499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1521.8328546514063" y="1185.552510579499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Send plain_message from challenge@bar.com to bob@outlook.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1521.8328546514063" y="1194.348389279499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1400.5889468401563 1197.8667407594992 L 1933.2328325868957 1197.8667407594992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1940.4747727165625,1197.8667407594992) translate(-1940.4747727165625,-1197.8667407594992)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1933.1448737998958 1194.201791301166 L 1940.4747727165625 1197.8667407594992 L 1933.1448737998958 1201.5316902178324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1584.831974194095" y="1211.060558809499" width="363.61645526039064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1584.831974194095" y="1219.856437509499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1586.151355999095" y="1218.976849639499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Retrieve dkim_signed_message sent from bob@outlook.com to response@bar.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1586.151355999095" y="1227.772728339499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2132.6914568084244 1231.2910798194991 L 1407.830886969823 1231.2910798194991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1400.5889468401563,1231.2910798194991) translate(-1400.5889468401563,-1231.2910798194991)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1407.918845756823 1227.626130361166 L 1400.5889468401563 1231.2910798194991 L 1407.918845756823 1234.9560292778324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1031.5519938938282" y="1257.678715919499" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1031.5519938938282" y="1266.474594619499" width="225.8080446158594" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1031.5519938938282" y="1275.270473319499" width="297.121917906875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1032.8713756988282" y="1265.595006749499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1032.8713756988282" y="1274.390885449499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Bob's user_claims, dkim_signed_message - optional)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1032.8713756988282" y="1283.186764149499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1400.5889468401563 1286.705115629499 L 966.8788989840417 1286.705115629499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(959.636958854375,1286.705115629499) translate(-959.636958854375,-1286.705115629499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 966.9668577710418 1283.0401661711658 L 959.636958854375 1286.705115629499 L 966.9668577710418 1290.3700650878322 Z"/></g></g><g><g><rect fill="white" stroke="none" x="551.5870379033007" y="1299.898933679499" width="98.06091326820312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="551.5870379033007" y="1308.694812379499" width="157.91487139808595" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="552.9064197083007" y="1307.8152245094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="552.9064197083007" y="1316.6111032094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 1320.129454689499 L 308.69392847997915 1320.129454689499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(301.4519883503125,1320.129454689499) translate(-301.4519883503125,-1320.129454689499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.78188726697914 1316.4645052311657 L 301.4519883503125 1320.129454689499 L 308.78188726697914 1323.7944041478322 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 125.8064898597656 1333.3232727394989 L 469.18119601085937 1333.3232727394989 L 477.09748684085935 1341.2395635694988 L 477.09748684085935 1371.145551149499 L 125.8064898597656 1371.145551149499 L 125.8064898597656 1333.3232727394989 M 469.18119601085937 1333.3232727394989 L 469.18119601085937 1341.2395635694988 L 477.09748684085935 1341.2395635694988" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="138.12072003976562" y="1345.637502919499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="138.12072003976562" y="1354.433381619499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="138.12072003976562" y="1363.229260319499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 118.53946105117186 1431.8371141794987 L 476.4482248194531 1431.8371141794987 L 484.3645156494531 1439.7534050094987 L 484.3645156494531 1522.4346647894988 L 118.53946105117186 1522.4346647894988 L 118.53946105117186 1431.8371141794987 M 476.4482248194531 1431.8371141794987 L 476.4482248194531 1439.7534050094987 L 484.3645156494531 1439.7534050094987" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1444.1513443594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1452.9472230594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1461.7431017594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrap discovery of Claims Provider config url via Webfinger, if it doesn't work</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1470.5389804594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1479.3348591594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature </text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1488.1307378594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1496.9266165594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1505.7224952594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.85369123117187" y="1514.5183739594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate other optional claims e.g. recipient_info, file_info</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 95.47642699355467 1559.3773553294986 L 499.5112588770703 1559.3773553294986 L 507.4275497070703 1567.2936461594986 L 507.4275497070703 1649.9749059394987 L 95.47642699355467 1649.9749059394987 L 95.47642699355467 1559.3773553294986 M 499.5112588770703 1559.3773553294986 L 499.5112588770703 1567.2936461594986 L 507.4275497070703 1567.2936461594986" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1571.6915855094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract dkim_signed _message from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1580.4874642094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. verify DKIM signature of dkim_signed _message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1589.2833429094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. extract 'From:' part of dkim_signed_message e.g. Bob Sanders &lt;bob@outlook.com&gt;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1598.0792216094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. extract claims_provider_configuration_url and ticket_challenge from dkim_signed_message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1606.8751003094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1615.6709790094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1624.4668577094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1633.2627364094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="107.79065717355468" y="1642.0586151094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="596.8225649418749" y="1689.5563600894984" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="598.141946746875" y="1697.4726509194984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 301.4519883503125 1700.9910023994985 L 952.3950187247084 1700.9910023994985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(959.636958854375,1700.9910023994985) translate(-959.636958854375,-1700.9910023994985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 952.3070599377083 1697.3260529411652 L 959.636958854375 1700.9910023994985 L 952.3070599377083 1704.6559518578317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="726.9390466056641" y="1714.1848204494984" width="187.37963885414064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="726.9390466056641" y="1722.9806991494984" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="728.2584284106641" y="1722.1011112794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Get data from Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="728.2584284106641" y="1730.8969899794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 959.636958854375 1734.4153414594984 L 688.8627133407605 1734.4153414594984" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(681.6207732110938,1734.4153414594984) translate(-681.6207732110938,-1734.4153414594984)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 688.9506721277605 1730.7503920011652 L 681.6207732110938 1734.4153414594984 L 688.9506721277605 1738.0802909178317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="795.7135751090821" y="1747.6091595094983" width="49.830581847304686" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="797.0329569140821" y="1755.5254503394983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 681.6207732110938 1759.0438018194984 L 952.3950187247084 1759.0438018194984" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(959.636958854375,1759.0438018194984) translate(-959.636958854375,-1759.0438018194984)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 952.3070599377083 1755.3788523611652 L 959.636958854375 1759.0438018194984 L 952.3070599377083 1762.7087512778317 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2260.605535106636 95.7431396495 L 2619.8587235424175 95.7431396495 L 2619.8587235424175 170.5081085995 L 2260.605535106636 170.5081085995 L 2260.605535106636 95.7431396495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2260.605535106636 95.7431396495 L 2260.605535106636 106.29819408949999 L 2289.7845880388627 106.29819408949999 L 2295.062115258863 101.02066686949999 L 2295.062115258863 95.7431396495 L 2260.605535106636 95.7431396495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2269.401413806636" y="102.77984260949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2303.8579939588626" y="102.77984260949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Bob has to demonstrate control of his mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1141.356712002539 183.7019266495 L 1659.8211816777734 183.7019266495 L 1659.8211816777734 240.8751381995 L 1141.356712002539 240.8751381995 L 1141.356712002539 183.7019266495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1141.356712002539 183.7019266495 L 1141.356712002539 194.2569810895 L 1170.5357649347657 194.2569810895 L 1175.8132921547656 188.9794538695 L 1175.8132921547656 183.7019266495 L 1141.356712002539 183.7019266495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1150.152590702539" y="190.73862960949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1184.6091708547656" y="190.73862960949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Bob has to demonstrate control of his mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 928.851383404375 496.8352083695 L 2282.595231856636 496.8352083695 L 2282.595231856636 611.1816314694998 L 928.851383404375 611.1816314694998 L 928.851383404375 496.8352083695 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 928.851383404375 496.8352083695 L 928.851383404375 507.3902628095 L 955.140894710625 507.3902628095 L 960.4184219306251 502.1127355895 L 960.4184219306251 496.8352083695 L 928.851383404375 496.8352083695" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="937.647262104375" y="503.8719113295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="969.2143006306251" y="503.8719113295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Bob is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 928.851383404375 554.0084199194998 L 2282.595231856636 554.0084199194998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="969.2143006306251" y="561.0451228794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Bob is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 928.851383404375 682.4282489394998 L 1431.3745222901562 682.4282489394998 L 1431.3745222901562 863.6233501594996 L 928.851383404375 863.6233501594996 L 928.851383404375 682.4282489394998 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 928.851383404375 682.4282489394998 L 928.851383404375 692.9833033794998 L 955.140894710625 692.9833033794998 L 960.4184219306251 687.7057761594998 L 960.4184219306251 682.4282489394998 L 928.851383404375 682.4282489394998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="937.647262104375" y="689.4649518994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="969.2143006306251" y="689.4649518994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Bob was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 928.851383404375 773.0257995494997 L 1431.3745222901562 773.0257995494997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="969.2143006306251" y="780.0625025094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Bob was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1150.5685192535157 968.2943066894995 L 1650.6093744267969 968.2943066894995 L 1650.6093744267969 1082.6407297894993 L 1150.5685192535157 1082.6407297894993 L 1150.5685192535157 968.2943066894995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1150.5685192535157 968.2943066894995 L 1150.5685192535157 978.8493611294996 L 1176.8580305597657 978.8493611294996 L 1182.1355577797656 973.5718339094996 L 1182.1355577797656 968.2943066894995 L 1150.5685192535157 968.2943066894995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1159.3643979535157" y="975.3310096494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1190.9314364797656" y="975.3310096494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Bob was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1150.5685192535157 1025.4675182394994 L 1650.6093744267969 1025.4675182394994" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1190.9314364797656" y="1032.5042211994994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Bob was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1369.8033713901564 1153.8873472594992 L 2163.4770322584245 1153.8873472594992 L 2163.4770322584245 1244.484897869499 L 1369.8033713901564 1244.484897869499 L 1369.8033713901564 1153.8873472594992 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1369.8033713901564 1153.8873472594992 L 1369.8033713901564 1164.4424016994992 L 1398.982424322383 1164.4424016994992 L 1404.2599515423829 1159.164874479499 L 1404.2599515423829 1153.8873472594992 L 1369.8033713901564 1153.8873472594992" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1378.5992500901564" y="1160.9240502194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1413.0558302423829" y="1160.9240502194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Bob has to demonstrate control of his mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 82.28260894355466 1384.3393691994988 L 520.6213677570703 1384.3393691994988 L 520.6213677570703 1676.3625420394985 L 82.28260894355466 1676.3625420394985 L 82.28260894355466 1384.3393691994988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 82.28260894355466 1384.3393691994988 L 82.28260894355466 1394.8944236394989 L 178.55446583085936 1394.8944236394989 L 183.83199305085935 1389.6168964194987 L 183.83199305085935 1384.3393691994988 L 82.28260894355466 1384.3393691994988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="91.07848764355467" y="1391.3760721594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 91.07848764355467 1408.0882416894988 L 511.8254890570703 1408.0882416894988 L 511.8254890570703 1663.1687239894986 L 91.07848764355467 1663.1687239894986 L 91.07848764355467 1408.0882416894988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 91.07848764355467 1408.0882416894988 L 91.07848764355467 1418.6432961294988 L 117.36799894980467 1418.6432961294988 L 122.64552616980467 1413.3657689094987 L 122.64552616980467 1408.0882416894988 L 91.07848764355467 1408.0882416894988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="99.87436634355467" y="1415.1249446494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="131.44140486980467" y="1415.1249446494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Domain part of email_address or Webfinger is used to locate Claims Provider configuration url]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 91.07848764355467 1535.6284828394987 L 511.8254890570703 1535.6284828394987" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="131.44140486980467" y="1542.6651857994987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Bob has to demonstrate control of his mailbox]</text></g><g/></g></g></svg>