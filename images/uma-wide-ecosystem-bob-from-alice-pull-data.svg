<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1669" height="1436"><desc>Title%20UMA%20wide%20ecosystem%20-%20Bob%20from%20Alice%20(pull%20data)%0A%0Aactor%20%22Alice%20(RO)%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthZ%20Server%5Cnfoo.com%22%20as%20asServer%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnfoo.com%22%20as%20rsServer%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnbar.com%22%20as%20rqpClient%20%23lightsteelblue%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnbar.com%22%20as%20claimsProvider%20%23lightsteelblue%0Aparticipant%20%22AuthN%20Server%5Cnbar.com%22%20as%20authServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RqP)%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20Bob's%20AuthN%20server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20Alice's%20AuthZ%20server%0Anote%20left%20of%20rsServer%3AResource%20Server%20registers%20it's%20resource%20set%20'Incoming'%20and%20'Outgoing'%5Cnwith%20the%20Alice's%20AuthZ%20server%20with%20the%20associated%20scopes%3A%5Cn'Outgoing'%3A%20query%5Cn'Incoming'%3A%20write%0Anote%20over%20claimsProvider%3AClaims%20Provider%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Fbar.com%2F.well-known%2Fclaims-provider-configuration%0Anote%20right%20of%20claimsProvider%3AClaims%20Provider%20is%20registered%20at%20Bob's%20AuthN%20server%20and%20is%20assigned%20'query-users'%20admin%20role%0ArqpClient%3C-Bob%3AInitiate%20request%0ArsServer%3C-rqpClient%3A1.%20Request%20Alice's%20'Outgoing'%20resource%0ArsServer-%3ErqpClient%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Bob%20is%20involved%0ArqpClient-%3EauthServer%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Bob%20is%20not%20involved%0ArqpClient-%3EauthServer%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0ArqpClient%3C-authServer%3A4.%20Return%20access_token%0Anote%20right%20of%20rqpClient%3Aticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0Aalt%20Get%20Claims%20%20-%20Bob%20was%20involved%20at%20step%20%203.%20a)%0Anote%20right%20of%20rqpClient%3ABob's%20email_address%20is%20in%20access_token%20returned%20at%20step%203.%20a)%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%2C%20ticket_challenge)%0Aelse%20Get%20Claims%20-%20Bob%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20right%20of%20rqpClient%3A%20The%20email_address%20is%20determined%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%2C%20Bob's%20email_address%2C%20ticket_challenge)%0Aend%0Anote%20right%20of%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users'%20admin%20role%2C%20thus%20can%20query%20any%20user%20to%20get%20their%20claims%0AclaimsProvider-%3EauthServer%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users)%0AclaimsProvider%3C-authServer%3A7.%20Return%20access_token%0A%0Aalt%20Prepare%20email_address%20-%20Bob%20was%20involved%20at%20step%20%203.%20a)%0Anote%20over%20claimsProvider%3AUse%20Bob's%20email_address%20extracted%20from%20access_token%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Bob%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20over%20claimsProvider%3AUse%20Bob's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%20Bob's%20user_claims%5Cn(access_token%2C%20Bob's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Bob's%20user_claims%0A%0ArqpClient%3C-claimsProvider%3A10.%20Return%20claims_token%5Cn(Bob's%20user_claims%2C%20ticket_challenge)%0ArqpClient-%3EasServer%3A11.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token%20%2B%20metadata)%0Agroup%20Authorization%20process%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Anote%20over%20asServer%3AAuthZ%20Server%20uses%20domain%20part%20of%20Bob's%20email_address%20extracted%20from%20claims_token%5Cnto%20load%20Claims%20Provider%20configuration%20from%20URL%3A%5Cn'https%3A%2F%2F'%20%2B%20domain_part_of_email_address%20%2B%20'%2F.well-known%2Fclaims-provider-configuration'%0Anote%20over%20asServer%3AAuthZ%20Server%20evaluates%3A%5Cn1.%20domain%20part%20of%20email_address%20vs.%20claims%20issuer%5Cn2.%20ticket%5Cn3.%20ticket_challenge%20vs.%20ticket%5Cn4.%20claims_token%20signature%5Cn5.%20user_claims%5Cn6.%20other_claims%20(recipient_info%2C%20file_info)%0Aend%0ArqpClient%3C-asServer%3A12.%20Return%20RPT%0ArsServer%3C-rqpClient%3A13.%20Get%20data%20from%20Alice's%20'Outgoing'%20resource%5Cn(RPT)%0ArsServer-%3ErqpClient%3A14.%20200%20OK</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1669" height="1436"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="682.4750727426797" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Bob from Alice (pull data)</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 35.31561055361328 78.15138224949999 L 35.31561055361328 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 241.18967898625002 78.15138224949999 L 241.18967898625002 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 556.7537275189063 78.15138224949999 L 556.7537275189063 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 78.15138224949999 L 826.4415592803516 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1114.162407129414 78.15138224949999 L 1114.162407129414 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1560.2157134745703 78.15138224949999 L 1560.2157134745703 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1635.6580029493243 78.15138224949999 L 1635.6580029493243 1379.0618419794991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 32.143922998476604 M 35.31561055361328 37.16258750749999 L 35.31561055361328 47.893559521499995 M 28.98257788961328 41.03277413549999 L 41.648643217613284 41.03277413549999 M 35.31561055361328 47.893559521499995 L 28.98257788961328 57.92086123949999 M 35.31561055361328 47.893559521499995 L 41.648643217613284 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="13.808065082421876" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 204.16960335553907 45.694589846499994 L 278.20975461696094 45.694589846499994 L 278.20975461696094 78.15138224949999 L 204.16960335553907 78.15138224949999 L 204.16960335553907 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="213.71313174503908" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="224.59898837345705" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 501.3347337363399 45.694589846499994 L 612.1727213014727 45.694589846499994 L 612.1727213014727 78.15138224949999 L 501.3347337363399 78.15138224949999 L 501.3347337363399 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="510.8782621258399" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="540.1630369061133" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 794.604779853254 45.694589846499994 L 858.2783387074493 45.694589846499994 L 858.2783387074493 78.15138224949999 L 794.604779853254 78.15138224949999 L 794.604779853254 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="804.148308242754" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.8509297027149" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1060.8226522384493 45.694589846499994 L 1167.502162020379 45.694589846499994 L 1167.502162020379 78.15138224949999 L 1060.8226522384493 78.15138224949999 L 1060.8226522384493 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1070.3661806279492" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1097.5717775517774" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1522.6763965108516 45.694589846499994 L 1597.7550304382892 45.694589846499994 L 1597.7550304382892 78.15138224949999 L 1522.6763965108516 78.15138224949999 L 1522.6763965108516 45.694589846499994 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1532.2199249003515" y="60.5596248495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1543.6250838969336" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1640.6716538083244 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 1640.6716513014992 32.143922998476604 M 1635.6580029493243 37.16258750749999 L 1635.6580029493243 47.893559521499995 M 1629.3249702853243 41.03277413549999 L 1641.9910356133244 41.03277413549999 M 1635.6580029493243 47.893559521499995 L 1629.3249702853243 57.92086123949999 M 1635.6580029493243 47.893559521499995 L 1641.9910356133244 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1613.8840085035235" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1606.5509091382892" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 1405.0536635379992 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 1405.048649887976 M 35.31561055361328 1410.067314396999 L 35.31561055361328 1420.798286410999 M 28.98257788961328 1413.9375010249992 L 41.648643217613284 1413.9375010249992 M 35.31561055361328 1420.798286410999 L 28.98257788961328 1430.825588128999 M 35.31561055361328 1420.798286410999 L 41.648643217613284 1430.825588128999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="13.808065082421876" y="1387.8577206794992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1396.6535993794992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 204.16960335553907 1379.0618419794991 L 278.20975461696094 1379.0618419794991 L 278.20975461696094 1411.5186343824992 L 204.16960335553907 1411.5186343824992 L 204.16960335553907 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="213.71313174503908" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="224.59898837345705" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 501.3347337363399 1379.0618419794991 L 612.1727213014727 1379.0618419794991 L 612.1727213014727 1411.5186343824992 L 501.3347337363399 1411.5186343824992 L 501.3347337363399 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="510.8782621258399" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="540.1630369061133" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 794.604779853254 1379.0618419794991 L 858.2783387074493 1379.0618419794991 L 858.2783387074493 1411.5186343824992 L 794.604779853254 1411.5186343824992 L 794.604779853254 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="804.148308242754" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="809.8509297027149" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1060.8226522384493 1379.0618419794991 L 1167.502162020379 1379.0618419794991 L 1167.502162020379 1411.5186343824992 L 1060.8226522384493 1411.5186343824992 L 1060.8226522384493 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1070.3661806279492" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1097.5717775517774" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1522.6763965108516 1379.0618419794991 L 1597.7550304382892 1379.0618419794991 L 1597.7550304382892 1411.5186343824992 L 1522.6763965108516 1411.5186343824992 L 1522.6763965108516 1379.0618419794991 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1532.2199249003515" y="1393.9268769824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1543.6250838969336" y="1402.7227556824992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1640.6716538083244 1405.0536635379992 A 5.013650858999999 5.013650858999999 0 1 1 1640.6716513014992 1405.048649887976 M 1635.6580029493243 1410.067314396999 L 1635.6580029493243 1420.798286410999 M 1629.3249702853243 1413.9375010249992 L 1641.9910356133244 1413.9375010249992 M 1635.6580029493243 1420.798286410999 L 1629.3249702853243 1430.825588128999 M 1635.6580029493243 1420.798286410999 L 1641.9910356133244 1430.825588128999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1613.8840085035235" y="1387.8577206794992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1606.5509091382892" y="1396.6535993794992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 561.1516668689063 95.7431396495 L 1083.8151608617968 95.7431396495 L 1091.7314516917968 103.65943047949999 L 1091.7314516917968 115.97366065949998 L 561.1516668689063 115.97366065949998 L 561.1516668689063 95.7431396495 M 1083.8151608617968 95.7431396495 L 1083.8151608617968 103.65943047949999 L 1091.7314516917968 103.65943047949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="573.4658970489063" y="108.0573698295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at Bob's AuthN server and pre-registered as a universal AEMS public client at Alice's AuthZ server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 556.7537275189063 152.4765572645 L 552.3557881689063 152.4765572645 M 245.58761833625005 129.1674787095 L 544.4394973389063 129.1674787095 L 552.3557881689063 137.0837695395 L 552.3557881689063 175.7856358195 L 245.58761833625005 175.7856358195 L 245.58761833625005 129.1674787095 M 544.4394973389063 129.1674787095 L 544.4394973389063 137.0837695395 L 552.3557881689063 137.0837695395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="257.9018485162501" y="141.48170888950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server registers it's resource set 'Incoming' and 'Outgoing'</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="257.9018485162501" y="150.27758758950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">with the Alice's AuthZ server with the associated scopes:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="257.9018485162501" y="159.07346628950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing': query</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="257.9018485162501" y="167.86934498950004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming': write</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 881.5074176720703 188.9794538695 L 1338.901105756758 188.9794538695 L 1346.817396586758 196.8957446995 L 1346.817396586758 209.20997487949998 L 881.5074176720703 209.20997487949998 L 881.5074176720703 188.9794538695 M 1338.901105756758 188.9794538695 L 1338.901105756758 196.8957446995 L 1346.817396586758 196.8957446995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="893.8216478520703" y="201.29368404949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1122.4657976323438" y="201.29368404949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1127.6491167241406" y="201.29368404949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com/.well-known/claims-provider-configuration</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1114.162407129414 232.51905343449997 L 1118.560346479414 232.51905343449997 M 1118.560346479414 222.40379292949999 L 1516.4964539976952 222.40379292949999 L 1524.4127448276952 230.3200837595 L 1524.4127448276952 242.63431393949998 L 1118.560346479414 242.63431393949998 L 1118.560346479414 222.40379292949999 M 1516.4964539976952 222.40379292949999 L 1516.4964539976952 230.3200837595 L 1524.4127448276952 230.3200837595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1130.874576659414" y="234.71802310949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is registered at Bob's AuthN server and is assigned 'query-users' admin role</text></g><g><g><rect fill="white" stroke="none" x="1199.1360999934318" y="255.8281319895" width="63.8273622428125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1200.4554817984317" y="263.7444228195" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1635.6580029493243 267.2627742995 L 833.6834994100183 267.2627742995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(826.4415592803516,267.2627742995) translate(-826.4415592803516,-267.2627742995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 833.7714581970183 263.59782484116664 L 826.4415592803516 267.2627742995 L 833.7714581970183 270.92772375783335 Z"/></g></g><g><g><rect fill="white" stroke="none" x="611.6449684427735" y="280.4565923495" width="159.90534991371095" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="612.9643502477735" y="288.3728831795" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Alice's 'Outgoing' resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 291.8912346595 L 563.995667648573 291.8912346595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(556.7537275189063,291.8912346595) translate(-556.7537275189063,-291.8912346595)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 564.083626435573 288.22628520116666 L 556.7537275189063 291.8912346595 L 564.083626435573 295.55618411783337 Z"/></g></g><g><g><rect fill="white" stroke="none" x="631.6927208231446" y="305.0850527095" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="633.0121026281446" y="313.0013435395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 556.7537275189063 316.51969501950003 L 819.199619150685 316.51969501950003" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(826.4415592803516,316.51969501950003) translate(-826.4415592803516,-316.51969501950003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 819.1116603636849 312.8547455611667 L 826.4415592803516 316.51969501950003 L 819.1116603636849 320.1846444778334 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1075.3437882638673" y="353.4623855595" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1075.3437882638673" y="362.2582642595" width="235.9696962271875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1076.6631700688672" y="361.37867638949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1076.6631700688672" y="370.17455508949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 373.6929065695 L 1552.9737733449035 373.6929065695" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1560.2157134745703,373.6929065695) translate(-1560.2157134745703,-373.6929065695)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1552.8858145579036 370.02795711116664 L 1560.2157134745703 373.6929065695 L 1552.8858145579036 377.35785602783335 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1078.721138117383" y="410.6355971095" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1078.721138117383" y="419.4314758095" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1080.0405199223828" y="418.5518879395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1080.0405199223828" y="427.3477666395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 430.8661181195 L 1552.9737733449035 430.8661181195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1560.2157134745703,430.8661181195) translate(-1560.2157134745703,-430.8661181195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1552.8858145579036 427.20116866116666 L 1560.2157134745703 430.8661181195 L 1552.8858145579036 434.53106757783337 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1143.0092087960938" y="457.2537542195" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1144.3285906010938" y="465.1700450495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1560.2157134745703 468.68839652950004 L 833.6834994100183 468.68839652950004" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(826.4415592803516,468.68839652950004) translate(-826.4415592803516,-468.68839652950004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 833.7714581970183 465.0234470711667 L 826.4415592803516 468.68839652950004 L 833.7714581970183 472.3533459878334 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 491.9974750845001 L 830.8394986303516 491.9974750845001 M 830.8394986303516 481.88221457950004 L 1079.0606861046876 481.88221457950004 L 1086.9769769346876 489.7985054095 L 1086.9769769346876 502.11273558950006 L 830.8394986303516 502.11273558950006 L 830.8394986303516 481.88221457950004 M 1079.0606861046876 481.88221457950004 L 1079.0606861046876 489.7985054095 L 1086.9769769346876 489.7985054095" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="843.1537288103516" y="494.1964447595001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 549.1706866344999 L 830.8394986303516 549.1706866344999 M 830.8394986303516 539.0554261295 L 1101.8481769494142 539.0554261295 L 1109.7644677794142 546.9717169595 L 1109.7644677794142 559.2859471395 L 830.8394986303516 559.2859471395 L 830.8394986303516 539.0554261295 M 1101.8481769494142 539.0554261295 L 1101.8481769494142 546.9717169595 L 1109.7644677794142 546.9717169595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="843.1537288103516" y="551.3696563094999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob's email_address is in access_token returned at step 3. a)</text></g><g><g><rect fill="white" stroke="none" x="901.3171732382617" y="572.4797651895" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="901.3171732382617" y="581.2756438895" width="137.9696199332422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="902.6365550432618" y="580.3960560195" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="902.6365550432618" y="589.1919347195" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 592.7102861994999 L 1106.9204669997473 592.7102861994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1114.162407129414,592.7102861994999) translate(-1114.162407129414,-592.7102861994999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1106.8325082127474 589.0453367411666 L 1114.162407129414 592.7102861994999 L 1106.8325082127474 596.3752356578333 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 639.7682372444998 L 830.8394986303516 639.7682372444998 M 830.8394986303516 629.6529767394999 L 1045.0913867882814 629.6529767394999 L 1053.0076776182814 637.5692675694999 L 1053.0076776182814 649.8834977494998 L 830.8394986303516 649.8834977494998 L 830.8394986303516 629.6529767394999 M 1045.0913867882814 629.6529767394999 L 1045.0913867882814 637.5692675694999 L 1053.0076776182814 637.5692675694999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="843.1537288103516" y="641.9672069194997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is determined by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="855.5760538534961" y="663.0773157994998" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="855.5760538534961" y="671.8731944994998" width="229.45185870277345" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.8954356584961" y="670.9936066294998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.8954356584961" y="679.7894853294998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Bob's email_address, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 683.3078368094998 L 1106.9204669997473 683.3078368094998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1114.162407129414,683.3078368094998) translate(-1114.162407129414,-683.3078368094998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1106.8325082127474 679.6428873511665 L 1114.162407129414 683.3078368094998 L 1106.8325082127474 686.9727862678332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1114.162407129414 719.8107334144997 L 1118.560346479414 719.8107334144997 M 1118.560346479414 709.6954729094998 L 1547.9014832945702 709.6954729094998 L 1555.8177741245702 717.6117637394998 L 1555.8177741245702 729.9259939194998 L 1118.560346479414 729.9259939194998 L 1118.560346479414 709.6954729094998 M 1547.9014832945702 709.6954729094998 L 1547.9014832945702 717.6117637394998 L 1555.8177741245702 717.6117637394998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1130.874576659414" y="722.0097030894997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users' admin role, thus can query any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="1234.2440071102735" y="743.1198119694998" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1234.2440071102735" y="751.9156906694998" width="205.8901063834375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1235.5633889152734" y="751.0361027994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1235.5633889152734" y="759.8319814994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1114.162407129414 763.3503329794997 L 1552.9737733449035 763.3503329794997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1560.2157134745703,763.3503329794997) translate(-1560.2157134745703,-763.3503329794997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1552.8858145579036 759.6853835211664 L 1560.2157134745703 763.3503329794997 L 1552.8858145579036 767.0152824378331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1286.869632720625" y="776.5441510294997" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1288.189014525625" y="784.4604418594997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1560.2157134745703 787.9787933394997 L 1121.4043472590809 787.9787933394997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1114.162407129414,787.9787933394997) translate(-1114.162407129414,-787.9787933394997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1121.4923060460808 784.3138438811663 L 1114.162407129414 787.9787933394997 L 1121.4923060460808 791.643742797833 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 930.8968219689453 824.9214838794998 L 1289.511701459883 824.9214838794998 L 1297.427992289883 832.8377747094997 L 1297.427992289883 845.1520048894997 L 930.8968219689453 845.1520048894997 L 930.8968219689453 824.9214838794998 M 1289.511701459883 824.9214838794998 L 1289.511701459883 832.8377747094997 L 1297.427992289883 832.8377747094997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="943.2110521489453" y="837.2357140594996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Bob's email_address extracted from access_token from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 959.9265766076172 882.0946954294997 L 1260.481946821211 882.0946954294997 L 1268.398237651211 890.0109862594996 L 1268.398237651211 902.3252164394996 L 959.9265766076172 902.3252164394996 L 959.9265766076172 882.0946954294997 M 1260.481946821211 882.0946954294997 L 1260.481946821211 890.0109862594996 L 1268.398237651211 890.0109862594996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="972.2408067876172" y="894.4089256094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Bob's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="1258.5026359554884" y="928.7128525394996" width="116.40284747230469" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1258.5026359554884" y="937.5087312394996" width="157.37284869300782" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1259.8220177604883" y="936.6291433694996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query Bob's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1259.8220177604883" y="945.4250220694996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Bob's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1114.162407129414 948.9433735494996 L 1552.9737733449035 948.9433735494996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1560.2157134745703,948.9433735494996) translate(-1560.2157134745703,-948.9433735494996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1552.8858145579036 945.2784240911662 L 1560.2157134745703 948.9433735494996 L 1552.8858145579036 952.608323007833 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1277.6895256039259" y="962.1371915994996" width="118.99906939613281" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1279.0089074089258" y="970.0534824294996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Bob's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1560.2157134745703 973.5718339094996 L 1121.4043472590809 973.5718339094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1114.162407129414,973.5718339094996) translate(-1114.162407129414,-973.5718339094996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1121.4923060460808 969.9068844511662 L 1114.162407129414 973.5718339094996 L 1121.4923060460808 977.2367833678329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="892.1370661215625" y="986.7656519594996" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="892.1370661215625" y="995.5615306594996" width="156.32983416664064" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="893.4564479265625" y="994.6819427894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="893.4564479265625" y="1003.4778214894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Bob's user_claims, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1114.162407129414 1006.9961729694995 L 833.6834994100183 1006.9961729694995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(826.4415592803516,1006.9961729694995) translate(-826.4415592803516,-1006.9961729694995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 833.7714581970183 1003.3312235111662 L 826.4415592803516 1006.9961729694995 L 833.7714581970183 1010.6611224278329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="430.09625869060557" y="1020.1899910194996" width="97.36843890296875" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="430.09625869060557" y="1028.9858697194995" width="207.43872088539064" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="431.41564049560554" y="1028.1062818494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="431.41564049560554" y="1036.9021605494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token + metadata)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 1040.4205120294996 L 248.43161911591667 1040.4205120294996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(241.18967898625002,1040.4205120294996) translate(-241.18967898625002,-1040.4205120294996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 248.5195779029167 1036.7555625711664 L 241.18967898625002 1040.4205120294996 L 248.5195779029167 1044.0854614878328 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 65.54418049570313 1077.3632025694994 L 408.9188866467969 1077.3632025694994 L 416.8351774767969 1085.2794933994994 L 416.8351774767969 1115.1854809794995 L 65.54418049570313 1115.1854809794995 L 65.54418049570313 1077.3632025694994 M 408.9188866467969 1077.3632025694994 L 408.9188866467969 1085.2794933994994 L 416.8351774767969 1085.2794933994994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="77.85841067570314" y="1089.6774327494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="77.85841067570314" y="1098.4733114494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="77.85841067570314" y="1107.2691901494995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 48.50942860361329 1128.3792990294994 L 425.95363853888676 1128.3792990294994 L 433.86992936888674 1136.2955898594994 L 433.86992936888674 1166.2015774394995 L 48.50942860361329 1166.2015774394995 L 48.50942860361329 1128.3792990294994 M 425.95363853888676 1128.3792990294994 L 425.95363853888676 1136.2955898594994 L 433.86992936888674 1136.2955898594994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="1140.6935292094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server uses domain part of Bob's email_address extracted from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="1149.4894079094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to load Claims Provider configuration from URL:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="60.8236587836133" y="1158.2852866094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="85.41934664982423" y="1158.2852866094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.60266574162111" y="1158.2852866094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">' + domain_part_of_email_address + '/.well-known/claims-provider-configuration'</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 126.74191151376955 1179.3953954894994 L 347.7211556287305 1179.3953954894994 L 355.6374464587305 1187.3116863194994 L 355.6374464587305 1252.4011886994995 L 126.74191151376955 1252.4011886994995 L 126.74191151376955 1179.3953954894994 M 347.7211556287305 1179.3953954894994 L 347.7211556287305 1187.3116863194994 L 355.6374464587305 1187.3116863194994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="139.05614169376955" y="1191.7096256694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server evaluates:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="139.05614169376955" y="1200.5055043694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. domain part of email_address vs. claims issuer</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="139.05614169376955" y="1209.3013830694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="139.05614169376955" y="1218.0972617694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. ticket_challenge vs. ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="139.05614169376955" y="1226.8931404694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="139.05614169376955" y="1235.6890191694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="139.05614169376955" y="1244.4848978694995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. other_claims (recipient_info, file_info)</text></g><g><g><rect fill="white" stroke="none" x="500.09371047283213" y="1278.7888247994993" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="501.4130922778321" y="1286.7051156294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 241.18967898625002 1290.2234671094993 L 819.199619150685 1290.2234671094993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(826.4415592803516,1290.2234671094993) translate(-826.4415592803516,-1290.2234671094993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 819.1116603636849 1286.558517651166 L 826.4415592803516 1290.2234671094993 L 819.1116603636849 1293.8884165678326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="597.9078239725586" y="1303.4172851594992" width="187.37963885414064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="597.9078239725586" y="1312.2131638594992" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="599.2272057775587" y="1311.3335759894992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Get data from Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="599.2272057775587" y="1320.1294546894992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 826.4415592803516 1323.6478061694993 L 563.995667648573 1323.6478061694993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(556.7537275189063,1323.6478061694993) translate(-556.7537275189063,-1323.6478061694993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 564.083626435573 1319.982856711166 L 556.7537275189063 1323.6478061694993 L 564.083626435573 1327.3127556278325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="666.6823524759766" y="1336.8416242194992" width="49.830581847304686" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="668.0017342809766" y="1344.7579150494992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. 200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 556.7537275189063 1348.2762665294993 L 819.199619150685 1348.2762665294993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(826.4415592803516,1348.2762665294993) translate(-826.4415592803516,-1348.2762665294993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 819.1116603636849 1344.611317071166 L 826.4415592803516 1348.2762665294993 L 819.1116603636849 1351.9412159878325 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6559838303516 329.71351306950004 L 1591.0012889245702 329.71351306950004 L 1591.0012889245702 444.0599361695 L 795.6559838303516 444.0599361695 L 795.6559838303516 329.71351306950004 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 795.6559838303516 329.71351306950004 L 795.6559838303516 340.26856750950003 L 821.9454951366016 340.26856750950003 L 827.2230223566016 334.99104028950006 L 827.2230223566016 329.71351306950004 L 795.6559838303516 329.71351306950004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="804.4518625303516" y="336.75021602950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="836.0189010566016" y="336.75021602950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Bob is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6559838303516 386.8867246195 L 1591.0012889245702 386.8867246195" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="836.0189010566016" y="393.9234275795" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Bob is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6559838303516 515.3065536395 L 1144.947982579414 515.3065536395 L 1144.947982579414 696.5016548594998 L 795.6559838303516 696.5016548594998 L 795.6559838303516 515.3065536395 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 795.6559838303516 515.3065536395 L 795.6559838303516 525.8616080795 L 821.9454951366016 525.8616080795 L 827.2230223566016 520.5840808595 L 827.2230223566016 515.3065536395 L 795.6559838303516 515.3065536395" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="804.4518625303516" y="522.3432565995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="836.0189010566016" y="522.3432565995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Bob was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 795.6559838303516 605.9041042494998 L 1144.947982579414 605.9041042494998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="836.0189010566016" y="612.9408072094999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Bob was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.4988826189453 801.1726113894997 L 1301.8259316398828 801.1726113894997 L 1301.8259316398828 915.5190344894996 L 926.4988826189453 915.5190344894996 L 926.4988826189453 801.1726113894997 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 926.4988826189453 801.1726113894997 L 926.4988826189453 811.7276658294998 L 952.7883939251954 811.7276658294998 L 958.0659211451954 806.4501386094997 L 958.0659211451954 801.1726113894997 L 926.4988826189453 801.1726113894997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="935.2947613189453" y="808.2093143494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="966.8617998451954" y="808.2093143494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Bob was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.4988826189453 858.3458229394996 L 1301.8259316398828 858.3458229394996" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="966.8617998451954" y="865.3825258994997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Bob was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.111489253613286 1053.6143300794995 L 438.26786871888675 1053.6143300794995 L 438.26786871888675 1265.5950067494994 L 44.111489253613286 1265.5950067494994 L 44.111489253613286 1053.6143300794995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 44.111489253613286 1053.6143300794995 L 44.111489253613286 1064.1693845194995 L 140.38334614091798 1064.1693845194995 L 145.66087336091798 1058.8918572994994 L 145.66087336091798 1053.6143300794995 L 44.111489253613286 1053.6143300794995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="52.90736795361329" y="1060.6510330394995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g></g></g></svg>