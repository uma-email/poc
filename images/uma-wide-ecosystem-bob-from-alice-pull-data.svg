<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2400" height="1873"><desc>Title%20UMA%20wide%20ecosystem%20-%20Bob%20from%20Alice%20(pull%20data)%20with%20DKIM%20signed%20claims%0A%0Aactor%20%22Alice%20(RO)%5Cnalice%40gmail.com%5Cnor%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22AuthZ%20Server%5Cnfoo.com%22%20as%20asServer%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnfoo.com%22%20as%20rsServer%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnbar.com%22%20as%20rqpClient%20%23lightsteelblue%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnbar.com%22%20as%20claimsProvider%20%23lightsteelblue%0Aparticipant%20%22SMTP%20Server%5Cnoutlook.com%22%20as%20smtpServer%20%2300a2ed%0Aparticipant%20%22IMAP%20Server%5Cnoutlook.com%22%20as%20imapServer%20%2300a2ed%0Aparticipant%20%22AuthN%20Server%5Cnbar.com%22%20as%20authServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RqP)%5Cnbob%40outlook.com%5Cnor%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Aopt%20Bob%20has%20to%20demonstrate%20control%20of%20his%20mailbox%0Anote%20left%20of%20Bob%3ABob%20has%20set%20up%20his%20mailbox%20to%20auto-forward%20emails%20sent%20from%5Cnchallenge%40bar.com%20to%20response%40bar.com%0Aend%0Aopt%20Bob%20has%20to%20demonstrate%20control%20of%20his%20mailbox%0Abox%20over%20claimsProvider%3AClaims%20Provider%20can%20send%20email%20messages%20from%20addresses%20challenge%40bar.com%20and%20retrieve%20from%20response%40bar.com%0Aend%0Anote%20over%20rqpClient%3ARqP%20Client%20is%20registered%20at%20bar.com%20AuthN%20server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20foo.com%20AuthZ%20server%0Anote%20left%20of%20rsServer%3Afoo.com%20Admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%20set%5Cn'Incoming'%20and%20'Outgoing'%20with%20the%20foo.com%20AuthZ%20server%20with%20the%20associated%20scopes%3A%5Cn'Outgoing'%3A%20query%2C%20view%5Cn'Incoming'%3A%20create%0Anote%20over%20claimsProvider%3AClaims%20Provider%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Fbar.com%2F.well-known%2Fclaims-provider-configuration%0Anote%20right%20of%20claimsProvider%3AClaims%20Provider%20is%20registered%20at%20Bob's%20AuthN%20server%20and%20is%20assigned%20'query-users'%2C%20'view-user'%20admin%20role%0ArqpClient%3C-Bob%3AInitiate%20request%0ArsServer%3C-rqpClient%3A1.%20Request%20Alice's%20'Outgoing'%20resource%5Cn(scope%3Dquery%2C%20view)%0ArsServer-%3ErqpClient%3A2.%20401%20with%20permission%20ticket%0Aalt%20RqP%20Client%20uses%20Authorization%20Code%20Grant%20-%20Bob%20is%20involved%0ArqpClient-%3EauthServer%3A3.%20a)%20Get%20access_token%5Cn(grant_type%3Dauthorization_code%2C%20scope%3Dclaims-provider)%0Aelse%20RqP%20Client%20uses%20Client%20Credential%20Grant%20-%20Bob%20is%20not%20involved%0ArqpClient-%3EauthServer%3A3.%20b)%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0Aend%0ArqpClient%3C-authServer%3A4.%20Return%20access_token%0Anote%20right%20of%20rqpClient%3Aticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%0Aalt%20Get%20Claims%20%20-%20Bob%20was%20involved%20at%20step%20%203.%20a)%0Anote%20right%20of%20rqpClient%3ABob's%20email_address%20is%20in%20access_token%20returned%20at%20step%203.%20a)%0AclaimsProvider%3C-rqpClient%3A5.%20a)%20Get%20claims_token%5Cn(access_token%2C%20ticket_challenge)%0Aelse%20Get%20Claims%20-%20Bob%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20right%20of%20rqpClient%3A%20The%20email_address%20is%20determined%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20b)%20Get%20claims_token%5Cn(access_token%2C%20Bob's%20email_address%2C%20ticket_challenge)%0Aend%0Anote%20right%20of%20claimsProvider%3AClaims%20Provider%20is%20assigned%20the%20'query-users%2C%20view-users'%20admin%20role%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0AclaimsProvider-%3EauthServer%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20role%3Dquery-users%2C%20view-users)%0AclaimsProvider%3C-authServer%3A7.%20Return%20access_token%0A%0Aalt%20Prepare%20email_address%20-%20Bob%20was%20involved%20at%20step%20%203.%20a)%0Anote%20over%20claimsProvider%3AUse%20Bob's%20email_address%20extracted%20from%20access_token%20from%20a%20request%20at%20step%205.%20a)%0Aelse%20Prepare%20email_address%20-%20Bob%20was%20not%20involved%20at%20step%20%203.%20b)%0Anote%20over%20claimsProvider%3AUse%20Bob's%20email_address%20extracted%20from%20a%20request%20body%20at%20step%205.%20b)%0Aend%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Bob's%20user_claims%5Cn(access_token%2C%20Bob's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Bob's%20user_claims%0A%0Aopt%20Bob%20has%20to%20demonstrate%20control%20of%20his%20mailbox%0AsmtpServer%3C-claimsProvider%3A10.%20Send%20plain_message%20from%20challenge%40bar.com%20to%20bob%40outlook.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0AimapServer-%3EclaimsProvider%3A11.%20Retrieve%20dkim_signed_message%20sent%20from%20bob%40outlook.com%20to%20response%40bar.com%5Cn(claims_provider_configuration_url%2C%20ticket_challenge)%0Aend%0ArqpClient%3C-claimsProvider%3A12.%20Return%20claims_token%5Cn(Bob's%20user_claims%2C%20dkim_signed_message%20-%20optional)%5Cnif%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn1.%20recipient_info%20(email%20address%2C%20fullname)%5Cn2.%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Aalt%20Domain%20part%20of%20email_address%20or%20Webfinger%20is%20used%20to%20locate%20Claims%20Provider%20configuration%20url%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrup%20discovery%20of%20Claims%20Provider%20config%20url%20via%20Webfinger%2C%20if%20it%20doesn't%20work%5Cnbuild%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%20%5Cn5.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20evaluate%20user_claims%5Cn8.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aelse%20Bob%20has%20to%20demonstrate%20control%20of%20his%20mailbox%0Anote%20over%20asServer%3A1.%20extract%20dkim_signed%20_message%20from%20claims_token%5Cn2.%20verify%20DKIM%20signature%20of%20dkim_signed%20_message%5Cn3.%20extract%20'From%3A'%20part%20of%20dkim_signed_message%20e.g.%20Bob%20Sanders%20%3Cbob%40outlook.com%3E%5Cn4.%20extract%20claims_provider_configuration_url%20and%20ticket_challenge%20from%20dkim_signed_message%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn7.%20extract%20user_claims%20from%20claims_token%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArsServer%3C-rqpClient%3A15.%20Get%20data%20from%20Alice's%20'Outgoing'%20resource%5Cn(RPT)%0ArsServer-%3ErqpClient%3A16.%20200%20OK</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2400" height="1873"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="970.0516580145161" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA wide ecosystem - Bob from Alice (pull data) with DKIM signed claims</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 39.97739949404297 95.7431396495 L 39.97739949404297 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 267.94265760080077 95.7431396495 L 267.94265760080077 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 648.1114424615821 95.7431396495 L 648.1114424615821 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 95.7431396495 L 926.1276281048633 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1244.0664589350718 95.7431396495 L 1244.0664589350718 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1779.288222311478 95.7431396495 L 1779.288222311478 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1971.5049064033399 95.7431396495 L 1971.5049064033399 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2068.5849285113172 95.7431396495 L 2068.5849285113172 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2358.633912140458 95.7431396495 L 2358.633912140458 1798.6252559694983" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 44.99105035304297 32.148936648500005 A 5.013650858999999 5.013650858999999 0 1 1 44.99104784621775 32.14392299847661 M 39.97739949404297 37.1625875075 L 39.97739949404297 47.893559521499995 M 33.64436683004297 41.032774135500006 L 46.31043215804297 41.032774135500006 M 39.97739949404297 47.893559521499995 L 33.64436683004297 57.9208612395 M 39.97739949404297 47.893559521499995 L 46.31043215804297 57.9208612395" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="18.469854022851564" y="66.7167399395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="75.5126186395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="35.83029713808594" y="84.30849733950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="9.059728290429689" y="93.10437603950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 230.92258197008982 63.2863472465 L 304.9627332315117 63.2863472465 L 304.9627332315117 95.7431396495 L 230.92258197008982 95.7431396495 L 230.92258197008982 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="240.46611035958983" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="251.3519669880078" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 592.6924486790157 63.2863472465 L 703.5304362441485 63.2863472465 L 703.5304362441485 95.7431396495 L 592.6924486790157 95.7431396495 L 592.6924486790157 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="602.2359770685157" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="631.5207518487891" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 894.2908486777657 63.2863472465 L 957.964407531961 63.2863472465 L 957.964407531961 95.7431396495 L 894.2908486777657 95.7431396495 L 894.2908486777657 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="903.8343770672657" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="909.5369985272266" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1190.726704044107 63.2863472465 L 1297.4062138260367 63.2863472465 L 1297.4062138260367 95.7431396495 L 1190.726704044107 95.7431396495 L 1190.726704044107 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1200.270232433607" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.475829357435" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="#00a2ed" stroke="black" paint-order="fill stroke markers" d=" M 1741.7557489146539 63.2863472465 L 1816.8206957083023 63.2863472465 L 1816.8206957083023 95.7431396495 L 1741.7557489146539 95.7431396495 L 1741.7557489146539 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1751.2992773041537" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1754.1414251313022" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">outlook.com</text></g><path fill="none" stroke="none"/><g><path fill="#00a2ed" stroke="black" paint-order="fill stroke markers" d=" M 1935.525602257004 63.2863472465 L 2007.484210549676 63.2863472465 L 2007.484210549676 95.7431396495 L 1935.525602257004 95.7431396495 L 1935.525602257004 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1945.069130646504" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1946.358109223164" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">outlook.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2031.0456115475986 63.2863472465 L 2106.124245475036 63.2863472465 L 2106.124245475036 95.7431396495 L 2031.0456115475986 95.7431396495 L 2031.0456115475986 63.2863472465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2040.5891399370985" y="78.15138224949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2051.9942989336805" y="86.94726094949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2363.647562999458 32.148936648500005 A 5.013650858999999 5.013650858999999 0 1 1 2363.6475604926327 32.14392299847661 M 2358.633912140458 37.1625875075 L 2358.633912140458 47.893559521499995 M 2352.3008794764582 41.032774135500006 L 2364.966944804458 41.032774135500006 M 2358.633912140458 47.893559521499995 L 2352.3008794764582 57.9208612395 M 2358.633912140458 47.893559521499995 L 2364.966944804458 57.9208612395" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2336.8599176946573" y="66.7167399395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2320.970650726884" y="75.5126186395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2354.486809784501" y="84.30849733950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2329.526818329423" y="93.10437603950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 44.99105035304297 1842.2088349279984 A 5.013650858999999 5.013650858999999 0 1 1 44.99104784621775 1842.203821277975 M 39.97739949404297 1847.2224857869983 L 39.97739949404297 1857.9534578009982 M 33.64436683004297 1851.0926724149983 L 46.31043215804297 1851.0926724149983 M 39.97739949404297 1857.9534578009982 L 33.64436683004297 1867.9807595189982 M 39.97739949404297 1857.9534578009982 L 46.31043215804297 1867.9807595189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="18.469854022851564" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="1816.2170133694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@gmail.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="35.83029713808594" y="1825.0128920694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="9.059728290429689" y="1833.8087707694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 230.92258197008982 1798.6252559694983 L 304.9627332315117 1798.6252559694983 L 304.9627332315117 1831.0820483724983 L 230.92258197008982 1831.0820483724983 L 230.92258197008982 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="240.46611035958983" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="251.3519669880078" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 592.6924486790157 1798.6252559694983 L 703.5304362441485 1798.6252559694983 L 703.5304362441485 1831.0820483724983 L 592.6924486790157 1831.0820483724983 L 592.6924486790157 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="602.2359770685157" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="631.5207518487891" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 894.2908486777657 1798.6252559694983 L 957.964407531961 1798.6252559694983 L 957.964407531961 1831.0820483724983 L 894.2908486777657 1831.0820483724983 L 894.2908486777657 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="903.8343770672657" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="909.5369985272266" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1190.726704044107 1798.6252559694983 L 1297.4062138260367 1798.6252559694983 L 1297.4062138260367 1831.0820483724983 L 1190.726704044107 1831.0820483724983 L 1190.726704044107 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1200.270232433607" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.475829357435" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="#00a2ed" stroke="black" paint-order="fill stroke markers" d=" M 1741.7557489146539 1798.6252559694983 L 1816.8206957083023 1798.6252559694983 L 1816.8206957083023 1831.0820483724983 L 1741.7557489146539 1831.0820483724983 L 1741.7557489146539 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1751.2992773041537" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SMTP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1754.1414251313022" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">outlook.com</text></g><path fill="none" stroke="none"/><g><path fill="#00a2ed" stroke="black" paint-order="fill stroke markers" d=" M 1935.525602257004 1798.6252559694983 L 2007.484210549676 1798.6252559694983 L 2007.484210549676 1831.0820483724983 L 1935.525602257004 1831.0820483724983 L 1935.525602257004 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1945.069130646504" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IMAP Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1946.358109223164" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">outlook.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2031.0456115475986 1798.6252559694983 L 2106.124245475036 1798.6252559694983 L 2106.124245475036 1831.0820483724983 L 2031.0456115475986 1831.0820483724983 L 2031.0456115475986 1798.6252559694983 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2040.5891399370985" y="1813.4902909724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthN Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2051.9942989336805" y="1822.2861696724983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 2363.647562999458 1842.2088349279984 A 5.013650858999999 5.013650858999999 0 1 1 2363.6475604926327 1842.203821277975 M 2358.633912140458 1847.2224857869983 L 2358.633912140458 1857.9534578009982 M 2352.3008794764582 1851.0926724149983 L 2364.966944804458 1851.0926724149983 M 2358.633912140458 1857.9534578009982 L 2352.3008794764582 1867.9807595189982 M 2358.633912140458 1857.9534578009982 L 2364.966944804458 1867.9807595189982" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2336.8599176946573" y="1807.4211346694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2320.970650726884" y="1816.2170133694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@outlook.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2354.486809784501" y="1825.0128920694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2329.526818329423" y="1833.8087707694983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2358.633912140458 151.59696939449998 L 2354.235972790458 151.59696939449998 M 2081.7787465613173 137.0837695395 L 2346.319681960458 137.0837695395 L 2354.235972790458 145.0000603695 L 2354.235972790458 166.1101692495 L 2081.7787465613173 166.1101692495 L 2081.7787465613173 137.0837695395 M 2346.319681960458 137.0837695395 L 2346.319681960458 145.0000603695 L 2354.235972790458 145.0000603695" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2094.0929767413177" y="149.39799971949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob has set up his mailbox to auto-forward emails sent from</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="2094.0929767413177" y="158.19387841949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">challenge@bar.com to response@bar.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 989.2321634474546 216.2466778395 L 1498.9007544226888 216.2466778395 L 1498.9007544226888 236.47719884949998 L 989.2321634474546 236.47719884949998 L 989.2321634474546 216.2466778395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1001.5463936274546" y="228.56090801949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider can send email messages from addresses challenge@bar.com and retrieve from response@bar.com</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 652.5093818115821 262.8648349495 L 1191.8295835681447 262.8648349495 L 1199.7458743981447 270.7811257795 L 1199.7458743981447 283.0953559595 L 652.5093818115821 283.0953559595 L 652.5093818115821 262.8648349495 M 1191.8295835681447 262.8648349495 L 1191.8295835681447 270.7811257795 L 1199.7458743981447 270.7811257795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="664.8236119915821" y="275.17906512950003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client is registered at bar.com AuthN server and pre-registered as a universal AEMS public client at foo.com AuthZ server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 648.1114424615821 319.5982525645 L 643.7135031115821 319.5982525645 M 272.34059695080083 296.2891740095 L 635.7972122815821 296.2891740095 L 643.7135031115821 304.2054648395 L 643.7135031115821 342.9073311195 L 272.34059695080083 342.9073311195 L 272.34059695080083 296.2891740095 M 635.7972122815821 296.2891740095 L 635.7972122815821 304.2054648395 L 643.7135031115821 304.2054648395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="284.65482713080087" y="308.6034041895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com Admin has set up the Resource Server and registers it's resource set</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="284.65482713080087" y="317.3992828895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming' and 'Outgoing' with the foo.com AuthZ server with the associated scopes:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="284.65482713080087" y="326.1951615895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Outgoing': query, view</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="284.65482713080087" y="334.9910402895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming': create</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1011.411469477728 356.10114916949993 L 1468.8051575624156 356.10114916949993 L 1476.7214483924156 364.0174399994999 L 1476.7214483924156 376.33167017949995 L 1011.411469477728 376.33167017949995 L 1011.411469477728 356.10114916949993 M 1468.8051575624156 356.10114916949993 L 1468.8051575624156 364.0174399994999 L 1476.7214483924156 364.0174399994999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1023.725699657728" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1252.3698494380014" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1257.5531685297983" y="368.4153793495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com/.well-known/claims-provider-configuration</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1244.0664589350718 399.64074873449994 L 1248.4643982850716 399.64074873449994 M 1248.4643982850716 389.5254882294999 L 1695.0588920338216 389.5254882294999 L 1702.9751828638216 397.4417790594999 L 1702.9751828638216 409.7560092394999 L 1248.4643982850716 409.7560092394999 L 1248.4643982850716 389.5254882294999 M 1695.0588920338216 389.5254882294999 L 1695.0588920338216 397.4417790594999 L 1702.9751828638216 397.4417790594999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1260.7786284650717" y="401.83971840949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is registered at Bob's AuthN server and is assigned 'query-users', 'view-user' admin role</text></g><g><g><rect fill="white" stroke="none" x="1610.4670890012544" y="422.9498272894999" width="63.8273622428125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1611.7864708062543" y="430.8661181194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2358.633912140458 434.38446959949994 L 933.36956823453 434.38446959949994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(926.1276281048633,434.38446959949994) translate(-926.1276281048633,-434.38446959949994)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 933.45752702153 430.7195201411666 L 926.1276281048633 434.38446959949994 L 933.45752702153 438.0494190578333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="707.1668603263672" y="447.57828764949994" width="159.90534991371095" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="707.1668603263672" y="456.37416634949994" width="85.67631548988281" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="708.4862421313672" y="455.4945784794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="708.4862421313672" y="464.2904571794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=query, view)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 467.80880865949996 L 655.3533825912488 467.80880865949996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(648.1114424615821,467.80880865949996) translate(-648.1114424615821,-467.80880865949996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 655.4413413782488 464.1438592011666 L 648.1114424615821 467.80880865949996 L 655.4413413782488 471.4737581178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="727.2146127067383" y="481.00262670949996" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="728.5339945117383" y="488.91891753949994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 648.1114424615821 492.4372690195 L 918.8856879751967 492.4372690195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(926.1276281048633,492.4372690195) translate(-926.1276281048633,-492.4372690195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 918.7977291881966 488.7723195611666 L 926.1276281048633 492.4372690195 L 918.7977291881966 496.10221847783333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1379.3714301944965" y="529.3799595595" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1379.3714301944965" y="538.1758382595" width="235.9696962271875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1380.6908119994964" y="537.2962503895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. a) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1380.6908119994964" y="546.0921290895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=authorization_code, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 549.6104805694999 L 2061.3429883816507 549.6104805694999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2068.5849285113172,549.6104805694999) translate(-2068.5849285113172,-549.6104805694999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2061.2550295946508 545.9455311111666 L 2068.5849285113172 549.6104805694999 L 2061.2550295946508 553.2754300278333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1382.7487800480121" y="586.5531711094999" width="98.56188983070312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1382.7487800480121" y="595.3490498094999" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1384.068161853012" y="594.4694619394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. b) Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1384.068161853012" y="603.2653406394999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 606.7836921194998 L 2061.3429883816507 606.7836921194998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2068.5849285113172,606.7836921194998) translate(-2068.5849285113172,-606.7836921194998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2061.2550295946508 603.1187426611665 L 2068.5849285113172 606.7836921194998 L 2061.2550295946508 610.4486415778332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1447.036850726723" y="633.1713282194999" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1448.356232531723" y="641.0876190494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2068.5849285113172 644.6059705294998 L 933.36956823453 644.6059705294998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(926.1276281048633,644.6059705294998) translate(-926.1276281048633,-644.6059705294998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 933.45752702153 640.9410210711665 L 926.1276281048633 644.6059705294998 L 933.45752702153 648.2709199878332 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 667.9150490844997 L 930.5255674548633 667.9150490844997 M 930.5255674548633 657.7997885794998 L 1178.7467549291994 657.7997885794998 L 1186.6630457591993 665.7160794094998 L 1186.6630457591993 678.0303095894998 L 930.5255674548633 678.0303095894998 L 930.5255674548633 657.7997885794998 M 1178.7467549291994 657.7997885794998 L 1178.7467549291994 665.7160794094998 L 1186.6630457591993 665.7160794094998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="942.8397976348633" y="670.1140187594997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_challenge = Base64URL-Encode(SHA256(ticket))</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 725.0882606344998 L 930.5255674548633 725.0882606344998 M 930.5255674548633 714.9730001294998 L 1201.534245773926 714.9730001294998 L 1209.450536603926 722.8892909594998 L 1209.450536603926 735.2035211394998 L 930.5255674548633 735.2035211394998 L 930.5255674548633 714.9730001294998 M 1201.534245773926 714.9730001294998 L 1201.534245773926 722.8892909594998 L 1209.450536603926 722.8892909594998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="942.8397976348633" y="727.2872303094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob's email_address is in access_token returned at step 3. a)</text></g><g><g><rect fill="white" stroke="none" x="1016.1122335533463" y="748.3973391894998" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1016.1122335533463" y="757.1932178894998" width="137.9696199332422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1017.4316153583463" y="756.3136300194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. a) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1017.4316153583463" y="765.1095087194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 768.6278601994998 L 1236.824518805405 768.6278601994998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1244.0664589350718,768.6278601994998) translate(-1244.0664589350718,-768.6278601994998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1236.736560018405 764.9629107411664 L 1244.0664589350718 768.6278601994998 L 1236.736560018405 772.2928096578331 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 815.6858112444996 L 930.5255674548633 815.6858112444996 M 930.5255674548633 805.5705507394997 L 1144.7774556127931 805.5705507394997 L 1152.693746442793 813.4868415694997 L 1152.693746442793 825.8010717494997 L 930.5255674548633 825.8010717494997 L 930.5255674548633 805.5705507394997 M 1144.7774556127931 805.5705507394997 L 1144.7774556127931 813.4868415694997 L 1152.693746442793 813.4868415694997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="942.8397976348633" y="817.8847809194996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The email_address is determined by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="970.3711141685807" y="838.9948897994997" width="95.96113604652344" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="970.3711141685807" y="847.7907684994997" width="229.45185870277345" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="971.6904959735807" y="846.9111806294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. b) Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="971.6904959735807" y="855.7070593294997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Bob's email_address, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 859.2254108094996 L 1236.824518805405 859.2254108094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1244.0664589350718,859.2254108094996) translate(-1244.0664589350718,-859.2254108094996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1236.736560018405 855.5604613511663 L 1244.0664589350718 859.2254108094996 L 1236.736560018405 862.890360267833 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1244.0664589350718 895.7283074144996 L 1248.4643982850716 895.7283074144996 M 1248.4643982850716 885.6130469094996 L 1766.9739921314779 885.6130469094996 L 1774.8902829614779 893.5293377394996 L 1774.8902829614779 905.8435679194996 L 1248.4643982850716 905.8435679194996 L 1248.4643982850716 885.6130469094996 M 1766.9739921314779 885.6130469094996 L 1766.9739921314779 893.5293377394996 L 1774.8902829614779 893.5293377394996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1260.7786284650717" y="897.9272770894995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider is assigned the 'query-users, view-users' admin role, thus can query and view any user to get their claims</text></g><g><g><rect fill="white" stroke="none" x="1528.500299955304" y="919.0373859694996" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1528.500299955304" y="927.8332646694996" width="255.65078753578126" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1529.8196817603039" y="926.9536767994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1529.8196817603039" y="935.7495554994996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1244.0664589350718 939.2679069794996 L 2061.3429883816507 939.2679069794996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2068.5849285113172,939.2679069794996) translate(-2068.5849285113172,-939.2679069794996)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2061.2550295946508 935.6029575211662 L 2068.5849285113172 939.2679069794996 L 2061.2550295946508 942.9328564378329 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1606.0062661418274" y="952.4617250294996" width="100.63885516273437" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1607.3256479468273" y="960.3780158594996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2068.5849285113172 963.8963673394995 L 1251.3083990647385 963.8963673394995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1244.0664589350718,963.8963673394995) translate(-1244.0664589350718,-963.8963673394995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1251.3963578517385 960.2314178811662 L 1244.0664589350718 963.8963673394995 L 1251.3963578517385 967.5613167978329 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1060.800873774603 1000.8390578794996 L 1419.4157532655404 1000.8390578794996 L 1427.3320440955404 1008.7553487094996 L 1427.3320440955404 1021.0695788894996 L 1060.800873774603 1021.0695788894996 L 1060.800873774603 1000.8390578794996 M 1419.4157532655404 1000.8390578794996 L 1419.4157532655404 1008.7553487094996 L 1427.3320440955404 1008.7553487094996" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1073.115103954603" y="1013.1532880594995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Bob's email_address extracted from access_token from a request at step 5. a)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1089.8306284132748 1058.0122694294994 L 1390.3859986268685 1058.0122694294994 L 1398.3022894568685 1065.9285602594994 L 1398.3022894568685 1078.2427904394995 L 1089.8306284132748 1078.2427904394995 L 1089.8306284132748 1058.0122694294994 M 1390.3859986268685 1058.0122694294994 L 1390.3859986268685 1065.9285602594994 L 1398.3022894568685 1065.9285602594994" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1102.1448585932749" y="1070.3264996094995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Use Bob's email_address extracted from a request body at step 5. b)</text></g><g><g><rect fill="white" stroke="none" x="1577.6392693766907" y="1104.6304265394992" width="139.0444948111719" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1577.6392693766907" y="1113.4263052394992" width="157.37284869300782" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1578.9586511816906" y="1112.5467173694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Bob's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1578.9586511816906" y="1121.3425960694992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token, Bob's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1244.0664589350718 1124.8609475494993 L 2061.3429883816507 1124.8609475494993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(2068.5849285113172,1124.8609475494993) translate(-2068.5849285113172,-1124.8609475494993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 2061.2550295946508 1121.195998091166 L 2068.5849285113172 1124.8609475494993 L 2061.2550295946508 1128.5258970078326 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1596.8261590251282" y="1138.0547655994992" width="118.99906939613281" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1598.145540830128" y="1145.9710564294992" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Bob's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2068.5849285113172 1149.4894079094993 L 1251.3083990647385 1149.4894079094993" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1244.0664589350718,1149.4894079094993) translate(-1244.0664589350718,-1149.4894079094993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1251.3963578517385 1145.824458451166 L 1244.0664589350718 1149.4894079094993 L 1251.3963578517385 1153.1543573678325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1361.6589536913218" y="1186.432098449499" width="300.03677386390626" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1361.6589536913218" y="1195.227977149499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1362.9783354963217" y="1194.348389279499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Send plain_message from challenge@bar.com to bob@outlook.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1362.9783354963217" y="1203.144267979499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1244.0664589350718 1206.6626194594992 L 1772.0462821818112 1206.6626194594992" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1779.288222311478,1206.6626194594992) translate(-1779.288222311478,-1206.6626194594992)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1771.9583233948113 1202.997670001166 L 1779.288222311478 1206.6626194594992 L 1771.9583233948113 1210.3275689178324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1425.9774550390107" y="1219.856437509499" width="363.61645526039064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="1425.9774550390107" y="1228.652316209499" width="220.4061433707422" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1427.2968368440106" y="1227.772728339499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. Retrieve dkim_signed_message sent from bob@outlook.com to response@bar.com</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1427.2968368440106" y="1236.568607039499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(claims_provider_configuration_url, ticket_challenge)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1971.5049064033399 1240.0869585194991 L 1251.3083990647385 1240.0869585194991" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1244.0664589350718,1240.0869585194991) translate(-1244.0664589350718,-1240.0869585194991)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1251.3963578517385 1236.422009061166 L 1244.0664589350718 1240.0869585194991 L 1251.3963578517385 1243.7519079778324 Z"/></g></g><g><g><rect fill="white" stroke="none" x="936.5360845665299" y="1266.474594619499" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="936.5360845665299" y="1275.270473319499" width="225.8080446158594" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="936.5360845665299" y="1284.066352019499" width="297.121917906875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.8554663715299" y="1274.390885449499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.8554663715299" y="1283.186764149499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Bob's user_claims, dkim_signed_message - optional)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="937.8554663715299" y="1291.982642849499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1244.0664589350718 1295.500994329499 L 933.36956823453 1295.500994329499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(926.1276281048633,1295.500994329499) translate(-926.1276281048633,-1295.500994329499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 933.45752702153 1291.8360448711658 L 926.1276281048633 1295.500994329499 L 933.45752702153 1299.1659437878322 Z"/></g></g><g><g><rect fill="white" stroke="none" x="518.077707153789" y="1308.694812379499" width="98.06091326820312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="518.077707153789" y="1317.490691079499" width="157.91487139808595" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="519.397088958789" y="1316.6111032094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="519.397088958789" y="1325.4069819094989" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 1328.925333389499 L 275.18459773046743 1328.925333389499" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(267.94265760080077,1328.925333389499) translate(-267.94265760080077,-1328.925333389499)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 275.2725565174674 1325.2603839311657 L 267.94265760080077 1328.925333389499 L 275.2725565174674 1332.5902828478322 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 92.29715911025389 1342.1191514394989 L 435.67186526134765 1342.1191514394989 L 443.5881560913476 1350.0354422694988 L 443.5881560913476 1379.941429849499 L 92.29715911025389 1379.941429849499 L 92.29715911025389 1342.1191514394989 M 435.67186526134765 1342.1191514394989 L 435.67186526134765 1350.0354422694988 L 443.5881560913476 1350.0354422694988" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="104.6113892902539" y="1354.433381619499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="104.6113892902539" y="1363.229260319499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="104.6113892902539" y="1372.025139019499" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 85.03013030166014 1440.6329928794987 L 442.9388940699414 1440.6329928794987 L 450.8551848999414 1448.5492837094987 L 450.8551848999414 1531.2305434894988 L 85.03013030166014 1531.2305434894988 L 85.03013030166014 1440.6329928794987 M 442.9388940699414 1440.6329928794987 L 442.9388940699414 1448.5492837094987 L 450.8551848999414 1448.5492837094987" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1452.9472230594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1461.7431017594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1470.5389804594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrup discovery of Claims Provider config url via Webfinger, if it doesn't work</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1479.3348591594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1488.1307378594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature </text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1496.9266165594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1505.7224952594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1514.5183739594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.34436048166015" y="1523.3142526594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate other optional claims e.g. recipient_info, file_info</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 61.96709624404295 1568.1732340294986 L 466.0019281275586 1568.1732340294986 L 473.91821895755857 1576.0895248594986 L 473.91821895755857 1658.7707846394987 L 61.96709624404295 1658.7707846394987 L 61.96709624404295 1568.1732340294986 M 466.0019281275586 1568.1732340294986 L 466.0019281275586 1576.0895248594986 L 473.91821895755857 1576.0895248594986" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1580.4874642094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract dkim_signed _message from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1589.2833429094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. verify DKIM signature of dkim_signed _message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1598.0792216094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. extract 'From:' part of dkim_signed_message e.g. Bob Sanders &lt;bob@outlook.com&gt;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1606.8751003094987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. extract claims_provider_configuration_url and ticket_challenge from dkim_signed_message</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1615.6709790094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1624.4668577094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1633.2627364094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1642.0586151094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.28132642404296" y="1650.8544938094988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="563.3132341923632" y="1698.3522387894984" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="564.6326159973632" y="1706.2685296194984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 267.94265760080077 1709.7868810994985 L 918.8856879751967 1709.7868810994985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(926.1276281048633,1709.7868810994985) translate(-926.1276281048633,-1709.7868810994985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 918.7977291881966 1706.1219316411652 L 926.1276281048633 1709.7868810994985 L 918.7977291881966 1713.4518305578317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="693.4297158561524" y="1722.9806991494984" width="187.37963885414064" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="693.4297158561524" y="1731.7765778494984" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="694.7490976611524" y="1730.8969899794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Get data from Alice's 'Outgoing' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="694.7490976611524" y="1739.6928686794984" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 926.1276281048633 1743.2112201594985 L 655.3533825912488 1743.2112201594985" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(648.1114424615821,1743.2112201594985) translate(-648.1114424615821,-1743.2112201594985)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 655.4413413782488 1739.5462707011652 L 648.1114424615821 1743.2112201594985 L 655.4413413782488 1746.8761696178317 Z"/></g></g><g><g><rect fill="white" stroke="none" x="762.2042443595703" y="1756.4050382094983" width="49.830581847304686" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="763.5236261645704" y="1764.3213290394983" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 648.1114424615821 1767.8396805194984 L 918.8856879751967 1767.8396805194984" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(926.1276281048633,1767.8396805194984) translate(-926.1276281048633,-1767.8396805194984)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 918.7977291881966 1764.1747310611652 L 926.1276281048633 1767.8396805194984 L 918.7977291881966 1771.5046299778317 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2077.3808072113175 113.3348970495 L 2389.419487590458 113.3348970495 L 2389.419487590458 179.3039872995 L 2077.3808072113175 179.3039872995 L 2077.3808072113175 113.3348970495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 2077.3808072113175 113.3348970495 L 2077.3808072113175 123.88995148949999 L 2106.559860143544 123.88995148949999 L 2111.837387363544 118.6124242695 L 2111.837387363544 113.3348970495 L 2077.3808072113175 113.3348970495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2086.1766859113172" y="120.37160000949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="2120.633266063544" y="120.37160000949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Bob has to demonstrate control of his mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 984.8342240974546 192.4978053495 L 1503.298693772689 192.4978053495 L 1503.298693772689 249.6710168995 L 984.8342240974546 249.6710168995 L 984.8342240974546 192.4978053495 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 984.8342240974546 192.4978053495 L 984.8342240974546 203.0528597895 L 1014.0132770296811 203.0528597895 L 1019.2908042496812 197.7753325695 L 1019.2908042496812 192.4978053495 L 984.8342240974546 192.4978053495" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="993.6301027974546" y="199.53450830949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1028.086682949681" y="199.53450830949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Bob has to demonstrate control of his mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 895.3420526548633 505.6310870695 L 2099.3705039613174 505.6310870695 L 2099.3705039613174 619.9775101694999 L 895.3420526548633 619.9775101694999 L 895.3420526548633 505.6310870695 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 895.3420526548633 505.6310870695 L 895.3420526548633 516.1861415095 L 921.6315639611133 516.1861415095 L 926.9090911811134 510.9086142895 L 926.9090911811134 505.6310870695 L 895.3420526548633 505.6310870695" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="904.1379313548633" y="512.6677900295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="935.7049698811134" y="512.6677900295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Authorization Code Grant - Bob is involved]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 895.3420526548633 562.8042986194998 L 2099.3705039613174 562.8042986194998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="935.7049698811134" y="569.8410015794999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[RqP Client uses Client Credential Grant - Bob is not involved]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 895.3420526548633 691.2241276394998 L 1274.8520343850716 691.2241276394998 L 1274.8520343850716 872.4192288594996 L 895.3420526548633 872.4192288594996 L 895.3420526548633 691.2241276394998 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 895.3420526548633 691.2241276394998 L 895.3420526548633 701.7791820794998 L 921.6315639611133 701.7791820794998 L 926.9090911811134 696.5016548594998 L 926.9090911811134 691.2241276394998 L 895.3420526548633 691.2241276394998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="904.1379313548633" y="698.2608305994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="935.7049698811134" y="698.2608305994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims  - Bob was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 895.3420526548633 781.8216782494997 L 1274.8520343850716 781.8216782494997" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="935.7049698811134" y="788.8583812094997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Get Claims - Bob was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1056.402934424603 977.0901853894995 L 1431.7299834455405 977.0901853894995 L 1431.7299834455405 1091.4366084894993 L 1056.402934424603 1091.4366084894993 L 1056.402934424603 977.0901853894995 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1056.402934424603 977.0901853894995 L 1056.402934424603 987.6452398294996 L 1082.692445730853 987.6452398294996 L 1087.969972950853 982.3677126094996 L 1087.969972950853 977.0901853894995 L 1056.402934424603 977.0901853894995" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1065.198813124603" y="984.1268883494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1096.765851650853" y="984.1268883494996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Bob was involved at step  3. a)]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1056.402934424603 1034.2633969394994 L 1431.7299834455405 1034.2633969394994" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1096.765851650853" y="1041.3000998994994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Prepare email_address - Bob was not involved at step  3. b)]</text></g><g/><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1213.2808834850719 1162.6832259594992 L 2002.2904818533398 1162.6832259594992 L 2002.2904818533398 1253.280776569499 L 1213.2808834850719 1253.280776569499 L 1213.2808834850719 1162.6832259594992 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1213.2808834850719 1162.6832259594992 L 1213.2808834850719 1173.2382803994992 L 1242.4599364172984 1173.2382803994992 L 1247.7374636372983 1167.960753179499 L 1247.7374636372983 1162.6832259594992 L 1213.2808834850719 1162.6832259594992" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1222.0767621850719" y="1169.7199289194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">opt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1256.5333423372983" y="1169.7199289194991" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Bob has to demonstrate control of his mailbox]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 48.773278194042945 1393.1352478994988 L 487.11203700755857 1393.1352478994988 L 487.11203700755857 1685.1584207394985 L 48.773278194042945 1685.1584207394985 L 48.773278194042945 1393.1352478994988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 48.773278194042945 1393.1352478994988 L 48.773278194042945 1403.6903023394989 L 145.04513508134764 1403.6903023394989 L 150.32266230134763 1398.4127751194987 L 150.32266230134763 1393.1352478994988 L 48.773278194042945 1393.1352478994988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="57.56915689404295" y="1400.1719508594988" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 57.56915689404295 1416.8841203894988 L 478.31615830755857 1416.8841203894988 L 478.31615830755857 1671.9646026894986 L 57.56915689404295 1671.9646026894986 L 57.56915689404295 1416.8841203894988 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 57.56915689404295 1416.8841203894988 L 57.56915689404295 1427.4391748294988 L 83.85866820029295 1427.4391748294988 L 89.13619542029295 1422.1616476094987 L 89.13619542029295 1416.8841203894988 L 57.56915689404295 1416.8841203894988" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="66.36503559404295" y="1423.9208233494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alt</text><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="97.93207412029295" y="1423.9208233494987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Domain part of email_address or Webfinger is used to locate Claims Provider configuration url]</text><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 57.56915689404295 1544.4243615394987 L 478.31615830755857 1544.4243615394987" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="2.198969675"/></g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="97.93207412029295" y="1551.4610644994987" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[Bob has to demonstrate control of his mailbox]</text></g><g/></g></g></svg>