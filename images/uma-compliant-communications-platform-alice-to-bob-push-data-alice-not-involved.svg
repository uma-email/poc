<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1515" height="1032"><desc>Title%20UMA-compliant%20communications%20platform%20-%20Alice%20to%20Bob%20(push%20data)%20-%20Alice%20not%20involved%0A%0Aactor%20%22Alice%20(RqP)%5Cnsender%5Cnalice%40foo.com%22%20as%20Alice%20%23lightpink%0Aparticipant%20%22IAM%20Server%5Cnfoo.com%22%20as%20authServer%20%23lightpink%0Aparticipant%20%22Claims%20Provider%20(CP)%5Cnfoo.com%22%20as%20claimsProvider%20%23lightpink%0Aparticipant%20%22RqP%20Client%5Cnfoo.com%22%20as%20rqpClient%20%23lightpink%0Aparticipant%20%22Resource%20Server%20(RS)%5Cnbar.com%22%20as%20rsServer%20%23lightsteelblue%0Aparticipant%20%22UMA%20Server%5Cnbar.com%22%20as%20asServer%20%23lightsteelblue%0Aactor%20%22Bob%20(RO)%5Cnrecipient%5Cnbob%40bar.com%22%20as%20Bob%20%23lightsteelblue%0A%0Abottomparticipants%0A%0Anote%20over%20claimsProvider%3AClaims%20Provider%3A%5Cn%E2%80%A2%20publishes%20its%20metadata%20on%20a%20URL%20https%3A%2F%2Ffoo.com%2F.well-known%2Fclaims-provider-configuration%5Cn%E2%80%A2%20is%20registered%20at%20Alice's%20IAM%20Server%20and%20is%20assigned%20'query-users'%2C%20'view-users'%20admin%20roles%2C%20thus%20can%20query%20and%20view%20any%20user%20to%20get%20their%20claims%0Anote%20over%20rqpClient%3ARqP%20Client%3A%5Cn%E2%80%A2%20is%20registered%20at%20foo.com%20IAM%20Server%20and%20pre-registered%20as%20a%20universal%20AEMS%20public%20client%20at%20bar.com%20UMA%20Server%5Cn%E2%80%A2%20is%20an%20agent%20that%20can%20act%20on%20behalf%20of%20any%20user%20registered%20at%20foo.com%20IAM%20Server%0Anote%20over%20rsServer%3Abar.com%20admin%20has%20set%20up%20the%20Resource%20Server%20and%20registers%20it's%20resource%5Cn'Incoming'%20at%20the%20bar.com%20UMA%20Server%20with%20the%20associated%20scope%20'create'%0AAlice--%3ErqpClient%3AInitiate%20the%20request%20asynchronously%20via%20the%20message%20queue%0ArqpClient-%3ErsServer%3A1.%20Request%20Bob's%20'Incoming'%20resource%5Cn(scope%3Dcreate)%0ArqpClient%3C-rsServer%3A2.%20401%20with%20permission%20ticket%0AauthServer%3C-rqpClient%3A3.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Dclaims-provider)%0AauthServer-%3ErqpClient%3A4.%20Return%20access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%0Anote%20over%20rqpClient%3A%E2%80%A2%20ticket_challenge%20%3D%20Base64URL-Encode(SHA256(ticket))%5Cn%E2%80%A2%20the%20email_address%20is%20specified%20by%20RqP%20Client%0AclaimsProvider%3C-rqpClient%3A5.%20Get%20claims_token%5Cn(access_token%20%22audience%22%3A%5B%22claims-provider%22%5D%2C%20Alice's%20email_address%2C%5Cn%20ticket_challenge%2C%20scope%3Daems-agent)%0AauthServer%3C-claimsProvider%3A6.%20Get%20access_token%5Cn(grant_type%3Dclient_credentials%2C%20scope%3Drealm-management%2C%20role%3Dquery-users%2C%20view-users)%0AauthServer-%3EclaimsProvider%3A7.%20Return%20access_token%20%22audience%22%3A%5B%22realm-management%22%5D%0A%0AauthServer%3C-claimsProvider%3A8.%20Query%2FView%20Alice's%20user_claims%5Cn(access_token%20%22audience%22%3A%5B%22realm-management%22%5D%2C%20Alice's%20email_address)%0AauthServer-%3EclaimsProvider%3A9.%20Return%20Alice's%20user_claims%0A%0AclaimsProvider-%3ErqpClient%3A12.%20Return%20claims_token%5Cn(Alice's%20user_claims%2C%20audience%3A%5Baems-agent%5D)%5Cn%20if%20the%20payload%20is%20large%2C%20consider%20using%20PCT%20(see%20UMA%20specs.%20for%20details)%0ArqpClient-%3EasServer%3A13.%20Call%20token%20endpoint%5Cn(ticket%2C%20pushed_claims%3Dclaims_token%20%22audience%22%3A%5B%22aems-agent%22%5D)%0Anote%20over%20asServer%3AIn%20addition%20to%20claims_token%2C%20pushed%20claims%20may%20also%20contain%20metadata%20such%20as%3A%5Cn%E2%80%A2%20recipient_info%20(email%20address%2C%20fullname)%5Cn%E2%80%A2%20file_info%20(filename%2C%20file%20size%2C%20file%20digest%2C%20mime%20type)%0Agroup%20Authorization%20process%0Anote%20over%20asServer%3A1.%20extract%20user_claims%20from%20claims_token%5Cn2.%20select%20email_address%20claim%5Cn3.%20bootstrap%20discovery%20of%20Claims%20Provider%20config%20url%20from%20email%20address%20via%20WebFinger%3B%5Cn%20%20%20%20if%20this%20doesn't%20work%2C%20build%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn4.%20verify%20claims_token%20signature%5Cn5.%20check%20audience%3Daems-agent%5Cn6.%20extract%20ticket_challenge%20claim%20from%20claims_token%5Cn7.%20compare%20ticket_challenge%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn8.%20evaluate%20user_claims%5Cn9.%20evaluate%20other%20optional%20claims%20e.g.%20recipient_info%2C%20file_info%0Aend%0ArqpClient%3C-asServer%3A14.%20Return%20RPT%0ArqpClient-%3ErsServer%3A15.%20Post%20data%20into%20Bob's%20'Incoming'%20resource%5Cn(RPT)%0ArqpClient%3C-rsServer%3A16.%20201%20Created</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1515" height="1032"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="10.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="488.5417111511108" y="13.19381805" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA-compliant communications platform - Alice to Bob (push data) - Alice not involved</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 35.31561055361328 86.94726094949999 L 35.31561055361328 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 107.8975713540508 86.94726094949999 L 107.8975713540508 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 500.76657796550916 86.94726094949999 L 500.76657796550916 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 821.2970225652488 86.94726094949999 L 821.2970225652488 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1073.4603639702489 86.94726094949999 L 1073.4603639702489 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1277.7425210869676 86.94726094949999 L 1277.7425210869676 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1482.0246782036863 86.94726094949999 L 1482.0246782036863 966.5351309494998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="6.766060538461538,2.9319595666666665"/></g><g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 32.143922998476604 M 35.31561055361328 37.16258750749999 L 35.31561055361328 47.893559521499995 M 28.98257788961328 41.03277413549999 L 41.648643217613284 41.03277413549999 M 35.31561055361328 47.893559521499995 L 28.98257788961328 57.92086123949999 M 35.31561055361328 47.893559521499995 L 41.648643217613284 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="11.731099750390626" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="21.05467763125" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sender</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="84.3084973395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 75.02916045722657 54.4904685465 L 140.76598225087503 54.4904685465 L 140.76598225087503 86.94726094949999 L 75.02916045722657 86.94726094949999 L 75.02916045722657 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="84.57268884672658" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IAM Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="91.30688074125783" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 447.4268230745443 54.4904685465 L 554.106332856474 54.4904685465 L 554.106332856474 86.94726094949999 L 447.4268230745443 86.94726094949999 L 447.4268230745443 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="456.9703514640443" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.1758873527162" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 789.4602431381511 54.4904685465 L 853.1338019923464 54.4904685465 L 853.1338019923464 86.94726094949999 L 789.4602431381511 86.94726094949999 L 789.4602431381511 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="799.0037715276511" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="804.7063319524558" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1018.0413701876824 54.4904685465 L 1128.8793577528152 54.4904685465 L 1128.8793577528152 86.94726094949999 L 1018.0413701876824 86.94726094949999 L 1018.0413701876824 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1027.5848985771825" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1056.8697343926121" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1242.8016996066474 54.4904685465 L 1312.683342567288 54.4904685465 L 1312.683342567288 86.94726094949999 L 1242.8016996066474 86.94726094949999 L 1242.8016996066474 54.4904685465 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1252.3452279961473" y="69.3555035495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1261.1518915093309" y="78.1513822495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1487.0383290626864 32.1489366485 A 5.013650858999999 5.013650858999999 0 1 1 1487.0383265558612 32.143922998476604 M 1482.0246782036863 37.16258750749999 L 1482.0246782036863 47.893559521499995 M 1475.6916455396863 41.03277413549999 L 1488.3577108676864 41.03277413549999 M 1482.0246782036863 47.893559521499995 L 1475.6916455396863 57.92086123949999 M 1482.0246782036863 47.893559521499995 L 1488.3577108676864 57.92086123949999" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1462.3276490899168" y="66.71673993949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1464.3954972954832" y="75.51261863949999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">recipient</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1452.9175843926512" y="84.3084973395" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 40.329261412613285 1001.3228312079996 A 5.013650858999999 5.013650858999999 0 1 1 40.32925890578806 1001.3178175579761 M 35.31561055361328 1006.3364820669996 L 35.31561055361328 1017.0674540809996 M 28.98257788961328 1010.2066686949996 L 41.648643217613284 1010.2066686949996 M 35.31561055361328 1017.0674540809996 L 28.98257788961328 1027.0947557989996 M 35.31561055361328 1017.0674540809996 L 41.648643217613284 1027.0947557989996" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="11.731099750390626" y="975.3310096494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Alice (RqP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="21.05467763125" y="984.1268883494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sender</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="4.3979393500000015" y="992.9227670494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">alice@foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 75.02916045722657 966.5351309494998 L 140.76598225087503 966.5351309494998 L 140.76598225087503 998.9919233524998 L 75.02916045722657 998.9919233524998 L 75.02916045722657 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="84.57268884672658" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">IAM Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="91.30688074125783" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 447.4268230745443 966.5351309494998 L 554.106332856474 966.5351309494998 L 554.106332856474 998.9919233524998 L 447.4268230745443 998.9919233524998 L 447.4268230745443 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="456.9703514640443" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider (CP)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.1758873527162" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightpink" stroke="black" paint-order="fill stroke markers" d=" M 789.4602431381511 966.5351309494998 L 853.1338019923464 966.5351309494998 L 853.1338019923464 998.9919233524998 L 789.4602431381511 998.9919233524998 L 789.4602431381511 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="799.0037715276511" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="804.7063319524558" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1018.0413701876824 966.5351309494998 L 1128.8793577528152 966.5351309494998 L 1128.8793577528152 998.9919233524998 L 1018.0413701876824 998.9919233524998 L 1018.0413701876824 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1027.5848985771825" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1056.8697343926121" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><path fill="none" stroke="none"/><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1242.8016996066474 966.5351309494998 L 1312.683342567288 966.5351309494998 L 1312.683342567288 998.9919233524998 L 1242.8016996066474 998.9919233524998 L 1242.8016996066474 966.5351309494998 Z" stroke-miterlimit="10" stroke-width="1.407340592" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1252.3452279961473" y="981.4001659524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1261.1518915093309" y="990.1960446524998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com</text></g><g><path fill="lightsteelblue" stroke="black" paint-order="fill stroke markers" d=" M 1487.0383290626864 1001.3228312079996 A 5.013650858999999 5.013650858999999 0 1 1 1487.0383265558612 1001.3178175579761 M 1482.0246782036863 1006.3364820669996 L 1482.0246782036863 1017.0674540809996 M 1475.6916455396863 1010.2066686949996 L 1488.3577108676864 1010.2066686949996 M 1482.0246782036863 1017.0674540809996 L 1475.6916455396863 1027.0947557989996 M 1482.0246782036863 1017.0674540809996 L 1488.3577108676864 1027.0947557989996" stroke-miterlimit="10" stroke-width="1.495299379" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1462.3276490899168" y="975.3310096494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Bob (RO)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1464.3954972954832" y="984.1268883494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">recipient</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1452.9175843926512" y="992.9227670494998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bob@bar.com</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 192.2907572093373 104.5390183495 L 801.326107891681 104.5390183495 L 809.242398721681 112.45530917949999 L 809.242398721681 142.3612967595 L 192.2907572093373 142.3612967595 L 192.2907572093373 104.5390183495 M 801.326107891681 104.5390183495 L 801.326107891681 112.45530917949999 L 809.242398721681 112.45530917949999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="204.60498738933728" y="116.85324852950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Claims Provider:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="204.60498738933728" y="125.64912722950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• publishes its metadata on a URL https:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="370.6850502555482" y="125.64912722950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="375.8683693473451" y="125.64912722950001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">foo.com/.well-known/claims-provider-configuration</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="204.60498738933728" y="134.4450059295" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at Alice's IAM Server and is assigned 'query-users', 'view-users' admin roles, thus can query and view any user to get their claims</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 573.5316205102488 155.5551148095 L 1061.1461337902488 155.5551148095 L 1069.0624246202487 163.4714056395 L 1069.0624246202487 193.3773932195 L 573.5316205102488 193.3773932195 L 573.5316205102488 155.5551148095 M 1061.1461337902488 155.5551148095 L 1061.1461337902488 163.4714056395 L 1069.0624246202487 163.4714056395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="585.8458506902488" y="167.8693449895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RqP Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="585.8458506902488" y="176.6652236895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at foo.com IAM Server and pre-registered as a universal AEMS public client at bar.com UMA Server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="585.8458506902488" y="185.4611023895" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is an agent that can act on behalf of any user registered at foo.com IAM Server</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 909.1198734142723 206.5712112695 L 1229.8845636962255 206.5712112695 L 1237.8008545262255 214.4875020995 L 1237.8008545262255 235.5976109795 L 909.1198734142723 235.5976109795 L 909.1198734142723 206.5712112695 M 1229.8845636962255 206.5712112695 L 1229.8845636962255 214.4875020995 L 1237.8008545262255 214.4875020995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="921.4341035942723" y="218.88544144949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">bar.com admin has set up the Resource Server and registers it's resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="921.4341035942723" y="227.68132014949998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">'Incoming' at the bar.com UMA Server with the associated scope 'create'</text></g><g><g><rect fill="white" stroke="none" x="305.3863640757201" y="248.7914290295" width="245.8399049674219" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="306.7057458807201" y="256.7077198595" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Initiate the request asynchronously via the message queue</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 35.31561055361328 260.2260713395 L 814.0550824355821 260.2260713395" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray="3.5183514799999998"/><g transform="translate(821.2970225652488,260.2260713395) translate(-821.2970225652488,-260.2260713395)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 813.9671236485821 256.5611218811666 L 821.2970225652488 260.2260713395 L 813.9671236485821 263.89102079783333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="869.2410970462448" y="273.41988938949993" width="156.27519244300782" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="869.2410970462448" y="282.21576808949993" width="65.1163026725" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="870.5604788512449" y="281.3361802194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="870.5604788512449" y="290.1320589194999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(scope=create)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 821.2970225652488 293.65041039949995 L 1066.218423840582 293.65041039949995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1073.4603639702489,293.65041039949995) translate(-1073.4603639702489,-293.65041039949995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1066.1304650535822 289.9854609411666 L 1073.4603639702489 293.65041039949995 L 1066.1304650535822 297.3153598578333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="887.4737706912643" y="306.84422844949995" width="119.80984515296875" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="888.7931524962644" y="314.76051927949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. 401 with permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1073.4603639702489 318.27887075949997 L 828.5389626949154 318.27887075949997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(821.2970225652488,318.27887075949997) translate(-821.2970225652488,-318.27887075949997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 828.6269214819155 314.6139213011666 L 821.2970225652488 318.27887075949997 L 828.6269214819155 321.9438202178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="349.9897986995717" y="331.47268880949997" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="349.9897986995717" y="340.2685675095" width="229.21499652015626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="351.30918050457166" y="339.38897963949995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="351.30918050457166" y="348.18485833949995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=claims-provider)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 821.2970225652488 351.7032098195 L 115.13951148371746 351.7032098195" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(107.8975713540508,351.7032098195) translate(-107.8975713540508,-351.7032098195)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 115.22747027071746 348.03826036116664 L 107.8975713540508 351.7032098195 L 115.22747027071746 355.36815927783334 Z"/></g></g><g><g><rect fill="white" stroke="none" x="351.92099681968887" y="364.8970278695" width="225.3526002799219" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="353.24037862468884" y="372.8133186995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return access_token "audience":["claims-provider"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 107.8975713540508 376.3316701795 L 814.0550824355821 376.3316701795" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(821.2970225652488,376.3316701795) translate(-821.2970225652488,-376.3316701795)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 813.9671236485821 372.66672072116666 L 821.2970225652488 376.3316701795 L 813.9671236485821 379.99661963783336 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 690.2995724755808 389.5254882295 L 944.3781818249167 389.5254882295 L 952.2944726549167 397.4417790595 L 952.2944726549167 418.55188793950003 L 690.2995724755808 418.55188793950003 L 690.2995724755808 389.5254882295 M 944.3781818249167 389.5254882295 L 944.3781818249167 397.4417790595 L 952.2944726549167 397.4417790595" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="702.6138026555808" y="401.83971840950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• ticket_challenge = Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="702.6138026555808" y="410.63559710950005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• the email_address is specified by RqP Client</text></g><g><g><rect fill="white" stroke="none" x="518.4353188510039" y="431.7457059895" width="85.07527178871094" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="518.4353188510039" y="440.5415846895" width="285.19296282875" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="518.4353188510039" y="449.3374633895" width="160.01463336097657" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="519.7547006560039" y="439.66199681949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Get claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="519.7547006560039" y="448.45787551949996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["claims-provider"], Alice's email_address,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="519.7547006560039" y="457.25375421949997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> ticket_challenge, scope=aems-agent)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 821.2970225652488 460.7721056995 L 508.0085180951758 460.7721056995" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(500.76657796550916,460.7721056995) translate(-500.76657796550916,-460.7721056995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 508.0964768821758 457.10715624116665 L 500.76657796550916 460.7721056995 L 508.0964768821758 464.43705515783336 Z"/></g></g><g><g><rect fill="white" stroke="none" x="118.3060278157175" y="473.96592374949995" width="87.67602557289062" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="118.3060278157175" y="482.76180244949995" width="372.052093688125" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="119.6254096207175" y="481.88221457949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Get access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="119.6254096207175" y="490.67809327949993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(grant_type=client_credentials, scope=realm-management, role=query-users, view-users)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 500.76657796550916 494.19644475949997 L 115.13951148371746 494.19644475949997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(107.8975713540508,494.19644475949997) translate(-107.8975713540508,-494.19644475949997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 115.22747027071746 490.5314953011666 L 107.8975713540508 494.19644475949997 L 115.22747027071746 497.8613942178333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="182.8354925373972" y="507.3902628094999" width="242.99316424476564" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="184.1548743423972" y="515.3065536394998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Return access_token "audience":["realm-management"]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 107.8975713540508 518.8249051194999 L 493.5246378358425 518.8249051194999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(500.76657796550916,518.8249051194999) translate(-500.76657796550916,-518.8249051194999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 493.4366790488425 515.1599556611666 L 500.76657796550916 518.8249051194999 L 493.4366790488425 522.4898545778333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="152.65798704423312" y="532.0187231694999" width="142.66552752601564" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="152.65798704423312" y="540.8146018694999" width="303.34817523109376" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="153.97736884923313" y="539.9350139994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Query/View Alice's user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="153.97736884923313" y="548.7308926994999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(access_token "audience":["realm-management"], Alice's email_address)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 500.76657796550916 552.2492441794999 L 115.13951148371746 552.2492441794999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(107.8975713540508,552.2492441794999) translate(-107.8975713540508,-552.2492441794999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 115.22747027071746 548.5842947211665 L 107.8975713540508 552.2492441794999 L 115.22747027071746 555.9141936378333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="243.02202360429172" y="565.4430622294999" width="122.62010211097656" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="244.34140540929172" y="573.3593530594999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Return Alice's user_claims</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 107.8975713540508 576.8777045394999 L 493.5246378358425 576.8777045394999" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(500.76657796550916,576.8777045394999) translate(-500.76657796550916,-576.8777045394999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 493.4366790488425 573.2127550811665 L 500.76657796550916 576.8777045394999 L 493.4366790488425 580.5426539978332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="511.17503442717583" y="590.0715225894999" width="103.22596758949219" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="511.17503442717583" y="598.8674012894999" width="187.95349139320314" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="511.17503442717583" y="607.6632799894999" width="299.71353167640626" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.4944162321758" y="597.9878134194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">12. Return claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.4944162321758" y="606.7836921194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(Alice's user_claims, audience:[aems-agent])</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="512.4944162321758" y="615.5795708194998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> if the payload is large, consider using PCT (see UMA specs. for details)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 500.76657796550916 619.0979222994998 L 814.0550824355821 619.0979222994998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(821.2970225652488,619.0979222994998) translate(-821.2970225652488,-619.0979222994998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 813.9671236485821 615.4329728411665 L 821.2970225652488 619.0979222994998 L 813.9671236485821 622.7628717578332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="915.1947290103659" y="632.2917403494998" width="98.06091326820312" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="915.1947290103659" y="641.0876190494998" width="268.6500856314844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="916.5141108153659" y="640.2080311794998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">13. Call token endpoint</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="916.5141108153659" y="649.0039098794998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(ticket, pushed_claims=claims_token "audience":["aems-agent"])</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 821.2970225652488 652.5222613594998 L 1270.5005809573008 652.5222613594998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1277.7425210869676,652.5222613594998) translate(-1277.7425210869676,-652.5222613594998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1270.412622170301 648.8573119011664 L 1277.7425210869676 652.5222613594998 L 1270.412622170301 656.1872108178331 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1102.0970225964206 665.7160794094998 L 1445.4717287475144 665.7160794094998 L 1453.3880195775143 673.6323702394998 L 1453.3880195775143 703.5383578194998 L 1102.0970225964206 703.5383578194998 L 1102.0970225964206 665.7160794094998 M 1445.4717287475144 665.7160794094998 L 1445.4717287475144 673.6323702394998 L 1453.3880195775143 673.6323702394998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1114.4112527764207" y="678.0303095894997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">In addition to claims_token, pushed claims may also contain metadata such as:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1114.4112527764207" y="686.8261882894997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• recipient_info (email address, fullname)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1114.4112527764207" y="695.6220669894997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• file_info (filename, file size, file digest, mime type)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1086.6541820202488 740.4810483594998 L 1460.9145693236862 740.4810483594998 L 1468.8308601536862 748.3973391894998 L 1468.8308601536862 839.8744776694998 L 1086.6541820202488 839.8744776694998 L 1086.6541820202488 740.4810483594998 M 1460.9145693236862 740.4810483594998 L 1460.9145693236862 748.3973391894998 L 1468.8308601536862 748.3973391894998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="752.7952785394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="761.5911572394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="770.3870359394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. bootstrap discovery of Claims Provider config url from email address via WebFinger;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="779.1829146394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    if this doesn't work, build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="787.9787933394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="796.7746720394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. check audience=aems-agent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="805.5705507394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. extract ticket_challenge claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="814.3664294394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. compare ticket_challenge vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="823.1623081394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. evaluate user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1098.9684122002488" y="831.9581868394997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate other optional claims e.g. recipient_info, file_info</text></g><g><g><rect fill="white" stroke="none" x="1015.7978631656393" y="866.2621137694998" width="67.4438173209375" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1017.1172449706394" y="874.1784045994998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">14. Return RPT</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1277.7425210869676 877.6967560794998 L 828.5389626949154 877.6967560794998" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(821.2970225652488,877.6967560794998) translate(-821.2970225652488,-877.6967560794998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 828.6269214819155 874.0318066211664 L 821.2970225652488 877.6967560794998 L 828.6269214819155 881.3617055378331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="855.49711663853" y="890.8905741294998" width="183.7631532584375" height="11.43464231"/></g><g><rect fill="white" stroke="none" x="855.49711663853" y="899.6864528294998" width="27.507705870742186" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.81649844353" y="898.8068649594998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">15. Post data into Bob's 'Incoming' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="856.81649844353" y="907.6027436594998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(RPT)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 821.2970225652488 911.1210951394997 L 1066.218423840582 911.1210951394997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(1073.4603639702489,911.1210951394997) translate(-1073.4603639702489,-911.1210951394997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1066.1304650535822 907.4561456811664 L 1073.4603639702489 911.1210951394997 L 1066.1304650535822 914.7860445978331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="912.6091848147995" y="924.3149131894997" width="69.53901690589844" height="11.43464231"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="7pt" font-style="normal" font-weight="normal" text-decoration="normal" x="913.9285666197995" y="932.2312040194997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">16. 201 Created</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1073.4603639702489 935.7495554994997 L 828.5389626949154 935.7495554994997" stroke-miterlimit="10" stroke-width="0.7329898916666666" stroke-dasharray=""/><g transform="translate(821.2970225652488,935.7495554994997) translate(-821.2970225652488,-935.7495554994997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 828.6269214819155 932.0846060411664 L 821.2970225652488 935.7495554994997 L 828.6269214819155 939.4145049578331 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1082.2562426702489 716.7321758694998 L 1473.2287995036863 716.7321758694998 L 1473.2287995036863 853.0682957194998 L 1082.2562426702489 853.0682957194998 L 1082.2562426702489 716.7321758694998 Z" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1082.2562426702489 716.7321758694998 L 1082.2562426702489 727.2872303094998 L 1178.5280995575536 727.2872303094998 L 1183.8056267775535 722.0097030894998 L 1183.8056267775535 716.7321758694998 L 1082.2562426702489 716.7321758694998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="5.6000000000000005pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1091.0521213702489" y="723.7688788294998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization process</text></g></g></g></svg>